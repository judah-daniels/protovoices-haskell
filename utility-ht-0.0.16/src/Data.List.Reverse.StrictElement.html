<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- |
The functions in this module process the list formally from the end.
Actually they traverse the list from the start and check every element.
This way they are strict in the elements and lazy in the list spline.
Thus you can apply them to infinite lists.
Use these functions if the list is long or the test is cheap.
-}</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.List.Reverse.StrictElement</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Tuple.HT.html"><span class="hs-identifier">Data.Tuple.HT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Tuple.Lazy.html#mapFst"><span class="hs-identifier">mapFst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Tuple.Lazy.html#mapSnd"><span class="hs-identifier">mapSnd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Tuple.Lazy.html#forcePair"><span class="hs-identifier">forcePair</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">dropWhile</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">takeWhile</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">span</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-comment">-- $setup</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- &gt;&gt;&gt; import Test.Utility (forAllPredicates, defined)</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Data.List.Reverse.StrictElement as Rev</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Data.List.Match as Match</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Data.List as List</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Tuple.HT (mapPair, swap)</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- &gt;&gt;&gt;</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- &gt;&gt;&gt; _suppressUnusedImportWarning :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- &gt;&gt;&gt; _suppressUnusedImportWarning = Data.List.Reverse.StrictElement.dropWhile</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-comment">{- |
Remove the longest suffix of elements satisfying p.
In contrast to @reverse . dropWhile p . reverse@
this works for infinite lists, too.

prop&gt; forAllPredicates $ \p xs -&gt; Rev.dropWhile p xs == reverse (List.dropWhile p (reverse xs))
prop&gt; \x xs pad -&gt; defined $ Match.take (pad::[()]) $ Rev.dropWhile ((x::Char)/=) $ cycle $ x:xs
-}</span><span>
</span><span id="line-34"></span><span id="local-6989586621679043143"><span class="annot"><a href="Data.List.Reverse.StrictElement.html#dropWhile"><span class="hs-identifier hs-type">dropWhile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679043143"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679043143"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679043143"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-35"></span><span id="dropWhile"><span class="annot"><span class="annottext">dropWhile :: forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="Data.List.Reverse.StrictElement.html#dropWhile"><span class="hs-identifier hs-var hs-var">dropWhile</span></a></span></span><span> </span><span id="local-6989586621679043106"><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679043106"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-36"></span><span>   </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679043104"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679043104"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679043103"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679043103"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679043106"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679043104"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679043103"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679043104"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679043103"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-comment">{- |
Alternative version of @reverse . takeWhile p . reverse@.

prop&gt; forAllPredicates $ \p xs -&gt; Rev.takeWhile p xs == reverse (List.takeWhile p (reverse xs))
-}</span><span>
</span><span id="line-43"></span><span id="local-6989586621679043100"><span class="annot"><a href="Data.List.Reverse.StrictElement.html#takeWhile"><span class="hs-identifier hs-type">takeWhile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679043100"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679043100"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679043100"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-44"></span><span id="takeWhile"><span class="annot"><span class="annottext">takeWhile :: forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="Data.List.Reverse.StrictElement.html#takeWhile"><span class="hs-identifier hs-var hs-var">takeWhile</span></a></span></span><span> </span><span id="local-6989586621679043097"><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679043097"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-45"></span><span>   </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-46"></span><span>   </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span>
</span><span id="line-47"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679043095"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679043095"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679043094"><span class="annot"><span class="annottext">(Bool, [a])
</span><a href="#local-6989586621679043094"><span class="hs-identifier hs-var">xys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-48"></span><span>         </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679043097"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679043095"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Bool, [a])
</span><a href="#local-6989586621679043094"><span class="hs-identifier hs-var">xys</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a, b) -&gt; (a, c)
</span><a href="Data.Tuple.Lazy.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679043095"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a c b. (a -&gt; c) -&gt; (a, b) -&gt; (c, b)
</span><a href="Data.Tuple.Lazy.html#mapFst"><span class="hs-identifier hs-var">mapFst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool, [a])
</span><a href="#local-6989586621679043094"><span class="hs-identifier hs-var">xys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">{- |
prop&gt; forAllPredicates $ \p xs -&gt; Rev.span p xs == swap (mapPair (reverse, reverse) (List.span p (reverse xs)))
prop&gt; forAllPredicates $ \p xs -&gt; Rev.span p xs == (Rev.dropWhile p xs, Rev.takeWhile p xs)
prop&gt; \x xs pad -&gt; defined $ Match.take (pad::[()]) $ fst $ Rev.span ((x::Char)/=) $ cycle $ x:xs
-}</span><span>
</span><span id="line-56"></span><span id="local-6989586621679043120"><span class="annot"><a href="Data.List.Reverse.StrictElement.html#span"><span class="hs-identifier hs-type">span</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679043120"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679043120"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679043120"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679043120"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-57"></span><span id="span"><span class="annot"><span class="annottext">span :: forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="Data.List.Reverse.StrictElement.html#span"><span class="hs-identifier hs-var hs-var">span</span></a></span></span><span> </span><span id="local-6989586621679043089"><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679043089"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-58"></span><span>   </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; (a, b)
</span><a href="Data.Tuple.Lazy.html#forcePair"><span class="hs-identifier hs-var">forcePair</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-59"></span><span>   </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span>
</span><span id="line-60"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679043088"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679043088"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679043087"><span class="annot"><span class="annottext">([a], [a])
</span><a href="#local-6989586621679043087"><span class="hs-identifier hs-var">xys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-61"></span><span>         </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679043089"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679043088"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([a], [a])
</span><a href="#local-6989586621679043087"><span class="hs-identifier hs-var">xys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a, b) -&gt; (a, c)
</span><a href="Data.Tuple.Lazy.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a c b. (a -&gt; c) -&gt; (a, b) -&gt; (c, b)
</span><a href="Data.Tuple.Lazy.html#mapFst"><span class="hs-identifier hs-var">mapFst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679043088"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([a], [a])
</span><a href="#local-6989586621679043087"><span class="hs-identifier hs-var">xys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span></pre></body></html>