<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE RankNTypes, TypeFamilies, FlexibleContexts, FlexibleInstances,
      MultiParamTypeClasses, UndecidableInstances, ScopedTypeVariables,
      GeneralizedNewtypeDeriving, Trustworthy #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">{-| This module provides an orphan 'MonadMask' instance for 'Proxy' of the
    form:

&gt; instance (MonadMask m, MonadIO m) =&gt; MonadMask (Proxy a' a b' b m) where

    Which is needed to implement the instance for MonadSafe for Proxy.

    This module also provides generalized versions of some 'MonadCatch'
    operations so that you can also protect against premature termination of
    connected components.  For example, if you protect a 'readFile' computation
    using 'bracket' from this module:

&gt; -- readFile.hs
&gt; import Pipes
&gt; import qualified Pipes.Prelude as P
&gt; import Pipes.Safe
&gt; import qualified System.IO as IO
&gt; import Prelude hiding (readFile)
&gt;
&gt; readFile :: FilePath -&gt; Producer' String (SafeT IO) ()
&gt; readFile file = bracket
&gt;     (do h &lt;- IO.openFile file IO.ReadMode
&gt;         putStrLn $ &quot;{&quot; ++ file ++ &quot; open}&quot;
&gt;         return h )
&gt;     (\h -&gt; do
&gt;         IO.hClose h
&gt;         putStrLn $ &quot;{&quot; ++ file ++ &quot; closed}&quot; )
&gt;     P.fromHandle

    ... then this generalized 'bracket' will guard against both exceptions and
    premature termination of other pipes:

&gt;&gt;&gt; runSafeT $ runEffect $ readFile &quot;readFile.hs&quot; &gt;-&gt; P.take 4 &gt;-&gt; P.stdoutLn
{readFile.hs open}
-- readFile.hs
import Pipes
import qualified Pipes.Prelude as P
import Pipes.Safe
{readFile.hs closed}

    Note that the 'MonadCatch' instance for 'Proxy' provides weaker versions of
    'mask' and 'uninterruptibleMask' that do not completely prevent asynchronous
    exceptions.  Instead, they provide a weaker guarantee that asynchronous
    exceptions will only occur during 'Pipes.await's or 'Pipes.yield's and
    nowhere else.  For example, if you write:

&gt; mask_ $ do
&gt;     x &lt;- await
&gt;     lift $ print x
&gt;     lift $ print x

    ... then you may receive an asynchronous exception during the 'Pipes.await',
    but you will not receive an asynchronous exception during or in between the
    two 'print' statements.  This weaker guarantee suffices to provide
    asynchronous exception safety.
-}</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Pipes.Safe</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * SafeT</span></span><span>
</span><span id="line-65"></span><span>      </span><span class="annot"><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier">SafeT</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Safe.html#runSafeT"><span class="hs-identifier">runSafeT</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Safe.html#runSafeP"><span class="hs-identifier">runSafeP</span></a></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span>     </span><span class="annot"><span class="hs-comment">-- * MonadSafe</span></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Safe.html#ReleaseKey"><span class="hs-identifier">ReleaseKey</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier">MonadSafe</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>      </span><span class="annot"><span class="hs-comment">-- * Utilities</span></span><span>
</span><span id="line-74"></span><span>      </span><span class="annot"><span class="hs-comment">-- $utilities</span></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Safe.html#onException"><span class="hs-identifier">onException</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Safe.html#tryP"><span class="hs-identifier">tryP</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Safe.html#catchP"><span class="hs-identifier">catchP</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Safe.html#finally"><span class="hs-identifier">finally</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Safe.html#bracket"><span class="hs-identifier">bracket</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Safe.html#bracket_"><span class="hs-identifier">bracket_</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Safe.html#bracketOnError"><span class="hs-identifier">bracketOnError</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Re-exports</span></span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><span class="hs-comment">-- $reexports</span></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch</span></span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Alternative</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Exception</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SomeException</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch</span></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadCatch</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MonadThrow</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MonadMask</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ExitCase</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mask_</span></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">uninterruptibleMask_</span></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">catchAll</span></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">catchIOError</span></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">catchJust</span></span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">catchIf</span></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Handler</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">catches</span></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">handle</span></span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">handleAll</span></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">handleIOError</span></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">handleJust</span></span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">handleIf</span></span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tryJust</span></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Exception</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SomeException</span></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadPlus</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">liftM</span></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Fix</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadFix</span></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">liftIO</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Control</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadBaseControl</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadTrans</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Base</span></span><span>                </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch.Pure</span></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Identity</span></span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Cont.Class</span></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CC</span></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Error.Class</span></span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EC</span></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Primitive</span></span><span>           </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Prim</span></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Reader</span></span><span>        </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.RWS.Lazy</span></span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RWS</span></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.RWS.Strict</span></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RWS'</span></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.State.Lazy</span></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.State.Strict</span></span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S'</span></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State.Class</span></span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SC</span></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Writer.Lazy</span></span><span>   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Writer.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W'</span></span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer.Class</span></span><span>        </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WC</span></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IORef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">newIORef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readIORef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">writeIORef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">atomicModifyIORef'</span></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Pipes</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Effect</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Effect'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runEffect</span></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Pipes.Internal</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-keyword">data</span><span> </span><span id="Restore"><span class="annot"><a href="Pipes.Safe.html#Restore"><span class="hs-identifier hs-var">Restore</span></a></span></span><span> </span><span id="local-6989586621679058385"><span class="annot"><a href="#local-6989586621679058385"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Unmasked"><span class="annot"><a href="Pipes.Safe.html#Unmasked"><span class="hs-identifier hs-var">Unmasked</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Masked"><span class="annot"><a href="Pipes.Safe.html#Masked"><span class="hs-identifier hs-var">Masked</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679058374"><span class="annot"><a href="#local-6989586621679058374"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679058385"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058374"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058385"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058374"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="annot"><a href="Pipes.Safe.html#liftMask"><span class="hs-identifier hs-type">liftMask</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679058423"><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679058418"><span class="annot"><a href="#local-6989586621679058418"><span class="hs-identifier hs-type">a'</span></a></span></span><span> </span><span id="local-6989586621679058417"><span class="annot"><a href="#local-6989586621679058417"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679058416"><span class="annot"><a href="#local-6989586621679058416"><span class="hs-identifier hs-type">b'</span></a></span></span><span> </span><span id="local-6989586621679058415"><span class="annot"><a href="#local-6989586621679058415"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621679058412"><span class="annot"><a href="#local-6989586621679058412"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679058419"><span class="annot"><a href="#local-6989586621679058419"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679058420"><span class="annot"><a href="#local-6989586621679058420"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058420"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058420"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058419"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058419"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679058414"><span class="annot"><a href="#local-6989586621679058414"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679058418"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058417"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058416"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058415"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058414"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679058418"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058417"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058416"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058415"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058414"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679058418"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058417"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058416"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058415"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058412"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679058418"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058417"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058416"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058415"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058412"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-148"></span><span id="liftMask"><span class="annot"><span class="annottext">liftMask :: forall (m :: * -&gt; *) a' a b' b r.
(MonadIO m, MonadCatch m) =&gt;
(forall s. ((forall x. m x -&gt; m x) -&gt; m s) -&gt; m s)
-&gt; ((forall x. Proxy a' a b' b m x -&gt; Proxy a' a b' b m x)
    -&gt; Proxy a' a b' b m r)
-&gt; Proxy a' a b' b m r
</span><a href="Pipes.Safe.html#liftMask"><span class="hs-identifier hs-var hs-var">liftMask</span></a></span></span><span> </span><span id="local-6989586621679057807"><span class="annot"><span class="annottext">forall s. ((forall x. m x -&gt; m x) -&gt; m s) -&gt; m s
</span><a href="#local-6989586621679057807"><span class="hs-identifier hs-var">maskVariant</span></a></span></span><span> </span><span id="local-6989586621679057806"><span class="annot"><span class="annottext">(forall x. Proxy a' a b' b m x -&gt; Proxy a' a b' b m x)
-&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679057806"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-149"></span><span>    </span><span id="local-6989586621679057805"><span class="annot"><span class="annottext">IORef (Restore m)
</span><a href="#local-6989586621679057805"><span class="hs-identifier hs-var">ioref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Restore m
</span><a href="Pipes.Safe.html#Unmasked"><span class="hs-identifier hs-var">Unmasked</span></a></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- mask adjacent actions in base monad</span><span>
</span><span id="line-152"></span><span>        </span><span class="annot"><a href="#local-6989586621679057804"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679058418"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058417"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058416"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058415"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058412"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679058418"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058417"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058416"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058415"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058412"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-153"></span><span>        </span><span id="local-6989586621679057804"><span class="annot"><span class="annottext">loop :: Proxy a' a b' b m r -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679057804"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span> </span><span id="local-6989586621679057802"><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679057802"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span id="local-6989586621679057801"><span class="annot"><span class="annottext">a -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679057801"><span class="hs-identifier hs-var">fa</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r.
a' -&gt; (a -&gt; Proxy a' a b' b m r) -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">Request</span></span><span> </span><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679057802"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy a' a b' b m r -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679057804"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679057801"><span class="hs-identifier hs-var">fa</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>        </span><span class="annot"><a href="#local-6989586621679057804"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Respond</span></span><span> </span><span id="local-6989586621679057798"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679057798"><span class="hs-identifier hs-var">b</span></a></span></span><span>  </span><span id="local-6989586621679057797"><span class="annot"><span class="annottext">b' -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679057797"><span class="hs-identifier hs-var">fb'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r.
b -&gt; (b' -&gt; Proxy a' a b' b m r) -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">Respond</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679057798"><span class="hs-identifier hs-var">b</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy a' a b' b m r -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679057804"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b' -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679057797"><span class="hs-identifier hs-var">fb'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>        </span><span class="annot"><a href="#local-6989586621679057804"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">M</span></span><span> </span><span id="local-6989586621679057795"><span class="annot"><span class="annottext">m (Proxy a' a b' b m r)
</span><a href="#local-6989586621679057795"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r.
m (Proxy a' a b' b m r) -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">M</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. ((forall x. m x -&gt; m x) -&gt; m s) -&gt; m s
</span><a href="#local-6989586621679057807"><span class="hs-identifier hs-var">maskVariant</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057794"><span class="annot"><span class="annottext">forall x. m x -&gt; m x
</span><a href="#local-6989586621679057794"><span class="hs-identifier hs-var">unmaskVariant</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-156"></span><span>            </span><span class="hs-comment">-- stash base's unmask and merge action</span><span>
</span><span id="line-157"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. IORef a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (Restore m)
</span><a href="#local-6989586621679057805"><span class="hs-identifier hs-var">ioref</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). (forall x. m x -&gt; m x) -&gt; Restore m
</span><a href="Pipes.Safe.html#Masked"><span class="hs-identifier hs-var">Masked</span></a></span><span> </span><span class="annot"><span class="annottext">forall x. m x -&gt; m x
</span><a href="#local-6989586621679057794"><span class="hs-identifier hs-var">unmaskVariant</span></a></span><span>
</span><span id="line-158"></span><span>            </span><span class="annot"><span class="annottext">m (Proxy a' a b' b m r)
</span><a href="#local-6989586621679057795"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall s. Proxy a' a b' b m s -&gt; m (Proxy a' a b' b m s)
</span><a href="#local-6989586621679057793"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Proxy a' a b' b m r -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679057804"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-159"></span><span>        </span><span class="annot"><a href="#local-6989586621679057804"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pure</span></span><span> </span><span id="local-6989586621679057791"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679057791"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r. r -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">Pure</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679057791"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>        </span><span class="hs-comment">-- unmask adjacent actions in base monad</span><span>
</span><span id="line-162"></span><span>        </span><span class="annot"><a href="#local-6989586621679057790"><span class="hs-identifier hs-type">unmask</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679057789"><span class="annot"><a href="#local-6989586621679057789"><span class="hs-identifier hs-type">q</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679058418"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058417"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058416"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058415"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057789"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679058418"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058417"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058416"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058415"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057789"><span class="hs-identifier hs-type">q</span></a></span><span>
</span><span id="line-163"></span><span>        </span><span id="local-6989586621679057790"><span class="annot"><span class="annottext">unmask :: forall x. Proxy a' a b' b m x -&gt; Proxy a' a b' b m x
</span><a href="#local-6989586621679057790"><span class="hs-identifier hs-var hs-var">unmask</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span> </span><span id="local-6989586621679057778"><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679057778"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span id="local-6989586621679057777"><span class="annot"><span class="annottext">a -&gt; Proxy a' a b' b m q
</span><a href="#local-6989586621679057777"><span class="hs-identifier hs-var">fa</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r.
a' -&gt; (a -&gt; Proxy a' a b' b m r) -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">Request</span></span><span> </span><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679057778"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall x. Proxy a' a b' b m x -&gt; Proxy a' a b' b m x
</span><a href="#local-6989586621679057790"><span class="hs-identifier hs-var">unmask</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Proxy a' a b' b m q
</span><a href="#local-6989586621679057777"><span class="hs-identifier hs-var">fa</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>        </span><span class="annot"><a href="#local-6989586621679057790"><span class="hs-identifier hs-var">unmask</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Respond</span></span><span> </span><span id="local-6989586621679057776"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679057776"><span class="hs-identifier hs-var">b</span></a></span></span><span>  </span><span id="local-6989586621679057775"><span class="annot"><span class="annottext">b' -&gt; Proxy a' a b' b m q
</span><a href="#local-6989586621679057775"><span class="hs-identifier hs-var">fb'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r.
b -&gt; (b' -&gt; Proxy a' a b' b m r) -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">Respond</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679057776"><span class="hs-identifier hs-var">b</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall x. Proxy a' a b' b m x -&gt; Proxy a' a b' b m x
</span><a href="#local-6989586621679057790"><span class="hs-identifier hs-var">unmask</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b' -&gt; Proxy a' a b' b m q
</span><a href="#local-6989586621679057775"><span class="hs-identifier hs-var">fb'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>        </span><span class="annot"><a href="#local-6989586621679057790"><span class="hs-identifier hs-var">unmask</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">M</span></span><span> </span><span id="local-6989586621679057774"><span class="annot"><span class="annottext">m (Proxy a' a b' b m q)
</span><a href="#local-6989586621679057774"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r.
m (Proxy a' a b' b m r) -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">M</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-166"></span><span>            </span><span class="hs-comment">-- retrieve base's unmask and apply to merged action</span><span>
</span><span id="line-167"></span><span>            </span><span id="local-6989586621679057773"><span class="annot"><span class="annottext">m (Proxy a' a b' b m q) -&gt; m (Proxy a' a b' b m q)
</span><a href="#local-6989586621679057773"><span class="hs-identifier hs-var">unmaskVariant</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-168"></span><span>                </span><span class="annot"><a href="Pipes.Safe.html#Masked"><span class="hs-identifier hs-type">Masked</span></a></span><span> </span><span id="local-6989586621679057772"><span class="annot"><span class="annottext">forall x. m x -&gt; m x
</span><a href="#local-6989586621679057772"><span class="hs-identifier hs-var">unmaskVariant</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (Restore m)
</span><a href="#local-6989586621679057805"><span class="hs-identifier hs-var">ioref</span></a></span><span>
</span><span id="line-169"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall x. m x -&gt; m x
</span><a href="#local-6989586621679057772"><span class="hs-identifier hs-var">unmaskVariant</span></a></span><span>
</span><span id="line-170"></span><span>            </span><span class="annot"><span class="annottext">m (Proxy a' a b' b m q) -&gt; m (Proxy a' a b' b m q)
</span><a href="#local-6989586621679057773"><span class="hs-identifier hs-var">unmaskVariant</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Proxy a' a b' b m q)
</span><a href="#local-6989586621679057774"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall s. Proxy a' a b' b m s -&gt; m (Proxy a' a b' b m s)
</span><a href="#local-6989586621679057793"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall x. Proxy a' a b' b m x -&gt; Proxy a' a b' b m x
</span><a href="#local-6989586621679057790"><span class="hs-identifier hs-var">unmask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>        </span><span class="annot"><a href="#local-6989586621679057790"><span class="hs-identifier hs-var">unmask</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pure</span></span><span> </span><span id="local-6989586621679057771"><span class="annot"><span class="annottext">q
</span><a href="#local-6989586621679057771"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r. r -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">Pure</span></span><span> </span><span class="annot"><span class="annottext">q
</span><a href="#local-6989586621679057771"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span>        </span><span class="hs-comment">-- merge adjacent actions in base monad</span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><a href="#local-6989586621679057793"><span class="hs-identifier hs-type">chunk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679058371"><span class="annot"><a href="#local-6989586621679058371"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679058418"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058417"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058416"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058415"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058371"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679058418"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058417"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058416"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058415"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058371"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>        </span><span id="local-6989586621679057793"><span class="annot"><span class="annottext">chunk :: forall s. Proxy a' a b' b m s -&gt; m (Proxy a' a b' b m s)
</span><a href="#local-6989586621679057793"><span class="hs-identifier hs-var hs-var">chunk</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">M</span></span><span> </span><span id="local-6989586621679057768"><span class="annot"><span class="annottext">m (Proxy a' a b' b m s)
</span><a href="#local-6989586621679057768"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Proxy a' a b' b m s)
</span><a href="#local-6989586621679057768"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall s. Proxy a' a b' b m s -&gt; m (Proxy a' a b' b m s)
</span><a href="#local-6989586621679057793"><span class="hs-identifier hs-var">chunk</span></a></span><span>
</span><span id="line-176"></span><span>        </span><span class="annot"><a href="#local-6989586621679057793"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span id="local-6989586621679057767"><span class="annot"><span class="annottext">Proxy a' a b' b m s
</span><a href="#local-6989586621679057767"><span class="hs-identifier hs-var">s</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Proxy a' a b' b m s
</span><a href="#local-6989586621679057767"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="annottext">Proxy a' a b' b m r -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679057804"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(forall x. Proxy a' a b' b m x -&gt; Proxy a' a b' b m x)
-&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679057806"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">forall x. Proxy a' a b' b m x -&gt; Proxy a' a b' b m x
</span><a href="#local-6989586621679057790"><span class="hs-identifier hs-var">unmask</span></a></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679058339"><span id="local-6989586621679058340"><span id="local-6989586621679058341"><span id="local-6989586621679058342"><span id="local-6989586621679058343"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679058343"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679058343"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679058342"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058341"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058340"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058339"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058343"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621679057746"><span class="annot"><span class="annottext">mask :: forall b.
((forall a. Proxy a' a b' b m a -&gt; Proxy a' a b' b m a)
 -&gt; Proxy a' a b' b m b)
-&gt; Proxy a' a b' b m b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mask</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a' a b' b r.
(MonadIO m, MonadCatch m) =&gt;
(forall s. ((forall x. m x -&gt; m x) -&gt; m s) -&gt; m s)
-&gt; ((forall x. Proxy a' a b' b m x -&gt; Proxy a' a b' b m x)
    -&gt; Proxy a' a b' b m r)
-&gt; Proxy a' a b' b m r
</span><a href="Pipes.Safe.html#liftMask"><span class="hs-identifier hs-var">liftMask</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b.
MonadMask m =&gt;
((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">mask</span></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621679057741"><span class="annot"><span class="annottext">uninterruptibleMask :: forall b.
((forall a. Proxy a' a b' b m a -&gt; Proxy a' a b' b m a)
 -&gt; Proxy a' a b' b m b)
-&gt; Proxy a' a b' b m b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">uninterruptibleMask</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a' a b' b r.
(MonadIO m, MonadCatch m) =&gt;
(forall s. ((forall x. m x -&gt; m x) -&gt; m s) -&gt; m s)
-&gt; ((forall x. Proxy a' a b' b m x -&gt; Proxy a' a b' b m x)
    -&gt; Proxy a' a b' b m r)
-&gt; Proxy a' a b' b m r
</span><a href="Pipes.Safe.html#liftMask"><span class="hs-identifier hs-var">liftMask</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b.
MonadMask m =&gt;
((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">uninterruptibleMask</span></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621679057724"><span class="annot"><span class="annottext">generalBracket :: forall a b c.
Proxy a' a b' b m a
-&gt; (a -&gt; ExitCase b -&gt; Proxy a' a b' b m c)
-&gt; (a -&gt; Proxy a' a b' b m b)
-&gt; Proxy a' a b' b m (b, c)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">generalBracket</span></span></span><span> </span><span id="local-6989586621679057722"><span class="annot"><span class="annottext">Proxy a' a b' b m a
</span><a href="#local-6989586621679057722"><span class="hs-identifier hs-var">acquire</span></a></span></span><span> </span><span id="local-6989586621679057721"><span class="annot"><span class="annottext">a -&gt; ExitCase b -&gt; Proxy a' a b' b m c
</span><a href="#local-6989586621679057721"><span class="hs-identifier hs-var">release_</span></a></span></span><span> </span><span id="local-6989586621679057720"><span class="annot"><span class="annottext">a -&gt; Proxy a' a b' b m b
</span><a href="#local-6989586621679057720"><span class="hs-identifier hs-var">use</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b.
MonadMask m =&gt;
((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">mask</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057719"><span class="annot"><span class="annottext">forall a. Proxy a' a b' b m a -&gt; Proxy a' a b' b m a
</span><a href="#local-6989586621679057719"><span class="hs-identifier hs-var">unmasked</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-186"></span><span>      </span><span id="local-6989586621679057718"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679057718"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Proxy a' a b' b m a
</span><a href="#local-6989586621679057722"><span class="hs-identifier hs-var">acquire</span></a></span><span>
</span><span id="line-187"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679057717"><span class="annot"><span class="annottext">action :: Proxy a' a b' b m (ExitCase b, ExitCase_ b)
</span><a href="#local-6989586621679057717"><span class="hs-identifier hs-var hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-188"></span><span>              </span><span id="local-6989586621679057716"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679057716"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; Proxy a' a b' b m b
</span><a href="#local-6989586621679057720"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679057718"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-189"></span><span>              </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; ExitCase a
</span><span class="hs-identifier hs-var">ExitCaseSuccess</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679057716"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; ExitCase_ a
</span><a href="Pipes.Safe.html#ExitCaseSuccess_"><span class="hs-identifier hs-var">ExitCaseSuccess_</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679057716"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679057711"><span class="annot"><span class="annottext">handler :: SomeException -&gt; m (ExitCase a, ExitCase_ a)
</span><a href="#local-6989586621679057711"><span class="hs-identifier hs-var hs-var">handler</span></a></span></span><span> </span><span id="local-6989586621679057710"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679057710"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. SomeException -&gt; ExitCase a
</span><span class="hs-identifier hs-var">ExitCaseException</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679057710"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. SomeException -&gt; ExitCase_ a
</span><a href="Pipes.Safe.html#ExitCaseException_"><span class="hs-identifier hs-var">ExitCaseException_</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679057710"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679057707"><span class="annot"><span class="annottext">ExitCase b
</span><a href="#local-6989586621679057707"><span class="hs-identifier hs-var">exitCase</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057706"><span class="annot"><span class="annottext">ExitCase_ b
</span><a href="#local-6989586621679057706"><span class="hs-identifier hs-var">exitCase_</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Proxy a' a b' b m a -&gt; Proxy a' a b' b m a
</span><a href="#local-6989586621679057719"><span class="hs-identifier hs-var">unmasked</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy a' a b' b m (ExitCase b, ExitCase_ b)
</span><a href="#local-6989586621679057717"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catch`</span></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {a} {a}.
Monad m =&gt;
SomeException -&gt; m (ExitCase a, ExitCase_ a)
</span><a href="#local-6989586621679057711"><span class="hs-identifier hs-var">handler</span></a></span><span>
</span><span id="line-192"></span><span>      </span><span id="local-6989586621679057704"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679057704"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; ExitCase b -&gt; Proxy a' a b' b m c
</span><a href="#local-6989586621679057721"><span class="hs-identifier hs-var">release_</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679057718"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCase b
</span><a href="#local-6989586621679057707"><span class="hs-identifier hs-var">exitCase</span></a></span><span>
</span><span id="line-193"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ExitCase_ b
</span><a href="#local-6989586621679057706"><span class="hs-identifier hs-var">exitCase_</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-194"></span><span>          </span><span class="annot"><a href="Pipes.Safe.html#ExitCaseException_"><span class="hs-identifier hs-type">ExitCaseException_</span></a></span><span> </span><span id="local-6989586621679057703"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679057703"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679057703"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-195"></span><span>          </span><span class="annot"><a href="Pipes.Safe.html#ExitCaseSuccess_"><span class="hs-identifier hs-type">ExitCaseSuccess_</span></a></span><span> </span><span id="local-6989586621679057701"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679057701"><span class="hs-identifier hs-var">b</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679057701"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679057704"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="hs-comment">-- | This is to avoid an unnecessary partial pattern match in `generalBracket`</span><span>
</span><span id="line-198"></span><span class="hs-keyword">data</span><span> </span><span id="ExitCase_"><span class="annot"><a href="Pipes.Safe.html#ExitCase_"><span class="hs-identifier hs-var">ExitCase_</span></a></span></span><span> </span><span id="local-6989586621679058326"><span class="annot"><a href="#local-6989586621679058326"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ExitCaseSuccess_"><span class="annot"><a href="Pipes.Safe.html#ExitCaseSuccess_"><span class="hs-identifier hs-var">ExitCaseSuccess_</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679058326"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="ExitCaseException_"><span class="annot"><a href="Pipes.Safe.html#ExitCaseException_"><span class="hs-identifier hs-var">ExitCaseException_</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-keyword">data</span><span> </span><span id="Finalizers"><span class="annot"><a href="Pipes.Safe.html#Finalizers"><span class="hs-identifier hs-var">Finalizers</span></a></span></span><span> </span><span id="local-6989586621679058318"><span class="annot"><a href="#local-6989586621679058318"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Finalizers"><span class="annot"><a href="Pipes.Safe.html#Finalizers"><span class="hs-identifier hs-var">Finalizers</span></a></span></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_nextKey"><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Finalizers m -&gt; Integer
</span><a href="Pipes.Safe.html#_nextKey"><span class="hs-identifier hs-var hs-var">_nextKey</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_finalizers"><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Finalizers m -&gt; Map Integer (m ())
</span><a href="Pipes.Safe.html#_finalizers"><span class="hs-identifier hs-var hs-var">_finalizers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058318"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-comment">{-| 'SafeT' is a monad transformer that extends the base monad with the ability
    to 'register' and 'release' finalizers.

    All unreleased finalizers are called at the end of the 'SafeT' block, even
    in the event of exceptions.
-}</span><span>
</span><span id="line-211"></span><span class="hs-keyword">newtype</span><span> </span><span id="SafeT"><span class="annot"><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-var">SafeT</span></a></span></span><span> </span><span id="local-6989586621679058313"><span class="annot"><a href="#local-6989586621679058313"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679058312"><span class="annot"><a href="#local-6989586621679058312"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SafeT"><span class="annot"><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-var">SafeT</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unSafeT"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r.
SafeT m r -&gt; ReaderT (IORef (Maybe (Finalizers m))) m r
</span><a href="Pipes.Safe.html#unSafeT"><span class="hs-identifier hs-var hs-var">unSafeT</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">R.ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#Finalizers"><span class="hs-identifier hs-type">Finalizers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058313"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679058313"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058312"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-keyword">deriving</span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621679057688"><span id="local-6989586621679057693"><span class="annot"><span class="annottext">forall a b. a -&gt; SafeT m b -&gt; SafeT m a
forall a b. (a -&gt; b) -&gt; SafeT m a -&gt; SafeT m b
forall (m :: * -&gt; *) a b. Functor m =&gt; a -&gt; SafeT m b -&gt; SafeT m a
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; SafeT m a -&gt; SafeT m b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: forall a b. a -&gt; SafeT m b -&gt; SafeT m a
$c&lt;$ :: forall (m :: * -&gt; *) a b. Functor m =&gt; a -&gt; SafeT m b -&gt; SafeT m a
fmap :: forall a b. (a -&gt; b) -&gt; SafeT m a -&gt; SafeT m b
$cfmap :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; SafeT m a -&gt; SafeT m b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057661"><span id="local-6989586621679057665"><span id="local-6989586621679057669"><span id="local-6989586621679057673"><span id="local-6989586621679057678"><span class="annot"><span class="annottext">forall a. a -&gt; SafeT m a
forall a b. SafeT m a -&gt; SafeT m b -&gt; SafeT m a
forall a b. SafeT m a -&gt; SafeT m b -&gt; SafeT m b
forall a b. SafeT m (a -&gt; b) -&gt; SafeT m a -&gt; SafeT m b
forall a b c. (a -&gt; b -&gt; c) -&gt; SafeT m a -&gt; SafeT m b -&gt; SafeT m c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
forall {m :: * -&gt; *}. Applicative m =&gt; Functor (SafeT m)
forall (m :: * -&gt; *) a. Applicative m =&gt; a -&gt; SafeT m a
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
SafeT m a -&gt; SafeT m b -&gt; SafeT m a
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
SafeT m a -&gt; SafeT m b -&gt; SafeT m b
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
SafeT m (a -&gt; b) -&gt; SafeT m a -&gt; SafeT m b
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; c) -&gt; SafeT m a -&gt; SafeT m b -&gt; SafeT m c
&lt;* :: forall a b. SafeT m a -&gt; SafeT m b -&gt; SafeT m a
$c&lt;* :: forall (m :: * -&gt; *) a b.
Applicative m =&gt;
SafeT m a -&gt; SafeT m b -&gt; SafeT m a
*&gt; :: forall a b. SafeT m a -&gt; SafeT m b -&gt; SafeT m b
$c*&gt; :: forall (m :: * -&gt; *) a b.
Applicative m =&gt;
SafeT m a -&gt; SafeT m b -&gt; SafeT m b
liftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; SafeT m a -&gt; SafeT m b -&gt; SafeT m c
$cliftA2 :: forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; c) -&gt; SafeT m a -&gt; SafeT m b -&gt; SafeT m c
&lt;*&gt; :: forall a b. SafeT m (a -&gt; b) -&gt; SafeT m a -&gt; SafeT m b
$c&lt;*&gt; :: forall (m :: * -&gt; *) a b.
Applicative m =&gt;
SafeT m (a -&gt; b) -&gt; SafeT m a -&gt; SafeT m b
pure :: forall a. a -&gt; SafeT m a
$cpure :: forall (m :: * -&gt; *) a. Applicative m =&gt; a -&gt; SafeT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057638"><span id="local-6989586621679057642"><span id="local-6989586621679057646"><span id="local-6989586621679057651"><span class="annot"><span class="annottext">forall a. SafeT m a
forall a. SafeT m a -&gt; SafeT m [a]
forall a. SafeT m a -&gt; SafeT m a -&gt; SafeT m a
forall (f :: * -&gt; *).
Applicative f
-&gt; (forall a. f a)
-&gt; (forall a. f a -&gt; f a -&gt; f a)
-&gt; (forall a. f a -&gt; f [a])
-&gt; (forall a. f a -&gt; f [a])
-&gt; Alternative f
forall {m :: * -&gt; *}. Alternative m =&gt; Applicative (SafeT m)
forall (m :: * -&gt; *) a. Alternative m =&gt; SafeT m a
forall (m :: * -&gt; *) a. Alternative m =&gt; SafeT m a -&gt; SafeT m [a]
forall (m :: * -&gt; *) a.
Alternative m =&gt;
SafeT m a -&gt; SafeT m a -&gt; SafeT m a
many :: forall a. SafeT m a -&gt; SafeT m [a]
$cmany :: forall (m :: * -&gt; *) a. Alternative m =&gt; SafeT m a -&gt; SafeT m [a]
some :: forall a. SafeT m a -&gt; SafeT m [a]
$csome :: forall (m :: * -&gt; *) a. Alternative m =&gt; SafeT m a -&gt; SafeT m [a]
&lt;|&gt; :: forall a. SafeT m a -&gt; SafeT m a -&gt; SafeT m a
$c&lt;|&gt; :: forall (m :: * -&gt; *) a.
Alternative m =&gt;
SafeT m a -&gt; SafeT m a -&gt; SafeT m a
empty :: forall a. SafeT m a
$cempty :: forall (m :: * -&gt; *) a. Alternative m =&gt; SafeT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Alternative</span></span></span></span></span></span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057618"><span id="local-6989586621679057622"><span id="local-6989586621679057627"><span class="annot"><span class="annottext">forall a. a -&gt; SafeT m a
forall a b. SafeT m a -&gt; SafeT m b -&gt; SafeT m b
forall a b. SafeT m a -&gt; (a -&gt; SafeT m b) -&gt; SafeT m b
forall {m :: * -&gt; *}. Monad m =&gt; Applicative (SafeT m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; SafeT m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
SafeT m a -&gt; SafeT m b -&gt; SafeT m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
SafeT m a -&gt; (a -&gt; SafeT m b) -&gt; SafeT m b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: forall a. a -&gt; SafeT m a
$creturn :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; SafeT m a
&gt;&gt; :: forall a b. SafeT m a -&gt; SafeT m b -&gt; SafeT m b
$c&gt;&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
SafeT m a -&gt; SafeT m b -&gt; SafeT m b
&gt;&gt;= :: forall a b. SafeT m a -&gt; (a -&gt; SafeT m b) -&gt; SafeT m b
$c&gt;&gt;= :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
SafeT m a -&gt; (a -&gt; SafeT m b) -&gt; SafeT m b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span>
</span><span id="line-217"></span><span class="hs-comment">-- The derived instance for `MonadFail` requires a `MonadFail` instance for</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- `ReaderT` which is first available in `transformers-0.5.0.0`</span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057608"><span class="annot"><span class="annottext">forall a. String -&gt; SafeT m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. String -&gt; m a) -&gt; MonadFail m
forall {m :: * -&gt; *}. MonadFail m =&gt; Monad (SafeT m)
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; SafeT m a
fail :: forall a. String -&gt; SafeT m a
$cfail :: forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; SafeT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadFail</span></span></span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057588"><span id="local-6989586621679057593"><span class="annot"><span class="annottext">forall a. SafeT m a
forall a. SafeT m a -&gt; SafeT m a -&gt; SafeT m a
forall {m :: * -&gt; *}. MonadPlus m =&gt; Monad (SafeT m)
forall {m :: * -&gt; *}. MonadPlus m =&gt; Alternative (SafeT m)
forall (m :: * -&gt; *) a. MonadPlus m =&gt; SafeT m a
forall (m :: * -&gt; *) a.
MonadPlus m =&gt;
SafeT m a -&gt; SafeT m a -&gt; SafeT m a
forall (m :: * -&gt; *).
Alternative m
-&gt; Monad m
-&gt; (forall a. m a)
-&gt; (forall a. m a -&gt; m a -&gt; m a)
-&gt; MonadPlus m
mplus :: forall a. SafeT m a -&gt; SafeT m a -&gt; SafeT m a
$cmplus :: forall (m :: * -&gt; *) a.
MonadPlus m =&gt;
SafeT m a -&gt; SafeT m a -&gt; SafeT m a
mzero :: forall a. SafeT m a
$cmzero :: forall (m :: * -&gt; *) a. MonadPlus m =&gt; SafeT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadPlus</span></span></span></span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057576"><span class="annot"><span class="annottext">forall a. (a -&gt; SafeT m a) -&gt; SafeT m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. (a -&gt; m a) -&gt; m a) -&gt; MonadFix m
forall {m :: * -&gt; *}. MonadFix m =&gt; Monad (SafeT m)
forall (m :: * -&gt; *) a. MonadFix m =&gt; (a -&gt; SafeT m a) -&gt; SafeT m a
mfix :: forall a. (a -&gt; SafeT m a) -&gt; SafeT m a
$cmfix :: forall (m :: * -&gt; *) a. MonadFix m =&gt; (a -&gt; SafeT m a) -&gt; SafeT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadFix</span></span></span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057559"><span id="local-6989586621679057564"><span id="local-6989586621679058216"><span class="annot"><span class="hs-identifier hs-type">EC.MonadError</span></span><span> </span><span class="annot"><a href="#local-6989586621679058216"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057539"><span id="local-6989586621679057543"><span id="local-6989586621679057548"><span id="local-6989586621679058205"><span class="annot"><span class="hs-identifier hs-type">SC.MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679058205"><span class="hs-identifier hs-type">s</span></a></span></span></span></span></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057512"><span id="local-6989586621679057516"><span id="local-6989586621679057520"><span id="local-6989586621679057525"><span id="local-6989586621679058190"><span class="annot"><span class="hs-identifier hs-type">WC.MonadWriter</span></span><span> </span><span class="annot"><a href="#local-6989586621679058190"><span class="hs-identifier hs-type">w</span></a></span></span></span></span></span></span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057500"><span class="annot"><span class="annottext">forall a b. ((a -&gt; SafeT m b) -&gt; SafeT m a) -&gt; SafeT m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a b. ((a -&gt; m b) -&gt; m a) -&gt; m a) -&gt; MonadCont m
forall {m :: * -&gt; *}. MonadCont m =&gt; Monad (SafeT m)
forall (m :: * -&gt; *) a b.
MonadCont m =&gt;
((a -&gt; SafeT m b) -&gt; SafeT m a) -&gt; SafeT m a
callCC :: forall a b. ((a -&gt; SafeT m b) -&gt; SafeT m a) -&gt; SafeT m a
$ccallCC :: forall (m :: * -&gt; *) a b.
MonadCont m =&gt;
((a -&gt; SafeT m b) -&gt; SafeT m a) -&gt; SafeT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">CC.MonadCont</span></span></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057486"><span class="annot"><span class="annottext">forall e a. Exception e =&gt; e -&gt; SafeT m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall e a. Exception e =&gt; e -&gt; m a) -&gt; MonadThrow m
forall {m :: * -&gt; *}. MonadThrow m =&gt; Monad (SafeT m)
forall (m :: * -&gt; *) e a.
(MonadThrow m, Exception e) =&gt;
e -&gt; SafeT m a
throwM :: forall e a. Exception e =&gt; e -&gt; SafeT m a
$cthrowM :: forall (m :: * -&gt; *) e a.
(MonadThrow m, Exception e) =&gt;
e -&gt; SafeT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadThrow</span></span></span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057471"><span class="annot"><span class="annottext">forall e a.
Exception e =&gt;
SafeT m a -&gt; (e -&gt; SafeT m a) -&gt; SafeT m a
forall (m :: * -&gt; *).
MonadThrow m
-&gt; (forall e a. Exception e =&gt; m a -&gt; (e -&gt; m a) -&gt; m a)
-&gt; MonadCatch m
forall {m :: * -&gt; *}. MonadCatch m =&gt; MonadThrow (SafeT m)
forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
SafeT m a -&gt; (e -&gt; SafeT m a) -&gt; SafeT m a
catch :: forall e a.
Exception e =&gt;
SafeT m a -&gt; (e -&gt; SafeT m a) -&gt; SafeT m a
$ccatch :: forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
SafeT m a -&gt; (e -&gt; SafeT m a) -&gt; SafeT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadCatch</span></span></span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057449"><span id="local-6989586621679057453"><span id="local-6989586621679057458"><span class="annot"><span class="annottext">forall b.
((forall a. SafeT m a -&gt; SafeT m a) -&gt; SafeT m b) -&gt; SafeT m b
forall a b c.
SafeT m a
-&gt; (a -&gt; ExitCase b -&gt; SafeT m c)
-&gt; (a -&gt; SafeT m b)
-&gt; SafeT m (b, c)
forall {m :: * -&gt; *}. MonadMask m =&gt; MonadCatch (SafeT m)
forall (m :: * -&gt; *) b.
MonadMask m =&gt;
((forall a. SafeT m a -&gt; SafeT m a) -&gt; SafeT m b) -&gt; SafeT m b
forall (m :: * -&gt; *) a b c.
MonadMask m =&gt;
SafeT m a
-&gt; (a -&gt; ExitCase b -&gt; SafeT m c)
-&gt; (a -&gt; SafeT m b)
-&gt; SafeT m (b, c)
forall (m :: * -&gt; *).
MonadCatch m
-&gt; (forall b. ((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b)
-&gt; (forall b. ((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b)
-&gt; (forall a b c.
    m a -&gt; (a -&gt; ExitCase b -&gt; m c) -&gt; (a -&gt; m b) -&gt; m (b, c))
-&gt; MonadMask m
generalBracket :: forall a b c.
SafeT m a
-&gt; (a -&gt; ExitCase b -&gt; SafeT m c)
-&gt; (a -&gt; SafeT m b)
-&gt; SafeT m (b, c)
$cgeneralBracket :: forall (m :: * -&gt; *) a b c.
MonadMask m =&gt;
SafeT m a
-&gt; (a -&gt; ExitCase b -&gt; SafeT m c)
-&gt; (a -&gt; SafeT m b)
-&gt; SafeT m (b, c)
uninterruptibleMask :: forall b.
((forall a. SafeT m a -&gt; SafeT m a) -&gt; SafeT m b) -&gt; SafeT m b
$cuninterruptibleMask :: forall (m :: * -&gt; *) b.
MonadMask m =&gt;
((forall a. SafeT m a -&gt; SafeT m a) -&gt; SafeT m b) -&gt; SafeT m b
mask :: forall b.
((forall a. SafeT m a -&gt; SafeT m a) -&gt; SafeT m b) -&gt; SafeT m b
$cmask :: forall (m :: * -&gt; *) b.
MonadMask m =&gt;
((forall a. SafeT m a -&gt; SafeT m a) -&gt; SafeT m b) -&gt; SafeT m b
</span><a href="#local-6989586621679057449"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadMask</span></a></span></span></span></span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057440"><span class="annot"><span class="annottext">forall a. IO a -&gt; SafeT m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. IO a -&gt; m a) -&gt; MonadIO m
forall {m :: * -&gt; *}. MonadIO m =&gt; Monad (SafeT m)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; SafeT m a
liftIO :: forall a. IO a -&gt; SafeT m a
$cliftIO :: forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; SafeT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057420"><span id="local-6989586621679058146"><span class="annot"><span class="hs-identifier hs-type">B.MonadBase</span></span><span> </span><span class="annot"><a href="#local-6989586621679058146"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTrans</span></span><span> </span><span class="annot"><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-type">SafeT</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-234"></span><span>    </span><span id="local-6989586621679057403"><span class="annot"><span class="annottext">lift :: forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; SafeT m a
</span><a href="#local-6989586621679057403"><span class="hs-identifier hs-var hs-var hs-var hs-var">lift</span></a></span></span><span> </span><span id="local-6989586621679057402"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679057402"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r.
ReaderT (IORef (Maybe (Finalizers m))) m r -&gt; SafeT m r
</span><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-var">SafeT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679057402"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679058128"><span id="local-6989586621679058129"><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="#local-6989586621679058129"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058128"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="#local-6989586621679058129"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-type">SafeT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058128"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-237"></span><span>     </span><span class="hs-keyword">type</span><span> </span><span id="StM"><span class="annot"><span class="hs-identifier hs-var">StM</span></span></span><span> </span><span id="local-6989586621679057392"><span id="local-6989586621679058128"><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-type">SafeT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058128"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679057392"><span class="hs-identifier hs-type">a</span></a></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StM</span></span><span> </span><span class="annot"><a href="#local-6989586621679058128"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057392"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-238"></span><span>     </span><span id="local-6989586621679057390"><span class="annot"><span class="annottext">liftBaseWith :: forall a. (RunInBase (SafeT m) b -&gt; b a) -&gt; SafeT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">liftBaseWith</span></span></span><span> </span><span id="local-6989586621679057388"><span class="annot"><span class="annottext">RunInBase (SafeT m) b -&gt; b a
</span><a href="#local-6989586621679057388"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r.
ReaderT (IORef (Maybe (Finalizers m))) m r -&gt; SafeT m r
</span><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-var">SafeT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. (r -&gt; m a) -&gt; ReaderT r m a
</span><span class="hs-identifier hs-var">R.ReaderT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057386"><span class="annot"><span class="annottext">IORef (Maybe (Finalizers m))
</span><a href="#local-6989586621679057386"><span class="hs-identifier hs-var">reader'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-239"></span><span>         </span><span class="annot"><span class="annottext">forall (b :: * -&gt; *) (m :: * -&gt; *) a.
MonadBaseControl b m =&gt;
(RunInBase m b -&gt; b a) -&gt; m a
</span><span class="hs-identifier hs-var">liftBaseWith</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057385"><span class="annot"><span class="annottext">RunInBase m b
</span><a href="#local-6989586621679057385"><span class="hs-identifier hs-var">runInBase</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-240"></span><span>             </span><span class="annot"><span class="annottext">RunInBase (SafeT m) b -&gt; b a
</span><a href="#local-6989586621679057388"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RunInBase m b
</span><a href="#local-6989586621679057385"><span class="hs-identifier hs-var">runInBase</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-type">SafeT</span></a></span><span> </span><span id="local-6989586621679057384"><span class="annot"><span class="annottext">ReaderT (IORef (Maybe (Finalizers m))) m a
</span><a href="#local-6989586621679057384"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">R.runReaderT</span></span><span> </span><span class="annot"><span class="annottext">ReaderT (IORef (Maybe (Finalizers m))) m a
</span><a href="#local-6989586621679057384"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe (Finalizers m))
</span><a href="#local-6989586621679057386"><span class="hs-identifier hs-var">reader'</span></a></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>     </span><span id="local-6989586621679057381"><span class="annot"><span class="annottext">restoreM :: forall a. StM (SafeT m) a -&gt; SafeT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">restoreM</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r.
ReaderT (IORef (Maybe (Finalizers m))) m r -&gt; SafeT m r
</span><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-var">SafeT</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. (r -&gt; m a) -&gt; ReaderT r m a
</span><span class="hs-identifier hs-var">R.ReaderT</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: * -&gt; *) (m :: * -&gt; *) a.
MonadBaseControl b m =&gt;
StM m a -&gt; m a
</span><span class="hs-identifier hs-var">restoreM</span></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679058111"><span class="annot"><span class="hs-identifier hs-type">Prim.PrimMonad</span></span><span> </span><span class="annot"><a href="#local-6989586621679058111"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Prim.PrimMonad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-type">SafeT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058111"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="PrimState"><span class="annot"><span class="hs-identifier hs-var">PrimState</span></span></span><span> </span><span id="local-6989586621679058111"><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-type">SafeT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058111"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Prim.PrimState</span></span><span> </span><span class="annot"><a href="#local-6989586621679058111"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-245"></span><span>  </span><span id="local-6989586621679057367"><span class="annot"><span class="annottext">primitive :: forall a.
(State# (PrimState (SafeT m))
 -&gt; (# State# (PrimState (SafeT m)), a #))
-&gt; SafeT m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">primitive</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
</span><span class="hs-identifier hs-var">Prim.primitive</span></span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">primitive</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="hs-comment">{-| Run the 'SafeT' monad transformer, executing all unreleased finalizers at
    the end of the computation
-}</span><span>
</span><span id="line-251"></span><span id="local-6989586621679058108"><span id="local-6989586621679058109"><span class="annot"><a href="Pipes.Safe.html#runSafeT"><span class="hs-identifier hs-type">runSafeT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679058109"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679058109"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-type">SafeT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058109"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058108"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058109"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058108"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-252"></span><span id="runSafeT"><span class="annot"><span class="annottext">runSafeT :: forall (m :: * -&gt; *) r.
(MonadMask m, MonadIO m) =&gt;
SafeT m r -&gt; m r
</span><a href="Pipes.Safe.html#runSafeT"><span class="hs-identifier hs-var hs-var">runSafeT</span></a></span></span><span> </span><span id="local-6989586621679057353"><span class="annot"><span class="annottext">SafeT m r
</span><a href="#local-6989586621679057353"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a c b.
MonadMask m =&gt;
m a -&gt; (a -&gt; m c) -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">C.bracket</span></span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Integer -&gt; Map Integer (m ()) -&gt; Finalizers m
</span><a href="Pipes.Safe.html#Finalizers"><span class="hs-identifier hs-var">Finalizers</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679057349"><span class="annot"><span class="annottext">IORef (Maybe (Finalizers m))
</span><a href="#local-6989586621679057349"><span class="hs-identifier hs-var">ioref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-255"></span><span>        </span><span id="local-6989586621679057348"><span class="annot"><span class="annottext">Maybe (Finalizers m)
</span><a href="#local-6989586621679057348"><span class="hs-identifier hs-var">mres</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><span class="hs-identifier hs-var">atomicModifyIORef'</span></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe (Finalizers m))
</span><a href="#local-6989586621679057349"><span class="hs-identifier hs-var">ioref</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057347"><span class="annot"><span class="annottext">Maybe (Finalizers m)
</span><a href="#local-6989586621679057347"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-256"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Finalizers m)
</span><a href="#local-6989586621679057347"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Finalizers m)
</span><a href="#local-6989586621679057348"><span class="hs-identifier hs-var">mres</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-258"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Finalizers m)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runSafeT's resources were freed by another&quot;</span></span><span>
</span><span id="line-259"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#Finalizers"><span class="hs-identifier hs-type">Finalizers</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679057345"><span class="annot"><span class="annottext">Map Integer (m ())
</span><a href="#local-6989586621679057345"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toDescList</span></span><span> </span><span class="annot"><span class="annottext">Map Integer (m ())
</span><a href="#local-6989586621679057345"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">R.runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r.
SafeT m r -&gt; ReaderT (IORef (Maybe (Finalizers m))) m r
</span><a href="Pipes.Safe.html#unSafeT"><span class="hs-identifier hs-var">unSafeT</span></a></span><span> </span><span class="annot"><span class="annottext">SafeT m r
</span><a href="#local-6989586621679057353"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Safe.html#runSafeT"><span class="hs-pragma hs-type">runSafeT</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="hs-comment">{-| Run 'SafeT' in the base monad, executing all unreleased finalizers at the
    end of the computation

    Use 'runSafeP' to safely flush all unreleased finalizers and ensure prompt
    finalization without exiting the 'Proxy' monad.
-}</span><span>
</span><span id="line-269"></span><span id="local-6989586621679058084"><span id="local-6989586621679058085"><span class="annot"><a href="Pipes.Safe.html#runSafeP"><span class="hs-identifier hs-type">runSafeP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679058085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679058085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Effect</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-type">SafeT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679058084"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Effect'</span></span><span> </span><span class="annot"><a href="#local-6989586621679058085"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058084"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-270"></span><span id="runSafeP"><span class="annot"><span class="annottext">runSafeP :: forall (m :: * -&gt; *) r.
(MonadMask m, MonadIO m) =&gt;
Effect (SafeT m) r -&gt; Effect' m r
</span><a href="Pipes.Safe.html#runSafeP"><span class="hs-identifier hs-var hs-var">runSafeP</span></a></span></span><span> </span><span id="local-6989586621679057332"><span class="annot"><span class="annottext">Effect (SafeT m) r
</span><a href="#local-6989586621679057332"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r.
(MonadMask m, MonadIO m) =&gt;
SafeT m r -&gt; m r
</span><a href="Pipes.Safe.html#runSafeT"><span class="hs-identifier hs-var">runSafeT</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. Monad m =&gt; Effect m r -&gt; m r
</span><span class="hs-identifier hs-var">runEffect</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Effect (SafeT m) r
</span><a href="#local-6989586621679057332"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-271"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Safe.html#runSafeP"><span class="hs-pragma hs-type">runSafeP</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-comment">-- | Token used to 'release' a previously 'register'ed finalizer</span><span>
</span><span id="line-274"></span><span class="hs-keyword">newtype</span><span> </span><span id="ReleaseKey"><span class="annot"><a href="Pipes.Safe.html#ReleaseKey"><span class="hs-identifier hs-var">ReleaseKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ReleaseKey"><span class="annot"><a href="Pipes.Safe.html#ReleaseKey"><span class="hs-identifier hs-var">ReleaseKey</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unlock"><span class="annot"><span class="annottext">ReleaseKey -&gt; Integer
</span><a href="Pipes.Safe.html#unlock"><span class="hs-identifier hs-var hs-var">unlock</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-comment">{-| 'MonadSafe' lets you 'register' and 'release' finalizers that execute in a
    'Base' monad
-}</span><span>
</span><span id="line-279"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621679058068"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679058068"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679058068"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058068"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="MonadSafe"><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-var">MonadSafe</span></a></span></span><span> </span><span id="local-6989586621679058068"><span class="annot"><a href="#local-6989586621679058068"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-comment">{-| The monad used to run resource management actions, corresponding to the
        monad directly beneath 'SafeT'
    -}</span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Base"><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-var">Base</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679058068"><span class="annot"><a href="#local-6989586621679058068"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-comment">-- | Lift an action from the 'Base' monad</span><span>
</span><span id="line-286"></span><span>    </span><span id="liftBase"><span class="annot"><a href="Pipes.Safe.html#liftBase"><span class="hs-identifier hs-type">liftBase</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679058064"><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058068"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058064"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058068"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058064"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-comment">{-| 'register' a finalizer, ensuring that the finalizer gets called if the
        finalizer is not 'release'd before the end of the surrounding 'SafeT'
        block.
    -}</span><span>
</span><span id="line-292"></span><span>    </span><span id="register"><span class="annot"><a href="Pipes.Safe.html#register"><span class="hs-identifier hs-type">register</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058068"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058068"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Pipes.Safe.html#ReleaseKey"><span class="hs-identifier hs-type">ReleaseKey</span></a></span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-comment">{-| 'release' a registered finalizer

        You can safely call 'release' more than once on the same 'ReleaseKey'.
        Every 'release' after the first one does nothing.
    -}</span><span>
</span><span id="line-299"></span><span>    </span><span id="release"><span class="annot"><a href="Pipes.Safe.html#release"><span class="hs-identifier hs-type">release</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Safe.html#ReleaseKey"><span class="hs-identifier hs-type">ReleaseKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058068"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679058063"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679058063"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621679058063"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679058063"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-type">SafeT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058063"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-302"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Base"><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-var">Base</span></a></span></span><span> </span><span id="local-6989586621679058063"><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-type">SafeT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058063"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679058063"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span>    </span><span id="local-6989586621679057303"><span class="annot"><span class="annottext">liftBase :: forall r. Base (SafeT m) r -&gt; SafeT m r
</span><a href="#local-6989586621679057303"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span>    </span><span id="local-6989586621679057290"><span class="annot"><span class="annottext">register :: Base (SafeT m) () -&gt; SafeT m ReleaseKey
</span><a href="#local-6989586621679057290"><span class="hs-identifier hs-var hs-var hs-var hs-var">register</span></a></span></span><span> </span><span id="local-6989586621679057289"><span class="annot"><span class="annottext">Base (SafeT m) ()
</span><a href="#local-6989586621679057289"><span class="hs-identifier hs-var">io</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-307"></span><span>        </span><span id="local-6989586621679057288"><span class="annot"><span class="annottext">IORef (Maybe (Finalizers m))
</span><a href="#local-6989586621679057288"><span class="hs-identifier hs-var">ioref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r.
ReaderT (IORef (Maybe (Finalizers m))) m r -&gt; SafeT m r
</span><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-var">SafeT</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. Monad m =&gt; ReaderT r m r
</span><span class="hs-identifier hs-var">R.ask</span></span><span>
</span><span id="line-308"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-309"></span><span>            </span><span id="local-6989586621679057286"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679057286"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><span class="hs-identifier hs-var">atomicModifyIORef'</span></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe (Finalizers m))
</span><a href="#local-6989586621679057288"><span class="hs-identifier hs-var">ioref</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057285"><span class="annot"><span class="annottext">Maybe (Finalizers m)
</span><a href="#local-6989586621679057285"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-310"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Finalizers m)
</span><a href="#local-6989586621679057285"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-311"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (Finalizers m)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;register: SafeT block is closed&quot;</span></span><span>
</span><span id="line-312"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#Finalizers"><span class="hs-identifier hs-type">Finalizers</span></a></span><span> </span><span id="local-6989586621679057284"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679057284"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679057283"><span class="annot"><span class="annottext">Map Integer (m ())
</span><a href="#local-6989586621679057283"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-313"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Integer -&gt; Map Integer (m ()) -&gt; Finalizers m
</span><a href="Pipes.Safe.html#Finalizers"><span class="hs-identifier hs-var">Finalizers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679057284"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679057284"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Base (SafeT m) ()
</span><a href="#local-6989586621679057289"><span class="hs-identifier hs-var">io</span></a></span><span> </span><span class="annot"><span class="annottext">Map Integer (m ())
</span><a href="#local-6989586621679057283"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679057284"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; ReleaseKey
</span><a href="Pipes.Safe.html#ReleaseKey"><span class="hs-identifier hs-var">ReleaseKey</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679057286"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>    </span><span id="local-6989586621679057274"><span class="annot"><span class="annottext">release :: ReleaseKey -&gt; SafeT m ()
</span><a href="#local-6989586621679057274"><span class="hs-identifier hs-var hs-var hs-var hs-var">release</span></a></span></span><span> </span><span id="local-6989586621679057273"><span class="annot"><span class="annottext">ReleaseKey
</span><a href="#local-6989586621679057273"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-317"></span><span>        </span><span id="local-6989586621679057272"><span class="annot"><span class="annottext">IORef (Maybe (Finalizers m))
</span><a href="#local-6989586621679057272"><span class="hs-identifier hs-var">ioref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r.
ReaderT (IORef (Maybe (Finalizers m))) m r -&gt; SafeT m r
</span><a href="Pipes.Safe.html#SafeT"><span class="hs-identifier hs-var">SafeT</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. Monad m =&gt; ReaderT r m r
</span><span class="hs-identifier hs-var">R.ask</span></span><span>
</span><span id="line-318"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><span class="hs-identifier hs-var">atomicModifyIORef'</span></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe (Finalizers m))
</span><a href="#local-6989586621679057272"><span class="hs-identifier hs-var">ioref</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057271"><span class="annot"><span class="annottext">Maybe (Finalizers m)
</span><a href="#local-6989586621679057271"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-319"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Finalizers m)
</span><a href="#local-6989586621679057271"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-320"></span><span>                </span><span class="annot"><span class="annottext">Maybe (Finalizers m)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;release: SafeT block is closed&quot;</span></span><span>
</span><span id="line-321"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#Finalizers"><span class="hs-identifier hs-type">Finalizers</span></a></span><span> </span><span id="local-6989586621679057270"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679057270"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679057269"><span class="annot"><span class="annottext">Map Integer (m ())
</span><a href="#local-6989586621679057269"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-322"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Integer -&gt; Map Integer (m ()) -&gt; Finalizers m
</span><a href="Pipes.Safe.html#Finalizers"><span class="hs-identifier hs-var">Finalizers</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679057270"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.delete</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReleaseKey -&gt; Integer
</span><a href="Pipes.Safe.html#unlock"><span class="hs-identifier hs-var">unlock</span></a></span><span> </span><span class="annot"><span class="annottext">ReleaseKey
</span><a href="#local-6989586621679057273"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Integer (m ())
</span><a href="#local-6989586621679057269"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679058046"><span id="local-6989586621679058047"><span id="local-6989586621679058048"><span id="local-6989586621679058049"><span id="local-6989586621679058050"><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058050"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679058049"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058048"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058047"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058046"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058050"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Base"><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-var">Base</span></a></span></span><span> </span><span id="local-6989586621679058046"><span id="local-6989586621679058047"><span id="local-6989586621679058048"><span id="local-6989586621679058049"><span id="local-6989586621679058050"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679058049"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058048"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058047"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058046"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058050"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058050"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-326"></span><span>    </span><span id="local-6989586621679057245"><span class="annot"><span class="annottext">liftBase :: forall r. Base (Proxy a' a b' b m) r -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679057245"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. MonadSafe m =&gt; Base m r -&gt; m r
</span><a href="Pipes.Safe.html#liftBase"><span class="hs-identifier hs-var">liftBase</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span id="local-6989586621679057241"><span class="annot"><span class="annottext">register :: Base (Proxy a' a b' b m) () -&gt; Proxy a' a b' b m ReleaseKey
</span><a href="#local-6989586621679057241"><span class="hs-identifier hs-var hs-var hs-var hs-var">register</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; Base m () -&gt; m ReleaseKey
</span><a href="Pipes.Safe.html#register"><span class="hs-identifier hs-var">register</span></a></span><span>
</span><span id="line-328"></span><span>    </span><span id="local-6989586621679057237"><span class="annot"><span class="annottext">release :: ReleaseKey -&gt; Proxy a' a b' b m ()
</span><a href="#local-6989586621679057237"><span class="hs-identifier hs-var hs-var hs-var hs-var">release</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; ReleaseKey -&gt; m ()
</span><a href="Pipes.Safe.html#release"><span class="hs-identifier hs-var">release</span></a></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679058039"><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058039"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I.IdentityT</span></span><span> </span><span class="annot"><a href="#local-6989586621679058039"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Base"><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-var">Base</span></a></span></span><span> </span><span id="local-6989586621679058039"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I.IdentityT</span></span><span> </span><span class="annot"><a href="#local-6989586621679058039"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058039"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-332"></span><span>    </span><span id="local-6989586621679057210"><span class="annot"><span class="annottext">liftBase :: forall r. Base (IdentityT m) r -&gt; IdentityT m r
</span><a href="#local-6989586621679057210"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. MonadSafe m =&gt; Base m r -&gt; m r
</span><a href="Pipes.Safe.html#liftBase"><span class="hs-identifier hs-var">liftBase</span></a></span><span>
</span><span id="line-333"></span><span>    </span><span id="local-6989586621679057206"><span class="annot"><span class="annottext">register :: Base (IdentityT m) () -&gt; IdentityT m ReleaseKey
</span><a href="#local-6989586621679057206"><span class="hs-identifier hs-var hs-var hs-var hs-var">register</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; Base m () -&gt; m ReleaseKey
</span><a href="Pipes.Safe.html#register"><span class="hs-identifier hs-var">register</span></a></span><span>
</span><span id="line-334"></span><span>    </span><span id="local-6989586621679057202"><span class="annot"><span class="annottext">release :: ReleaseKey -&gt; IdentityT m ()
</span><a href="#local-6989586621679057202"><span class="hs-identifier hs-var hs-var hs-var hs-var">release</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; ReleaseKey -&gt; m ()
</span><a href="Pipes.Safe.html#release"><span class="hs-identifier hs-var">release</span></a></span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679058032"><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058032"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">E.CatchT</span></span><span> </span><span class="annot"><a href="#local-6989586621679058032"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Base"><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-var">Base</span></a></span></span><span> </span><span id="local-6989586621679058032"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">E.CatchT</span></span><span> </span><span class="annot"><a href="#local-6989586621679058032"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058032"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-338"></span><span>    </span><span id="local-6989586621679057176"><span class="annot"><span class="annottext">liftBase :: forall r. Base (CatchT m) r -&gt; CatchT m r
</span><a href="#local-6989586621679057176"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. MonadSafe m =&gt; Base m r -&gt; m r
</span><a href="Pipes.Safe.html#liftBase"><span class="hs-identifier hs-var">liftBase</span></a></span><span>
</span><span id="line-339"></span><span>    </span><span id="local-6989586621679057172"><span class="annot"><span class="annottext">register :: Base (CatchT m) () -&gt; CatchT m ReleaseKey
</span><a href="#local-6989586621679057172"><span class="hs-identifier hs-var hs-var hs-var hs-var">register</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; Base m () -&gt; m ReleaseKey
</span><a href="Pipes.Safe.html#register"><span class="hs-identifier hs-var">register</span></a></span><span>
</span><span id="line-340"></span><span>    </span><span id="local-6989586621679057168"><span class="annot"><span class="annottext">release :: ReleaseKey -&gt; CatchT m ()
</span><a href="#local-6989586621679057168"><span class="hs-identifier hs-var hs-var hs-var hs-var">release</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; ReleaseKey -&gt; m ()
</span><a href="Pipes.Safe.html#release"><span class="hs-identifier hs-var">release</span></a></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679058027"><span id="local-6989586621679058028"><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058028"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">R.ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679058027"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058028"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Base"><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-var">Base</span></a></span></span><span> </span><span id="local-6989586621679058027"><span id="local-6989586621679058028"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">R.ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679058027"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058028"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058028"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span id="local-6989586621679057145"><span class="annot"><span class="annottext">liftBase :: forall r. Base (ReaderT i m) r -&gt; ReaderT i m r
</span><a href="#local-6989586621679057145"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. MonadSafe m =&gt; Base m r -&gt; m r
</span><a href="Pipes.Safe.html#liftBase"><span class="hs-identifier hs-var">liftBase</span></a></span><span>
</span><span id="line-345"></span><span>    </span><span id="local-6989586621679057141"><span class="annot"><span class="annottext">register :: Base (ReaderT i m) () -&gt; ReaderT i m ReleaseKey
</span><a href="#local-6989586621679057141"><span class="hs-identifier hs-var hs-var hs-var hs-var">register</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; Base m () -&gt; m ReleaseKey
</span><a href="Pipes.Safe.html#register"><span class="hs-identifier hs-var">register</span></a></span><span>
</span><span id="line-346"></span><span>    </span><span id="local-6989586621679057137"><span class="annot"><span class="annottext">release :: ReleaseKey -&gt; ReaderT i m ()
</span><a href="#local-6989586621679057137"><span class="hs-identifier hs-var hs-var hs-var hs-var">release</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; ReleaseKey -&gt; m ()
</span><a href="Pipes.Safe.html#release"><span class="hs-identifier hs-var">release</span></a></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679058015"><span id="local-6989586621679058016"><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058016"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.StateT</span></span><span> </span><span class="annot"><a href="#local-6989586621679058015"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058016"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Base"><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-var">Base</span></a></span></span><span> </span><span id="local-6989586621679058015"><span id="local-6989586621679058016"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.StateT</span></span><span> </span><span class="annot"><a href="#local-6989586621679058015"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058016"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058016"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-350"></span><span>    </span><span id="local-6989586621679057110"><span class="annot"><span class="annottext">liftBase :: forall r. Base (StateT s m) r -&gt; StateT s m r
</span><a href="#local-6989586621679057110"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. MonadSafe m =&gt; Base m r -&gt; m r
</span><a href="Pipes.Safe.html#liftBase"><span class="hs-identifier hs-var">liftBase</span></a></span><span>
</span><span id="line-351"></span><span>    </span><span id="local-6989586621679057106"><span class="annot"><span class="annottext">register :: Base (StateT s m) () -&gt; StateT s m ReleaseKey
</span><a href="#local-6989586621679057106"><span class="hs-identifier hs-var hs-var hs-var hs-var">register</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; Base m () -&gt; m ReleaseKey
</span><a href="Pipes.Safe.html#register"><span class="hs-identifier hs-var">register</span></a></span><span>
</span><span id="line-352"></span><span>    </span><span id="local-6989586621679057102"><span class="annot"><span class="annottext">release :: ReleaseKey -&gt; StateT s m ()
</span><a href="#local-6989586621679057102"><span class="hs-identifier hs-var hs-var hs-var hs-var">release</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; ReleaseKey -&gt; m ()
</span><a href="Pipes.Safe.html#release"><span class="hs-identifier hs-var">release</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679058002"><span id="local-6989586621679058003"><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058003"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S'.StateT</span></span><span> </span><span class="annot"><a href="#local-6989586621679058002"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058003"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Base"><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-var">Base</span></a></span></span><span> </span><span id="local-6989586621679058002"><span id="local-6989586621679058003"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S'.StateT</span></span><span> </span><span class="annot"><a href="#local-6989586621679058002"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058003"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058003"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-356"></span><span>    </span><span id="local-6989586621679057075"><span class="annot"><span class="annottext">liftBase :: forall r. Base (StateT s m) r -&gt; StateT s m r
</span><a href="#local-6989586621679057075"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. MonadSafe m =&gt; Base m r -&gt; m r
</span><a href="Pipes.Safe.html#liftBase"><span class="hs-identifier hs-var">liftBase</span></a></span><span>
</span><span id="line-357"></span><span>    </span><span id="local-6989586621679057071"><span class="annot"><span class="annottext">register :: Base (StateT s m) () -&gt; StateT s m ReleaseKey
</span><a href="#local-6989586621679057071"><span class="hs-identifier hs-var hs-var hs-var hs-var">register</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; Base m () -&gt; m ReleaseKey
</span><a href="Pipes.Safe.html#register"><span class="hs-identifier hs-var">register</span></a></span><span>
</span><span id="line-358"></span><span>    </span><span id="local-6989586621679057067"><span class="annot"><span class="annottext">release :: ReleaseKey -&gt; StateT s m ()
</span><a href="#local-6989586621679057067"><span class="hs-identifier hs-var hs-var hs-var hs-var">release</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; ReleaseKey -&gt; m ()
</span><a href="Pipes.Safe.html#release"><span class="hs-identifier hs-var">release</span></a></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679057989"><span id="local-6989586621679057990"><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057990"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679057989"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">W.WriterT</span></span><span> </span><span class="annot"><a href="#local-6989586621679057989"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057990"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Base"><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-var">Base</span></a></span></span><span> </span><span id="local-6989586621679057989"><span id="local-6989586621679057990"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">W.WriterT</span></span><span> </span><span class="annot"><a href="#local-6989586621679057989"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057990"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057990"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-362"></span><span>    </span><span id="local-6989586621679057039"><span class="annot"><span class="annottext">liftBase :: forall r. Base (WriterT w m) r -&gt; WriterT w m r
</span><a href="#local-6989586621679057039"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. MonadSafe m =&gt; Base m r -&gt; m r
</span><a href="Pipes.Safe.html#liftBase"><span class="hs-identifier hs-var">liftBase</span></a></span><span>
</span><span id="line-363"></span><span>    </span><span id="local-6989586621679057035"><span class="annot"><span class="annottext">register :: Base (WriterT w m) () -&gt; WriterT w m ReleaseKey
</span><a href="#local-6989586621679057035"><span class="hs-identifier hs-var hs-var hs-var hs-var">register</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; Base m () -&gt; m ReleaseKey
</span><a href="Pipes.Safe.html#register"><span class="hs-identifier hs-var">register</span></a></span><span>
</span><span id="line-364"></span><span>    </span><span id="local-6989586621679057031"><span class="annot"><span class="annottext">release :: ReleaseKey -&gt; WriterT w m ()
</span><a href="#local-6989586621679057031"><span class="hs-identifier hs-var hs-var hs-var hs-var">release</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; ReleaseKey -&gt; m ()
</span><a href="Pipes.Safe.html#release"><span class="hs-identifier hs-var">release</span></a></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679057976"><span id="local-6989586621679057977"><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057977"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679057976"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">W'.WriterT</span></span><span> </span><span class="annot"><a href="#local-6989586621679057976"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057977"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Base"><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-var">Base</span></a></span></span><span> </span><span id="local-6989586621679057976"><span id="local-6989586621679057977"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">W'.WriterT</span></span><span> </span><span class="annot"><a href="#local-6989586621679057976"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057977"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057977"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-368"></span><span>    </span><span id="local-6989586621679057003"><span class="annot"><span class="annottext">liftBase :: forall r. Base (WriterT w m) r -&gt; WriterT w m r
</span><a href="#local-6989586621679057003"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. MonadSafe m =&gt; Base m r -&gt; m r
</span><a href="Pipes.Safe.html#liftBase"><span class="hs-identifier hs-var">liftBase</span></a></span><span>
</span><span id="line-369"></span><span>    </span><span id="local-6989586621679056999"><span class="annot"><span class="annottext">register :: Base (WriterT w m) () -&gt; WriterT w m ReleaseKey
</span><a href="#local-6989586621679056999"><span class="hs-identifier hs-var hs-var hs-var hs-var">register</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; Base m () -&gt; m ReleaseKey
</span><a href="Pipes.Safe.html#register"><span class="hs-identifier hs-var">register</span></a></span><span>
</span><span id="line-370"></span><span>    </span><span id="local-6989586621679056995"><span class="annot"><span class="annottext">release :: ReleaseKey -&gt; WriterT w m ()
</span><a href="#local-6989586621679056995"><span class="hs-identifier hs-var hs-var hs-var hs-var">release</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; ReleaseKey -&gt; m ()
</span><a href="Pipes.Safe.html#release"><span class="hs-identifier hs-var">release</span></a></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679057953"><span id="local-6989586621679057954"><span id="local-6989586621679057955"><span id="local-6989586621679057956"><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057956"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679057955"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RWS.RWST</span></span><span> </span><span class="annot"><a href="#local-6989586621679057954"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057955"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057953"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057956"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Base"><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-var">Base</span></a></span></span><span> </span><span id="local-6989586621679057953"><span id="local-6989586621679057954"><span id="local-6989586621679057955"><span id="local-6989586621679057956"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RWS.RWST</span></span><span> </span><span class="annot"><a href="#local-6989586621679057954"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057955"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057953"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057956"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057956"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-374"></span><span>    </span><span id="local-6989586621679056967"><span class="annot"><span class="annottext">liftBase :: forall r. Base (RWST i w s m) r -&gt; RWST i w s m r
</span><a href="#local-6989586621679056967"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. MonadSafe m =&gt; Base m r -&gt; m r
</span><a href="Pipes.Safe.html#liftBase"><span class="hs-identifier hs-var">liftBase</span></a></span><span>
</span><span id="line-375"></span><span>    </span><span id="local-6989586621679056963"><span class="annot"><span class="annottext">register :: Base (RWST i w s m) () -&gt; RWST i w s m ReleaseKey
</span><a href="#local-6989586621679056963"><span class="hs-identifier hs-var hs-var hs-var hs-var">register</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; Base m () -&gt; m ReleaseKey
</span><a href="Pipes.Safe.html#register"><span class="hs-identifier hs-var">register</span></a></span><span>
</span><span id="line-376"></span><span>    </span><span id="local-6989586621679056959"><span class="annot"><span class="annottext">release :: ReleaseKey -&gt; RWST i w s m ()
</span><a href="#local-6989586621679056959"><span class="hs-identifier hs-var hs-var hs-var hs-var">release</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; ReleaseKey -&gt; m ()
</span><a href="Pipes.Safe.html#release"><span class="hs-identifier hs-var">release</span></a></span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679057928"><span id="local-6989586621679057929"><span id="local-6989586621679057930"><span id="local-6989586621679057931"><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057931"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679057930"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RWS'.RWST</span></span><span> </span><span class="annot"><a href="#local-6989586621679057929"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057930"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057928"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057931"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-379"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Base"><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-var">Base</span></a></span></span><span> </span><span id="local-6989586621679057928"><span id="local-6989586621679057929"><span id="local-6989586621679057930"><span id="local-6989586621679057931"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RWS'.RWST</span></span><span> </span><span class="annot"><a href="#local-6989586621679057929"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057930"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057928"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057931"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057931"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-380"></span><span>    </span><span id="local-6989586621679056931"><span class="annot"><span class="annottext">liftBase :: forall r. Base (RWST i w s m) r -&gt; RWST i w s m r
</span><a href="#local-6989586621679056931"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. MonadSafe m =&gt; Base m r -&gt; m r
</span><a href="Pipes.Safe.html#liftBase"><span class="hs-identifier hs-var">liftBase</span></a></span><span>
</span><span id="line-381"></span><span>    </span><span id="local-6989586621679056927"><span class="annot"><span class="annottext">register :: Base (RWST i w s m) () -&gt; RWST i w s m ReleaseKey
</span><a href="#local-6989586621679056927"><span class="hs-identifier hs-var hs-var hs-var hs-var">register</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; Base m () -&gt; m ReleaseKey
</span><a href="Pipes.Safe.html#register"><span class="hs-identifier hs-var">register</span></a></span><span>
</span><span id="line-382"></span><span>    </span><span id="local-6989586621679056923"><span class="annot"><span class="annottext">release :: ReleaseKey -&gt; RWST i w s m ()
</span><a href="#local-6989586621679056923"><span class="hs-identifier hs-var hs-var hs-var hs-var">release</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; ReleaseKey -&gt; m ()
</span><a href="Pipes.Safe.html#release"><span class="hs-identifier hs-var">release</span></a></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="hs-comment">{-| Analogous to 'C.onException' from @Control.Monad.Catch@, except this also
    protects against premature termination

    @(\`onException\` io)@ is a monad morphism.
-}</span><span>
</span><span id="line-389"></span><span id="local-6989586621679057921"><span id="local-6989586621679057922"><span id="local-6989586621679057923"><span class="annot"><a href="Pipes.Safe.html#onException"><span class="hs-identifier hs-type">onException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057923"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679057923"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057922"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057923"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057921"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679057923"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057922"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-390"></span><span id="local-6989586621679056909"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679056909"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="onException"><span class="annot"><span class="annottext">onException :: forall (m :: * -&gt; *) a b. MonadSafe m =&gt; m a -&gt; Base m b -&gt; m a
</span><a href="Pipes.Safe.html#onException"><span class="hs-operator hs-var hs-var">`onException`</span></a></span></span><span> </span><span id="local-6989586621679056908"><span class="annot"><span class="annottext">Base m b
</span><a href="#local-6989586621679056908"><span class="hs-identifier hs-var">io</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-391"></span><span>    </span><span id="local-6989586621679056907"><span class="annot"><span class="annottext">ReleaseKey
</span><a href="#local-6989586621679056907"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; Base m () -&gt; m ReleaseKey
</span><a href="Pipes.Safe.html#register"><span class="hs-identifier hs-var">register</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Base m b
</span><a href="#local-6989586621679056908"><span class="hs-identifier hs-var">io</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>    </span><span id="local-6989586621679056906"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056906"><span class="hs-identifier hs-var">r</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679056909"><span class="hs-identifier hs-var">m1</span></a></span><span>
</span><span id="line-393"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadSafe m =&gt; ReleaseKey -&gt; m ()
</span><a href="Pipes.Safe.html#release"><span class="hs-identifier hs-var">release</span></a></span><span> </span><span class="annot"><span class="annottext">ReleaseKey
</span><a href="#local-6989586621679056907"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-394"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056906"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-395"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Safe.html#onException"><span class="hs-pragma hs-type">onException</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span class="hs-comment">{- $utilities
    These utilities let you supply a finalizer that runs in the 'Base' monad
    (i.e. the monad directly beneath 'SafeT').  If you don't need to use the
    full power of the 'Base' monad and you only need to use to use 'IO', then
    just wrap the finalizer in 'liftIO', like this:

&gt; myAction `finally` (liftIO myFinalizer)

    This will lead to a simple inferred type with a single 'MonadSafe'
    constraint:

&gt; (MonadSafe m) =&gt; ...

    For examples of this, see the utilities in &quot;Pipes.Safe.Prelude&quot;.

    If you omit the 'liftIO', the compiler will infer the following constraint
    instead:

&gt; (MonadSafe m, Base m ~ IO) =&gt; ...

    This means that this function would require 'IO' directly beneath the
    'SafeT' monad transformer, which might not be what you want.
-}</span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="hs-comment">{-| Analogous to 'C.finally' from @Control.Monad.Catch@, except this also
    protects against premature termination
-}</span><span>
</span><span id="line-424"></span><span id="local-6989586621679056903"><span id="local-6989586621679056904"><span id="local-6989586621679056905"><span class="annot"><a href="Pipes.Safe.html#finally"><span class="hs-identifier hs-type">finally</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056905"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056905"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056904"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056905"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056903"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056905"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056904"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-425"></span><span id="local-6989586621679056897"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679056897"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="finally"><span class="annot"><span class="annottext">finally :: forall (m :: * -&gt; *) a b. MonadSafe m =&gt; m a -&gt; Base m b -&gt; m a
</span><a href="Pipes.Safe.html#finally"><span class="hs-operator hs-var hs-var">`finally`</span></a></span></span><span> </span><span id="local-6989586621679056896"><span class="annot"><span class="annottext">Base m b
</span><a href="#local-6989586621679056896"><span class="hs-identifier hs-var">after</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
MonadSafe m =&gt;
Base m a -&gt; Base m b -&gt; m c -&gt; m c
</span><a href="Pipes.Safe.html#bracket_"><span class="hs-identifier hs-var">bracket_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Base m b
</span><a href="#local-6989586621679056896"><span class="hs-identifier hs-var">after</span></a></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679056897"><span class="hs-identifier hs-var">m1</span></a></span><span>
</span><span id="line-426"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Safe.html#finally"><span class="hs-pragma hs-type">finally</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span class="hs-comment">{-| Analogous to 'C.bracket' from @Control.Monad.Catch@, except this also
    protects against premature termination
-}</span><span>
</span><span id="line-431"></span><span id="local-6989586621679057907"><span id="local-6989586621679057908"><span id="local-6989586621679057909"><span id="local-6989586621679057910"><span class="annot"><a href="Pipes.Safe.html#bracket"><span class="hs-identifier hs-type">bracket</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057910"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057910"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057909"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679057909"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057910"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057908"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679057909"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679057910"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057907"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679057910"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057907"><span class="hs-identifier hs-type">c</span></a></span></span></span></span></span><span>
</span><span id="line-432"></span><span id="bracket"><span class="annot"><span class="annottext">bracket :: forall (m :: * -&gt; *) a b c.
MonadSafe m =&gt;
Base m a -&gt; (a -&gt; Base m b) -&gt; (a -&gt; m c) -&gt; m c
</span><a href="Pipes.Safe.html#bracket"><span class="hs-identifier hs-var hs-var">bracket</span></a></span></span><span> </span><span id="local-6989586621679056883"><span class="annot"><span class="annottext">Base m a
</span><a href="#local-6989586621679056883"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span id="local-6989586621679056882"><span class="annot"><span class="annottext">a -&gt; Base m b
</span><a href="#local-6989586621679056882"><span class="hs-identifier hs-var">after</span></a></span></span><span> </span><span id="local-6989586621679056881"><span class="annot"><span class="annottext">a -&gt; m c
</span><a href="#local-6989586621679056881"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b.
MonadMask m =&gt;
((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">mask</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679056880"><span class="annot"><span class="annottext">forall a. m a -&gt; m a
</span><a href="#local-6989586621679056880"><span class="hs-identifier hs-var">restore</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-433"></span><span>    </span><span id="local-6989586621679056879"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056879"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. MonadSafe m =&gt; Base m r -&gt; m r
</span><a href="Pipes.Safe.html#liftBase"><span class="hs-identifier hs-var">liftBase</span></a></span><span> </span><span class="annot"><span class="annottext">Base m a
</span><a href="#local-6989586621679056883"><span class="hs-identifier hs-var">before</span></a></span><span>
</span><span id="line-434"></span><span>    </span><span id="local-6989586621679056878"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679056878"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; m a
</span><a href="#local-6989586621679056880"><span class="hs-identifier hs-var">restore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; m c
</span><a href="#local-6989586621679056881"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056879"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. MonadSafe m =&gt; m a -&gt; Base m b -&gt; m a
</span><a href="Pipes.Safe.html#onException"><span class="hs-operator hs-var">`onException`</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Base m b
</span><a href="#local-6989586621679056882"><span class="hs-identifier hs-var">after</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056879"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-435"></span><span>    </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. MonadSafe m =&gt; Base m r -&gt; m r
</span><a href="Pipes.Safe.html#liftBase"><span class="hs-identifier hs-var">liftBase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Base m b
</span><a href="#local-6989586621679056882"><span class="hs-identifier hs-var">after</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056879"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679056878"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-437"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Safe.html#bracket"><span class="hs-pragma hs-type">bracket</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="hs-comment">{-| Analogous to 'C.bracket_' from @Control.Monad.Catch@, except this also
    protects against premature termination
-}</span><span>
</span><span id="line-442"></span><span id="local-6989586621679057911"><span id="local-6989586621679057912"><span id="local-6989586621679057913"><span id="local-6989586621679057914"><span class="annot"><a href="Pipes.Safe.html#bracket_"><span class="hs-identifier hs-type">bracket_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057914"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057914"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057913"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057914"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057912"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679057914"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057911"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679057914"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057911"><span class="hs-identifier hs-type">c</span></a></span></span></span></span></span><span>
</span><span id="line-443"></span><span id="bracket_"><span class="annot"><span class="annottext">bracket_ :: forall (m :: * -&gt; *) a b c.
MonadSafe m =&gt;
Base m a -&gt; Base m b -&gt; m c -&gt; m c
</span><a href="Pipes.Safe.html#bracket_"><span class="hs-identifier hs-var hs-var">bracket_</span></a></span></span><span> </span><span id="local-6989586621679056875"><span class="annot"><span class="annottext">Base m a
</span><a href="#local-6989586621679056875"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span id="local-6989586621679056874"><span class="annot"><span class="annottext">Base m b
</span><a href="#local-6989586621679056874"><span class="hs-identifier hs-var">after</span></a></span></span><span> </span><span id="local-6989586621679056873"><span class="annot"><span class="annottext">m c
</span><a href="#local-6989586621679056873"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
MonadSafe m =&gt;
Base m a -&gt; (a -&gt; Base m b) -&gt; (a -&gt; m c) -&gt; m c
</span><a href="Pipes.Safe.html#bracket"><span class="hs-identifier hs-var">bracket</span></a></span><span> </span><span class="annot"><span class="annottext">Base m a
</span><a href="#local-6989586621679056875"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Base m b
</span><a href="#local-6989586621679056874"><span class="hs-identifier hs-var">after</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m c
</span><a href="#local-6989586621679056873"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Safe.html#bracket_"><span class="hs-pragma hs-type">bracket_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span class="hs-comment">{-| Analogous to 'C.bracketOnError' from @Control.Monad.Catch@, except this also
    protects against premature termination
-}</span><span>
</span><span id="line-449"></span><span id="local-6989586621679056869"><span id="local-6989586621679056870"><span id="local-6989586621679056871"><span id="local-6989586621679056872"><span class="annot"><a href="Pipes.Safe.html#bracketOnError"><span class="hs-identifier hs-type">bracketOnError</span></a></span><span>
</span><span id="line-450"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056872"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056872"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056871"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679056871"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056872"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056870"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679056871"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056872"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056869"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056872"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056869"><span class="hs-identifier hs-type">c</span></a></span></span></span></span></span><span>
</span><span id="line-451"></span><span id="bracketOnError"><span class="annot"><span class="annottext">bracketOnError :: forall (m :: * -&gt; *) a b c.
MonadSafe m =&gt;
Base m a -&gt; (a -&gt; Base m b) -&gt; (a -&gt; m c) -&gt; m c
</span><a href="Pipes.Safe.html#bracketOnError"><span class="hs-identifier hs-var hs-var">bracketOnError</span></a></span></span><span> </span><span id="local-6989586621679056860"><span class="annot"><span class="annottext">Base m a
</span><a href="#local-6989586621679056860"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span id="local-6989586621679056859"><span class="annot"><span class="annottext">a -&gt; Base m b
</span><a href="#local-6989586621679056859"><span class="hs-identifier hs-var">after</span></a></span></span><span> </span><span id="local-6989586621679056858"><span class="annot"><span class="annottext">a -&gt; m c
</span><a href="#local-6989586621679056858"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b.
MonadMask m =&gt;
((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">mask</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679056857"><span class="annot"><span class="annottext">forall a. m a -&gt; m a
</span><a href="#local-6989586621679056857"><span class="hs-identifier hs-var">restore</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-452"></span><span>    </span><span id="local-6989586621679056856"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056856"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. MonadSafe m =&gt; Base m r -&gt; m r
</span><a href="Pipes.Safe.html#liftBase"><span class="hs-identifier hs-var">liftBase</span></a></span><span> </span><span class="annot"><span class="annottext">Base m a
</span><a href="#local-6989586621679056860"><span class="hs-identifier hs-var">before</span></a></span><span>
</span><span id="line-453"></span><span>    </span><span class="annot"><span class="annottext">forall a. m a -&gt; m a
</span><a href="#local-6989586621679056857"><span class="hs-identifier hs-var">restore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; m c
</span><a href="#local-6989586621679056858"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056856"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. MonadSafe m =&gt; m a -&gt; Base m b -&gt; m a
</span><a href="Pipes.Safe.html#onException"><span class="hs-operator hs-var">`onException`</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Base m b
</span><a href="#local-6989586621679056859"><span class="hs-identifier hs-var">after</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056856"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-454"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Safe.html#bracketOnError"><span class="hs-pragma hs-type">bracketOnError</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span class="hs-comment">{- $reexports
    @Control.Monad.Catch@ re-exports all functions except for the ones that
    conflict with the generalized versions provided here (i.e. 'bracket',
    'finally', etc.).

    @Control.Exception@ re-exports 'Exception' and 'SomeException'.
-}</span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="hs-comment">{- | Transform a 'Proxy' into one that catches any exceptions caused by its
     effects, and returns the resulting exception.
-}</span><span>
</span><span id="line-467"></span><span id="local-6989586621679057888"><span id="local-6989586621679057889"><span id="local-6989586621679057890"><span id="local-6989586621679057891"><span id="local-6989586621679057892"><span id="local-6989586621679057893"><span id="local-6989586621679057894"><span class="annot"><a href="Pipes.Safe.html#tryP"><span class="hs-identifier hs-type">tryP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057894"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="#local-6989586621679057893"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679057892"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057891"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057890"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057889"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057894"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057888"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679057892"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057891"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057890"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057889"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057894"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679057893"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057888"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span><span>
</span><span id="line-469"></span><span id="tryP"><span class="annot"><span class="annottext">tryP :: forall (m :: * -&gt; *) e a' a b' b r.
(MonadSafe m, Exception e) =&gt;
Proxy a' a b' b m r -&gt; Proxy a' a b' b m (Either e r)
</span><a href="Pipes.Safe.html#tryP"><span class="hs-identifier hs-var hs-var">tryP</span></a></span></span><span> </span><span id="local-6989586621679056840"><span class="annot"><span class="annottext">Proxy a' a b' b m r
</span><a href="#local-6989586621679056840"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Proxy a' a b' b m r
</span><a href="#local-6989586621679056840"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-470"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span>  </span><span id="local-6989586621679056839"><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056839"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span id="local-6989586621679056838"><span class="annot"><span class="annottext">a -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679056838"><span class="hs-identifier hs-var">fa</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r.
a' -&gt; (a -&gt; Proxy a' a b' b m r) -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">Request</span></span><span> </span><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056839"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679056837"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056837"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a' a b' b r.
(MonadSafe m, Exception e) =&gt;
Proxy a' a b' b m r -&gt; Proxy a' a b' b m (Either e r)
</span><a href="Pipes.Safe.html#tryP"><span class="hs-identifier hs-var">tryP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679056838"><span class="hs-identifier hs-var">fa</span></a></span><span>  </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056837"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Respond</span></span><span>  </span><span id="local-6989586621679056836"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679056836"><span class="hs-identifier hs-var">b</span></a></span></span><span>  </span><span id="local-6989586621679056835"><span class="annot"><span class="annottext">b' -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679056835"><span class="hs-identifier hs-var">fb'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r.
b -&gt; (b' -&gt; Proxy a' a b' b m r) -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">Respond</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679056836"><span class="hs-identifier hs-var">b</span></a></span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679056834"><span class="annot"><span class="annottext">b'
</span><a href="#local-6989586621679056834"><span class="hs-identifier hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a' a b' b r.
(MonadSafe m, Exception e) =&gt;
Proxy a' a b' b m r -&gt; Proxy a' a b' b m (Either e r)
</span><a href="Pipes.Safe.html#tryP"><span class="hs-identifier hs-var">tryP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b' -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679056835"><span class="hs-identifier hs-var">fb'</span></a></span><span> </span><span class="annot"><span class="annottext">b'
</span><a href="#local-6989586621679056834"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">M</span></span><span>        </span><span id="local-6989586621679056833"><span class="annot"><span class="annottext">m (Proxy a' a b' b m r)
</span><a href="#local-6989586621679056833"><span class="hs-identifier hs-var">m</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r.
m (Proxy a' a b' b m r) -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">M</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">C.try</span></span><span> </span><span class="annot"><span class="annottext">m (Proxy a' a b' b m r)
</span><a href="#local-6989586621679056833"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679056831"><span class="annot"><span class="annottext">Either e (Proxy a' a b' b m r)
</span><a href="#local-6989586621679056831"><span class="hs-identifier hs-var">eres</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either e (Proxy a' a b' b m r)
</span><a href="#local-6989586621679056831"><span class="hs-identifier hs-var">eres</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-473"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span>  </span><span id="local-6989586621679056830"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679056830"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r. r -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">Pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679056830"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679056829"><span class="annot"><span class="annottext">Proxy a' a b' b m r
</span><a href="#local-6989586621679056829"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a' a b' b r.
(MonadSafe m, Exception e) =&gt;
Proxy a' a b' b m r -&gt; Proxy a' a b' b m (Either e r)
</span><a href="Pipes.Safe.html#tryP"><span class="hs-identifier hs-var">tryP</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy a' a b' b m r
</span><a href="#local-6989586621679056829"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-475"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Pure</span></span><span>     </span><span id="local-6989586621679056828"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679056828"><span class="hs-identifier hs-var">r</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r. r -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">Pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679056828"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span class="hs-comment">{- | Allows direct handling of exceptions raised by the effects in a 'Proxy'.
-}</span><span>
</span><span id="line-479"></span><span id="local-6989586621679057869"><span id="local-6989586621679057870"><span id="local-6989586621679057871"><span id="local-6989586621679057872"><span id="local-6989586621679057873"><span id="local-6989586621679057874"><span id="local-6989586621679057875"><span class="annot"><a href="Pipes.Safe.html#catchP"><span class="hs-identifier hs-type">catchP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057875"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="#local-6989586621679057874"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679057873"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057872"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057871"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057870"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057875"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057869"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679057874"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679057873"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057872"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057871"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057870"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057875"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057869"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679057873"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057872"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057871"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057870"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057875"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057869"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span></span></span></span><span>
</span><span id="line-482"></span><span id="catchP"><span class="annot"><span class="annottext">catchP :: forall (m :: * -&gt; *) e a' a b' b r.
(MonadSafe m, Exception e) =&gt;
Proxy a' a b' b m r
-&gt; (e -&gt; Proxy a' a b' b m r) -&gt; Proxy a' a b' b m r
</span><a href="Pipes.Safe.html#catchP"><span class="hs-identifier hs-var hs-var">catchP</span></a></span></span><span> </span><span id="local-6989586621679056818"><span class="annot"><span class="annottext">Proxy a' a b' b m r
</span><a href="#local-6989586621679056818"><span class="hs-identifier hs-var">p0</span></a></span></span><span> </span><span id="local-6989586621679056817"><span class="annot"><span class="annottext">e -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679056817"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy a' a b' b m r -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679056816"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy a' a b' b m r
</span><a href="#local-6989586621679056818"><span class="hs-identifier hs-var">p0</span></a></span><span>
</span><span id="line-483"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-484"></span><span>    </span><span id="local-6989586621679056816"><span class="annot"><span class="annottext">go :: Proxy a' a b' b m r -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679056816"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679056815"><span class="annot"><span class="annottext">Proxy a' a b' b m r
</span><a href="#local-6989586621679056815"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Proxy a' a b' b m r
</span><a href="#local-6989586621679056815"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-485"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span>  </span><span id="local-6989586621679056814"><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056814"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span id="local-6989586621679056813"><span class="annot"><span class="annottext">a -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679056813"><span class="hs-identifier hs-var">fa</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r.
a' -&gt; (a -&gt; Proxy a' a b' b m r) -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">Request</span></span><span> </span><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056814"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679056812"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056812"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Proxy a' a b' b m r -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679056816"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679056813"><span class="hs-identifier hs-var">fa</span></a></span><span>  </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056812"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Respond</span></span><span>  </span><span id="local-6989586621679056811"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679056811"><span class="hs-identifier hs-var">b</span></a></span></span><span>  </span><span id="local-6989586621679056810"><span class="annot"><span class="annottext">b' -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679056810"><span class="hs-identifier hs-var">fb'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r.
b -&gt; (b' -&gt; Proxy a' a b' b m r) -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">Respond</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679056811"><span class="hs-identifier hs-var">b</span></a></span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679056809"><span class="annot"><span class="annottext">b'
</span><a href="#local-6989586621679056809"><span class="hs-identifier hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Proxy a' a b' b m r -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679056816"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b' -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679056810"><span class="hs-identifier hs-var">fb'</span></a></span><span> </span><span class="annot"><span class="annottext">b'
</span><a href="#local-6989586621679056809"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">M</span></span><span>        </span><span id="local-6989586621679056808"><span class="annot"><span class="annottext">m (Proxy a' a b' b m r)
</span><a href="#local-6989586621679056808"><span class="hs-identifier hs-var">m</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r.
m (Proxy a' a b' b m r) -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">M</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">C.catch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="annot"><span class="annottext">Proxy a' a b' b m r -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679056816"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">m (Proxy a' a b' b m r)
</span><a href="#local-6989586621679056808"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">e -&gt; Proxy a' a b' b m r
</span><a href="#local-6989586621679056817"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Pure</span></span><span>     </span><span id="local-6989586621679056807"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679056807"><span class="hs-identifier hs-var">r</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a' a b' b (m :: * -&gt; *) r. r -&gt; Proxy a' a b' b m r
</span><span class="hs-identifier hs-var">Pure</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679056807"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-489"></span></pre></body></html>