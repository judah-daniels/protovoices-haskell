<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">{- | A chart-based semiring parser for path grammars (e.g. the PV grammar).
Path grammars operate on &quot;paths&quot;
consisting of nodes (slices) and edges (transitions),
both of which can contain arbitrary content.
Paths are elaborated through two operations,
@split@ting transitions and @spread@ing slices
(plus @freeze@, which terminates generation on a transition).

The parser is polymorphic in the grammar
as well as the contents of slices (path nodes) and transitions (path edges).
The grammar to parse is definend in an &quot;evaluator&quot; ('Common.Eval')
which provides completions for parsing the splits, spreads and freezes.
-}</span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">ChartParser</span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Parsing Interface</span></span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="ChartParser.html#parse"><span class="hs-identifier">parse</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#parseSize"><span class="hs-identifier">parseSize</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#parseSilent"><span class="hs-identifier">parseSilent</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#logSize"><span class="hs-identifier">logSize</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#logTikz"><span class="hs-identifier">logTikz</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Charts</span></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Basic Elements</span></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier">Slice</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier">Transition</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#transLen"><span class="hs-identifier">transLen</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Item"><span class="hs-identifier">Item</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier">TItem</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Transition Chart</span></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#TContents"><span class="hs-identifier">TContents</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier">TChart</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier">tcGetByLength</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Verticalization Chart</span></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier">Vert</span></a></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier">VChart</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#vcGetByLength"><span class="hs-identifier">vcGetByLength</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Constraint Aliases</span></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier">Parsable</span></a></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Normal"><span class="hs-identifier">Normal</span></a></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Normal%27"><span class="hs-identifier">Normal'</span></a></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Common.html"><span class="hs-identifier">Common</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Scoring.FunTyped.html"><span class="hs-identifier">Scoring.FunTyped</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IM</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Semiring</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ST</span></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Parallel.Strategies</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Hashable</span></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Hashable</span></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">hash</span></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">hashWithSalt</span></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Constraint</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-comment">-- Basic Types</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- ===========</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-- | An alias for common constraints on slices and transitions</span><span>
</span><span id="line-80"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="ChartParser.html#Normal"><span class="hs-identifier hs-type">Normal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Constraint</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">type</span><span> </span><span id="Normal"><span class="annot"><a href="ChartParser.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span></span><span> </span><span id="local-6989586621679519119"><span class="annot"><a href="#local-6989586621679519119"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679519119"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679519119"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519119"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679519119"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679519119"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- | An alias for common constraints on semiring values</span><span>
</span><span id="line-84"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="ChartParser.html#Normal%27"><span class="hs-identifier hs-type">Normal'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Constraint</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">type</span><span> </span><span id="Normal%27"><span class="annot"><a href="ChartParser.html#Normal%27"><span class="hs-identifier hs-var">Normal'</span></a></span></span><span> </span><span id="local-6989586621679519118"><span class="annot"><a href="#local-6989586621679519118"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679519118"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519118"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679519118"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">R.Semiring</span></span><span> </span><span class="annot"><a href="#local-6989586621679519118"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-comment">-- | A summary constraint for transitions, slices, and semiring values</span><span>
</span><span id="line-88"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Constraint</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">type</span><span> </span><span id="Parsable"><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-var">Parsable</span></a></span></span><span> </span><span id="local-6989586621679519117"><span class="annot"><a href="#local-6989586621679519117"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679519116"><span class="annot"><a href="#local-6989586621679519116"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679519115"><span class="annot"><a href="#local-6989586621679519115"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Normal"><span class="hs-identifier hs-type">Normal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519117"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Normal"><span class="hs-identifier hs-type">Normal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519116"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Normal%27"><span class="hs-identifier hs-type">Normal'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519115"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- Slices</span><span>
</span><span id="line-92"></span><span class="hs-comment">---------</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">{- | A slice during chart parsing.
 Besides the slice content (e.g., notes),
 it maintains indices to the first and last surface slice covered,
 as well as an ID that is used for matching compatible parents of a spread.
-}</span><span>
</span><span id="line-99"></span><span id="local-6989586621679519113"><span id="local-6989586621679519114"></span></span><span class="hs-keyword">data</span><span> </span><span id="Slice"><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-var">Slice</span></a></span></span><span> </span><span id="local-6989586621679519896"><span class="annot"><a href="#local-6989586621679519896"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Slice"><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-var">Slice</span></a></span></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="sFirst"><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sFirst"><span class="hs-identifier hs-var hs-var">sFirst</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-comment">-- ^ index of the first surface slice covered</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sContent"><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var hs-var">sContent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519896"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-comment">-- ^ slice content (or 'Start'/'Stop')</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sID"><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var hs-var">sID</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-comment">-- ^ unique slice ID</span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sLast"><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sLast"><span class="hs-identifier hs-var hs-var">sLast</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-comment">-- ^ index of the last surface slice covered</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679519098"><span id="local-6989586621679519106"><span class="annot"><span class="annottext">Slice slc -&gt; Slice slc -&gt; Bool
forall slc. Eq slc =&gt; Slice slc -&gt; Slice slc -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Slice slc -&gt; Slice slc -&gt; Bool
$c/= :: forall slc. Eq slc =&gt; Slice slc -&gt; Slice slc -&gt; Bool
== :: Slice slc -&gt; Slice slc -&gt; Bool
$c== :: forall slc. Eq slc =&gt; Slice slc -&gt; Slice slc -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679519068"><span id="local-6989586621679519070"><span id="local-6989586621679519073"><span id="local-6989586621679519076"><span id="local-6989586621679519079"><span id="local-6989586621679519085"><span id="local-6989586621679519093"><span class="annot"><span class="annottext">Slice slc -&gt; Slice slc -&gt; Bool
Slice slc -&gt; Slice slc -&gt; Ordering
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall {slc}. Ord slc =&gt; Eq (Slice slc)
forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Bool
forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Ordering
forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Slice slc
min :: Slice slc -&gt; Slice slc -&gt; Slice slc
$cmin :: forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Slice slc
max :: Slice slc -&gt; Slice slc -&gt; Slice slc
$cmax :: forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Slice slc
&gt;= :: Slice slc -&gt; Slice slc -&gt; Bool
$c&gt;= :: forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Bool
&gt; :: Slice slc -&gt; Slice slc -&gt; Bool
$c&gt; :: forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Bool
&lt;= :: Slice slc -&gt; Slice slc -&gt; Bool
$c&lt;= :: forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Bool
&lt; :: Slice slc -&gt; Slice slc -&gt; Bool
$c&lt; :: forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Bool
compare :: Slice slc -&gt; Slice slc -&gt; Ordering
$ccompare :: forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall slc x. Rep (Slice slc) x -&gt; Slice slc
forall slc x. Slice slc -&gt; Rep (Slice slc) x
$cto :: forall slc x. Rep (Slice slc) x -&gt; Slice slc
$cfrom :: forall slc x. Slice slc -&gt; Rep (Slice slc) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679519062"><span class="annot"><span class="annottext">forall slc. NFData slc =&gt; Slice slc -&gt; ()
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: Slice slc -&gt; ()
$crnf :: forall slc. NFData slc =&gt; Slice slc -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679519056"><span id="local-6989586621679519884"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679519884"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519884"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-112"></span><span>  </span><span id="local-6989586621679519052"><span class="annot"><span class="annottext">hashWithSalt :: Int -&gt; Slice slc -&gt; Int
</span><a href="#local-6989586621679519052"><span class="hs-identifier hs-var hs-var hs-var hs-var">hashWithSalt</span></a></span></span><span> </span><span id="local-6989586621679519051"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679519051"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">StartStop slc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679519050"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679519050"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Hashable a =&gt; Int -&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">hashWithSalt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679519051"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679519050"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679519045"><span id="local-6989586621679519048"><span id="local-6989586621679519881"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519881"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519881"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-115"></span><span>  </span><span id="local-6989586621679519030"><span class="annot"><span class="annottext">show :: Slice slc -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span id="local-6989586621679519028"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679519028"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679519027"><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679519027"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679519026"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679519026"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679519025"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679519025"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679519028"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679519027"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;@&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679519026"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679519025"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">-- Transitions</span><span>
</span><span id="line-119"></span><span class="hs-comment">--------------</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-comment">{- | A transition during chart parsing.
 Has pointers to the two slices it connects,
 a content (e.g., protovoice connections),
 and a flag indicating whether it is the second (right) parent of a spread.
-}</span><span>
</span><span id="line-126"></span><span id="local-6989586621679519023"><span id="local-6989586621679519024"></span></span><span class="hs-keyword">data</span><span> </span><span id="Transition"><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-var">Transition</span></a></span></span><span> </span><span id="local-6989586621679519875"><span class="annot"><a href="#local-6989586621679519875"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679519874"><span class="annot"><a href="#local-6989586621679519874"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Transition"><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-var">Transition</span></a></span></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="tLeftSlice"><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tLeftSlice"><span class="hs-identifier hs-var hs-var">tLeftSlice</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519874"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="tContent"><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; tr
</span><a href="ChartParser.html#tContent"><span class="hs-identifier hs-var hs-var">tContent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679519875"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="tRightSlice"><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tRightSlice"><span class="hs-identifier hs-var hs-var">tRightSlice</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519874"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="t2nd"><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Bool
</span><a href="ChartParser.html#t2nd"><span class="hs-identifier hs-var hs-var">t2nd</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679519009"><span id="local-6989586621679519016"><span class="annot"><span class="annottext">Transition tr slc -&gt; Transition tr slc -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall tr slc.
(Eq slc, Eq tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Bool
/= :: Transition tr slc -&gt; Transition tr slc -&gt; Bool
$c/= :: forall tr slc.
(Eq slc, Eq tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Bool
== :: Transition tr slc -&gt; Transition tr slc -&gt; Bool
$c== :: forall tr slc.
(Eq slc, Eq tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679518981"><span id="local-6989586621679518983"><span id="local-6989586621679518986"><span id="local-6989586621679518989"><span id="local-6989586621679518992"><span id="local-6989586621679518998"><span id="local-6989586621679519005"><span class="annot"><span class="annottext">Transition tr slc -&gt; Transition tr slc -&gt; Bool
Transition tr slc -&gt; Transition tr slc -&gt; Ordering
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall {tr} {slc}. (Ord slc, Ord tr) =&gt; Eq (Transition tr slc)
forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Bool
forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Ordering
forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Transition tr slc
min :: Transition tr slc -&gt; Transition tr slc -&gt; Transition tr slc
$cmin :: forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Transition tr slc
max :: Transition tr slc -&gt; Transition tr slc -&gt; Transition tr slc
$cmax :: forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Transition tr slc
&gt;= :: Transition tr slc -&gt; Transition tr slc -&gt; Bool
$c&gt;= :: forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Bool
&gt; :: Transition tr slc -&gt; Transition tr slc -&gt; Bool
$c&gt; :: forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Bool
&lt;= :: Transition tr slc -&gt; Transition tr slc -&gt; Bool
$c&lt;= :: forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Bool
&lt; :: Transition tr slc -&gt; Transition tr slc -&gt; Bool
$c&lt; :: forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Bool
compare :: Transition tr slc -&gt; Transition tr slc -&gt; Ordering
$ccompare :: forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall tr slc x. Rep (Transition tr slc) x -&gt; Transition tr slc
forall tr slc x. Transition tr slc -&gt; Rep (Transition tr slc) x
$cto :: forall tr slc x. Rep (Transition tr slc) x -&gt; Transition tr slc
$cfrom :: forall tr slc x. Transition tr slc -&gt; Rep (Transition tr slc) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679518977"><span class="annot"><span class="annottext">forall a. (a -&gt; ()) -&gt; NFData a
forall tr slc. (NFData slc, NFData tr) =&gt; Transition tr slc -&gt; ()
rnf :: Transition tr slc -&gt; ()
$crnf :: forall tr slc. (NFData slc, NFData tr) =&gt; Transition tr slc -&gt; ()
</span><a href="#local-6989586621679518977"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679518971"><span id="local-6989586621679518973"><span class="annot"><span class="annottext">forall a. Eq a -&gt; (Int -&gt; a -&gt; Int) -&gt; (a -&gt; Int) -&gt; Hashable a
forall {tr} {slc}. (Eq slc, Hashable tr) =&gt; Eq (Transition tr slc)
forall tr slc.
(Eq slc, Hashable tr) =&gt;
Int -&gt; Transition tr slc -&gt; Int
forall tr slc. (Eq slc, Hashable tr) =&gt; Transition tr slc -&gt; Int
hash :: Transition tr slc -&gt; Int
$chash :: forall tr slc. (Eq slc, Hashable tr) =&gt; Transition tr slc -&gt; Int
hashWithSalt :: Int -&gt; Transition tr slc -&gt; Int
$chashWithSalt :: forall tr slc.
(Eq slc, Hashable tr) =&gt;
Int -&gt; Transition tr slc -&gt; Int
</span><a href="#local-6989586621679518971"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Hashable</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679518966"><span id="local-6989586621679518969"><span id="local-6989586621679519864"><span id="local-6989586621679519865"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519865"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519864"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519864"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519865"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-135"></span><span>  </span><span id="local-6989586621679518955"><span class="annot"><span class="annottext">show :: Transition e a -&gt; String
</span><a href="#local-6989586621679518955"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span id="local-6989586621679518954"><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679518954"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679518953"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679518953"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679518952"><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679518952"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679518951"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679518951"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;&quot;</span></span><span>
</span><span id="line-137"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679518954"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-138"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span>
</span><span id="line-139"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679518953"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-140"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span>
</span><span id="line-141"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679518952"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-142"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&gt;&quot;</span></span><span>
</span><span id="line-143"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679518951"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-144"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;2&quot;</span></span><span>
</span><span id="line-145"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-comment">-- | Returns the &quot;length&quot; of the transition in terms of surface slices covered.</span><span>
</span><span id="line-148"></span><span id="local-6989586621679519862"><span id="local-6989586621679519863"><span class="annot"><a href="ChartParser.html#transLen"><span class="hs-identifier hs-type">transLen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519863"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519862"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span><span>
</span><span id="line-149"></span><span id="transLen"><span class="annot"><span class="annottext">transLen :: forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var hs-var">transLen</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span id="local-6989586621679518946"><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679518946"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679518945"><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679518945"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sLast"><span class="hs-identifier hs-var">sLast</span></a></span><span> </span><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679518945"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sFirst"><span class="hs-identifier hs-var">sFirst</span></a></span><span> </span><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679518946"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-comment">-- Items</span><span>
</span><span id="line-152"></span><span class="hs-comment">--------</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">{- | A parsing item.
 Combines an intermediate value (e.g. a transition) with a semiring score.
-}</span><span>
</span><span id="line-157"></span><span id="local-6989586621679518942"><span id="local-6989586621679518943"></span></span><span class="hs-keyword">data</span><span> </span><span id="Item"><span class="annot"><a href="ChartParser.html#Item"><span class="hs-identifier hs-var">Item</span></a></span></span><span> </span><span id="local-6989586621679519856"><span class="annot"><a href="#local-6989586621679519856"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621679519855"><span class="annot"><a href="#local-6989586621679519855"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="%3A%3D"><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-var">(:=)</span></a></span></span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="iItem"><span class="annot"><span class="annottext">forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var hs-var">iItem</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679519856"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="iScore"><span class="annot"><span class="annottext">forall i v. Item i v -&gt; Score v Int
</span><a href="ChartParser.html#iScore"><span class="hs-identifier hs-var hs-var">iScore</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Scoring.FunTyped.html#Score"><span class="hs-identifier hs-type">S.Score</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519855"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall i v x. Rep (Item i v) x -&gt; Item i v
forall i v x. Item i v -&gt; Rep (Item i v) x
$cto :: forall i v x. Rep (Item i v) x -&gt; Item i v
$cfrom :: forall i v x. Item i v -&gt; Rep (Item i v) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679518935"><span class="annot"><span class="annottext">forall a. (a -&gt; ()) -&gt; NFData a
forall i v. (NFData i, NFData v) =&gt; Item i v -&gt; ()
rnf :: Item i v -&gt; ()
$crnf :: forall i v. (NFData i, NFData v) =&gt; Item i v -&gt; ()
</span><a href="#local-6989586621679518935"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679518930"><span id="local-6989586621679518933"><span id="local-6989586621679519849"><span id="local-6989586621679519850"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519850"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519849"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519850"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519849"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-164"></span><span>  </span><span id="local-6989586621679518923"><span class="annot"><span class="annottext">show :: Item i v -&gt; String
</span><a href="#local-6989586621679518923"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679518922"><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679518922"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span id="local-6989586621679518921"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518921"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679518922"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; := &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518921"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-comment">-- | A transition item.</span><span>
</span><span id="line-167"></span><span class="hs-keyword">type</span><span> </span><span id="TItem"><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-var">TItem</span></a></span></span><span> </span><span id="local-6989586621679518920"><span class="annot"><a href="#local-6989586621679518920"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679518919"><span class="annot"><a href="#local-6989586621679518919"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679518918"><span class="annot"><a href="#local-6989586621679518918"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="ChartParser.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518920"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518919"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679518918"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-comment">-- Vert Items</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">{- | Represents the middle part of an incomplete unspread (&quot;verticalization&quot;).
 Expresses how the middle transition and the two child slices (@vMiddle@)
 are derived from the parent slice (@vTop@) using a spread operation (@vOp@).

 'Vert' objects are stored in the 'VChart'
 to record the intermediate steps of an unspread,
 which is found by first parsing the middle transition into the parent slice
 (generating a 'Vert')
 and then combining the 'Vert' with the left and right child transitions
 to generate the left and right parent transitions, respectively.
-}</span><span>
</span><span id="line-182"></span><span id="local-6989586621679518916"><span id="local-6989586621679518917"></span></span><span class="hs-keyword">data</span><span> </span><span id="Vert"><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-var">Vert</span></a></span></span><span> </span><span id="local-6989586621679519843"><span class="annot"><a href="#local-6989586621679519843"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679519842"><span class="annot"><a href="#local-6989586621679519842"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679519841"><span class="annot"><a href="#local-6989586621679519841"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Vert"><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-var">Vert</span></a></span></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="vTop"><span class="annot"><span class="annottext">forall tr slc v. Vert tr slc v -&gt; Slice slc
</span><a href="ChartParser.html#vTop"><span class="hs-identifier hs-var hs-var">vTop</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519842"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="vOp"><span class="annot"><span class="annottext">forall tr slc v. Vert tr slc v -&gt; v
</span><a href="ChartParser.html#vOp"><span class="hs-identifier hs-var hs-var">vOp</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679519841"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="vMiddle"><span class="annot"><span class="annottext">forall tr slc v. Vert tr slc v -&gt; TItem tr slc v
</span><a href="ChartParser.html#vMiddle"><span class="hs-identifier hs-var hs-var">vMiddle</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519843"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519842"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519841"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall tr slc v x. Rep (Vert tr slc v) x -&gt; Vert tr slc v
forall tr slc v x. Vert tr slc v -&gt; Rep (Vert tr slc v) x
$cto :: forall tr slc v x. Rep (Vert tr slc v) x -&gt; Vert tr slc v
$cfrom :: forall tr slc v x. Vert tr slc v -&gt; Rep (Vert tr slc v) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679518908"><span class="annot"><span class="annottext">forall a. (a -&gt; ()) -&gt; NFData a
forall tr slc v.
(NFData slc, NFData v, NFData tr) =&gt;
Vert tr slc v -&gt; ()
rnf :: Vert tr slc v -&gt; ()
$crnf :: forall tr slc v.
(NFData slc, NFData v, NFData tr) =&gt;
Vert tr slc v -&gt; ()
</span><a href="#local-6989586621679518908"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679518903"><span id="local-6989586621679518906"><span id="local-6989586621679519829"><span id="local-6989586621679519830"><span id="local-6989586621679519831"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519831"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519830"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519829"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519831"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519830"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519829"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-190"></span><span>  </span><span id="local-6989586621679518892"><span class="annot"><span class="annottext">show :: Vert e a v -&gt; String
</span><a href="#local-6989586621679518892"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span id="local-6989586621679518891"><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679518891"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621679518890"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679518890"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679518889"><span class="annot"><span class="annottext">TItem e a v
</span><a href="#local-6989586621679518889"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Vert&quot;</span></span><span>
</span><span id="line-192"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n top: &quot;</span></span><span>
</span><span id="line-193"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679518891"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-194"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n op:  &quot;</span></span><span>
</span><span id="line-195"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679518890"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-196"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n m:   &quot;</span></span><span>
</span><span id="line-197"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TItem e a v
</span><a href="#local-6989586621679518889"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">-- slice and transition charts</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- ===========================</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-comment">-- vert chart</span><span>
</span><span id="line-203"></span><span class="hs-comment">-------------</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-comment">-- ops:</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- - get all of len n</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- - get all with left child = x</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- - get all with right child = x</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- - check ID for (top,left,leftid)</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-comment">{- | A verticalization chart.
 Stores 'Vert' objects at certain chart positions.
 To support efficient lookup of 'Vert' objects from different indices,
 each 'Vert' is redundantly stored in several hash maps,
 one for each index:

 - by surface length
 - by surface length (only left border of a 'Vert')
 - by left child slice ID and mid transition length
 - by right child ID

 In addition, the 'VChart' maintains IDs of new slices.
 (Every new slice is the parent of an unspread.)
-}</span><span>
</span><span id="line-225"></span><span id="local-6989586621679518887"><span id="local-6989586621679518888"></span></span><span class="hs-keyword">data</span><span> </span><span id="VChart"><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-var">VChart</span></a></span></span><span> </span><span id="local-6989586621679519825"><span class="annot"><a href="#local-6989586621679519825"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679519824"><span class="annot"><a href="#local-6989586621679519824"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679519823"><span class="annot"><a href="#local-6989586621679519823"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="VChart"><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-var">VChart</span></a></span></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="vcNextId"><span class="annot"><span class="annottext">forall tr slc v. VChart tr slc v -&gt; Int
</span><a href="ChartParser.html#vcNextId"><span class="hs-identifier hs-var hs-var">vcNextId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-comment">-- ^ next free ID</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="vcIDs"><span class="annot"><span class="annottext">forall tr slc v. VChart tr slc v -&gt; HashMap (Int, Int) Int
</span><a href="ChartParser.html#vcIDs"><span class="hs-identifier hs-var hs-var">vcIDs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-comment">-- ^ a mapping from child slice ids to the corresponding parent id</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="vcByLength"><span class="annot"><span class="annottext">forall tr slc v. VChart tr slc v -&gt; IntMap [Vert tr slc v]
</span><a href="ChartParser.html#vcByLength"><span class="hs-identifier hs-var hs-var">vcByLength</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IM.IntMap</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519825"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519824"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519823"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-comment">-- ^ maps surface length to the 'Vert' with that length</span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="vcByLengthLeft"><span class="annot"><span class="annottext">forall tr slc v.
VChart tr slc v -&gt; IntMap (Set (Slice slc, Slice slc))
</span><a href="ChartParser.html#vcByLengthLeft"><span class="hs-identifier hs-var hs-var">vcByLengthLeft</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IM.IntMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519824"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519824"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-comment">-- ^ maps surface length to the &quot;left borders&quot; of 'Vert' objects with that length</span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-comment">-- (parent slice, left child slice)</span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="vcByLeftChild"><span class="annot"><span class="annottext">forall tr slc v.
VChart tr slc v -&gt; HashMap (Int, Int) (Set (Slice slc))
</span><a href="ChartParser.html#vcByLeftChild"><span class="hs-identifier hs-var hs-var">vcByLeftChild</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519824"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-comment">-- ^ maps a left child slice ID and the surface length of the middle transition</span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-comment">-- to its potential parent slices</span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="vcByRightChild"><span class="annot"><span class="annottext">forall tr slc v.
VChart tr slc v -&gt; HashMap (Int, Int) [Vert tr slc v]
</span><a href="ChartParser.html#vcByRightChild"><span class="hs-identifier hs-var hs-var">vcByRightChild</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519825"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519824"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519823"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-comment">-- ^ maps a right child slice ID and the surface length of the middle transition</span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-comment">-- to all 'Vert' objects it is part of.</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall tr slc v x. Rep (VChart tr slc v) x -&gt; VChart tr slc v
forall tr slc v x. VChart tr slc v -&gt; Rep (VChart tr slc v) x
$cto :: forall tr slc v x. Rep (VChart tr slc v) x -&gt; VChart tr slc v
$cfrom :: forall tr slc v x. VChart tr slc v -&gt; Rep (VChart tr slc v) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679518876"><span class="annot"><span class="annottext">forall a. (a -&gt; ()) -&gt; NFData a
forall tr slc v.
(NFData slc, NFData v, NFData tr) =&gt;
VChart tr slc v -&gt; ()
rnf :: VChart tr slc v -&gt; ()
$crnf :: forall tr slc v.
(NFData slc, NFData v, NFData tr) =&gt;
VChart tr slc v -&gt; ()
</span><a href="#local-6989586621679518876"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679518871"><span id="local-6989586621679518874"><span id="local-6989586621679519802"><span id="local-6989586621679519803"><span id="local-6989586621679519804"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519804"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519803"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519802"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519804"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519803"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519802"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-245"></span><span>  </span><span id="local-6989586621679518866"><span class="annot"><span class="annottext">show :: VChart e a v -&gt; String
</span><a href="#local-6989586621679518866"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span id="local-6989586621679518865"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518865"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679518864"><span class="annot"><span class="annottext">IntMap [Vert e a v]
</span><a href="#local-6989586621679518864"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="annot"><span class="annottext">IntMap (Set (Slice a, Slice a))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) (Set (Slice a))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) [Vert e a v]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;VChart (next id: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518865"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679518863"><span class="hs-identifier hs-var">levels</span></a></span><span>
</span><span id="line-246"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-247"></span><span>    </span><span id="local-6989586621679518863"><span class="annot"><span class="annottext">levels :: String
</span><a href="#local-6989586621679518863"><span class="hs-identifier hs-var hs-var">levels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">forall {a} {t :: * -&gt; *} {a}.
(Show a, Foldable t, Show a) =&gt;
(a, t a) -&gt; String
</span><a href="#local-6989586621679518853"><span class="hs-identifier hs-var">showLevel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. IntMap a -&gt; [(Int, a)]
</span><span class="hs-identifier hs-var">IM.toAscList</span></span><span> </span><span class="annot"><span class="annottext">IntMap [Vert e a v]
</span><a href="#local-6989586621679518864"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621679518853"><span class="annot"><span class="annottext">showLevel :: (a, t a) -&gt; String
</span><a href="#local-6989586621679518853"><span class="hs-identifier hs-var hs-var">showLevel</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679518844"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679518844"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679518843"><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621679518843"><span class="hs-identifier hs-var">items</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nlevel &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679518844"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679518842"><span class="hs-identifier hs-var">sitems</span></a></span><span>
</span><span id="line-249"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-250"></span><span>      </span><span id="local-6989586621679518842"><span class="annot"><span class="annottext">sitems :: String
</span><a href="#local-6989586621679518842"><span class="hs-identifier hs-var hs-var">sitems</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n  &quot;</span></span><span> </span><span class="hs-operator">&lt;&gt;</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621679518843"><span class="hs-identifier hs-var">items</span></a></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-comment">-- | Returns an empty 'VChart' with the next free ID set to @n + 1@.</span><span>
</span><span id="line-253"></span><span id="local-6989586621679519786"><span id="local-6989586621679519787"><span id="local-6989586621679519788"><span class="annot"><a href="ChartParser.html#vcEmpty"><span class="hs-identifier hs-type">vcEmpty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519788"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519787"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519786"><span class="hs-identifier hs-type">v</span></a></span></span></span></span><span>
</span><span id="line-254"></span><span id="vcEmpty"><span class="annot"><span class="annottext">vcEmpty :: forall e a v. Int -&gt; VChart e a v
</span><a href="ChartParser.html#vcEmpty"><span class="hs-identifier hs-var hs-var">vcEmpty</span></a></span></span><span> </span><span id="local-6989586621679518834"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518834"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tr slc v.
Int
-&gt; HashMap (Int, Int) Int
-&gt; IntMap [Vert tr slc v]
-&gt; IntMap (Set (Slice slc, Slice slc))
-&gt; HashMap (Int, Int) (Set (Slice slc))
-&gt; HashMap (Int, Int) [Vert tr slc v]
-&gt; VChart tr slc v
</span><a href="ChartParser.html#VChart"><span class="hs-identifier hs-var">VChart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518834"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span> </span><span class="annot"><span class="annottext">forall a. IntMap a
</span><span class="hs-identifier hs-var">IM.empty</span></span><span> </span><span class="annot"><span class="annottext">forall a. IntMap a
</span><span class="hs-identifier hs-var">IM.empty</span></span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="hs-comment">-- | Insert a new 'Vert' object into a 'VChart'.</span><span>
</span><span id="line-257"></span><span id="local-6989586621679519780"><span id="local-6989586621679519781"><span id="local-6989586621679519782"><span class="annot"><a href="ChartParser.html#vcInsert"><span class="hs-identifier hs-type">vcInsert</span></a></span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679519782"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679519782"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519781"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519782"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519780"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-comment">-- ^ the old chart</span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679519782"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679519780"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519781"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519782"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519780"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-comment">-- ^ the new 'Vert' item's parent slice, operation, and middle child transition.</span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519781"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519782"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519780"><span class="hs-identifier hs-type">v</span></a></span></span></span></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-comment">-- ^ the new chart</span><span>
</span><span id="line-265"></span><span id="vcInsert"><span class="annot"><span class="annottext">vcInsert :: forall slc tr v.
(Hashable slc, Ord slc) =&gt;
VChart tr slc v -&gt; (slc, v, TItem tr slc v) -&gt; VChart tr slc v
</span><a href="ChartParser.html#vcInsert"><span class="hs-identifier hs-var hs-var">vcInsert</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span id="local-6989586621679518828"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518828"><span class="hs-identifier hs-var">nextid</span></a></span></span><span> </span><span id="local-6989586621679518827"><span class="annot"><span class="annottext">HashMap (Int, Int) Int
</span><a href="#local-6989586621679518827"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621679518826"><span class="annot"><span class="annottext">IntMap [Vert tr slc v]
</span><a href="#local-6989586621679518826"><span class="hs-identifier hs-var">bylen</span></a></span></span><span> </span><span id="local-6989586621679518825"><span class="annot"><span class="annottext">IntMap (Set (Slice slc, Slice slc))
</span><a href="#local-6989586621679518825"><span class="hs-identifier hs-var">bylenleft</span></a></span></span><span> </span><span id="local-6989586621679518824"><span class="annot"><span class="annottext">HashMap (Int, Int) (Set (Slice slc))
</span><a href="#local-6989586621679518824"><span class="hs-identifier hs-var">byleft</span></a></span></span><span> </span><span id="local-6989586621679518823"><span class="annot"><span class="annottext">HashMap (Int, Int) [Vert tr slc v]
</span><a href="#local-6989586621679518823"><span class="hs-identifier hs-var">byright</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679518822"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518822"><span class="hs-identifier hs-var">topContent</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679518821"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679518821"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679518820"><span class="annot"><span class="annottext">mid :: TItem tr slc v
</span><a href="#local-6989586621679518820"><span class="hs-identifier hs-var">mid</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679518819"><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679518819"><span class="hs-identifier hs-var">tmid</span></a></span></span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679518818"><span class="annot"><span class="annottext">left :: Slice slc
</span><a href="#local-6989586621679518818"><span class="hs-identifier hs-var hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tLeftSlice"><span class="hs-identifier hs-var">tLeftSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679518819"><span class="hs-identifier hs-var">tmid</span></a></span><span>
</span><span id="line-267"></span><span>      </span><span id="local-6989586621679518817"><span class="annot"><span class="annottext">right :: Slice slc
</span><a href="#local-6989586621679518817"><span class="hs-identifier hs-var hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tRightSlice"><span class="hs-identifier hs-var">tRightSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679518819"><span class="hs-identifier hs-var">tmid</span></a></span><span>
</span><span id="line-268"></span><span>      </span><span id="local-6989586621679518816"><span class="annot"><span class="annottext">idKey :: (Int, Int)
</span><a href="#local-6989586621679518816"><span class="hs-identifier hs-var hs-var">idKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518818"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518817"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679518803"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518803"><span class="hs-identifier hs-var">nextid'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679518802"><span class="annot"><span class="annottext">HashMap (Int, Int) Int
</span><a href="#local-6989586621679518802"><span class="hs-identifier hs-var">ids'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679518801"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518801"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679518816"><span class="hs-identifier hs-var">idKey</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) Int
</span><a href="#local-6989586621679518827"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-270"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679518799"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518799"><span class="hs-identifier hs-var">i'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518828"><span class="hs-identifier hs-var">nextid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) Int
</span><a href="#local-6989586621679518827"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518799"><span class="hs-identifier hs-var">i'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518828"><span class="hs-identifier hs-var">nextid</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insert</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679518816"><span class="hs-identifier hs-var">idKey</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518828"><span class="hs-identifier hs-var">nextid</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) Int
</span><a href="#local-6989586621679518827"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518828"><span class="hs-identifier hs-var">nextid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>      </span><span id="local-6989586621679518797"><span class="annot"><span class="annottext">top :: Slice slc
</span><a href="#local-6989586621679518797"><span class="hs-identifier hs-var hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall slc. Int -&gt; StartStop slc -&gt; Int -&gt; Int -&gt; Slice slc
</span><a href="ChartParser.html#Slice"><span class="hs-identifier hs-var">Slice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sFirst"><span class="hs-identifier hs-var">sFirst</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518818"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518822"><span class="hs-identifier hs-var">topContent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518801"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sLast"><span class="hs-identifier hs-var">sLast</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518817"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>      </span><span id="local-6989586621679518795"><span class="annot"><span class="annottext">vert :: [Vert tr slc v]
</span><a href="#local-6989586621679518795"><span class="hs-identifier hs-var hs-var">vert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall tr slc v. Slice slc -&gt; v -&gt; TItem tr slc v -&gt; Vert tr slc v
</span><a href="ChartParser.html#Vert"><span class="hs-identifier hs-var">Vert</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518797"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679518821"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518820"><span class="hs-identifier hs-var">mid</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-274"></span><span>      </span><span id="local-6989586621679518794"><span class="annot"><span class="annottext">vert' :: Set (Slice slc, Slice slc)
</span><a href="#local-6989586621679518794"><span class="hs-identifier hs-var hs-var">vert'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518797"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tLeftSlice"><span class="hs-identifier hs-var">tLeftSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679518819"><span class="hs-identifier hs-var">tmid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>      </span><span id="local-6989586621679518792"><span class="annot"><span class="annottext">vertl :: Set (Slice slc)
</span><a href="#local-6989586621679518792"><span class="hs-identifier hs-var hs-var">vertl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518797"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-276"></span><span>      </span><span id="local-6989586621679518790"><span class="annot"><span class="annottext">bylen' :: IntMap [Vert tr slc v]
</span><a href="#local-6989586621679518790"><span class="hs-identifier hs-var hs-var">bylen'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; a) -&gt; Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.insertWith</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679518819"><span class="hs-identifier hs-var">tmid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Vert tr slc v]
</span><a href="#local-6989586621679518795"><span class="hs-identifier hs-var">vert</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap [Vert tr slc v]
</span><a href="#local-6989586621679518826"><span class="hs-identifier hs-var">bylen</span></a></span><span>
</span><span id="line-277"></span><span>      </span><span id="local-6989586621679518781"><span class="annot"><span class="annottext">bylenleft' :: IntMap (Set (Slice slc, Slice slc))
</span><a href="#local-6989586621679518781"><span class="hs-identifier hs-var hs-var">bylenleft'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; a) -&gt; Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.insertWith</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679518819"><span class="hs-identifier hs-var">tmid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (Slice slc, Slice slc)
</span><a href="#local-6989586621679518794"><span class="hs-identifier hs-var">vert'</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap (Set (Slice slc, Slice slc))
</span><a href="#local-6989586621679518825"><span class="hs-identifier hs-var">bylenleft</span></a></span><span>
</span><span id="line-278"></span><span>      </span><span id="local-6989586621679518771"><span class="annot"><span class="annottext">byleft' :: HashMap (Int, Int) (Set (Slice slc))
</span><a href="#local-6989586621679518771"><span class="hs-identifier hs-var hs-var">byleft'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v -&gt; v) -&gt; k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insertWith</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518818"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679518819"><span class="hs-identifier hs-var">tmid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (Slice slc)
</span><a href="#local-6989586621679518792"><span class="hs-identifier hs-var">vertl</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) (Set (Slice slc))
</span><a href="#local-6989586621679518824"><span class="hs-identifier hs-var">byleft</span></a></span><span>
</span><span id="line-279"></span><span>      </span><span id="local-6989586621679518762"><span class="annot"><span class="annottext">byright' :: HashMap (Int, Int) [Vert tr slc v]
</span><a href="#local-6989586621679518762"><span class="hs-identifier hs-var hs-var">byright'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v -&gt; v) -&gt; k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insertWith</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518817"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679518819"><span class="hs-identifier hs-var">tmid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Vert tr slc v]
</span><a href="#local-6989586621679518795"><span class="hs-identifier hs-var">vert</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) [Vert tr slc v]
</span><a href="#local-6989586621679518823"><span class="hs-identifier hs-var">byright</span></a></span><span>
</span><span id="line-280"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tr slc v.
Int
-&gt; HashMap (Int, Int) Int
-&gt; IntMap [Vert tr slc v]
-&gt; IntMap (Set (Slice slc, Slice slc))
-&gt; HashMap (Int, Int) (Set (Slice slc))
-&gt; HashMap (Int, Int) [Vert tr slc v]
-&gt; VChart tr slc v
</span><a href="ChartParser.html#VChart"><span class="hs-identifier hs-var">VChart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518803"><span class="hs-identifier hs-var">nextid'</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) Int
</span><a href="#local-6989586621679518802"><span class="hs-identifier hs-var">ids'</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap [Vert tr slc v]
</span><a href="#local-6989586621679518790"><span class="hs-identifier hs-var">bylen'</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap (Set (Slice slc, Slice slc))
</span><a href="#local-6989586621679518781"><span class="hs-identifier hs-var">bylenleft'</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) (Set (Slice slc))
</span><a href="#local-6989586621679518771"><span class="hs-identifier hs-var">byleft'</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) [Vert tr slc v]
</span><a href="#local-6989586621679518762"><span class="hs-identifier hs-var">byright'</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="hs-comment">-- | Merge a sequence of new items into a 'VChart'</span><span>
</span><span id="line-283"></span><span id="local-6989586621679519757"><span id="local-6989586621679519758"><span id="local-6989586621679519759"><span id="local-6989586621679519760"><span class="annot"><a href="ChartParser.html#vcMerge"><span class="hs-identifier hs-type">vcMerge</span></a></span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679519760"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679519759"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679519759"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519758"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519759"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519757"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679519760"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679519759"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679519757"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519758"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519759"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519757"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519758"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519759"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519757"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span><span>
</span><span id="line-288"></span><span id="vcMerge"><span class="annot"><span class="annottext">vcMerge :: forall (t :: * -&gt; *) slc tr v.
(Foldable t, Ord slc, Hashable slc) =&gt;
VChart tr slc v -&gt; t (slc, v, TItem tr slc v) -&gt; VChart tr slc v
</span><a href="ChartParser.html#vcMerge"><span class="hs-identifier hs-var hs-var">vcMerge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">forall slc tr v.
(Hashable slc, Ord slc) =&gt;
VChart tr slc v -&gt; (slc, v, TItem tr slc v) -&gt; VChart tr slc v
</span><a href="ChartParser.html#vcInsert"><span class="hs-identifier hs-var">vcInsert</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="hs-comment">-- | Returns all 'Vert' objects in the 'VChart' with the same length.</span><span>
</span><span id="line-291"></span><span id="local-6989586621679519749"><span id="local-6989586621679519750"><span id="local-6989586621679519751"><span class="annot"><a href="ChartParser.html#vcGetByLength"><span class="hs-identifier hs-type">vcGetByLength</span></a></span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519751"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519750"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519749"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-comment">-- ^ the chart</span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-comment">-- ^ surface length of a middle transition</span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519751"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519750"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519749"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-comment">-- ^ all corresponding 'Vert' objects</span><span>
</span><span id="line-298"></span><span id="vcGetByLength"><span class="annot"><span class="annottext">vcGetByLength :: forall tr slc v. VChart tr slc v -&gt; Int -&gt; [Vert tr slc v]
</span><a href="ChartParser.html#vcGetByLength"><span class="hs-identifier hs-var hs-var">vcGetByLength</span></a></span></span><span> </span><span id="local-6989586621679518754"><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518754"><span class="hs-identifier hs-var">chart</span></a></span></span><span> </span><span id="local-6989586621679518753"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518753"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IM.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518753"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall tr slc v. VChart tr slc v -&gt; IntMap [Vert tr slc v]
</span><a href="ChartParser.html#vcByLength"><span class="hs-identifier hs-var">vcByLength</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518754"><span class="hs-identifier hs-var">chart</span></a></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="hs-comment">-- | Returns the &quot;left borders&quot; of all 'Vert' objects in the 'VChart' with the same length.</span><span>
</span><span id="line-301"></span><span id="local-6989586621679519740"><span id="local-6989586621679519741"><span id="local-6989586621679519742"><span class="annot"><a href="ChartParser.html#vcGetByLengthLeft"><span class="hs-identifier hs-type">vcGetByLengthLeft</span></a></span><span>
</span><span id="line-302"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519742"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519741"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519740"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-comment">-- ^ the chart</span><span>
</span><span id="line-304"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-comment">-- ^ the surface length of a middle transition</span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519741"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519741"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-comment">-- ^ (parent slice, left slice) of all corresponding 'Vert' objects (without duplicates)</span><span>
</span><span id="line-308"></span><span id="vcGetByLengthLeft"><span class="annot"><span class="annottext">vcGetByLengthLeft :: forall tr slc v. VChart tr slc v -&gt; Int -&gt; [(Slice slc, Slice slc)]
</span><a href="ChartParser.html#vcGetByLengthLeft"><span class="hs-identifier hs-var hs-var">vcGetByLengthLeft</span></a></span></span><span> </span><span id="local-6989586621679518750"><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518750"><span class="hs-identifier hs-var">chart</span></a></span></span><span> </span><span id="local-6989586621679518749"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518749"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-309"></span><span>  </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IM.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518749"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tr slc v.
VChart tr slc v -&gt; IntMap (Set (Slice slc, Slice slc))
</span><a href="ChartParser.html#vcByLengthLeft"><span class="hs-identifier hs-var">vcByLengthLeft</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518750"><span class="hs-identifier hs-var">chart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="hs-comment">{- | Returns the all potential parents of a left child slice
 up to a certain middle transition length.
-}</span><span>
</span><span id="line-314"></span><span id="local-6989586621679519731"><span id="local-6989586621679519732"><span id="local-6989586621679519733"><span class="annot"><a href="ChartParser.html#vcGetByLeftChild"><span class="hs-identifier hs-type">vcGetByLeftChild</span></a></span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679519733"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679519733"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-317"></span><span>  </span><span class="hs-comment">-- ^ maximum middle transition length</span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519732"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519733"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519731"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-comment">-- ^ the chart</span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519733"><span class="hs-identifier hs-type">slc</span></a></span><span>
</span><span id="line-321"></span><span>  </span><span class="hs-comment">-- ^ the left child slice</span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519733"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-comment">-- ^ all potential parent slices</span><span>
</span><span id="line-324"></span><span id="vcGetByLeftChild"><span class="annot"><span class="annottext">vcGetByLeftChild :: forall slc tr v.
(Ord slc, Hashable slc) =&gt;
Int -&gt; VChart tr slc v -&gt; Slice slc -&gt; [Slice slc]
</span><a href="ChartParser.html#vcGetByLeftChild"><span class="hs-identifier hs-var hs-var">vcGetByLeftChild</span></a></span></span><span> </span><span id="local-6989586621679518738"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518738"><span class="hs-identifier hs-var">maxn</span></a></span></span><span> </span><span id="local-6989586621679518737"><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518737"><span class="hs-identifier hs-var">chart</span></a></span></span><span> </span><span id="local-6989586621679518736"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518736"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-325"></span><span>  </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><span class="hs-identifier hs-var">Set.unions</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe (Set (Slice slc))
</span><a href="#local-6989586621679518734"><span class="hs-identifier hs-var">getN</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518738"><span class="hs-identifier hs-var">maxn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-326"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-327"></span><span>  </span><span id="local-6989586621679518734"><span class="annot"><span class="annottext">getN :: Int -&gt; Maybe (Set (Slice slc))
</span><a href="#local-6989586621679518734"><span class="hs-identifier hs-var hs-var">getN</span></a></span></span><span> </span><span id="local-6989586621679518727"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518727"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518736"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518727"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall tr slc v.
VChart tr slc v -&gt; HashMap (Int, Int) (Set (Slice slc))
</span><a href="ChartParser.html#vcByLeftChild"><span class="hs-identifier hs-var">vcByLeftChild</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518737"><span class="hs-identifier hs-var">chart</span></a></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="hs-comment">{- | Returns all 'Vert' objects with the same right child
 up to a certain middle transition length.
-}</span><span>
</span><span id="line-332"></span><span id="local-6989586621679519721"><span id="local-6989586621679519722"><span id="local-6989586621679519723"><span class="annot"><a href="ChartParser.html#vcGetByRightChild"><span class="hs-identifier hs-type">vcGetByRightChild</span></a></span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679519723"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679519723"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-comment">-- ^ ID of the right child</span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519722"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519723"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519721"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519723"><span class="hs-identifier hs-type">slc</span></a></span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519722"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519723"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519721"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-339"></span><span id="vcGetByRightChild"><span class="annot"><span class="annottext">vcGetByRightChild :: forall slc tr v.
(Ord slc, Hashable slc) =&gt;
Int -&gt; VChart tr slc v -&gt; Slice slc -&gt; [Vert tr slc v]
</span><a href="ChartParser.html#vcGetByRightChild"><span class="hs-identifier hs-var hs-var">vcGetByRightChild</span></a></span></span><span> </span><span id="local-6989586621679518720"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518720"><span class="hs-identifier hs-var">maxn</span></a></span></span><span> </span><span id="local-6989586621679518719"><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518719"><span class="hs-identifier hs-var">chart</span></a></span></span><span> </span><span id="local-6989586621679518718"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518718"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe [Vert tr slc v]
</span><a href="#local-6989586621679518716"><span class="hs-identifier hs-var">getN</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518720"><span class="hs-identifier hs-var">maxn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-341"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-342"></span><span>  </span><span id="local-6989586621679518716"><span class="annot"><span class="annottext">getN :: Int -&gt; Maybe [Vert tr slc v]
</span><a href="#local-6989586621679518716"><span class="hs-identifier hs-var hs-var">getN</span></a></span></span><span> </span><span id="local-6989586621679518709"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518709"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518718"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518709"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall tr slc v.
VChart tr slc v -&gt; HashMap (Int, Int) [Vert tr slc v]
</span><a href="ChartParser.html#vcByRightChild"><span class="hs-identifier hs-var">vcByRightChild</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518719"><span class="hs-identifier hs-var">chart</span></a></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="hs-comment">-- transition chart</span><span>
</span><span id="line-345"></span><span class="hs-comment">-------------------</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="hs-comment">-- ops:</span><span>
</span><span id="line-348"></span><span class="hs-comment">-- - get all of length n</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- - get all with left slice l</span><span>
</span><span id="line-350"></span><span class="hs-comment">-- - get all with right slice r</span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="hs-comment">{- | The contents of a transition chart (under a particular index).
 A mapping from transitions (with score ID constraints left and right)
 to (partial) semiring scores.
 This mapping usually contains all transition items that satisfy a certain criterion,
 irrespective of their position in the chart (which is encoded in the transitions themselves).

 When new transition items are added, if the transition already exists in the chart
 (as the result of a different partial parse),
 the scores of the new and existing items are &quot;added&quot; (this also requires the score IDs to match).
-}</span><span>
</span><span id="line-362"></span><span class="hs-keyword">type</span><span> </span><span id="TContents"><span class="annot"><a href="ChartParser.html#TContents"><span class="hs-identifier hs-var">TContents</span></a></span></span><span> </span><span id="local-6989586621679518708"><span class="annot"><a href="#local-6989586621679518708"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679518707"><span class="annot"><a href="#local-6989586621679518707"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679518706"><span class="annot"><a href="#local-6989586621679518706"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-363"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span>
</span><span id="line-364"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518708"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518707"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Scoring.FunTyped.html#LeftId"><span class="hs-identifier hs-type">S.LeftId</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Scoring.FunTyped.html#RightId"><span class="hs-identifier hs-type">S.RightId</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Scoring.FunTyped.html#Score"><span class="hs-identifier hs-type">S.Score</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518706"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="hs-comment">{- | A transition chart.
 Stores intermediate transition items redundantly under several indices:

 - by surface length
 - by left slice
 - by right slice
-}</span><span>
</span><span id="line-374"></span><span id="local-6989586621679518704"><span id="local-6989586621679518705"></span></span><span class="hs-keyword">data</span><span> </span><span id="TChart"><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-var">TChart</span></a></span></span><span> </span><span id="local-6989586621679519712"><span class="annot"><a href="#local-6989586621679519712"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679519711"><span class="annot"><a href="#local-6989586621679519711"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679519710"><span class="annot"><a href="#local-6989586621679519710"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TChart"><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-var">TChart</span></a></span></span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="tcByLength"><span class="annot"><span class="annottext">forall tr slc v. TChart tr slc v -&gt; IntMap (TContents tr slc v)
</span><a href="ChartParser.html#tcByLength"><span class="hs-identifier hs-var hs-var">tcByLength</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IM.IntMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TContents"><span class="hs-identifier hs-type">TContents</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519712"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519711"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519710"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="tcByLeft"><span class="annot"><span class="annottext">forall tr slc v.
TChart tr slc v -&gt; HashMap (Slice slc) (TContents tr slc v)
</span><a href="ChartParser.html#tcByLeft"><span class="hs-identifier hs-var hs-var">tcByLeft</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519711"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TContents"><span class="hs-identifier hs-type">TContents</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519712"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519711"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519710"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="tcByRight"><span class="annot"><span class="annottext">forall tr slc v.
TChart tr slc v -&gt; HashMap (Slice slc) (TContents tr slc v)
</span><a href="ChartParser.html#tcByRight"><span class="hs-identifier hs-var hs-var">tcByRight</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519711"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TContents"><span class="hs-identifier hs-type">TContents</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519712"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519711"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519710"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679518686"><span id="local-6989586621679518688"><span id="local-6989586621679518698"><span class="annot"><span class="annottext">Int -&gt; TChart tr slc v -&gt; ShowS
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall tr slc v.
(Show slc, Show tr) =&gt;
Int -&gt; TChart tr slc v -&gt; ShowS
forall tr slc v. (Show slc, Show tr) =&gt; [TChart tr slc v] -&gt; ShowS
forall tr slc v. (Show slc, Show tr) =&gt; TChart tr slc v -&gt; String
showList :: [TChart tr slc v] -&gt; ShowS
$cshowList :: forall tr slc v. (Show slc, Show tr) =&gt; [TChart tr slc v] -&gt; ShowS
show :: TChart tr slc v -&gt; String
$cshow :: forall tr slc v. (Show slc, Show tr) =&gt; TChart tr slc v -&gt; String
showsPrec :: Int -&gt; TChart tr slc v -&gt; ShowS
$cshowsPrec :: forall tr slc v.
(Show slc, Show tr) =&gt;
Int -&gt; TChart tr slc v -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall tr slc v x. Rep (TChart tr slc v) x -&gt; TChart tr slc v
forall tr slc v x. TChart tr slc v -&gt; Rep (TChart tr slc v) x
$cto :: forall tr slc v x. Rep (TChart tr slc v) x -&gt; TChart tr slc v
$cfrom :: forall tr slc v x. TChart tr slc v -&gt; Rep (TChart tr slc v) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679518670"><span class="annot"><span class="annottext">forall a. (a -&gt; ()) -&gt; NFData a
forall tr slc v.
(NFData slc, NFData tr, NFData v) =&gt;
TChart tr slc v -&gt; ()
rnf :: TChart tr slc v -&gt; ()
$crnf :: forall tr slc v.
(NFData slc, NFData tr, NFData v) =&gt;
TChart tr slc v -&gt; ()
</span><a href="#local-6989586621679518670"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span class="hs-comment">-- | Returns an empty transition chart.</span><span>
</span><span id="line-382"></span><span id="local-6989586621679519689"><span id="local-6989586621679519690"><span id="local-6989586621679519691"><span class="annot"><a href="ChartParser.html#tcEmpty"><span class="hs-identifier hs-type">tcEmpty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519691"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519690"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519689"><span class="hs-identifier hs-type">v</span></a></span></span></span></span><span>
</span><span id="line-383"></span><span id="tcEmpty"><span class="annot"><span class="annottext">tcEmpty :: forall tr slc v. TChart tr slc v
</span><a href="ChartParser.html#tcEmpty"><span class="hs-identifier hs-var hs-var">tcEmpty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tr slc v.
IntMap (TContents tr slc v)
-&gt; HashMap (Slice slc) (TContents tr slc v)
-&gt; HashMap (Slice slc) (TContents tr slc v)
-&gt; TChart tr slc v
</span><a href="ChartParser.html#TChart"><span class="hs-identifier hs-var">TChart</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IntMap a
</span><span class="hs-identifier hs-var">IM.empty</span></span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-comment">-- TODO: there might be room for improvement here</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="hs-comment">{- | Insert a new transition item into the transition chart.
 If the item's transition already exists, the existing and new score are &quot;added&quot;.
-}</span><span>
</span><span id="line-390"></span><span id="local-6989586621679519686"><span id="local-6989586621679519687"><span id="local-6989586621679519688"><span class="annot"><a href="ChartParser.html#tcInsert"><span class="hs-identifier hs-type">tcInsert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519688"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519687"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519686"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519688"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519687"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519686"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519688"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519687"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519686"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519688"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519687"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519686"><span class="hs-identifier hs-type">v</span></a></span></span></span></span><span>
</span><span id="line-391"></span><span id="tcInsert"><span class="annot"><span class="annottext">tcInsert :: forall tr slc v.
Parsable tr slc v =&gt;
TChart tr slc v -&gt; TItem tr slc v -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcInsert"><span class="hs-identifier hs-var hs-var">tcInsert</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span id="local-6989586621679518659"><span class="annot"><span class="annottext">IntMap (TContents tr slc v)
</span><a href="#local-6989586621679518659"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span id="local-6989586621679518658"><span class="annot"><span class="annottext">HashMap (Slice slc) (TContents tr slc v)
</span><a href="#local-6989586621679518658"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span id="local-6989586621679518657"><span class="annot"><span class="annottext">HashMap (Slice slc) (TContents tr slc v)
</span><a href="#local-6989586621679518657"><span class="hs-identifier hs-var">right</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679518656"><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679518656"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span id="local-6989586621679518655"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518655"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-392"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679518641"><span class="annot"><span class="annottext">new :: TContents tr slc v
</span><a href="#local-6989586621679518641"><span class="hs-identifier hs-var hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v. Hashable k =&gt; k -&gt; v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679518656"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall s i. Score s i -&gt; Maybe (LeftId i)
</span><a href="Scoring.FunTyped.html#leftSide"><span class="hs-identifier hs-var">S.leftSide</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518655"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall s i. Score s i -&gt; Maybe (RightId i)
</span><a href="Scoring.FunTyped.html#rightSide"><span class="hs-identifier hs-var">S.rightSide</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518655"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518655"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-393"></span><span>      </span><span id="local-6989586621679518637"><span class="annot"><span class="annottext">len' :: IntMap (TContents tr slc v)
</span><a href="#local-6989586621679518637"><span class="hs-identifier hs-var hs-var">len'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; a) -&gt; Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.insertWith</span></span><span> </span><span class="annot"><span class="annottext">TContents tr slc v -&gt; TContents tr slc v -&gt; TContents tr slc v
</span><a href="#local-6989586621679518636"><span class="hs-identifier hs-var">insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679518656"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TContents tr slc v
</span><a href="#local-6989586621679518641"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap (TContents tr slc v)
</span><a href="#local-6989586621679518659"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-394"></span><span>      </span><span id="local-6989586621679518632"><span class="annot"><span class="annottext">left' :: HashMap (Slice slc) (TContents tr slc v)
</span><a href="#local-6989586621679518632"><span class="hs-identifier hs-var hs-var">left'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v -&gt; v) -&gt; k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insertWith</span></span><span> </span><span class="annot"><span class="annottext">TContents tr slc v -&gt; TContents tr slc v -&gt; TContents tr slc v
</span><a href="#local-6989586621679518636"><span class="hs-identifier hs-var">insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tLeftSlice"><span class="hs-identifier hs-var">tLeftSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679518656"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TContents tr slc v
</span><a href="#local-6989586621679518641"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Slice slc) (TContents tr slc v)
</span><a href="#local-6989586621679518658"><span class="hs-identifier hs-var">left</span></a></span><span>
</span><span id="line-395"></span><span>      </span><span id="local-6989586621679518628"><span class="annot"><span class="annottext">right' :: HashMap (Slice slc) (TContents tr slc v)
</span><a href="#local-6989586621679518628"><span class="hs-identifier hs-var hs-var">right'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v -&gt; v) -&gt; k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insertWith</span></span><span> </span><span class="annot"><span class="annottext">TContents tr slc v -&gt; TContents tr slc v -&gt; TContents tr slc v
</span><a href="#local-6989586621679518636"><span class="hs-identifier hs-var">insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tRightSlice"><span class="hs-identifier hs-var">tRightSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679518656"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TContents tr slc v
</span><a href="#local-6989586621679518641"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Slice slc) (TContents tr slc v)
</span><a href="#local-6989586621679518657"><span class="hs-identifier hs-var">right</span></a></span><span>
</span><span id="line-396"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tr slc v.
IntMap (TContents tr slc v)
-&gt; HashMap (Slice slc) (TContents tr slc v)
-&gt; HashMap (Slice slc) (TContents tr slc v)
-&gt; TChart tr slc v
</span><a href="ChartParser.html#TChart"><span class="hs-identifier hs-var">TChart</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap (TContents tr slc v)
</span><a href="#local-6989586621679518637"><span class="hs-identifier hs-var">len'</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Slice slc) (TContents tr slc v)
</span><a href="#local-6989586621679518632"><span class="hs-identifier hs-var">left'</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Slice slc) (TContents tr slc v)
</span><a href="#local-6989586621679518628"><span class="hs-identifier hs-var">right'</span></a></span><span>
</span><span id="line-397"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-398"></span><span>  </span><span id="local-6989586621679518636"><span class="annot"><span class="annottext">insert :: TContents tr slc v -&gt; TContents tr slc v -&gt; TContents tr slc v
</span><a href="#local-6989586621679518636"><span class="hs-identifier hs-var hs-var">insert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v.
(Eq k, Hashable k) =&gt;
(k -&gt; v -&gt; v -&gt; v) -&gt; HashMap k v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.unionWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">(Transition tr slc, Maybe (LeftId Int), Maybe (RightId Int))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679518606"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518606"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621679518605"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518605"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s i.
(Semiring s, Eq i) =&gt;
Score s i -&gt; Score s i -&gt; Score s i
</span><a href="Scoring.FunTyped.html#addScores"><span class="hs-identifier hs-var">S.addScores</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518606"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518605"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="hs-comment">-- | Insert several transition items into the transition chart.</span><span>
</span><span id="line-401"></span><span id="local-6989586621679519651"><span id="local-6989586621679519652"><span id="local-6989586621679519653"><span id="local-6989586621679519654"><span class="annot"><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-type">tcMerge</span></a></span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679519654"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519653"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519652"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519651"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519653"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519652"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519651"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-404"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679519654"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519653"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519652"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519651"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519653"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519652"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519651"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span><span>
</span><span id="line-406"></span><span id="tcMerge"><span class="annot"><span class="annottext">tcMerge :: forall (t :: * -&gt; *) tr slc v.
(Foldable t, Parsable tr slc v) =&gt;
TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-var hs-var">tcMerge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">forall tr slc v.
Parsable tr slc v =&gt;
TChart tr slc v -&gt; TItem tr slc v -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcInsert"><span class="hs-identifier hs-var">tcInsert</span></a></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="hs-comment">-- | Helper function for getting transition items from the transition chart.</span><span>
</span><span id="line-409"></span><span id="local-6989586621679519642"><span id="local-6989586621679519643"><span id="local-6989586621679519644"><span id="local-6989586621679519645"><span id="local-6989586621679519646"><span class="annot"><a href="ChartParser.html#tcGetAny"><span class="hs-identifier hs-type">tcGetAny</span></a></span><span>
</span><span id="line-410"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519646"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519645"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519644"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679519643"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TContents"><span class="hs-identifier hs-type">TContents</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519646"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519645"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519644"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679519642"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679519643"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TContents"><span class="hs-identifier hs-type">TContents</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519646"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519645"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519644"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519646"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519645"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519644"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679519642"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-414"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519646"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519645"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519644"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span></span></span><span>
</span><span id="line-415"></span><span id="tcGetAny"><span class="annot"><span class="annottext">tcGetAny :: forall tr slc v m k.
(TChart tr slc v -&gt; m)
-&gt; (TContents tr slc v -&gt; k -&gt; m -&gt; TContents tr slc v)
-&gt; TChart tr slc v
-&gt; k
-&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetAny"><span class="hs-identifier hs-var hs-var">tcGetAny</span></a></span></span><span> </span><span id="local-6989586621679518595"><span class="annot"><span class="annottext">TChart tr slc v -&gt; m
</span><a href="#local-6989586621679518595"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span id="local-6989586621679518594"><span class="annot"><span class="annottext">TContents tr slc v -&gt; k -&gt; m -&gt; TContents tr slc v
</span><a href="#local-6989586621679518594"><span class="hs-identifier hs-var">getter</span></a></span></span><span> </span><span id="local-6989586621679518593"><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518593"><span class="hs-identifier hs-var">chart</span></a></span></span><span> </span><span id="local-6989586621679518592"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679518592"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-416"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall {i} {b} {c} {v}. ((i, b, c), Score v Int) -&gt; Item i v
</span><a href="#local-6989586621679518591"><span class="hs-identifier hs-var">mkItem</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TContents tr slc v -&gt; k -&gt; m -&gt; TContents tr slc v
</span><a href="#local-6989586621679518594"><span class="hs-identifier hs-var">getter</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679518592"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; m
</span><a href="#local-6989586621679518595"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518593"><span class="hs-identifier hs-var">chart</span></a></span><span>
</span><span id="line-417"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-418"></span><span>  </span><span id="local-6989586621679518591"><span class="annot"><span class="annottext">mkItem :: ((i, b, c), Score v Int) -&gt; Item i v
</span><a href="#local-6989586621679518591"><span class="hs-identifier hs-var hs-var">mkItem</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679518589"><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679518589"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679518588"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518588"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679518589"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">forall i v. i -&gt; Score v Int -&gt; Item i v
</span><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518588"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="hs-comment">-- | Returns all transition items with the same length.</span><span>
</span><span id="line-421"></span><span id="local-6989586621679519625"><span id="local-6989586621679519626"><span id="local-6989586621679519627"><span class="annot"><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-type">tcGetByLength</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519627"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519626"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519625"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519627"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519626"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519625"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-422"></span><span id="tcGetByLength"><span class="annot"><span class="annottext">tcGetByLength :: forall tr slc v. TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-var hs-var">tcGetByLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tr slc v m k.
(TChart tr slc v -&gt; m)
-&gt; (TContents tr slc v -&gt; k -&gt; m -&gt; TContents tr slc v)
-&gt; TChart tr slc v
-&gt; k
-&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetAny"><span class="hs-identifier hs-var">tcGetAny</span></a></span><span> </span><span class="annot"><span class="annottext">forall tr slc v. TChart tr slc v -&gt; IntMap (TContents tr slc v)
</span><a href="ChartParser.html#tcByLength"><span class="hs-identifier hs-var">tcByLength</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Int -&gt; IntMap a -&gt; a
</span><span class="hs-identifier hs-var">IM.findWithDefault</span></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="hs-comment">-- | Returns all transition items with the same left slice.</span><span>
</span><span id="line-425"></span><span id="local-6989586621679519621"><span id="local-6989586621679519622"><span id="local-6989586621679519623"><span class="annot"><a href="ChartParser.html#tcGetByLeft"><span class="hs-identifier hs-type">tcGetByLeft</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679519623"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679519623"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519622"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519623"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519621"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519623"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519622"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519623"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519621"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-426"></span><span id="tcGetByLeft"><span class="annot"><span class="annottext">tcGetByLeft :: forall slc tr v.
(Ord slc, Hashable slc) =&gt;
TChart tr slc v -&gt; Slice slc -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLeft"><span class="hs-identifier hs-var hs-var">tcGetByLeft</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tr slc v m k.
(TChart tr slc v -&gt; m)
-&gt; (TContents tr slc v -&gt; k -&gt; m -&gt; TContents tr slc v)
-&gt; TChart tr slc v
-&gt; k
-&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetAny"><span class="hs-identifier hs-var">tcGetAny</span></a></span><span> </span><span class="annot"><span class="annottext">forall tr slc v.
TChart tr slc v -&gt; HashMap (Slice slc) (TContents tr slc v)
</span><a href="ChartParser.html#tcByLeft"><span class="hs-identifier hs-var">tcByLeft</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; v -&gt; k -&gt; HashMap k v -&gt; v
</span><span class="hs-identifier hs-var">HM.findWithDefault</span></span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span class="hs-comment">-- | Returns all transition items with the same right slice.</span><span>
</span><span id="line-429"></span><span id="local-6989586621679518577"><span id="local-6989586621679518578"><span id="local-6989586621679518579"><span class="annot"><a href="ChartParser.html#tcGetByRight"><span class="hs-identifier hs-type">tcGetByRight</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679518579"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679518579"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518578"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518579"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518577"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518579"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518578"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518579"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518577"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-430"></span><span id="tcGetByRight"><span class="annot"><span class="annottext">tcGetByRight :: forall slc tr v.
(Ord slc, Hashable slc) =&gt;
TChart tr slc v -&gt; Slice slc -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByRight"><span class="hs-identifier hs-var hs-var">tcGetByRight</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tr slc v m k.
(TChart tr slc v -&gt; m)
-&gt; (TContents tr slc v -&gt; k -&gt; m -&gt; TContents tr slc v)
-&gt; TChart tr slc v
-&gt; k
-&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetAny"><span class="hs-identifier hs-var">tcGetAny</span></a></span><span> </span><span class="annot"><span class="annottext">forall tr slc v.
TChart tr slc v -&gt; HashMap (Slice slc) (TContents tr slc v)
</span><a href="ChartParser.html#tcByRight"><span class="hs-identifier hs-var">tcByRight</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; v -&gt; k -&gt; HashMap k v -&gt; v
</span><span class="hs-identifier hs-var">HM.findWithDefault</span></span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="hs-comment">-- parsing machinery</span><span>
</span><span id="line-433"></span><span class="hs-comment">-- =================</span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span class="hs-comment">-- applying evaluators</span><span>
</span><span id="line-436"></span><span class="hs-comment">----------------------</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- TODO: add checks that adjacent transitions and slices match?</span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="hs-comment">-- | Unspreads the two slices of a (middle) transition, if possible.</span><span>
</span><span id="line-440"></span><span id="local-6989586621679519614"><span id="local-6989586621679519615"><span id="local-6989586621679519616"><span class="annot"><a href="ChartParser.html#unspreadMiddle"><span class="hs-identifier hs-type">unspreadMiddle</span></a></span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.html#UnspreadMiddle"><span class="hs-identifier hs-type">UnspreadMiddle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519616"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519615"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519614"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-comment">-- ^ the UnspreadMiddle evaluator</span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519616"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519615"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519614"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-comment">-- ^ the middle transition</span><span>
</span><span id="line-445"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679519615"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679519614"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519616"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519615"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519614"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-comment">-- ^ the top slice, unspread operation,</span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-comment">-- and middle transition</span><span>
</span><span id="line-448"></span><span id="unspreadMiddle"><span class="annot"><span class="annottext">unspreadMiddle :: forall tr slc v.
UnspreadMiddle tr slc v
-&gt; TItem tr slc v -&gt; Maybe (slc, v, TItem tr slc v)
</span><a href="ChartParser.html#unspreadMiddle"><span class="hs-identifier hs-var hs-var">unspreadMiddle</span></a></span></span><span> </span><span id="local-6989586621679518563"><span class="annot"><span class="annottext">UnspreadMiddle tr slc v
</span><a href="#local-6989586621679518563"><span class="hs-identifier hs-var">unspreadm</span></a></span></span><span> </span><span id="local-6989586621679518562"><span class="annot"><span class="annottext">im :: TItem tr slc v
</span><a href="#local-6989586621679518562"><span class="hs-identifier hs-var">im</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span id="local-6989586621679518561"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518561"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679518560"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679518560"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679518559"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518559"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-449"></span><span>  </span><span id="local-6989586621679518558"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518558"><span class="hs-identifier hs-var">il</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a -&gt; Maybe a
</span><a href="Common.html#getInner"><span class="hs-identifier hs-var">getInner</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518561"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-450"></span><span>  </span><span id="local-6989586621679518556"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518556"><span class="hs-identifier hs-var">ir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a -&gt; Maybe a
</span><a href="Common.html#getInner"><span class="hs-identifier hs-var">getInner</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518559"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679518555"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518555"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679518554"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679518554"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnspreadMiddle tr slc v
</span><a href="#local-6989586621679518563"><span class="hs-identifier hs-var">unspreadm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518558"><span class="hs-identifier hs-var">il</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679518560"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518556"><span class="hs-identifier hs-var">ir</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518555"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679518554"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518562"><span class="hs-identifier hs-var">im</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="hs-comment">-- | Infers the possible left parent transitions of an unspread.</span><span>
</span><span id="line-455"></span><span id="local-6989586621679519604"><span id="local-6989586621679519605"><span id="local-6989586621679519606"><span class="annot"><a href="ChartParser.html#unspreadLeft"><span class="hs-identifier hs-type">unspreadLeft</span></a></span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519606"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519605"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">R.Semiring</span></span><span> </span><span class="annot"><a href="#local-6989586621679519604"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519604"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#UnspreadLeft"><span class="hs-identifier hs-type">UnspreadLeft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519605"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519606"><span class="hs-identifier hs-type">slc</span></a></span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-comment">-- ^ the UnspreadLeft evaluator</span><span>
</span><span id="line-459"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519605"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519606"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519604"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-460"></span><span>  </span><span class="hs-comment">-- ^ the left child transition</span><span>
</span><span id="line-461"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519606"><span class="hs-identifier hs-type">slc</span></a></span><span>
</span><span id="line-462"></span><span>  </span><span class="hs-comment">-- ^ the Vert's top slice and ID</span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519605"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519606"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519604"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-comment">-- ^ all possible left parent transitions</span><span>
</span><span id="line-465"></span><span id="unspreadLeft"><span class="annot"><span class="annottext">unspreadLeft :: forall slc tr v.
(Show slc, Show tr, Semiring v, Show v) =&gt;
UnspreadLeft tr slc
-&gt; TItem tr slc v -&gt; Slice slc -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unspreadLeft"><span class="hs-identifier hs-var hs-var">unspreadLeft</span></a></span></span><span> </span><span id="local-6989586621679518544"><span class="annot"><span class="annottext">UnspreadLeft tr slc
</span><a href="#local-6989586621679518544"><span class="hs-identifier hs-var">unspreadl</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679518543"><span class="annot"><span class="annottext">tleft :: Transition tr slc
</span><a href="#local-6989586621679518543"><span class="hs-identifier hs-var">tleft</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span id="local-6989586621679518542"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518542"><span class="hs-identifier hs-var">ll</span></a></span></span><span> </span><span id="local-6989586621679518541"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679518541"><span class="hs-identifier hs-var">lt</span></a></span></span><span> </span><span id="local-6989586621679518540"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518540"><span class="hs-identifier hs-var">lr</span></a></span></span><span> </span><span id="local-6989586621679518539"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679518539"><span class="hs-identifier hs-var">is2nd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span id="local-6989586621679518538"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518538"><span class="hs-identifier hs-var">vleft</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679518537"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518537"><span class="hs-identifier hs-var">top</span></a></span></span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679518539"><span class="hs-identifier hs-var">is2nd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-467"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">forall {a}. a
</span><a href="#local-6989586621679518536"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-468"></span><span>      </span><span id="local-6989586621679518535"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518535"><span class="hs-identifier hs-var">ir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a -&gt; Maybe a
</span><a href="Common.html#getInner"><span class="hs-identifier hs-var">getInner</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518540"><span class="hs-identifier hs-var">lr</span></a></span><span>
</span><span id="line-469"></span><span>      </span><span id="local-6989586621679518534"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518534"><span class="hs-identifier hs-var">itop</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a -&gt; Maybe a
</span><a href="Common.html#getInner"><span class="hs-identifier hs-var">getInner</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518537"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-470"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {v} {tr}. Score v Int -&gt; tr -&gt; Item (Transition tr slc) v
</span><a href="#local-6989586621679518533"><span class="hs-identifier hs-var">mkParent</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518532"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">UnspreadLeft tr slc
</span><a href="#local-6989586621679518544"><span class="hs-identifier hs-var">unspreadl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679518541"><span class="hs-identifier hs-var">lt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518535"><span class="hs-identifier hs-var">ir</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518534"><span class="hs-identifier hs-var">itop</span></a></span><span>
</span><span id="line-471"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-472"></span><span>  </span><span id="local-6989586621679518536"><span class="annot"><span class="annottext">err :: a
</span><a href="#local-6989586621679518536"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-473"></span><span>    </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-474"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal left-unspread: left=&quot;</span></span><span>
</span><span id="line-475"></span><span>        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679518543"><span class="hs-identifier hs-var">tleft</span></a></span><span>
</span><span id="line-476"></span><span>        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, top=&quot;</span></span><span>
</span><span id="line-477"></span><span>        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518537"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-478"></span><span>  </span><span id="local-6989586621679518532"><span class="annot"><span class="annottext">v' :: Score v Int
</span><a href="#local-6989586621679518532"><span class="hs-identifier hs-var hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s i.
(Eq i, Show i, Semiring s, Show s) =&gt;
i -&gt; Score s i -&gt; Score s i
</span><a href="Scoring.FunTyped.html#unspreadScoresLeft"><span class="hs-identifier hs-var">S.unspreadScoresLeft</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518537"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518538"><span class="hs-identifier hs-var">vleft</span></a></span><span>
</span><span id="line-479"></span><span>  </span><span id="local-6989586621679518533"><span class="annot"><span class="annottext">mkParent :: Score v Int -&gt; tr -&gt; Item (Transition tr slc) v
</span><a href="#local-6989586621679518533"><span class="hs-identifier hs-var hs-var">mkParent</span></a></span></span><span> </span><span id="local-6989586621679518515"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518515"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679518514"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679518514"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tr slc.
Slice slc -&gt; tr -&gt; Slice slc -&gt; Bool -&gt; Transition tr slc
</span><a href="ChartParser.html#Transition"><span class="hs-identifier hs-var">Transition</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518542"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679518514"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518537"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">forall i v. i -&gt; Score v Int -&gt; Item i v
</span><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518515"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span class="hs-comment">-- | Infers the possible right parent transitions of an unspread.</span><span>
</span><span id="line-482"></span><span id="local-6989586621679519586"><span id="local-6989586621679519587"><span id="local-6989586621679519588"><span class="annot"><a href="ChartParser.html#unspreadRight"><span class="hs-identifier hs-type">unspreadRight</span></a></span><span>
</span><span id="line-483"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">R.Semiring</span></span><span> </span><span class="annot"><a href="#local-6989586621679519588"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679519587"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679519586"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679519588"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519586"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519587"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519588"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#UnspreadRight"><span class="hs-identifier hs-type">UnspreadRight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519586"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519587"><span class="hs-identifier hs-type">slc</span></a></span><span>
</span><span id="line-485"></span><span>  </span><span class="hs-comment">-- ^ the UnspreadRight evaluator</span><span>
</span><span id="line-486"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519586"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519587"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519588"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-487"></span><span>  </span><span class="hs-comment">-- ^ the center 'Vert'</span><span>
</span><span id="line-488"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519586"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519587"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519588"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-489"></span><span>  </span><span class="hs-comment">-- ^ the right child transition</span><span>
</span><span id="line-490"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519586"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519587"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519588"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-comment">-- ^ all possible right parent transitions</span><span>
</span><span id="line-492"></span><span id="unspreadRight"><span class="annot"><span class="annottext">unspreadRight :: forall v slc tr.
(Semiring v, NFData slc, NFData tr, NFData v, Show tr, Show slc,
 Show v) =&gt;
UnspreadRight tr slc
-&gt; Vert tr slc v -&gt; TItem tr slc v -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unspreadRight"><span class="hs-identifier hs-var hs-var">unspreadRight</span></a></span></span><span> </span><span id="local-6989586621679518499"><span class="annot"><span class="annottext">UnspreadRight tr slc
</span><a href="#local-6989586621679518499"><span class="hs-identifier hs-var">unspreadr</span></a></span></span><span> </span><span id="local-6989586621679518498"><span class="annot"><span class="annottext">vert :: Vert tr slc v
</span><a href="#local-6989586621679518498"><span class="hs-identifier hs-var">vert</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span id="local-6989586621679518497"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518497"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621679518496"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679518496"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transition tr slc
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span id="local-6989586621679518495"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518495"><span class="hs-identifier hs-var">vm</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679518494"><span class="annot"><span class="annottext">tright :: TItem tr slc v
</span><a href="#local-6989586621679518494"><span class="hs-identifier hs-var">tright</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span id="local-6989586621679518493"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518493"><span class="hs-identifier hs-var">rl</span></a></span></span><span> </span><span id="local-6989586621679518492"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679518492"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679518491"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518491"><span class="hs-identifier hs-var">rr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span id="local-6989586621679518490"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518490"><span class="hs-identifier hs-var">vr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-493"></span><span>  </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">forall {a}. a
</span><a href="#local-6989586621679518489"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-494"></span><span>    </span><span id="local-6989586621679518488"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518488"><span class="hs-identifier hs-var">ir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a -&gt; Maybe a
</span><a href="Common.html#getInner"><span class="hs-identifier hs-var">getInner</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518493"><span class="hs-identifier hs-var">rl</span></a></span><span>
</span><span id="line-495"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. NFData a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">force</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {v} {tr}. Score v Int -&gt; tr -&gt; Item (Transition tr slc) v
</span><a href="#local-6989586621679518486"><span class="hs-identifier hs-var">mkParent</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518485"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">UnspreadRight tr slc
</span><a href="#local-6989586621679518499"><span class="hs-identifier hs-var">unspreadr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518488"><span class="hs-identifier hs-var">ir</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679518492"><span class="hs-identifier hs-var">rt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518488"><span class="hs-identifier hs-var">ir</span></a></span><span>
</span><span id="line-496"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-497"></span><span>  </span><span id="local-6989586621679518489"><span class="annot"><span class="annottext">err :: a
</span><a href="#local-6989586621679518489"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-498"></span><span>    </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-499"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal right-unspread: vert=&quot;</span></span><span>
</span><span id="line-500"></span><span>        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Vert tr slc v
</span><a href="#local-6989586621679518498"><span class="hs-identifier hs-var">vert</span></a></span><span>
</span><span id="line-501"></span><span>        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, right=&quot;</span></span><span>
</span><span id="line-502"></span><span>        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518494"><span class="hs-identifier hs-var">tright</span></a></span><span>
</span><span id="line-503"></span><span>  </span><span id="local-6989586621679518485"><span class="annot"><span class="annottext">v' :: Score v Int
</span><a href="#local-6989586621679518485"><span class="hs-identifier hs-var hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall i s.
(Eq i, Semiring s, Show i, Show s) =&gt;
i -&gt; s -&gt; Score s i -&gt; Score s i -&gt; Score s i
</span><a href="Scoring.FunTyped.html#unspreadScoresRight"><span class="hs-identifier hs-var">S.unspreadScoresRight</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518497"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679518496"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518495"><span class="hs-identifier hs-var">vm</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518490"><span class="hs-identifier hs-var">vr</span></a></span><span>
</span><span id="line-504"></span><span>  </span><span id="local-6989586621679518486"><span class="annot"><span class="annottext">mkParent :: Score v Int -&gt; tr -&gt; Item (Transition tr slc) v
</span><a href="#local-6989586621679518486"><span class="hs-identifier hs-var hs-var">mkParent</span></a></span></span><span> </span><span id="local-6989586621679518468"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518468"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679518467"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679518467"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tr slc.
Slice slc -&gt; tr -&gt; Slice slc -&gt; Bool -&gt; Transition tr slc
</span><a href="ChartParser.html#Transition"><span class="hs-identifier hs-var">Transition</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518497"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679518467"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518491"><span class="hs-identifier hs-var">rr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">forall i v. i -&gt; Score v Int -&gt; Item i v
</span><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518468"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span class="hs-comment">-- | Infers the possible parent transitions of a split.</span><span>
</span><span id="line-507"></span><span id="local-6989586621679519572"><span id="local-6989586621679519573"><span id="local-6989586621679519574"><span class="annot"><a href="ChartParser.html#unsplit"><span class="hs-identifier hs-type">unsplit</span></a></span><span>
</span><span id="line-508"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">R.Semiring</span></span><span> </span><span class="annot"><a href="#local-6989586621679519574"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679519573"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679519572"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679519574"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519574"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Unsplit"><span class="hs-identifier hs-type">Unsplit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519572"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519573"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519574"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-510"></span><span>  </span><span class="hs-comment">-- ^ the Unsplit evaluator</span><span>
</span><span id="line-511"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519572"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519573"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519574"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-512"></span><span>  </span><span class="hs-comment">-- ^ the left child transition</span><span>
</span><span id="line-513"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519572"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519573"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519574"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-514"></span><span>  </span><span class="hs-comment">-- ^ the right child transition</span><span>
</span><span id="line-515"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519572"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519573"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519574"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-516"></span><span>  </span><span class="hs-comment">-- ^ all possible parent transitions</span><span>
</span><span id="line-517"></span><span id="unsplit"><span class="annot"><span class="annottext">unsplit :: forall v slc tr.
(Semiring v, NFData slc, NFData tr, NFData v, Show v) =&gt;
Unsplit tr slc v
-&gt; TItem tr slc v -&gt; TItem tr slc v -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unsplit"><span class="hs-identifier hs-var hs-var">unsplit</span></a></span></span><span> </span><span id="local-6989586621679518454"><span class="annot"><span class="annottext">Unsplit tr slc v
</span><a href="#local-6989586621679518454"><span class="hs-identifier hs-var">mg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span id="local-6989586621679518453"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518453"><span class="hs-identifier hs-var">ll</span></a></span></span><span> </span><span id="local-6989586621679518452"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679518452"><span class="hs-identifier hs-var">lt</span></a></span></span><span> </span><span id="local-6989586621679518451"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518451"><span class="hs-identifier hs-var">lr</span></a></span></span><span> </span><span id="local-6989586621679518450"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679518450"><span class="hs-identifier hs-var">l2nd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span id="local-6989586621679518449"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518449"><span class="hs-identifier hs-var">vl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679518448"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679518448"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679518447"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518447"><span class="hs-identifier hs-var">rr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span id="local-6989586621679518446"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518446"><span class="hs-identifier hs-var">vr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-518"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a -&gt; Maybe a
</span><a href="Common.html#getInner"><span class="hs-identifier hs-var">getInner</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518451"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-519"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679518445"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518445"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-520"></span><span>      </span><span class="annot"><span class="annottext">forall a. NFData a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">force</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {tr}. (tr, v) -&gt; Item (Transition tr slc) v
</span><a href="#local-6989586621679518444"><span class="hs-identifier hs-var">mkItem</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Unsplit tr slc v
</span><a href="#local-6989586621679518454"><span class="hs-identifier hs-var">mg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518453"><span class="hs-identifier hs-var">ll</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679518452"><span class="hs-identifier hs-var">lt</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679518445"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679518448"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518447"><span class="hs-identifier hs-var">rr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SplitType
</span><a href="#local-6989586621679518443"><span class="hs-identifier hs-var">splitType</span></a></span><span>
</span><span id="line-521"></span><span>    </span><span class="annot"><span class="annottext">Maybe slc
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;trying to unsplit at a non-content slice&quot;</span></span><span>
</span><span id="line-522"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-523"></span><span>  </span><span id="local-6989586621679518443"><span class="annot"><span class="annottext">splitType :: SplitType
</span><a href="#local-6989586621679518443"><span class="hs-identifier hs-var hs-var">splitType</span></a></span></span><span>
</span><span id="line-524"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679518450"><span class="hs-identifier hs-var">l2nd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SplitType
</span><a href="Common.html#RightOfTwo"><span class="hs-identifier hs-var">RightOfTwo</span></a></span><span>
</span><span id="line-525"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a -&gt; Bool
</span><a href="Common.html#isStop"><span class="hs-identifier hs-var">isStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518447"><span class="hs-identifier hs-var">rr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SplitType
</span><a href="Common.html#SingleOfOne"><span class="hs-identifier hs-var">SingleOfOne</span></a></span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SplitType
</span><a href="Common.html#LeftOfTwo"><span class="hs-identifier hs-var">LeftOfTwo</span></a></span><span>
</span><span id="line-527"></span><span>  </span><span id="local-6989586621679518444"><span class="annot"><span class="annottext">mkItem :: (tr, v) -&gt; Item (Transition tr slc) v
</span><a href="#local-6989586621679518444"><span class="hs-identifier hs-var hs-var">mkItem</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679518434"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679518434"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679518433"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679518433"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tr slc.
Slice slc -&gt; tr -&gt; Slice slc -&gt; Bool -&gt; Transition tr slc
</span><a href="ChartParser.html#Transition"><span class="hs-identifier hs-var">Transition</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518453"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679518434"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518447"><span class="hs-identifier hs-var">rr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679518450"><span class="hs-identifier hs-var">l2nd</span></a></span><span> </span><span class="annot"><span class="annottext">forall i v. i -&gt; Score v Int -&gt; Item i v
</span><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a></span><span> </span><span class="annot"><span class="annottext">forall s i.
(Semiring s, Eq i, Show i, Show s) =&gt;
s -&gt; Score s i -&gt; Score s i -&gt; Score s i
</span><a href="Scoring.FunTyped.html#unsplitScores"><span class="hs-identifier hs-var">S.unsplitScores</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679518433"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518449"><span class="hs-identifier hs-var">vl</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679518446"><span class="hs-identifier hs-var">vr</span></a></span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span class="hs-comment">-- the parsing main loop</span><span>
</span><span id="line-530"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span class="hs-comment">-- | parallelized map</span><span>
</span><span id="line-533"></span><span id="local-6989586621679519561"><span id="local-6989586621679519562"><span class="annot"><a href="ChartParser.html#pmap"><span class="hs-identifier hs-type">pmap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679519562"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679519561"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679519562"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679519561"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679519562"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-534"></span><span id="pmap"><span class="annot"><span class="annottext">pmap :: forall b a. NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="ChartParser.html#pmap"><span class="hs-identifier hs-var hs-var">pmap</span></a></span></span><span> </span><span id="local-6989586621679518428"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679518428"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Strategy a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">P.withStrategy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Strategy a -&gt; Strategy [a]
</span><span class="hs-identifier hs-var">P.parList</span></span><span> </span><span class="annot"><span class="annottext">forall a. NFData a =&gt; Strategy a
</span><span class="hs-identifier hs-var">P.rdeepseq</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679518428"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span class="hs-comment">-- pmap = map</span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span class="hs-comment">{- | A type alias for  pair of transition chart ('TChart')
 and verticalization chart ('VChart').
-}</span><span>
</span><span id="line-541"></span><span class="hs-keyword">type</span><span> </span><span id="ParseState"><span class="annot"><a href="ChartParser.html#ParseState"><span class="hs-identifier hs-var">ParseState</span></a></span></span><span> </span><span id="local-6989586621679518424"><span class="annot"><a href="#local-6989586621679518424"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679518423"><span class="annot"><a href="#local-6989586621679518423"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679518422"><span class="annot"><a href="#local-6989586621679518422"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518424"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518423"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518422"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518424"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518423"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518422"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span class="hs-comment">{- | Type alias for a monadic parsing operation.
 A function that takes a level and a 'ParseState'
 and produces a monadic parsing action yielding a new state.

 Used to express the main parsing loop
 as well as all substeps that transform the charts on a specific level.
-}</span><span>
</span><span id="line-550"></span><span class="hs-keyword">type</span><span> </span><span id="ParseOp"><span class="annot"><a href="ChartParser.html#ParseOp"><span class="hs-identifier hs-var">ParseOp</span></a></span></span><span> </span><span id="local-6989586621679518421"><span class="annot"><a href="#local-6989586621679518421"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679518420"><span class="annot"><a href="#local-6989586621679518420"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679518419"><span class="annot"><a href="#local-6989586621679518419"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679518418"><span class="annot"><a href="#local-6989586621679518418"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#ParseState"><span class="hs-identifier hs-type">ParseState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518420"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518419"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518418"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679518421"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#ParseState"><span class="hs-identifier hs-type">ParseState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518420"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518419"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679518418"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span class="hs-comment">-- | A single level iteration of the chart parser.</span><span>
</span><span id="line-553"></span><span id="local-6989586621679519548"><span id="local-6989586621679519549"><span id="local-6989586621679519550"><span id="local-6989586621679519551"><span id="local-6989586621679519552"><span class="annot"><a href="ChartParser.html#parseStep"><span class="hs-identifier hs-type">parseStep</span></a></span><span>
</span><span id="line-554"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519552"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519551"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519550"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519552"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519551"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519550"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519552"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519551"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519550"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>  </span><span class="hs-comment">-- ^ a logging function that takes charts and level number.</span><span>
</span><span id="line-557"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519552"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519549"><span class="hs-identifier hs-type">tr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519551"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519548"><span class="hs-identifier hs-type">slc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519550"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-558"></span><span>  </span><span class="hs-comment">-- ^ the grammar's evaluator</span><span>
</span><span id="line-559"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#ParseOp"><span class="hs-identifier hs-type">ParseOp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679519552"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519551"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519550"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span></span><span>
</span><span id="line-560"></span><span>  </span><span class="hs-comment">-- ^ the parsing operation (from level number and charts to new charts).</span><span>
</span><span id="line-561"></span><span id="parseStep"><span class="annot"><span class="annottext">parseStep :: forall tr slc v tr' slc'.
Parsable tr slc v =&gt;
(TChart tr slc v -&gt; VChart tr slc v -&gt; Int -&gt; IO ())
-&gt; Eval tr tr' slc slc' v -&gt; ParseOp IO tr slc v
</span><a href="ChartParser.html#parseStep"><span class="hs-identifier hs-var hs-var">parseStep</span></a></span></span><span> </span><span id="local-6989586621679518402"><span class="annot"><span class="annottext">TChart tr slc v -&gt; VChart tr slc v -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621679518402"><span class="hs-identifier hs-var">logCharts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621679518400"><span class="annot"><span class="annottext">UnspreadMiddle tr slc v
</span><a href="#local-6989586621679518400"><span class="hs-identifier hs-var">eMid</span></a></span></span><span> </span><span id="local-6989586621679518399"><span class="annot"><span class="annottext">UnspreadLeft tr slc
</span><a href="#local-6989586621679518399"><span class="hs-identifier hs-var">eLeft</span></a></span></span><span> </span><span id="local-6989586621679518398"><span class="annot"><span class="annottext">UnspreadRight tr slc
</span><a href="#local-6989586621679518398"><span class="hs-identifier hs-var">eRight</span></a></span></span><span> </span><span id="local-6989586621679518397"><span class="annot"><span class="annottext">Unsplit tr slc v
</span><a href="#local-6989586621679518397"><span class="hs-identifier hs-var">eUnsplit</span></a></span></span><span> </span><span class="annot"><span class="annottext">StartStop slc -&gt; Maybe tr' -&gt; StartStop slc -&gt; Bool -&gt; [(tr, v)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">slc' -&gt; slc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679518396"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518396"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679518395"><span class="annot"><span class="annottext">ParseState tr slc v
</span><a href="#local-6989586621679518395"><span class="hs-identifier hs-var">charts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-562"></span><span>  </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; VChart tr slc v -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621679518402"><span class="hs-identifier hs-var">logCharts</span></a></span><span> </span><span class="annot"><span class="annottext">ParseState tr slc v
</span><a href="#local-6989586621679518395"><span class="hs-identifier hs-var">charts</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518396"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-563"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) tr slc v.
(Monad m, Parsable tr slc v) =&gt;
UnspreadMiddle tr slc v -&gt; ParseOp m tr slc v
</span><a href="ChartParser.html#unspreadAllMiddles"><span class="hs-identifier hs-var">unspreadAllMiddles</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadMiddle tr slc v
</span><a href="#local-6989586621679518400"><span class="hs-identifier hs-var">eMid</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518396"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ParseState tr slc v
</span><a href="#local-6989586621679518395"><span class="hs-identifier hs-var">charts</span></a></span><span>
</span><span id="line-564"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) tr slc v.
(Monad m, Parsable tr slc v) =&gt;
UnspreadLeft tr slc -&gt; ParseOp m tr slc v
</span><a href="ChartParser.html#unspreadAllLefts"><span class="hs-identifier hs-var">unspreadAllLefts</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadLeft tr slc
</span><a href="#local-6989586621679518399"><span class="hs-identifier hs-var">eLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518396"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-565"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) tr slc v.
(Monad m, Parsable tr slc v) =&gt;
UnspreadRight tr slc -&gt; ParseOp m tr slc v
</span><a href="ChartParser.html#unspreadAllRights"><span class="hs-identifier hs-var">unspreadAllRights</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadRight tr slc
</span><a href="#local-6989586621679518398"><span class="hs-identifier hs-var">eRight</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518396"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-566"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall tr slc v (m :: * -&gt; *).
(Monad m, Parsable tr slc v) =&gt;
Unsplit tr slc v -&gt; ParseOp m tr slc v
</span><a href="ChartParser.html#unsplitAll"><span class="hs-identifier hs-var">unsplitAll</span></a></span><span> </span><span class="annot"><span class="annottext">Unsplit tr slc v
</span><a href="#local-6989586621679518397"><span class="hs-identifier hs-var">eUnsplit</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518396"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span class="hs-comment">-- | Verticalizes all edges of length @n@.</span><span>
</span><span id="line-569"></span><span id="local-6989586621679519533"><span id="local-6989586621679519534"><span id="local-6989586621679519535"><span id="local-6989586621679519536"><span class="annot"><a href="ChartParser.html#unspreadAllMiddles"><span class="hs-identifier hs-type">unspreadAllMiddles</span></a></span><span>
</span><span id="line-570"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679519536"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519535"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519534"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519533"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#UnspreadMiddle"><span class="hs-identifier hs-type">UnspreadMiddle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519535"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519534"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519533"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#ParseOp"><span class="hs-identifier hs-type">ParseOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519536"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519535"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519534"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519533"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span><span>
</span><span id="line-571"></span><span id="unspreadAllMiddles"><span class="annot"><span class="annottext">unspreadAllMiddles :: forall (m :: * -&gt; *) tr slc v.
(Monad m, Parsable tr slc v) =&gt;
UnspreadMiddle tr slc v -&gt; ParseOp m tr slc v
</span><a href="ChartParser.html#unspreadAllMiddles"><span class="hs-identifier hs-var hs-var">unspreadAllMiddles</span></a></span></span><span> </span><span id="local-6989586621679518378"><span class="annot"><span class="annottext">UnspreadMiddle tr slc v
</span><a href="#local-6989586621679518378"><span class="hs-identifier hs-var">evalMid</span></a></span></span><span> </span><span id="local-6989586621679518377"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518377"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679518376"><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518376"><span class="hs-identifier hs-var">tchart</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679518375"><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518375"><span class="hs-identifier hs-var">vchart</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-572"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679518374"><span class="annot"><span class="annottext">ts :: [TItem tr slc v]
</span><a href="#local-6989586621679518374"><span class="hs-identifier hs-var hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tr slc v. TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-var">tcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518376"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518377"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-573"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621679518365"><span class="annot"><span class="annottext">newVerts :: [(slc, v, TItem tr slc v)]
</span><a href="#local-6989586621679518365"><span class="hs-identifier hs-var hs-var">newVerts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall b a. NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="ChartParser.html#pmap"><span class="hs-identifier hs-var">pmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tr slc v.
UnspreadMiddle tr slc v
-&gt; TItem tr slc v -&gt; Maybe (slc, v, TItem tr slc v)
</span><a href="ChartParser.html#unspreadMiddle"><span class="hs-identifier hs-var">unspreadMiddle</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadMiddle tr slc v
</span><a href="#local-6989586621679518378"><span class="hs-identifier hs-var">evalMid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. NFData a =&gt; (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!!</span></span><span> </span><span class="annot"><span class="annottext">[TItem tr slc v]
</span><a href="#local-6989586621679518374"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-574"></span><span>      </span><span id="local-6989586621679518360"><span class="annot"><span class="annottext">vchart' :: VChart tr slc v
</span><a href="#local-6989586621679518360"><span class="hs-identifier hs-var hs-var">vchart'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) slc tr v.
(Foldable t, Ord slc, Hashable slc) =&gt;
VChart tr slc v -&gt; t (slc, v, TItem tr slc v) -&gt; VChart tr slc v
</span><a href="ChartParser.html#vcMerge"><span class="hs-identifier hs-var">vcMerge</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518375"><span class="hs-identifier hs-var">vchart</span></a></span><span> </span><span class="annot"><span class="annottext">[(slc, v, TItem tr slc v)]
</span><a href="#local-6989586621679518365"><span class="hs-identifier hs-var">newVerts</span></a></span><span>
</span><span id="line-575"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518376"><span class="hs-identifier hs-var">tchart</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518360"><span class="hs-identifier hs-var">vchart'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span class="hs-comment">-- | Perform all left unspreads where either @l@ or @m@ have length @n@.</span><span>
</span><span id="line-578"></span><span id="local-6989586621679519526"><span id="local-6989586621679519527"><span id="local-6989586621679519528"><span id="local-6989586621679519529"><span class="annot"><a href="ChartParser.html#unspreadAllLefts"><span class="hs-identifier hs-type">unspreadAllLefts</span></a></span><span>
</span><span id="line-579"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679519529"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519528"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519527"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519526"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#UnspreadLeft"><span class="hs-identifier hs-type">UnspreadLeft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519528"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519527"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#ParseOp"><span class="hs-identifier hs-type">ParseOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519529"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519528"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519527"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519526"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span><span>
</span><span id="line-580"></span><span id="unspreadAllLefts"><span class="annot"><span class="annottext">unspreadAllLefts :: forall (m :: * -&gt; *) tr slc v.
(Monad m, Parsable tr slc v) =&gt;
UnspreadLeft tr slc -&gt; ParseOp m tr slc v
</span><a href="ChartParser.html#unspreadAllLefts"><span class="hs-identifier hs-var hs-var">unspreadAllLefts</span></a></span></span><span> </span><span id="local-6989586621679518339"><span class="annot"><span class="annottext">UnspreadLeft tr slc
</span><a href="#local-6989586621679518339"><span class="hs-identifier hs-var">evalLeft</span></a></span></span><span> </span><span id="local-6989586621679518338"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518338"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679518337"><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518337"><span class="hs-identifier hs-var">tchart</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679518336"><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518336"><span class="hs-identifier hs-var">vchart</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-581"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-582"></span><span>    </span><span class="hs-comment">-- left = n (and middle &lt;= n)</span><span>
</span><span id="line-583"></span><span>    </span><span id="local-6989586621679518315"><span class="annot"><span class="annottext">leftn :: [[TItem tr slc v]]
</span><a href="#local-6989586621679518315"><span class="hs-identifier hs-var hs-var">leftn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-584"></span><span>      </span><span class="annot"><span class="annottext">forall b a. NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="ChartParser.html#pmap"><span class="hs-identifier hs-var">pmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall slc tr v.
(Show slc, Show tr, Semiring v, Show v) =&gt;
UnspreadLeft tr slc
-&gt; TItem tr slc v -&gt; Slice slc -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unspreadLeft"><span class="hs-identifier hs-var">unspreadLeft</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadLeft tr slc
</span><a href="#local-6989586621679518339"><span class="hs-identifier hs-var">evalLeft</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. NFData a =&gt; (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!!</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-585"></span><span>        </span><span class="hs-comment">-- in list monad</span><span>
</span><span id="line-586"></span><span>        </span><span id="local-6989586621679518314"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518314"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall tr slc v. TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-var">tcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518337"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518338"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-587"></span><span>        </span><span id="local-6989586621679518313"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518313"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall slc tr v.
(Ord slc, Hashable slc) =&gt;
Int -&gt; VChart tr slc v -&gt; Slice slc -&gt; [Slice slc]
</span><a href="ChartParser.html#vcGetByLeftChild"><span class="hs-identifier hs-var">vcGetByLeftChild</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518338"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518336"><span class="hs-identifier hs-var">vchart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tRightSlice"><span class="hs-identifier hs-var">tRightSlice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518314"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518314"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518313"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-589"></span><span>
</span><span id="line-590"></span><span>    </span><span class="hs-comment">-- middle = n (and left &lt; n)</span><span>
</span><span id="line-591"></span><span>    </span><span id="local-6989586621679518293"><span class="annot"><span class="annottext">midn :: [[TItem tr slc v]]
</span><a href="#local-6989586621679518293"><span class="hs-identifier hs-var hs-var">midn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-592"></span><span>      </span><span class="annot"><span class="annottext">forall b a. NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="ChartParser.html#pmap"><span class="hs-identifier hs-var">pmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall slc tr v.
(Show slc, Show tr, Semiring v, Show v) =&gt;
UnspreadLeft tr slc
-&gt; TItem tr slc v -&gt; Slice slc -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unspreadLeft"><span class="hs-identifier hs-var">unspreadLeft</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadLeft tr slc
</span><a href="#local-6989586621679518339"><span class="hs-identifier hs-var">evalLeft</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. NFData a =&gt; (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!!</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-593"></span><span>        </span><span class="hs-comment">-- in list monad</span><span>
</span><span id="line-594"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679518292"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518292"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679518291"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518291"><span class="hs-identifier hs-var">lslice</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall tr slc v. VChart tr slc v -&gt; Int -&gt; [(Slice slc, Slice slc)]
</span><a href="ChartParser.html#vcGetByLengthLeft"><span class="hs-identifier hs-var">vcGetByLengthLeft</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518336"><span class="hs-identifier hs-var">vchart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518338"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-595"></span><span>        </span><span id="local-6989586621679518290"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518290"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-596"></span><span>          </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679518289"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518289"><span class="hs-identifier hs-var">item</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518289"><span class="hs-identifier hs-var">item</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518338"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-597"></span><span>            </span><span class="annot"><span class="annottext">forall slc tr v.
(Ord slc, Hashable slc) =&gt;
TChart tr slc v -&gt; Slice slc -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByRight"><span class="hs-identifier hs-var">tcGetByRight</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518337"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518291"><span class="hs-identifier hs-var">lslice</span></a></span><span>
</span><span id="line-598"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518290"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679518292"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span>    </span><span class="hs-comment">-- insert new transitions into chart</span><span>
</span><span id="line-601"></span><span>    </span><span id="local-6989586621679518264"><span class="annot"><span class="annottext">tchart' :: TChart tr slc v
</span><a href="#local-6989586621679518264"><span class="hs-identifier hs-var hs-var">tchart'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) tr slc v.
(Foldable t, Parsable tr slc v) =&gt;
TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-var">tcMerge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) tr slc v.
(Foldable t, Parsable tr slc v) =&gt;
TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-var">tcMerge</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518337"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="annot"><span class="annottext">[[TItem tr slc v]]
</span><a href="#local-6989586621679518315"><span class="hs-identifier hs-var">leftn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[TItem tr slc v]]
</span><a href="#local-6989586621679518293"><span class="hs-identifier hs-var">midn</span></a></span><span>
</span><span id="line-602"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518264"><span class="hs-identifier hs-var">tchart'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518336"><span class="hs-identifier hs-var">vchart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span class="hs-comment">-- | Perform all right unspreads where either @r@ or @m@ have length @n@</span><span>
</span><span id="line-605"></span><span id="local-6989586621679519522"><span id="local-6989586621679519523"><span id="local-6989586621679519524"><span id="local-6989586621679519525"><span class="annot"><a href="ChartParser.html#unspreadAllRights"><span class="hs-identifier hs-type">unspreadAllRights</span></a></span><span>
</span><span id="line-606"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679519525"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519524"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519523"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519522"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#UnspreadRight"><span class="hs-identifier hs-type">UnspreadRight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519524"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519523"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#ParseOp"><span class="hs-identifier hs-type">ParseOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519525"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519524"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519523"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519522"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span><span>
</span><span id="line-607"></span><span id="unspreadAllRights"><span class="annot"><span class="annottext">unspreadAllRights :: forall (m :: * -&gt; *) tr slc v.
(Monad m, Parsable tr slc v) =&gt;
UnspreadRight tr slc -&gt; ParseOp m tr slc v
</span><a href="ChartParser.html#unspreadAllRights"><span class="hs-identifier hs-var hs-var">unspreadAllRights</span></a></span></span><span> </span><span id="local-6989586621679518243"><span class="annot"><span class="annottext">UnspreadRight tr slc
</span><a href="#local-6989586621679518243"><span class="hs-identifier hs-var">evalRight</span></a></span></span><span> </span><span id="local-6989586621679518242"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518242"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679518241"><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518241"><span class="hs-identifier hs-var">tchart</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679518240"><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518240"><span class="hs-identifier hs-var">vchart</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-608"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-609"></span><span>    </span><span class="hs-comment">-- right = n (and middle &lt;= n)</span><span>
</span><span id="line-610"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679518216"><span class="annot"><span class="annottext">rightn :: [[TItem tr slc v]]
</span><a href="#local-6989586621679518216"><span class="hs-identifier hs-var hs-var">rightn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-611"></span><span>      </span><span class="annot"><span class="annottext">forall a. NFData a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">force</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall b a. NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="ChartParser.html#pmap"><span class="hs-identifier hs-var">pmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall v slc tr.
(Semiring v, NFData slc, NFData tr, NFData v, Show tr, Show slc,
 Show v) =&gt;
UnspreadRight tr slc
-&gt; Vert tr slc v -&gt; TItem tr slc v -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unspreadRight"><span class="hs-identifier hs-var">unspreadRight</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadRight tr slc
</span><a href="#local-6989586621679518243"><span class="hs-identifier hs-var">evalRight</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. NFData a =&gt; (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!!</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-612"></span><span>        </span><span class="hs-comment">-- in list monad</span><span>
</span><span id="line-613"></span><span>        </span><span id="local-6989586621679518215"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518215"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall tr slc v. TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-var">tcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518241"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518242"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-614"></span><span>        </span><span id="local-6989586621679518214"><span class="annot"><span class="annottext">Vert tr slc v
</span><a href="#local-6989586621679518214"><span class="hs-identifier hs-var">vert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall slc tr v.
(Ord slc, Hashable slc) =&gt;
Int -&gt; VChart tr slc v -&gt; Slice slc -&gt; [Vert tr slc v]
</span><a href="ChartParser.html#vcGetByRightChild"><span class="hs-identifier hs-var">vcGetByRightChild</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518242"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518240"><span class="hs-identifier hs-var">vchart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tLeftSlice"><span class="hs-identifier hs-var">tLeftSlice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518215"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-615"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vert tr slc v
</span><a href="#local-6989586621679518214"><span class="hs-identifier hs-var">vert</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518215"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span>    </span><span class="hs-comment">-- middle = n (and left &lt; n)</span><span>
</span><span id="line-618"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679518189"><span class="annot"><span class="annottext">midn :: [[TItem tr slc v]]
</span><a href="#local-6989586621679518189"><span class="hs-identifier hs-var hs-var">midn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-619"></span><span>      </span><span class="annot"><span class="annottext">forall a. NFData a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">force</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall b a. NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="ChartParser.html#pmap"><span class="hs-identifier hs-var">pmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall v slc tr.
(Semiring v, NFData slc, NFData tr, NFData v, Show tr, Show slc,
 Show v) =&gt;
UnspreadRight tr slc
-&gt; Vert tr slc v -&gt; TItem tr slc v -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unspreadRight"><span class="hs-identifier hs-var">unspreadRight</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadRight tr slc
</span><a href="#local-6989586621679518243"><span class="hs-identifier hs-var">evalRight</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. NFData a =&gt; (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!!</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-620"></span><span>        </span><span class="hs-comment">-- in list monad</span><span>
</span><span id="line-621"></span><span>        </span><span id="local-6989586621679518188"><span class="annot"><span class="annottext">Vert tr slc v
</span><a href="#local-6989586621679518188"><span class="hs-identifier hs-var">vert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall tr slc v. VChart tr slc v -&gt; Int -&gt; [Vert tr slc v]
</span><a href="ChartParser.html#vcGetByLength"><span class="hs-identifier hs-var">vcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518240"><span class="hs-identifier hs-var">vchart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518242"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-622"></span><span>        </span><span id="local-6989586621679518187"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518187"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-623"></span><span>          </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679518186"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518186"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518186"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518242"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-624"></span><span>            </span><span class="annot"><span class="annottext">forall slc tr v.
(Ord slc, Hashable slc) =&gt;
TChart tr slc v -&gt; Slice slc -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLeft"><span class="hs-identifier hs-var">tcGetByLeft</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518241"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tRightSlice"><span class="hs-identifier hs-var">tRightSlice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall tr slc v. Vert tr slc v -&gt; TItem tr slc v
</span><a href="ChartParser.html#vMiddle"><span class="hs-identifier hs-var">vMiddle</span></a></span><span> </span><span class="annot"><span class="annottext">Vert tr slc v
</span><a href="#local-6989586621679518188"><span class="hs-identifier hs-var">vert</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vert tr slc v
</span><a href="#local-6989586621679518188"><span class="hs-identifier hs-var">vert</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518187"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>
</span><span id="line-627"></span><span>    </span><span class="hs-comment">-- insert new transitions into chart</span><span>
</span><span id="line-628"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679518162"><span class="annot"><span class="annottext">tchart' :: TChart tr slc v
</span><a href="#local-6989586621679518162"><span class="hs-identifier hs-var hs-var">tchart'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) tr slc v.
(Foldable t, Parsable tr slc v) =&gt;
TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-var">tcMerge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) tr slc v.
(Foldable t, Parsable tr slc v) =&gt;
TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-var">tcMerge</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518241"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="annot"><span class="annottext">[[TItem tr slc v]]
</span><a href="#local-6989586621679518216"><span class="hs-identifier hs-var">rightn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[TItem tr slc v]]
</span><a href="#local-6989586621679518189"><span class="hs-identifier hs-var">midn</span></a></span><span>
</span><span id="line-629"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518162"><span class="hs-identifier hs-var">tchart'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518240"><span class="hs-identifier hs-var">vchart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span class="hs-comment">-- | perform all unsplits where either @l@ or @r@ have length @n@</span><span>
</span><span id="line-632"></span><span class="annot"><a href="ChartParser.html#unsplitAll"><span class="hs-identifier hs-type">unsplitAll</span></a></span><span>
</span><span id="line-633"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679519520"><span class="annot"><a href="#local-6989586621679519520"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679519519"><span class="annot"><a href="#local-6989586621679519519"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679519518"><span class="annot"><a href="#local-6989586621679519518"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679519521"><span class="annot"><a href="#local-6989586621679519521"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-634"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679519521"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519520"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519519"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519518"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Unsplit"><span class="hs-identifier hs-type">Unsplit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519520"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519519"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519518"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-636"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#ParseOp"><span class="hs-identifier hs-type">ParseOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519521"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519520"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519519"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519518"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-637"></span><span id="unsplitAll"><span class="annot"><span class="annottext">unsplitAll :: forall tr slc v (m :: * -&gt; *).
(Monad m, Parsable tr slc v) =&gt;
Unsplit tr slc v -&gt; ParseOp m tr slc v
</span><a href="ChartParser.html#unsplitAll"><span class="hs-identifier hs-var hs-var">unsplitAll</span></a></span></span><span> </span><span id="local-6989586621679518141"><span class="annot"><span class="annottext">Unsplit tr slc v
</span><a href="#local-6989586621679518141"><span class="hs-identifier hs-var">unsplitter</span></a></span></span><span> </span><span id="local-6989586621679518140"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518140"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679518139"><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518139"><span class="hs-identifier hs-var">tchart</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679518138"><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518138"><span class="hs-identifier hs-var">vchart</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-638"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679518131"><span class="annot"><span class="annottext">byLen :: [TItem tr slc v]
</span><a href="#local-6989586621679518131"><span class="hs-identifier hs-var hs-var">byLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. NFData a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">force</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall tr slc v. TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-var">tcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518139"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518140"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-639"></span><span>
</span><span id="line-640"></span><span>      </span><span class="hs-comment">-- left = n (and right &lt;= n)</span><span>
</span><span id="line-641"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621679518110"><span class="annot"><span class="annottext">leftn :: [[TItem tr slc v]]
</span><a href="#local-6989586621679518110"><span class="hs-identifier hs-var hs-var">leftn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-642"></span><span>        </span><span class="annot"><span class="annottext">forall b a. NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="ChartParser.html#pmap"><span class="hs-identifier hs-var">pmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v slc tr.
(Semiring v, NFData slc, NFData tr, NFData v, Show v) =&gt;
Unsplit tr slc v
-&gt; TItem tr slc v -&gt; TItem tr slc v -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unsplit"><span class="hs-identifier hs-var">unsplit</span></a></span><span> </span><span class="annot"><span class="annottext">Unsplit tr slc v
</span><a href="#local-6989586621679518141"><span class="hs-identifier hs-var">unsplitter</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. NFData a =&gt; (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!!</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-643"></span><span>          </span><span id="local-6989586621679518109"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518109"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TItem tr slc v]
</span><a href="#local-6989586621679518131"><span class="hs-identifier hs-var">byLen</span></a></span><span>
</span><span id="line-644"></span><span>          </span><span id="local-6989586621679518108"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518108"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-645"></span><span>            </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679518107"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518107"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518107"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518140"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-646"></span><span>              </span><span class="annot"><span class="annottext">forall slc tr v.
(Ord slc, Hashable slc) =&gt;
TChart tr slc v -&gt; Slice slc -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLeft"><span class="hs-identifier hs-var">tcGetByLeft</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518139"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tRightSlice"><span class="hs-identifier hs-var">tRightSlice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518109"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518109"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518108"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span>      </span><span class="hs-comment">-- right = n (and left &lt; n)</span><span>
</span><span id="line-650"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621679518085"><span class="annot"><span class="annottext">rightn :: [[TItem tr slc v]]
</span><a href="#local-6989586621679518085"><span class="hs-identifier hs-var hs-var">rightn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-651"></span><span>        </span><span class="annot"><span class="annottext">forall b a. NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="ChartParser.html#pmap"><span class="hs-identifier hs-var">pmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v slc tr.
(Semiring v, NFData slc, NFData tr, NFData v, Show v) =&gt;
Unsplit tr slc v
-&gt; TItem tr slc v -&gt; TItem tr slc v -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unsplit"><span class="hs-identifier hs-var">unsplit</span></a></span><span> </span><span class="annot"><span class="annottext">Unsplit tr slc v
</span><a href="#local-6989586621679518141"><span class="hs-identifier hs-var">unsplitter</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. NFData a =&gt; (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!!</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-652"></span><span>          </span><span id="local-6989586621679518084"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518084"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TItem tr slc v]
</span><a href="#local-6989586621679518131"><span class="hs-identifier hs-var">byLen</span></a></span><span>
</span><span id="line-653"></span><span>          </span><span id="local-6989586621679518083"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518083"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-654"></span><span>            </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679518082"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518082"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518082"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518140"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-655"></span><span>              </span><span class="annot"><span class="annottext">forall slc tr v.
(Ord slc, Hashable slc) =&gt;
TChart tr slc v -&gt; Slice slc -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByRight"><span class="hs-identifier hs-var">tcGetByRight</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518139"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tLeftSlice"><span class="hs-identifier hs-var">tLeftSlice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518084"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518083"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679518084"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span>      </span><span class="hs-comment">-- insert new transitions into chart</span><span>
</span><span id="line-659"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621679518058"><span class="annot"><span class="annottext">tchart' :: TChart tr slc v
</span><a href="#local-6989586621679518058"><span class="hs-identifier hs-var hs-var">tchart'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) tr slc v.
(Foldable t, Parsable tr slc v) =&gt;
TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-var">tcMerge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) tr slc v.
(Foldable t, Parsable tr slc v) =&gt;
TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-var">tcMerge</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518139"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="annot"><span class="annottext">[[TItem tr slc v]]
</span><a href="#local-6989586621679518110"><span class="hs-identifier hs-var">leftn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[TItem tr slc v]]
</span><a href="#local-6989586621679518085"><span class="hs-identifier hs-var">rightn</span></a></span><span>
</span><span id="line-660"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518058"><span class="hs-identifier hs-var">tchart'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518138"><span class="hs-identifier hs-var">vchart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-661"></span><span>
</span><span id="line-662"></span><span class="hs-comment">-- parsing entry point</span><span>
</span><span id="line-663"></span><span class="hs-comment">----------------------</span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span class="hs-comment">{- | The main entrypoint to the parser.
 Expects an evaluator for the specific grammar
 and an input path.
 Returns the combined semiring value of all full derivations.
-}</span><span>
</span><span id="line-670"></span><span id="local-6989586621679519486"><span id="local-6989586621679519487"><span id="local-6989586621679519488"><span id="local-6989586621679519489"><span id="local-6989586621679519490"><span class="annot"><a href="ChartParser.html#parse"><span class="hs-identifier hs-type">parse</span></a></span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519490"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519489"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519488"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-672"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519490"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519489"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519488"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519490"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519489"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519488"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519489"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-673"></span><span>  </span><span class="hs-comment">-- ^ logging function</span><span>
</span><span id="line-674"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519490"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519487"><span class="hs-identifier hs-type">tr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519489"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519486"><span class="hs-identifier hs-type">slc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519488"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-675"></span><span>  </span><span class="hs-comment">-- ^ the grammar's evaluator</span><span>
</span><span id="line-676"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519486"><span class="hs-identifier hs-type">slc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519487"><span class="hs-identifier hs-type">tr'</span></a></span><span>
</span><span id="line-677"></span><span>  </span><span class="hs-comment">-- ^ the input path (from first to last slice, excluding 'Start' and 'Stop')</span><span>
</span><span id="line-678"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679519488"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span></span><span>
</span><span id="line-679"></span><span>  </span><span class="hs-comment">-- ^ the semiring value at the top</span><span>
</span><span id="line-680"></span><span id="parse"><span class="annot"><span class="annottext">parse :: forall tr slc v tr' slc'.
Parsable tr slc v =&gt;
(TChart tr slc v
 -&gt; Either (VChart tr slc v) [Slice slc] -&gt; Int -&gt; IO ())
-&gt; Eval tr tr' slc slc' v -&gt; Path slc' tr' -&gt; IO v
</span><a href="ChartParser.html#parse"><span class="hs-identifier hs-var hs-var">parse</span></a></span></span><span> </span><span id="local-6989586621679518025"><span class="annot"><span class="annottext">TChart tr slc v
-&gt; Either (VChart tr slc v) [Slice slc] -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621679518025"><span class="hs-identifier hs-var">logCharts</span></a></span></span><span> </span><span id="local-6989586621679518024"><span class="annot"><span class="annottext">Eval tr tr' slc slc' v
</span><a href="#local-6989586621679518024"><span class="hs-identifier hs-var">eval</span></a></span></span><span> </span><span id="local-6989586621679518023"><span class="annot"><span class="annottext">Path slc' tr'
</span><a href="#local-6989586621679518023"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-681"></span><span>  </span><span class="annot"><span class="annottext">TChart tr slc v
-&gt; Either (VChart tr slc v) [Slice slc] -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621679518025"><span class="hs-identifier hs-var">logCharts</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518022"><span class="hs-identifier hs-var">tinit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Path a b -&gt; [a]
</span><a href="Common.html#pathArounds"><span class="hs-identifier hs-var">pathArounds</span></a></span><span> </span><span class="annot"><span class="annottext">Path (Slice slc) (Maybe tr')
</span><a href="#local-6989586621679518020"><span class="hs-identifier hs-var">slicePath</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-682"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679518019"><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518019"><span class="hs-identifier hs-var">tfinal</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679518018"><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518018"><span class="hs-identifier hs-var">vfinal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-683"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span>
</span><span id="line-684"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall tr slc v tr' slc'.
Parsable tr slc v =&gt;
(TChart tr slc v -&gt; VChart tr slc v -&gt; Int -&gt; IO ())
-&gt; Eval tr tr' slc slc' v -&gt; ParseOp IO tr slc v
</span><a href="ChartParser.html#parseStep"><span class="hs-identifier hs-var">parseStep</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679518015"><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518015"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679518014"><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518014"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679518013"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518013"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
-&gt; Either (VChart tr slc v) [Slice slc] -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621679518025"><span class="hs-identifier hs-var">logCharts</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518015"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518014"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518013"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Eval tr tr' slc slc' v
</span><a href="#local-6989586621679518024"><span class="hs-identifier hs-var">eval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518022"><span class="hs-identifier hs-var">tinit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall e a v. Int -&gt; VChart e a v
</span><a href="ChartParser.html#vcEmpty"><span class="hs-identifier hs-var">vcEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518012"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518012"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-687"></span><span>  </span><span class="annot"><span class="annottext">TChart tr slc v
-&gt; Either (VChart tr slc v) [Slice slc] -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621679518025"><span class="hs-identifier hs-var">logCharts</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518019"><span class="hs-identifier hs-var">tfinal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679518018"><span class="hs-identifier hs-var">vfinal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518012"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-688"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679518011"><span class="annot"><span class="annottext">goals :: [TItem tr slc v]
</span><a href="#local-6989586621679518011"><span class="hs-identifier hs-var hs-var">goals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tr slc v. TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-var">tcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679518019"><span class="hs-identifier hs-var">tfinal</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679518012"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-689"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Semiring a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">R.sum</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s i. Score s i -&gt; s
</span><a href="Scoring.FunTyped.html#getScoreVal"><span class="hs-identifier hs-var">S.getScoreVal</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall i v. Item i v -&gt; Score v Int
</span><a href="ChartParser.html#iScore"><span class="hs-identifier hs-var">iScore</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TItem tr slc v]
</span><a href="#local-6989586621679518011"><span class="hs-identifier hs-var">goals</span></a></span><span>
</span><span id="line-690"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-691"></span><span>  </span><span id="local-6989586621679518008"><span class="annot"><span class="annottext">wrapPath :: Path a a -&gt; Path (StartStop a) (Maybe a)
</span><a href="#local-6989586621679518008"><span class="hs-identifier hs-var hs-var">wrapPath</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span id="local-6989586621679518006"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679518006"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679518005"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679518005"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679518004"><span class="annot"><span class="annottext">Path a a
</span><a href="#local-6989586621679518004"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall around between.
around -&gt; between -&gt; Path around between -&gt; Path around between
</span><a href="Common.html#Path"><span class="hs-identifier hs-var">Path</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679518006"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679518005"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Path a a -&gt; Path (StartStop a) (Maybe a)
</span><a href="#local-6989586621679518008"><span class="hs-identifier hs-var">wrapPath</span></a></span><span> </span><span class="annot"><span class="annottext">Path a a
</span><a href="#local-6989586621679518004"><span class="hs-identifier hs-var">rst</span></a></span><span>
</span><span id="line-692"></span><span>  </span><span class="annot"><a href="#local-6989586621679518008"><span class="hs-identifier hs-var">wrapPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#PathEnd"><span class="hs-identifier hs-type">PathEnd</span></a></span><span> </span><span id="local-6989586621679518002"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679518002"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall around between.
around -&gt; between -&gt; Path around between -&gt; Path around between
</span><a href="Common.html#Path"><span class="hs-identifier hs-var">Path</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679518002"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall around between. around -&gt; Path around between
</span><a href="Common.html#PathEnd"><span class="hs-identifier hs-var">PathEnd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span>
</span><span id="line-693"></span><span>  </span><span id="local-6989586621679518000"><span class="annot"><span class="annottext">path' :: Path (StartStop slc') (Maybe tr')
</span><a href="#local-6989586621679518000"><span class="hs-identifier hs-var hs-var">path'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall around between.
around -&gt; between -&gt; Path around between -&gt; Path around between
</span><a href="Common.html#Path"><span class="hs-identifier hs-var">Path</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {a} {a}. Path a a -&gt; Path (StartStop a) (Maybe a)
</span><a href="#local-6989586621679518008"><span class="hs-identifier hs-var">wrapPath</span></a></span><span> </span><span class="annot"><span class="annottext">Path slc' tr'
</span><a href="#local-6989586621679518023"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-694"></span><span>  </span><span id="local-6989586621679518012"><span class="annot"><span class="annottext">len :: Int
</span><a href="#local-6989586621679518012"><span class="hs-identifier hs-var hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. Path a b -&gt; Int
</span><a href="Common.html#pathLen"><span class="hs-identifier hs-var">pathLen</span></a></span><span> </span><span class="annot"><span class="annottext">Path (StartStop slc') (Maybe tr')
</span><a href="#local-6989586621679518000"><span class="hs-identifier hs-var">path'</span></a></span><span>
</span><span id="line-695"></span><span>  </span><span id="local-6989586621679518020"><span class="annot"><span class="annottext">slicePath :: Path (Slice slc) (Maybe tr')
</span><a href="#local-6989586621679518020"><span class="hs-identifier hs-var hs-var">slicePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-696"></span><span>    </span><span class="annot"><span class="annottext">forall a a' b. Int -&gt; (Int -&gt; a -&gt; a') -&gt; Path a b -&gt; Path a' b
</span><a href="Common.html#mapAroundsWithIndex"><span class="hs-identifier hs-var">mapAroundsWithIndex</span></a></span><span>
</span><span id="line-697"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-698"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679517994"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517994"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679517993"><span class="annot"><span class="annottext">StartStop slc'
</span><a href="#local-6989586621679517993"><span class="hs-identifier hs-var">notes</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall slc. Int -&gt; StartStop slc -&gt; Int -&gt; Int -&gt; Slice slc
</span><a href="ChartParser.html#Slice"><span class="hs-identifier hs-var">Slice</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517994"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tr tr' slc slc' v. Eval tr tr' slc slc' v -&gt; slc' -&gt; slc
</span><a href="Common.html#evalSlice"><span class="hs-identifier hs-var">evalSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Eval tr tr' slc slc' v
</span><a href="#local-6989586621679518024"><span class="hs-identifier hs-var">eval</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StartStop slc'
</span><a href="#local-6989586621679517993"><span class="hs-identifier hs-var">notes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517994"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517994"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>      </span><span class="annot"><span class="annottext">Path (StartStop slc') (Maybe tr')
</span><a href="#local-6989586621679518000"><span class="hs-identifier hs-var">path'</span></a></span><span>
</span><span id="line-700"></span><span>  </span><span id="local-6989586621679517990"><span class="annot"><span class="annottext">mkTrans :: Slice slc -&gt; Maybe tr' -&gt; Slice slc -&gt; [TItem tr slc v]
</span><a href="#local-6989586621679517990"><span class="hs-identifier hs-var hs-var">mkTrans</span></a></span></span><span> </span><span id="local-6989586621679517989"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679517989"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679517988"><span class="annot"><span class="annottext">Maybe tr'
</span><a href="#local-6989586621679517988"><span class="hs-identifier hs-var">esurf</span></a></span></span><span> </span><span id="local-6989586621679517987"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679517987"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-701"></span><span>    </span><span class="annot"><span class="annottext">forall {tr} {v}. (tr, v) -&gt; Item (Transition tr slc) v
</span><a href="#local-6989586621679517986"><span class="hs-identifier hs-var">mk</span></a></span><span>
</span><span id="line-702"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall tr tr' slc slc' v.
Eval tr tr' slc slc' v
-&gt; StartStop slc -&gt; Maybe tr' -&gt; StartStop slc -&gt; Bool -&gt; [(tr, v)]
</span><a href="Common.html#evalUnfreeze"><span class="hs-identifier hs-var">evalUnfreeze</span></a></span><span>
</span><span id="line-703"></span><span>        </span><span class="annot"><span class="annottext">Eval tr tr' slc slc' v
</span><a href="#local-6989586621679518024"><span class="hs-identifier hs-var">eval</span></a></span><span>
</span><span id="line-704"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679517989"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-705"></span><span>        </span><span class="annot"><span class="annottext">Maybe tr'
</span><a href="#local-6989586621679517988"><span class="hs-identifier hs-var">esurf</span></a></span><span>
</span><span id="line-706"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679517987"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-707"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. StartStop a -&gt; Bool
</span><a href="Common.html#isStop"><span class="hs-identifier hs-var">isStop</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679517987"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-709"></span><span>    </span><span id="local-6989586621679517986"><span class="annot"><span class="annottext">mk :: (tr, v) -&gt; Item (Transition tr slc) v
</span><a href="#local-6989586621679517986"><span class="hs-identifier hs-var hs-var">mk</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679517984"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679517984"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679517983"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679517983"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tr slc.
Slice slc -&gt; tr -&gt; Slice slc -&gt; Bool -&gt; Transition tr slc
</span><a href="ChartParser.html#Transition"><span class="hs-identifier hs-var">Transition</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679517989"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679517984"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679517987"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">forall i v. i -&gt; Score v Int -&gt; Item i v
</span><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a></span><span> </span><span class="annot"><span class="annottext">forall s i. s -&gt; Score s i
</span><a href="Scoring.FunTyped.html#val"><span class="hs-identifier hs-var">S.val</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679517983"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-710"></span><span>  </span><span id="local-6989586621679517981"><span class="annot"><span class="annottext">trans0 :: [[TItem tr slc v]]
</span><a href="#local-6989586621679517981"><span class="hs-identifier hs-var hs-var">trans0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; a -&gt; c) -&gt; Path a b -&gt; [c]
</span><a href="Common.html#mapBetweens"><span class="hs-identifier hs-var">mapBetweens</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc -&gt; Maybe tr' -&gt; Slice slc -&gt; [TItem tr slc v]
</span><a href="#local-6989586621679517990"><span class="hs-identifier hs-var">mkTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Path (Slice slc) (Maybe tr')
</span><a href="#local-6989586621679518020"><span class="hs-identifier hs-var">slicePath</span></a></span><span>
</span><span id="line-711"></span><span>  </span><span id="local-6989586621679518022"><span class="annot"><span class="annottext">tinit :: TChart tr slc v
</span><a href="#local-6989586621679518022"><span class="hs-identifier hs-var hs-var">tinit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) tr slc v.
(Foldable t, Parsable tr slc v) =&gt;
TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-var">tcMerge</span></a></span><span> </span><span class="annot"><span class="annottext">forall tr slc v. TChart tr slc v
</span><a href="ChartParser.html#tcEmpty"><span class="hs-identifier hs-var">tcEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[TItem tr slc v]]
</span><a href="#local-6989586621679517981"><span class="hs-identifier hs-var">trans0</span></a></span><span>
</span><span id="line-712"></span><span>
</span><span id="line-713"></span><span class="hs-comment">-- | A logging function that logs the sice of the charts at each level.</span><span>
</span><span id="line-714"></span><span id="local-6989586621679519433"><span id="local-6989586621679519434"><span id="local-6989586621679519435"><span id="local-6989586621679519436"><span id="local-6989586621679519437"><span id="local-6989586621679519438"><span class="annot"><a href="ChartParser.html#logSize"><span class="hs-identifier hs-type">logSize</span></a></span><span>
</span><span id="line-715"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519438"><span class="hs-identifier hs-type">tr1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519437"><span class="hs-identifier hs-type">slc1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519436"><span class="hs-identifier hs-type">v1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519435"><span class="hs-identifier hs-type">tr2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519434"><span class="hs-identifier hs-type">slc2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519433"><span class="hs-identifier hs-type">v2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519434"><span class="hs-identifier hs-type">slc2</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-716"></span><span id="logSize"><span class="annot"><span class="annottext">logSize :: forall tr1 slc1 v1 tr2 slc2 v2.
TChart tr1 slc1 v1
-&gt; Either (VChart tr2 slc2 v2) [Slice slc2] -&gt; Int -&gt; IO ()
</span><a href="ChartParser.html#logSize"><span class="hs-identifier hs-var hs-var">logSize</span></a></span></span><span> </span><span id="local-6989586621679517950"><span class="annot"><span class="annottext">TChart tr1 slc1 v1
</span><a href="#local-6989586621679517950"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621679517949"><span class="annot"><span class="annottext">Either (VChart tr2 slc2 v2) [Slice slc2]
</span><a href="#local-6989586621679517949"><span class="hs-identifier hs-var">vc</span></a></span></span><span> </span><span id="local-6989586621679517948"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517948"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-717"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;parsing level &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517948"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-718"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;transitions: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall tr slc v. TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-var">tcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr1 slc1 v1
</span><a href="#local-6989586621679517950"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517948"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679517941"><span class="annot"><span class="annottext">nverts :: Int
</span><a href="#local-6989586621679517941"><span class="hs-identifier hs-var hs-var">nverts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (VChart tr2 slc2 v2) [Slice slc2]
</span><a href="#local-6989586621679517949"><span class="hs-identifier hs-var">vc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-720"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679517940"><span class="annot"><span class="annottext">VChart tr2 slc2 v2
</span><a href="#local-6989586621679517940"><span class="hs-identifier hs-var">chart</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall tr slc v. VChart tr slc v -&gt; Int -&gt; [Vert tr slc v]
</span><a href="ChartParser.html#vcGetByLength"><span class="hs-identifier hs-var">vcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr2 slc2 v2
</span><a href="#local-6989586621679517940"><span class="hs-identifier hs-var">chart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517948"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-721"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679517939"><span class="annot"><span class="annottext">[Slice slc2]
</span><a href="#local-6989586621679517939"><span class="hs-identifier hs-var">lst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Slice slc2]
</span><a href="#local-6989586621679517939"><span class="hs-identifier hs-var">lst</span></a></span><span>
</span><span id="line-722"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;verts: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517941"><span class="hs-identifier hs-var">nverts</span></a></span><span>
</span><span id="line-723"></span><span>
</span><span id="line-724"></span><span class="hs-comment">-- | Parse a piece using the 'logSize' logging function.</span><span>
</span><span id="line-725"></span><span id="local-6989586621679519421"><span id="local-6989586621679519422"><span id="local-6989586621679519423"><span id="local-6989586621679519424"><span id="local-6989586621679519425"><span class="annot"><a href="ChartParser.html#parseSize"><span class="hs-identifier hs-type">parseSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519425"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519424"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519423"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519425"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519422"><span class="hs-identifier hs-type">tr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519424"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519421"><span class="hs-identifier hs-type">slc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519423"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519421"><span class="hs-identifier hs-type">slc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519422"><span class="hs-identifier hs-type">tr'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679519423"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span></span><span>
</span><span id="line-726"></span><span id="parseSize"><span class="annot"><span class="annottext">parseSize :: forall tr slc v tr' slc'.
Parsable tr slc v =&gt;
Eval tr tr' slc slc' v -&gt; Path slc' tr' -&gt; IO v
</span><a href="ChartParser.html#parseSize"><span class="hs-identifier hs-var hs-var">parseSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tr slc v tr' slc'.
Parsable tr slc v =&gt;
(TChart tr slc v
 -&gt; Either (VChart tr slc v) [Slice slc] -&gt; Int -&gt; IO ())
-&gt; Eval tr tr' slc slc' v -&gt; Path slc' tr' -&gt; IO v
</span><a href="ChartParser.html#parse"><span class="hs-identifier hs-var">parse</span></a></span><span> </span><span class="annot"><span class="annottext">forall tr1 slc1 v1 tr2 slc2 v2.
TChart tr1 slc1 v1
-&gt; Either (VChart tr2 slc2 v2) [Slice slc2] -&gt; Int -&gt; IO ()
</span><a href="ChartParser.html#logSize"><span class="hs-identifier hs-var">logSize</span></a></span><span>
</span><span id="line-727"></span><span>
</span><span id="line-728"></span><span class="hs-comment">-- | A logging function that does nothing.</span><span>
</span><span id="line-729"></span><span id="local-6989586621679519414"><span id="local-6989586621679519415"><span id="local-6989586621679519416"><span id="local-6989586621679519417"><span class="annot"><a href="ChartParser.html#logNone"><span class="hs-identifier hs-type">logNone</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621679519417"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679519416"><span class="hs-identifier hs-type">p1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679519415"><span class="hs-identifier hs-type">p2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679519414"><span class="hs-identifier hs-type">p3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679519417"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-730"></span><span id="logNone"><span class="annot"><span class="annottext">logNone :: forall (f :: * -&gt; *) p1 p2 p3.
Applicative f =&gt;
p1 -&gt; p2 -&gt; p3 -&gt; f ()
</span><a href="ChartParser.html#logNone"><span class="hs-identifier hs-var hs-var">logNone</span></a></span></span><span> </span><span class="annot"><span class="annottext">p1
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p2
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span><span class="hs-comment">-- | Parse a piece without logging.</span><span>
</span><span id="line-733"></span><span id="local-6989586621679517929"><span id="local-6989586621679517930"><span id="local-6989586621679517931"><span id="local-6989586621679517932"><span id="local-6989586621679517933"><span class="annot"><a href="ChartParser.html#parseSilent"><span class="hs-identifier hs-type">parseSilent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679517933"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679517932"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679517931"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679517933"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679517930"><span class="hs-identifier hs-type">tr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679517932"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679517929"><span class="hs-identifier hs-type">slc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679517931"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679517929"><span class="hs-identifier hs-type">slc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679517930"><span class="hs-identifier hs-type">tr'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679517931"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span></span><span>
</span><span id="line-734"></span><span id="parseSilent"><span class="annot"><span class="annottext">parseSilent :: forall tr slc v tr' slc'.
Parsable tr slc v =&gt;
Eval tr tr' slc slc' v -&gt; Path slc' tr' -&gt; IO v
</span><a href="ChartParser.html#parseSilent"><span class="hs-identifier hs-var hs-var">parseSilent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tr slc v tr' slc'.
Parsable tr slc v =&gt;
(TChart tr slc v
 -&gt; Either (VChart tr slc v) [Slice slc] -&gt; Int -&gt; IO ())
-&gt; Eval tr tr' slc slc' v -&gt; Path slc' tr' -&gt; IO v
</span><a href="ChartParser.html#parse"><span class="hs-identifier hs-var">parse</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) p1 p2 p3.
Applicative f =&gt;
p1 -&gt; p2 -&gt; p3 -&gt; f ()
</span><a href="ChartParser.html#logNone"><span class="hs-identifier hs-var">logNone</span></a></span><span>
</span><span id="line-735"></span><span>
</span><span id="line-736"></span><span class="hs-comment">-- fancier logging</span><span>
</span><span id="line-737"></span><span class="hs-comment">-- ---------------</span><span>
</span><span id="line-738"></span><span>
</span><span id="line-739"></span><span class="hs-comment">-- | Generate TikZ code for a slice.</span><span>
</span><span id="line-740"></span><span id="local-6989586621679519406"><span class="annot"><a href="ChartParser.html#printTikzSlice"><span class="hs-identifier hs-type">printTikzSlice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679519406"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519406"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-741"></span><span id="printTikzSlice"><span class="annot"><span class="annottext">printTikzSlice :: forall slc. Show slc =&gt; Slice slc -&gt; IO ()
</span><a href="ChartParser.html#printTikzSlice"><span class="hs-identifier hs-var hs-var">printTikzSlice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span id="local-6989586621679517901"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517901"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679517900"><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679517900"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span id="local-6989586621679517899"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517899"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span id="local-6989586621679517898"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517898"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-742"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-743"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    \\node[slice,align=center] (slice&quot;</span></span><span>
</span><span id="line-744"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517899"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-745"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;) at (&quot;</span></span><span>
</span><span id="line-746"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517901"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517898"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2.0</span></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,0) {&quot;</span></span><span>
</span><span id="line-748"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="Common.html#showTex"><span class="hs-identifier hs-var">showTex</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679517900"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-749"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\\\\ &quot;</span></span><span>
</span><span id="line-750"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517899"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-751"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;};&quot;</span></span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span class="hs-comment">-- | Generate TikZ code for a verticalization.</span><span>
</span><span id="line-754"></span><span id="printTikzVert"><span class="annot"><span class="annottext">printTikzVert :: IntMap a -&gt; Vert tr slc v -&gt; IO (IntMap a)
</span><a href="ChartParser.html#printTikzVert"><span class="hs-identifier hs-var hs-var">printTikzVert</span></a></span></span><span> </span><span id="local-6989586621679517867"><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621679517867"><span class="hs-identifier hs-var">neighbors</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span id="local-6989586621679517866"><span class="annot"><span class="annottext">top :: Slice slc
</span><a href="#local-6989586621679517866"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span id="local-6989586621679517865"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517865"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679517864"><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679517864"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679517863"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517863"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679517862"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517862"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">v
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679517861"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679517861"><span class="hs-identifier hs-var">middle</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-755"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679517859"><span class="annot"><span class="annottext">index :: Int
</span><a href="#local-6989586621679517859"><span class="hs-identifier hs-var hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517865"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517862"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-756"></span><span>      </span><span id="local-6989586621679517853"><span class="annot"><span class="annottext">xpos :: Double
</span><a href="#local-6989586621679517853"><span class="hs-identifier hs-var hs-var">xpos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517865"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517862"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2.0</span></span><span>
</span><span id="line-757"></span><span>      </span><span id="local-6989586621679517851"><span class="annot"><span class="annottext">ypos :: a
</span><a href="#local-6989586621679517851"><span class="hs-identifier hs-var hs-var">ypos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Int -&gt; IntMap a -&gt; a
</span><span class="hs-identifier hs-var">IM.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517859"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621679517867"><span class="hs-identifier hs-var">neighbors</span></a></span><span>
</span><span id="line-758"></span><span>      </span><span id="local-6989586621679517847"><span class="annot"><span class="annottext">neighbors' :: IntMap a
</span><a href="#local-6989586621679517847"><span class="hs-identifier hs-var hs-var">neighbors'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-759"></span><span>        </span><span class="annot"><span class="annottext">forall a. (Maybe a -&gt; Maybe a) -&gt; Int -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.alter</span></span><span>
</span><span id="line-760"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-761"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679517845"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679517845"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679517845"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-762"></span><span>              </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span>
</span><span id="line-763"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517859"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-765"></span><span>          </span><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621679517867"><span class="hs-identifier hs-var">neighbors</span></a></span><span>
</span><span id="line-766"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-767"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    \\node[slice,align=center] (slice&quot;</span></span><span>
</span><span id="line-768"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517863"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-769"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;) at (&quot;</span></span><span>
</span><span id="line-770"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679517853"><span class="hs-identifier hs-var">xpos</span></a></span><span>
</span><span id="line-771"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span>
</span><span id="line-772"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679517851"><span class="hs-identifier hs-var">ypos</span></a></span><span>
</span><span id="line-773"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;) {&quot;</span></span><span>
</span><span id="line-774"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="Common.html#showTex"><span class="hs-identifier hs-var">showTex</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679517864"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-775"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\\\\ (&quot;</span></span><span>
</span><span id="line-776"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tLeftSlice"><span class="hs-identifier hs-var">tLeftSlice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679517861"><span class="hs-identifier hs-var">middle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-777"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;) - &quot;</span></span><span>
</span><span id="line-778"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517863"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-779"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; - (&quot;</span></span><span>
</span><span id="line-780"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tRightSlice"><span class="hs-identifier hs-var">tRightSlice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679517861"><span class="hs-identifier hs-var">middle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-781"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)};&quot;</span></span><span>
</span><span id="line-782"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621679517847"><span class="hs-identifier hs-var">neighbors'</span></a></span><span>
</span><span id="line-783"></span><span>
</span><span id="line-784"></span><span class="hs-comment">-- | Generate TikZ code for a transition.</span><span>
</span><span id="line-785"></span><span id="printTikzTrans"><span class="annot"><span class="annottext">printTikzTrans :: IntMap a -&gt; Transition tr slc -&gt; IO (IntMap a)
</span><a href="ChartParser.html#printTikzTrans"><span class="hs-identifier hs-var hs-var">printTikzTrans</span></a></span></span><span> </span><span id="local-6989586621679517813"><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621679517813"><span class="hs-identifier hs-var">neighbors</span></a></span></span><span> </span><span id="local-6989586621679517812"><span class="annot"><span class="annottext">t :: Transition tr slc
</span><a href="#local-6989586621679517812"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span id="local-6989586621679517811"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679517811"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span id="local-6989586621679517810"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679517810"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621679517809"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679517809"><span class="hs-identifier hs-var">sr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-786"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679517803"><span class="annot"><span class="annottext">tid :: String
</span><a href="#local-6989586621679517803"><span class="hs-identifier hs-var hs-var">tid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;t&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Hashable a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">hash</span></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679517812"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-787"></span><span>      </span><span id="local-6989586621679517801"><span class="annot"><span class="annottext">index :: Int
</span><a href="#local-6989586621679517801"><span class="hs-identifier hs-var hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sFirst"><span class="hs-identifier hs-var">sFirst</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679517811"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sLast"><span class="hs-identifier hs-var">sLast</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679517809"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-788"></span><span>      </span><span id="local-6989586621679517796"><span class="annot"><span class="annottext">xpos :: Double
</span><a href="#local-6989586621679517796"><span class="hs-identifier hs-var hs-var">xpos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517801"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2.0</span></span><span>
</span><span id="line-789"></span><span>      </span><span id="local-6989586621679517794"><span class="annot"><span class="annottext">ypos :: a
</span><a href="#local-6989586621679517794"><span class="hs-identifier hs-var hs-var">ypos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Int -&gt; IntMap a -&gt; a
</span><span class="hs-identifier hs-var">IM.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517801"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621679517813"><span class="hs-identifier hs-var">neighbors</span></a></span><span>
</span><span id="line-790"></span><span>      </span><span id="local-6989586621679517790"><span class="annot"><span class="annottext">neighbors' :: IntMap a
</span><a href="#local-6989586621679517790"><span class="hs-identifier hs-var hs-var">neighbors'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-791"></span><span>        </span><span class="annot"><span class="annottext">forall a. (Maybe a -&gt; Maybe a) -&gt; Int -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.alter</span></span><span>
</span><span id="line-792"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-793"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679517789"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679517789"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679517789"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-794"></span><span>              </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span>
</span><span id="line-795"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-796"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517801"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-797"></span><span>          </span><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621679517813"><span class="hs-identifier hs-var">neighbors</span></a></span><span>
</span><span id="line-798"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-799"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  \\begin{scope}[xshift=&quot;</span></span><span>
</span><span id="line-800"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679517796"><span class="hs-identifier hs-var">xpos</span></a></span><span>
</span><span id="line-801"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cm,yshift=&quot;</span></span><span>
</span><span id="line-802"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679517794"><span class="hs-identifier hs-var">ypos</span></a></span><span>
</span><span id="line-803"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cm]&quot;</span></span><span>
</span><span id="line-804"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-805"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    \\node[slice] (&quot;</span></span><span>
</span><span id="line-806"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679517803"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-807"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;left) at (-0.1,0) {&quot;</span></span><span>
</span><span id="line-808"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679517811"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-809"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;};&quot;</span></span><span>
</span><span id="line-810"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-811"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    \\node[slice] (&quot;</span></span><span>
</span><span id="line-812"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679517803"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-813"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;right) at (0.1,0) {&quot;</span></span><span>
</span><span id="line-814"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679517809"><span class="hs-identifier hs-var">sr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-815"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;};&quot;</span></span><span>
</span><span id="line-816"></span><span>  </span><span class="hs-comment">-- printTikzSlice sl (tid &lt;&gt; &quot;left&quot;)  &quot;(-0.2,0)&quot;</span><span>
</span><span id="line-817"></span><span>  </span><span class="hs-comment">-- printTikzSlice sr (tid &lt;&gt; &quot;right&quot;) &quot;(0.2,0)&quot;</span><span>
</span><span id="line-818"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-819"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    \\draw[transition] (&quot;</span></span><span>
</span><span id="line-820"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679517803"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-821"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;left) -- (&quot;</span></span><span>
</span><span id="line-822"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679517803"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-823"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;right);&quot;</span></span><span>
</span><span id="line-824"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  \\end{scope}&quot;</span></span><span>
</span><span id="line-825"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621679517790"><span class="hs-identifier hs-var">neighbors'</span></a></span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span class="hs-comment">-- | A logging function that emits the state of the chart in TikZ code at every level.</span><span>
</span><span id="line-828"></span><span id="logTikz"><span class="annot"><span class="annottext">logTikz :: TChart tr slc v
-&gt; Either (VChart tr slc v) (t (Slice slc)) -&gt; Int -&gt; IO ()
</span><a href="ChartParser.html#logTikz"><span class="hs-identifier hs-var hs-var">logTikz</span></a></span></span><span> </span><span id="local-6989586621679517752"><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679517752"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621679517751"><span class="annot"><span class="annottext">Either (VChart tr slc v) (t (Slice slc))
</span><a href="#local-6989586621679517751"><span class="hs-identifier hs-var">vc</span></a></span></span><span> </span><span id="local-6989586621679517750"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517750"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-829"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n% level &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517750"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-830"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679517742"><span class="annot"><span class="annottext">rel :: String
</span><a href="#local-6989586621679517742"><span class="hs-identifier hs-var hs-var">rel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-831"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517750"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-832"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-833"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,shift={($(0,0 |- scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517750"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.north)+(0,1cm)$)}&quot;</span></span><span>
</span><span id="line-834"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\\begin{scope}[local bounding box=scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517750"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679517742"><span class="hs-identifier hs-var">rel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;]&quot;</span></span><span>
</span><span id="line-835"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  % verticalizations:&quot;</span></span><span>
</span><span id="line-836"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (VChart tr slc v) (t (Slice slc))
</span><a href="#local-6989586621679517751"><span class="hs-identifier hs-var">vc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-837"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679517741"><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679517741"><span class="hs-identifier hs-var">chart</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">foldM_</span></span><span> </span><span class="annot"><span class="annottext">forall {a} {slc} {tr} {v}.
(Show a, Show slc, Num a) =&gt;
IntMap a -&gt; Vert tr slc v -&gt; IO (IntMap a)
</span><a href="ChartParser.html#printTikzVert"><span class="hs-identifier hs-var">printTikzVert</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IntMap a
</span><span class="hs-identifier hs-var">IM.empty</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall tr slc v. VChart tr slc v -&gt; Int -&gt; [Vert tr slc v]
</span><a href="ChartParser.html#vcGetByLength"><span class="hs-identifier hs-var">vcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc v
</span><a href="#local-6989586621679517741"><span class="hs-identifier hs-var">chart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517750"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-838"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679517739"><span class="annot"><span class="annottext">t (Slice slc)
</span><a href="#local-6989586621679517739"><span class="hs-identifier hs-var">lst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Show slc =&gt; Slice slc -&gt; IO ()
</span><a href="ChartParser.html#printTikzSlice"><span class="hs-identifier hs-var">printTikzSlice</span></a></span><span> </span><span class="annot"><span class="annottext">t (Slice slc)
</span><a href="#local-6989586621679517739"><span class="hs-identifier hs-var">lst</span></a></span><span>
</span><span id="line-839"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n  % transitions:&quot;</span></span><span>
</span><span id="line-840"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">foldM_</span></span><span> </span><span class="annot"><span class="annottext">forall {a} {tr} {slc}.
(Show a, Num a, Hashable tr, Eq slc) =&gt;
IntMap a -&gt; Transition tr slc -&gt; IO (IntMap a)
</span><a href="ChartParser.html#printTikzTrans"><span class="hs-identifier hs-var">printTikzTrans</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IntMap a
</span><span class="hs-identifier hs-var">IM.empty</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall tr slc v. TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-var">tcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679517752"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679517750"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-841"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\\end{scope}&quot;</span></span><span>
</span><span id="line-842"></span></pre></body></html>