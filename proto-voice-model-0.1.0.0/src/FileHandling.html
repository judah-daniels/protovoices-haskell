<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">{- | This module contains functionality for reading chord and slice data from csv files, as output by 'preprocess.py'.
     This also contains functionality for writing the results of the parses to json files, to be read by 'results.py'
-}</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">FileHandling</span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="FileHandling.html#InputSlice"><span class="hs-identifier">InputSlice</span></a></span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="FileHandling.html#pathFromSlices"><span class="hs-identifier">pathFromSlices</span></a></span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="FileHandling.html#concatResults"><span class="hs-identifier">concatResults</span></a></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="FileHandling.html#slicesFromFile%27"><span class="hs-identifier">slicesFromFile'</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="FileHandling.html#chordsFromFile"><span class="hs-identifier">chordsFromFile</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="FileHandling.html#writeJSONToFile"><span class="hs-identifier">writeJSONToFile</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="FileHandling.html#writeResultsToJSON"><span class="hs-identifier">writeResultsToJSON</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="FileHandling.html#nullResultToJSON"><span class="hs-identifier">nullResultToJSON</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="FileHandling.html#splitSlicesIntoSegments"><span class="hs-identifier">splitSlicesIntoSegments</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Common.html"><span class="hs-identifier">Common</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#split"><span class="hs-identifier">split</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Logging</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Log</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ExceptT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runExceptT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwError</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">evalState</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Except</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throwE</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">JSONPath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.=)</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.Encoding</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.Key</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Csv</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FromField</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">FromNamedRecord</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">FromRecord</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">decodeByName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">parseField</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">parseNamedRecord</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">parseRecord</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.:)</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Hashable</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.Split</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromJust</span></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isNothing</span></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">maybeToList</span></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Debug.Trace</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Display.html"><span class="hs-identifier">Display</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="HeuristicParser.html"><span class="hs-identifier">HeuristicParser</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Heuristics.html"><span class="hs-identifier">Heuristics</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Internal.MultiSet.html"><span class="hs-identifier">Internal.MultiSet</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MS</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.DoNotation</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Musicology.Core</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Musicology.Core</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Music</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Musicology.Pitch.Spelled</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Harmony.ChordLabel.html"><span class="hs-identifier">Harmony.ChordLabel</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Harmony.html"><span class="hs-identifier">Harmony</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Harmony.Params.html"><span class="hs-identifier">Harmony.Params</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PVGrammar.html"><span class="hs-identifier">PVGrammar</span></a></span><span> </span><span class="hs-keyword">hiding</span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PVGrammar.html#slicesFromFile"><span class="hs-identifier">slicesFromFile</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PVGrammar.Generate.html"><span class="hs-identifier">PVGrammar.Generate</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html"><span class="hs-identifier">PVGrammar.Parse</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Monad</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lift</span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">pure</span></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">createDirectoryIfMissing</span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath.Posix</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">takeDirectory</span></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Read</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">readMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">-- | Slice type for reading from csv</span><span>
</span><span id="line-73"></span><span class="hs-keyword">type</span><span> </span><span id="InputSlice"><span class="annot"><a href="FileHandling.html#InputSlice"><span class="hs-identifier hs-var">InputSlice</span></a></span></span><span> </span><span id="local-6989586621679530294"><span class="annot"><a href="#local-6989586621679530294"><span class="hs-identifier hs-type">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621679530294"><span class="hs-identifier hs-type">ns</span></a></span><span>
</span><span id="line-75"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- \^ Note</span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Music.RightTied</span></span><span>
</span><span id="line-77"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- \^ Marks whether or not this note is tied to the next</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">-- \^ Marks if this slice is the start of a new segment</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">-- -- ---------------------------------- -------------------------------- --------------------------------</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- Reading Data from Files</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromField</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Music.RightTied</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-90"></span><span>  </span><span id="local-6989586621679530282"><span class="annot"><span class="annottext">parseField :: Field -&gt; Parser RightTied
</span><a href="#local-6989586621679530282"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseField</span></a></span></span><span> </span><span id="local-6989586621679530281"><span class="annot"><span class="annottext">Field
</span><a href="#local-6989586621679530281"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Field
</span><a href="#local-6989586621679530281"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><span class="annottext">Field
</span><span class="hs-string">&quot;True&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">RightTied
</span><span class="hs-identifier hs-var">Music.Holds</span></span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><span class="annottext">Field
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">RightTied
</span><span class="hs-identifier hs-var">Music.Ends</span></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromField</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-95"></span><span>  </span><span id="local-6989586621679530270"><span class="annot"><span class="annottext">parseField :: Field -&gt; Parser Bool
</span><a href="#local-6989586621679530270"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseField</span></a></span></span><span> </span><span id="local-6989586621679530269"><span class="annot"><span class="annottext">Field
</span><a href="#local-6989586621679530269"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Field
</span><a href="#local-6989586621679530269"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><span class="annottext">Field
</span><span class="hs-string">&quot;True&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><span class="annottext">Field
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- | Data Structure for parsing individual notes</span><span>
</span><span id="line-100"></span><span class="hs-keyword">data</span><span> </span><span id="SalamiNote"><span class="annot"><a href="FileHandling.html#SalamiNote"><span class="hs-identifier hs-var">SalamiNote</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SalamiNote"><span class="annot"><a href="FileHandling.html#SalamiNote"><span class="hs-identifier hs-var">SalamiNote</span></a></span></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_new_segment"><span class="annot"><span class="annottext">SalamiNote -&gt; Bool
</span><a href="FileHandling.html#_new_segment"><span class="hs-identifier hs-var hs-var">_new_segment</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_new_slice"><span class="annot"><span class="annottext">SalamiNote -&gt; Bool
</span><a href="FileHandling.html#_new_slice"><span class="hs-identifier hs-var hs-var">_new_slice</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_pitch"><span class="annot"><span class="annottext">SalamiNote -&gt; String
</span><a href="FileHandling.html#_pitch"><span class="hs-identifier hs-var hs-var">_pitch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_tied"><span class="annot"><span class="annottext">SalamiNote -&gt; RightTied
</span><a href="FileHandling.html#_tied"><span class="hs-identifier hs-var hs-var">_tied</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Music.RightTied</span></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- | Data Structure for parsing chord labels</span><span>
</span><span id="line-108"></span><span class="hs-keyword">data</span><span> </span><span id="ChordLabel%27"><span class="annot"><a href="FileHandling.html#ChordLabel%27"><span class="hs-identifier hs-var">ChordLabel'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ChordLabel%27"><span class="annot"><a href="FileHandling.html#ChordLabel%27"><span class="hs-identifier hs-var">ChordLabel'</span></a></span></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_segment_id%27"><span class="annot"><span class="annottext">ChordLabel' -&gt; Int
</span><a href="FileHandling.html#_segment_id%27"><span class="hs-identifier hs-var hs-var">_segment_id'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_chordtype"><span class="annot"><span class="annottext">ChordLabel' -&gt; String
</span><a href="FileHandling.html#_chordtype"><span class="hs-identifier hs-var hs-var">_chordtype</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_rootoffset"><span class="annot"><span class="annottext">ChordLabel' -&gt; Int
</span><a href="FileHandling.html#_rootoffset"><span class="hs-identifier hs-var hs-var">_rootoffset</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_globalkey"><span class="annot"><span class="annottext">ChordLabel' -&gt; String
</span><a href="FileHandling.html#_globalkey"><span class="hs-identifier hs-var hs-var">_globalkey</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromNamedRecord</span></span><span> </span><span class="annot"><a href="FileHandling.html#SalamiNote"><span class="hs-identifier hs-type">SalamiNote</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-116"></span><span>  </span><span id="local-6989586621679530242"><span class="annot"><span class="annottext">parseNamedRecord :: NamedRecord -&gt; Parser SalamiNote
</span><a href="#local-6989586621679530242"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseNamedRecord</span></a></span></span><span> </span><span id="local-6989586621679530241"><span class="annot"><span class="annottext">NamedRecord
</span><a href="#local-6989586621679530241"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; String -&gt; RightTied -&gt; SalamiNote
</span><a href="FileHandling.html#SalamiNote"><span class="hs-identifier hs-var">SalamiNote</span></a></span><span>
</span><span id="line-118"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NamedRecord
</span><a href="#local-6989586621679530241"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. FromField a =&gt; NamedRecord -&gt; Field -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Field
</span><span class="hs-string">&quot;new_segment&quot;</span></span><span>
</span><span id="line-119"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">NamedRecord
</span><a href="#local-6989586621679530241"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. FromField a =&gt; NamedRecord -&gt; Field -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Field
</span><span class="hs-string">&quot;new_slice&quot;</span></span><span>
</span><span id="line-120"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">NamedRecord
</span><a href="#local-6989586621679530241"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. FromField a =&gt; NamedRecord -&gt; Field -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Field
</span><span class="hs-string">&quot;pitch&quot;</span></span><span>
</span><span id="line-121"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">NamedRecord
</span><a href="#local-6989586621679530241"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. FromField a =&gt; NamedRecord -&gt; Field -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Field
</span><span class="hs-string">&quot;tied&quot;</span></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromNamedRecord</span></span><span> </span><span class="annot"><a href="FileHandling.html#ChordLabel%27"><span class="hs-identifier hs-type">ChordLabel'</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>  </span><span id="local-6989586621679530225"><span class="annot"><span class="annottext">parseNamedRecord :: NamedRecord -&gt; Parser ChordLabel'
</span><a href="#local-6989586621679530225"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseNamedRecord</span></a></span></span><span> </span><span id="local-6989586621679530224"><span class="annot"><span class="annottext">NamedRecord
</span><a href="#local-6989586621679530224"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; String -&gt; Int -&gt; String -&gt; ChordLabel'
</span><a href="FileHandling.html#ChordLabel%27"><span class="hs-identifier hs-var">ChordLabel'</span></a></span><span>
</span><span id="line-126"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NamedRecord
</span><a href="#local-6989586621679530224"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. FromField a =&gt; NamedRecord -&gt; Field -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Field
</span><span class="hs-string">&quot;segment_id&quot;</span></span><span>
</span><span id="line-127"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">NamedRecord
</span><a href="#local-6989586621679530224"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. FromField a =&gt; NamedRecord -&gt; Field -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Field
</span><span class="hs-string">&quot;chord_type&quot;</span></span><span>
</span><span id="line-128"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">NamedRecord
</span><a href="#local-6989586621679530224"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. FromField a =&gt; NamedRecord -&gt; Field -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Field
</span><span class="hs-string">&quot;rootoffset&quot;</span></span><span>
</span><span id="line-129"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">NamedRecord
</span><a href="#local-6989586621679530224"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. FromField a =&gt; NamedRecord -&gt; Field -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Field
</span><span class="hs-string">&quot;globalkey&quot;</span></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="hs-comment">-- | Data type for a chord type. TODO specialise this datatype.</span><span>
</span><span id="line-132"></span><span class="hs-keyword">type</span><span> </span><span id="Chord"><span class="annot"><a href="FileHandling.html#Chord"><span class="hs-identifier hs-var">Chord</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">-- | Intermediate datatype for a slice, once boundaries have been parsed.</span><span>
</span><span id="line-135"></span><span class="hs-keyword">type</span><span> </span><span id="Slice%27"><span class="annot"><a href="FileHandling.html#Slice%27"><span class="hs-identifier hs-var">Slice'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Music.RightTied</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-comment">-- | Loads chord annotations from filepath</span><span>
</span><span id="line-138"></span><span class="annot"><a href="FileHandling.html#chordsFromFile"><span class="hs-identifier hs-type">chordsFromFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Harmony.ChordLabel.html#ChordLabel"><span class="hs-identifier hs-type">ChordLabel</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-139"></span><span id="chordsFromFile"><span class="annot"><span class="annottext">chordsFromFile :: String -&gt; IO [ChordLabel]
</span><a href="FileHandling.html#chordsFromFile"><span class="hs-identifier hs-var hs-var">chordsFromFile</span></a></span></span><span> </span><span id="local-6989586621679530221"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530221"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-140"></span><span>  </span><span id="local-6989586621679530220"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679530220"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ByteString
</span><span class="hs-identifier hs-var">BL.readFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530221"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a.
FromNamedRecord a =&gt;
ByteString -&gt; Either String (Header, Vector a)
</span><span class="hs-identifier hs-var">decodeByName</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679530220"><span class="hs-identifier hs-var">txt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679530218"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530218"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-143"></span><span>      </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">print</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530218"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-144"></span><span>      </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Header
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679530217"><span class="annot"><span class="annottext">Vector ChordLabel'
</span><a href="#local-6989586621679530217"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-146"></span><span>      </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ChordLabel' -&gt; ChordLabel
</span><a href="#local-6989586621679530216"><span class="hs-identifier hs-var">parseChordLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">V.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector ChordLabel'
</span><a href="#local-6989586621679530217"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><a href="#local-6989586621679530216"><span class="hs-identifier hs-type">parseChordLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="FileHandling.html#ChordLabel%27"><span class="hs-identifier hs-type">ChordLabel'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Harmony.ChordLabel.html#ChordLabel"><span class="hs-identifier hs-type">ChordLabel</span></a></span><span>
</span><span id="line-149"></span><span>  </span><span id="local-6989586621679530216"><span class="annot"><span class="annottext">parseChordLabel :: ChordLabel' -&gt; ChordLabel
</span><a href="#local-6989586621679530216"><span class="hs-identifier hs-var hs-var">parseChordLabel</span></a></span></span><span> </span><span id="local-6989586621679530214"><span class="annot"><span class="annottext">ChordLabel'
</span><a href="#local-6989586621679530214"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChordType -&gt; SPC -&gt; ChordLabel
</span><a href="Harmony.ChordLabel.html#ChordLabel"><span class="hs-identifier hs-var">ChordLabel</span></a></span><span> </span><span class="annot"><span class="annottext">ChordType
</span><a href="#local-6989586621679530212"><span class="hs-identifier hs-var">cType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a}. AdditiveGroup a =&gt; Pitch a -&gt; a -&gt; Pitch a
</span><span class="hs-operator hs-var">(Music.+^)</span></span><span> </span><span class="annot"><span class="annottext">SPC
</span><a href="#local-6989586621679530210"><span class="hs-identifier hs-var">globalKey'</span></a></span><span> </span><span class="annot"><span class="annottext">SIC
</span><a href="#local-6989586621679530209"><span class="hs-identifier hs-var">rootOffset'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-comment">-- (Music.sic $ _rootoffset r) (fromMaybe undefined (Music.readNotation $ _globalkey r))</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><a href="#local-6989586621679530212"><span class="hs-identifier hs-type">cType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Harmony.ChordLabel.html#ChordType"><span class="hs-identifier hs-type">ChordType</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span id="local-6989586621679530212"><span class="annot"><span class="annottext">cType :: ChordType
</span><a href="#local-6989586621679530212"><span class="hs-identifier hs-var hs-var">cType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. Read a =&gt; String -&gt; Maybe a
</span><span class="hs-identifier hs-var">readMaybe</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChordLabel' -&gt; String
</span><a href="FileHandling.html#_chordtype"><span class="hs-identifier hs-var">_chordtype</span></a></span><span> </span><span class="annot"><span class="annottext">ChordLabel'
</span><a href="#local-6989586621679530214"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span>
</span><span id="line-155"></span><span>              </span><span class="annot"><span class="annottext">Maybe ChordType
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">trace</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cant read chord type&quot;</span></span><span> </span><span class="annot"><span class="annottext">ChordType
</span><a href="Harmony.ChordLabel.html#Major"><span class="hs-identifier hs-var">Major</span></a></span><span> </span><span class="hs-comment">-- BUGBUG BUG BGU TODO FIX</span><span>
</span><span id="line-156"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679530207"><span class="annot"><span class="annottext">ChordType
</span><a href="#local-6989586621679530207"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChordType
</span><a href="#local-6989586621679530207"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><a href="#local-6989586621679530209"><span class="hs-identifier hs-type">rootOffset'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SIC</span></span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621679530209"><span class="annot"><span class="annottext">rootOffset' :: SIC
</span><a href="#local-6989586621679530209"><span class="hs-identifier hs-var hs-var">rootOffset'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SIC
</span><span class="hs-identifier hs-var">Music.sic</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChordLabel' -&gt; Int
</span><a href="FileHandling.html#_rootoffset"><span class="hs-identifier hs-var">_rootoffset</span></a></span><span> </span><span class="annot"><span class="annottext">ChordLabel'
</span><a href="#local-6989586621679530214"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><a href="#local-6989586621679530210"><span class="hs-identifier hs-type">globalKey'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SPC</span></span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621679530210"><span class="annot"><span class="annottext">globalKey' :: SPC
</span><a href="#local-6989586621679530210"><span class="hs-identifier hs-var hs-var">globalKey'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall i. Notation i =&gt; String -&gt; Maybe i
</span><span class="hs-identifier hs-var">Music.readNotation</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChordLabel' -&gt; String
</span><a href="FileHandling.html#_globalkey"><span class="hs-identifier hs-var">_globalkey</span></a></span><span> </span><span class="annot"><span class="annottext">ChordLabel'
</span><a href="#local-6989586621679530214"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-161"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679530204"><span class="annot"><span class="annottext">SPC
</span><a href="#local-6989586621679530204"><span class="hs-identifier hs-var">note</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SPC
</span><a href="#local-6989586621679530204"><span class="hs-identifier hs-var">note</span></a></span><span>
</span><span id="line-162"></span><span>      </span><span class="annot"><span class="annottext">Maybe SPC
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Text -&gt; a
</span><span class="hs-identifier hs-var">Log.errorL</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Can't Read notation of global key from &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530221"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; key: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChordLabel' -&gt; String
</span><a href="FileHandling.html#_globalkey"><span class="hs-identifier hs-var">_globalkey</span></a></span><span> </span><span class="annot"><span class="annottext">ChordLabel'
</span><a href="#local-6989586621679530214"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-comment">-- | Loads slices from filepath</span><span>
</span><span id="line-165"></span><span class="annot"><a href="FileHandling.html#slicesFromFile%27"><span class="hs-identifier hs-type">slicesFromFile'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="FileHandling.html#Slice%27"><span class="hs-identifier hs-type">Slice'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-166"></span><span id="slicesFromFile%27"><span class="annot"><span class="annottext">slicesFromFile' :: String -&gt; IO [(Slice', Bool)]
</span><a href="FileHandling.html#slicesFromFile%27"><span class="hs-identifier hs-var hs-var">slicesFromFile'</span></a></span></span><span> </span><span id="local-6989586621679530200"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530200"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-167"></span><span>  </span><span id="local-6989586621679530199"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679530199"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ByteString
</span><span class="hs-identifier hs-var">BL.readFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530200"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a.
FromNamedRecord a =&gt;
ByteString -&gt; Either String (Header, Vector a)
</span><span class="hs-identifier hs-var">decodeByName</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679530199"><span class="hs-identifier hs-var">txt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-169"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679530198"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530198"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Header
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679530197"><span class="annot"><span class="annottext">Vector SalamiNote
</span><a href="#local-6989586621679530197"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679530195"><span class="annot"><span class="annottext">notes :: [(SPitch, RightTied, Bool, Bool)]
</span><a href="#local-6989586621679530195"><span class="hs-identifier hs-var hs-var">notes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">SalamiNote -&gt; (SPitch, RightTied, Bool, Bool)
</span><a href="FileHandling.html#noteFromSalami"><span class="hs-identifier hs-var">noteFromSalami</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">V.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector SalamiNote
</span><a href="#local-6989586621679530197"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>      </span><span class="hs-comment">-- notes :: [(SPitch, Music.RightTied, NewSegment, NewSlice])</span><span>
</span><span id="line-173"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679530193"><span class="annot"><span class="annottext">slices :: [[(SPitch, RightTied, Bool)]]
</span><a href="#local-6989586621679530193"><span class="hs-identifier hs-var hs-var">slices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-174"></span><span>            </span><span class="hs-keyword">let</span><span>
</span><span id="line-175"></span><span>              </span><span id="local-6989586621679530192"><span class="annot"><span class="annottext">splitNotes :: [[(SPitch, RightTied, Bool, Bool)]]
</span><a href="#local-6989586621679530192"><span class="hs-identifier hs-var hs-var">splitNotes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Splitter a -&gt; [a] -&gt; [[a]]
</span><span class="hs-identifier hs-var">split</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Splitter a -&gt; Splitter a
</span><span class="hs-identifier hs-var">keepDelimsL</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; Splitter a
</span><span class="hs-identifier hs-var">whenElt</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">SPitch
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RightTied
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679530188"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679530188"><span class="hs-identifier hs-var">newSlice</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679530188"><span class="hs-identifier hs-var">newSlice</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SPitch, RightTied, Bool, Bool)]
</span><a href="#local-6989586621679530195"><span class="hs-identifier hs-var">notes</span></a></span><span>
</span><span id="line-176"></span><span>             </span><span class="hs-keyword">in</span><span>
</span><span id="line-177"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679530186"><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679530186"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679530185"><span class="annot"><span class="annottext">RightTied
</span><a href="#local-6989586621679530185"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679530184"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679530184"><span class="hs-identifier hs-var">newSeg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679530186"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RightTied
</span><a href="#local-6989586621679530185"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679530184"><span class="hs-identifier hs-var">newSeg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[(SPitch, RightTied, Bool, Bool)]]
</span><a href="#local-6989586621679530192"><span class="hs-identifier hs-var">splitNotes</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span>      </span><span class="hs-comment">-- let segmentedSlices = map addBoundary slices</span><span>
</span><span id="line-180"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679530183"><span class="annot"><span class="annottext">segmentedSlices :: [(Slice', Bool)]
</span><a href="#local-6989586621679530183"><span class="hs-identifier hs-var hs-var">segmentedSlices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[(SPitch, RightTied, Bool)] -&gt; (Slice', Bool)
</span><a href="#local-6989586621679530182"><span class="hs-identifier hs-var">addBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">[[(SPitch, RightTied, Bool)]]
</span><a href="#local-6989586621679530193"><span class="hs-identifier hs-var">slices</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-181"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679530181"><span class="annot"><span class="annottext">Slice'
</span><a href="#local-6989586621679530181"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679530180"><span class="annot"><span class="annottext">[(Slice', Bool)]
</span><a href="#local-6989586621679530180"><span class="hs-identifier hs-var">rst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice'
</span><a href="#local-6989586621679530181"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(Slice', Bool)]
</span><a href="#local-6989586621679530180"><span class="hs-identifier hs-var">rst</span></a></span><span>
</span><span id="line-182"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>      </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[(Slice', Bool)]
</span><a href="#local-6989586621679530183"><span class="hs-identifier hs-var">segmentedSlices</span></a></span><span>
</span><span id="line-185"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-186"></span><span>      </span><span class="annot"><a href="#local-6989586621679530182"><span class="hs-identifier hs-type">addBoundary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Music.RightTied</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="FileHandling.html#Slice%27"><span class="hs-identifier hs-type">Slice'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>      </span><span id="local-6989586621679530182"><span class="annot"><span class="annottext">addBoundary :: [(SPitch, RightTied, Bool)] -&gt; (Slice', Bool)
</span><a href="#local-6989586621679530182"><span class="hs-identifier hs-var hs-var">addBoundary</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-188"></span><span>      </span><span class="annot"><a href="#local-6989586621679530182"><span class="hs-identifier hs-var">addBoundary</span></a></span><span> </span><span id="local-6989586621679530178"><span class="annot"><span class="annottext">slc :: [(SPitch, RightTied, Bool)]
</span><a href="#local-6989586621679530178"><span class="hs-identifier hs-var">slc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679530177"><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679530177"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679530176"><span class="annot"><span class="annottext">RightTied
</span><a href="#local-6989586621679530176"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679530175"><span class="annot"><span class="annottext">[(SPitch, RightTied, Bool)]
</span><a href="#local-6989586621679530175"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a} {b} {c}. (a, b, c) -&gt; (a, b)
</span><a href="#local-6989586621679530174"><span class="hs-identifier hs-var">dropLastOf3</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(SPitch, RightTied, Bool)]
</span><a href="#local-6989586621679530178"><span class="hs-identifier hs-var">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>      </span><span class="annot"><a href="#local-6989586621679530182"><span class="hs-identifier hs-var">addBoundary</span></a></span><span> </span><span id="local-6989586621679530173"><span class="annot"><span class="annottext">slc :: [(SPitch, RightTied, Bool)]
</span><a href="#local-6989586621679530173"><span class="hs-identifier hs-var">slc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679530172"><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679530172"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679530171"><span class="annot"><span class="annottext">RightTied
</span><a href="#local-6989586621679530171"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679530170"><span class="annot"><span class="annottext">[(SPitch, RightTied, Bool)]
</span><a href="#local-6989586621679530170"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a} {b} {c}. (a, b, c) -&gt; (a, b)
</span><a href="#local-6989586621679530174"><span class="hs-identifier hs-var">dropLastOf3</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(SPitch, RightTied, Bool)]
</span><a href="#local-6989586621679530173"><span class="hs-identifier hs-var">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span>      </span><span id="local-6989586621679530174"><span class="annot"><span class="annottext">dropLastOf3 :: (a, b, c) -&gt; (a, b)
</span><a href="#local-6989586621679530174"><span class="hs-identifier hs-var hs-var">dropLastOf3</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679530169"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679530169"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679530168"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679530168"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679530167"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679530167"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679530169"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679530168"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>      </span><span class="annot"><a href="#local-6989586621679530166"><span class="hs-identifier hs-type">output</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Music.RightTied</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="FileHandling.html#Slice%27"><span class="hs-identifier hs-type">Slice'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-194"></span><span>      </span><span class="hs-comment">-- f :: [[a]] -&gt; (a-&gt;b) -&gt; [b]</span><span>
</span><span id="line-195"></span><span>      </span><span id="local-6989586621679530166"><span class="annot"><span class="annottext">output :: [[Slice']] -&gt; [(Slice', Bool)]
</span><a href="#local-6989586621679530166"><span class="hs-identifier hs-var hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">[Slice'] -&gt; [(Slice', Bool)]
</span><a href="#local-6989586621679530164"><span class="hs-identifier hs-var">addBoundaries</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>      </span><span class="annot"><a href="#local-6989586621679530163"><span class="hs-identifier hs-type">splitIntoSlices</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Music.RightTied</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Music.RightTied</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-198"></span><span>      </span><span id="local-6989586621679530163"><span class="annot"><span class="annottext">splitIntoSlices :: [(SPitch, RightTied, Bool)] -&gt; [Slice']
</span><a href="#local-6989586621679530163"><span class="hs-identifier hs-var hs-var">splitIntoSlices</span></a></span></span><span> </span><span id="local-6989586621679530162"><span class="annot"><span class="annottext">[(SPitch, RightTied, Bool)]
</span><a href="#local-6989586621679530162"><span class="hs-identifier hs-var">slices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679530161"><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679530161"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679530160"><span class="annot"><span class="annottext">RightTied
</span><a href="#local-6989586621679530160"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679530161"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RightTied
</span><a href="#local-6989586621679530160"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Splitter a -&gt; [a] -&gt; [[a]]
</span><span class="hs-identifier hs-var">split</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Splitter a -&gt; Splitter a
</span><span class="hs-identifier hs-var">keepDelimsR</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; Splitter a
</span><span class="hs-identifier hs-var">whenElt</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">SPitch
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RightTied
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679530158"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679530158"><span class="hs-identifier hs-var">newSlice</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679530158"><span class="hs-identifier hs-var">newSlice</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SPitch, RightTied, Bool)]
</span><a href="#local-6989586621679530162"><span class="hs-identifier hs-var">slices</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span>      </span><span class="hs-comment">-- Assign boundary marker to first slice of each segment</span><span>
</span><span id="line-201"></span><span>      </span><span class="annot"><a href="#local-6989586621679530164"><span class="hs-identifier hs-type">addBoundaries</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Music.RightTied</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="FileHandling.html#Slice%27"><span class="hs-identifier hs-type">Slice'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-202"></span><span>      </span><span id="local-6989586621679530164"><span class="annot"><span class="annottext">addBoundaries :: [Slice'] -&gt; [(Slice', Bool)]
</span><a href="#local-6989586621679530164"><span class="hs-identifier hs-var hs-var">addBoundaries</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-203"></span><span>      </span><span class="annot"><a href="#local-6989586621679530164"><span class="hs-identifier hs-var">addBoundaries</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679530157"><span class="annot"><span class="annottext">Slice'
</span><a href="#local-6989586621679530157"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679530156"><span class="annot"><span class="annottext">[Slice']
</span><a href="#local-6989586621679530156"><span class="hs-identifier hs-var">sx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice'
</span><a href="#local-6989586621679530157"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Slice']
</span><a href="#local-6989586621679530156"><span class="hs-identifier hs-var">sx</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-comment">-- | Parse a salami note as output from the DCML dimcat package.</span><span>
</span><span id="line-206"></span><span class="annot"><a href="FileHandling.html#noteFromSalami"><span class="hs-identifier hs-type">noteFromSalami</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="FileHandling.html#SalamiNote"><span class="hs-identifier hs-type">SalamiNote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Music.RightTied</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span id="noteFromSalami"><span class="annot"><span class="annottext">noteFromSalami :: SalamiNote -&gt; (SPitch, RightTied, Bool, Bool)
</span><a href="FileHandling.html#noteFromSalami"><span class="hs-identifier hs-var hs-var">noteFromSalami</span></a></span></span><span> </span><span id="local-6989586621679530155"><span class="annot"><span class="annottext">SalamiNote
</span><a href="#local-6989586621679530155"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679530154"><span class="hs-identifier hs-var">sPitch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RightTied
</span><a href="#local-6989586621679530153"><span class="hs-identifier hs-var">tied</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679530152"><span class="hs-identifier hs-var">newSegment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679530151"><span class="hs-identifier hs-var">newSlice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-209"></span><span>  </span><span id="local-6989586621679530152"><span class="annot"><span class="annottext">newSegment :: Bool
</span><a href="#local-6989586621679530152"><span class="hs-identifier hs-var hs-var">newSegment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SalamiNote -&gt; Bool
</span><a href="FileHandling.html#_new_segment"><span class="hs-identifier hs-var">_new_segment</span></a></span><span> </span><span class="annot"><span class="annottext">SalamiNote
</span><a href="#local-6989586621679530155"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-210"></span><span>  </span><span id="local-6989586621679530151"><span class="annot"><span class="annottext">newSlice :: Bool
</span><a href="#local-6989586621679530151"><span class="hs-identifier hs-var hs-var">newSlice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SalamiNote -&gt; Bool
</span><a href="FileHandling.html#_new_slice"><span class="hs-identifier hs-var">_new_slice</span></a></span><span> </span><span class="annot"><span class="annottext">SalamiNote
</span><a href="#local-6989586621679530155"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-211"></span><span>  </span><span id="local-6989586621679530153"><span class="annot"><span class="annottext">tied :: RightTied
</span><a href="#local-6989586621679530153"><span class="hs-identifier hs-var hs-var">tied</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SalamiNote -&gt; RightTied
</span><a href="FileHandling.html#_tied"><span class="hs-identifier hs-var">_tied</span></a></span><span> </span><span class="annot"><span class="annottext">SalamiNote
</span><a href="#local-6989586621679530155"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-212"></span><span>  </span><span id="local-6989586621679530154"><span class="annot"><span class="annottext">sPitch :: SPitch
</span><a href="#local-6989586621679530154"><span class="hs-identifier hs-var hs-var">sPitch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">Data.Maybe.fromJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall i. Notation i =&gt; String -&gt; Maybe i
</span><span class="hs-identifier hs-var">Music.readNotation</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SalamiNote -&gt; String
</span><a href="FileHandling.html#_pitch"><span class="hs-identifier hs-var">_pitch</span></a></span><span> </span><span class="annot"><span class="annottext">SalamiNote
</span><a href="#local-6989586621679530155"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Refactor to deal with maybe</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="annot"><a href="FileHandling.html#splitSlicesIntoSegments"><span class="hs-identifier hs-type">splitSlicesIntoSegments</span></a></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679530465"><span class="annot"><a href="#local-6989586621679530465"><span class="hs-identifier hs-type">ns</span></a></span></span><span> </span><span id="local-6989586621679530461"><span class="annot"><a href="#local-6989586621679530461"><span class="hs-identifier hs-type">o</span></a></span></span><span>
</span><span id="line-216"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530465"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530465"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530465"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679530465"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679530461"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HeuristicParser.html#SliceWrapper"><span class="hs-identifier hs-type">SliceWrapper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530465"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="FileHandling.html#InputSlice"><span class="hs-identifier hs-type">InputSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530465"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="FileHandling.html#InputSlice"><span class="hs-identifier hs-type">InputSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530465"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-220"></span><span id="splitSlicesIntoSegments"><span class="annot"><span class="annottext">splitSlicesIntoSegments :: forall ns o.
Eval (Edges ns) [Edge ns] (Notes ns) [ns] o
-&gt; SliceWrapper (Notes ns) -&gt; [InputSlice ns] -&gt; [[InputSlice ns]]
</span><a href="FileHandling.html#splitSlicesIntoSegments"><span class="hs-identifier hs-var hs-var">splitSlicesIntoSegments</span></a></span></span><span> </span><span id="local-6989586621679530146"><span class="annot"><span class="annottext">Eval (Edges ns) [Edge ns] (Notes ns) [ns] o
</span><a href="#local-6989586621679530146"><span class="hs-identifier hs-var">eval</span></a></span></span><span> </span><span id="local-6989586621679530145"><span class="annot"><span class="annottext">SliceWrapper (Notes ns)
</span><a href="#local-6989586621679530145"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Splitter a -&gt; [a] -&gt; [[a]]
</span><span class="hs-identifier hs-var">split</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Splitter a -&gt; Splitter a
</span><span class="hs-identifier hs-var">dropInitBlank</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. Splitter a -&gt; Splitter a
</span><span class="hs-identifier hs-var">keepDelimsL</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; Splitter a
</span><span class="hs-identifier hs-var">whenElt</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span class="hs-comment">-- | Create a 'Path' given a list of slices</span><span>
</span><span id="line-223"></span><span class="annot"><a href="FileHandling.html#pathFromSlices"><span class="hs-identifier hs-type">pathFromSlices</span></a></span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679530453"><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span></span><span> </span><span id="local-6989586621679530452"><span class="annot"><a href="#local-6989586621679530452"><span class="hs-identifier hs-type">o</span></a></span></span><span>
</span><span id="line-225"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679530452"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HeuristicParser.html#SliceWrapper"><span class="hs-identifier hs-type">SliceWrapper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="FileHandling.html#InputSlice"><span class="hs-identifier hs-type">InputSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span id="pathFromSlices"><span class="annot"><span class="annottext">pathFromSlices :: forall ns o.
Eval (Edges ns) [Edge ns] (Notes ns) [ns] o
-&gt; SliceWrapper (Notes ns)
-&gt; [InputSlice ns]
-&gt; Path (Maybe [Edge ns], Bool) (SliceWrapped (Notes ns))
</span><a href="FileHandling.html#pathFromSlices"><span class="hs-identifier hs-var hs-var">pathFromSlices</span></a></span></span><span> </span><span id="local-6989586621679530143"><span class="annot"><span class="annottext">Eval (Edges ns) [Edge ns] (Notes ns) [ns] o
</span><a href="#local-6989586621679530143"><span class="hs-identifier hs-var">eval</span></a></span></span><span> </span><span id="local-6989586621679530142"><span class="annot"><span class="annottext">SliceWrapper (Notes ns)
</span><a href="#local-6989586621679530142"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. Path a b -&gt; Path a b
</span><a href="Common.html#reversePath"><span class="hs-identifier hs-var">reversePath</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Maybe [Edge ns]
-&gt; [InputSlice ns]
-&gt; Path (Maybe [Edge ns], Bool) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679530140"><span class="hs-identifier hs-var">mkPath</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-230"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-231"></span><span>  </span><span class="annot"><a href="#local-6989586621679530140"><span class="hs-identifier hs-type">mkPath</span></a></span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="FileHandling.html#InputSlice"><span class="hs-identifier hs-type">InputSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span>  </span><span id="local-6989586621679530140"><span class="annot"><span class="annottext">mkPath :: Bool
-&gt; Maybe [Edge ns]
-&gt; [InputSlice ns]
-&gt; Path (Maybe [Edge ns], Bool) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679530140"><span class="hs-identifier hs-var hs-var">mkPath</span></a></span></span><span> </span><span id="local-6989586621679530139"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679530139"><span class="hs-identifier hs-var">tie</span></a></span></span><span> </span><span id="local-6989586621679530138"><span class="annot"><span class="annottext">Maybe [Edge ns]
</span><a href="#local-6989586621679530138"><span class="hs-identifier hs-var">eLeft</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall around between. around -&gt; Path around between
</span><a href="Common.html#PathEnd"><span class="hs-identifier hs-var">PathEnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [Edge ns]
</span><a href="#local-6989586621679530138"><span class="hs-identifier hs-var">eLeft</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><a href="#local-6989586621679530140"><span class="hs-identifier hs-var">mkPath</span></a></span><span> </span><span id="local-6989586621679530136"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679530136"><span class="hs-identifier hs-var">tie</span></a></span></span><span> </span><span id="local-6989586621679530135"><span class="annot"><span class="annottext">Maybe [Edge ns]
</span><a href="#local-6989586621679530135"><span class="hs-identifier hs-var">eLeft</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679530134"><span class="annot"><span class="annottext">[(ns, RightTied)]
</span><a href="#local-6989586621679530134"><span class="hs-identifier hs-var">slice</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679530133"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679530133"><span class="hs-identifier hs-var">boundary</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679530132"><span class="annot"><span class="annottext">[InputSlice ns]
</span><a href="#local-6989586621679530132"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><span class="annottext">forall around between.
around -&gt; between -&gt; Path around between -&gt; Path around between
</span><a href="Common.html#Path"><span class="hs-identifier hs-var">Path</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [Edge ns]
</span><a href="#local-6989586621679530135"><span class="hs-identifier hs-var">eLeft</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679530133"><span class="hs-identifier hs-var">boundary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679530130"><span class="hs-identifier hs-var">nextSlice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-240"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; Maybe [Edge ns]
-&gt; [InputSlice ns]
-&gt; Path (Maybe [Edge ns], Bool) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679530140"><span class="hs-identifier hs-var">mkPath</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(ns, RightTied)] -&gt; [Edge ns]
</span><a href="#local-6989586621679530129"><span class="hs-identifier hs-var">getTiedEdges</span></a></span><span> </span><span class="annot"><span class="annottext">[(ns, RightTied)]
</span><a href="#local-6989586621679530134"><span class="hs-identifier hs-var">slice</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[InputSlice ns]
</span><a href="#local-6989586621679530132"><span class="hs-identifier hs-var">rst</span></a></span><span>
</span><span id="line-241"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621679530130"><span class="annot"><span class="annottext">nextSlice :: SliceWrapped (Notes ns)
</span><a href="#local-6989586621679530130"><span class="hs-identifier hs-var hs-var">nextSlice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ns. SliceWrapper ns -&gt; ns -&gt; SliceWrapped ns
</span><a href="HeuristicParser.html#wrapSlice"><span class="hs-identifier hs-var">wrapSlice</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapper (Notes ns)
</span><a href="#local-6989586621679530142"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall tr tr' slc slc' v. Eval tr tr' slc slc' v -&gt; slc' -&gt; slc
</span><a href="Common.html#evalSlice"><span class="hs-identifier hs-var">evalSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Eval (Edges ns) [Edge ns] (Notes ns) [ns] o
</span><a href="#local-6989586621679530143"><span class="hs-identifier hs-var">eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(ns, RightTied)]
</span><a href="#local-6989586621679530134"><span class="hs-identifier hs-var">slice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span>  </span><span class="annot"><a href="#local-6989586621679530129"><span class="hs-identifier hs-type">getTiedEdges</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Music.RightTied</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-245"></span><span>  </span><span id="local-6989586621679530129"><span class="annot"><span class="annottext">getTiedEdges :: [(ns, RightTied)] -&gt; [Edge ns]
</span><a href="#local-6989586621679530129"><span class="hs-identifier hs-var hs-var">getTiedEdges</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">(ns, RightTied) -&gt; Maybe (Edge ns)
</span><a href="#local-6989586621679530125"><span class="hs-identifier hs-var">mkTiedEdge</span></a></span><span>
</span><span id="line-246"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><a href="#local-6989586621679530125"><span class="hs-identifier hs-type">mkTiedEdge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Music.RightTied</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679530453"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621679530125"><span class="annot"><span class="annottext">mkTiedEdge :: (ns, RightTied) -&gt; Maybe (Edge ns)
</span><a href="#local-6989586621679530125"><span class="hs-identifier hs-var hs-var">mkTiedEdge</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679530124"><span class="annot"><span class="annottext">ns
</span><a href="#local-6989586621679530124"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RightTied
</span><span class="hs-identifier hs-var">Music.Holds</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">ns
</span><a href="#local-6989586621679530124"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">ns
</span><a href="#local-6989586621679530124"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>    </span><span class="annot"><a href="#local-6989586621679530125"><span class="hs-identifier hs-var">mkTiedEdge</span></a></span><span> </span><span class="annot"><span class="annottext">(ns, RightTied)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-comment">-- Writing parse results to JSON</span><span>
</span><span id="line-253"></span><span class="hs-comment">-- ===========</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span class="hs-comment">-- | Alias for the accuracy of the predicted labels compared to the ground truth</span><span>
</span><span id="line-256"></span><span class="hs-keyword">type</span><span> </span><span id="Accuracy"><span class="annot"><a href="FileHandling.html#Accuracy"><span class="hs-identifier hs-var">Accuracy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-257"></span><span class="hs-comment">-- | Alias for the loglikelihood of the entire piece given the chordlabels, according to the probabilistic model of harmony</span><span>
</span><span id="line-258"></span><span class="hs-keyword">type</span><span> </span><span id="LogLikelihood"><span class="annot"><a href="FileHandling.html#LogLikelihood"><span class="hs-identifier hs-var">LogLikelihood</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-259"></span><span class="hs-comment">-- | Alias for how long the algorithm ran for, measured in TODO</span><span>
</span><span id="line-260"></span><span class="hs-keyword">type</span><span> </span><span id="Time"><span class="annot"><a href="FileHandling.html#Time"><span class="hs-identifier hs-var">Time</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-comment">-- | Coverts the results of a parsing algorithm to a JSON value</span><span>
</span><span id="line-263"></span><span class="annot"><a href="FileHandling.html#writeResultsToJSON"><span class="hs-identifier hs-type">writeResultsToJSON</span></a></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">]</span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Harmony.ChordLabel.html#ChordLabel"><span class="hs-identifier hs-type">ChordLabel</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#PVAnalysis"><span class="hs-identifier hs-type">PVAnalysis</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FileHandling.html#Accuracy"><span class="hs-identifier hs-type">Accuracy</span></a></span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FileHandling.html#LogLikelihood"><span class="hs-identifier hs-type">LogLikelihood</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FileHandling.html#Time"><span class="hs-identifier hs-type">Time</span></a></span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Value</span></span><span>
</span><span id="line-273"></span><span id="writeResultsToJSON"><span class="annot"><span class="annottext">writeResultsToJSON :: [Notes SPitch]
-&gt; [ChordLabel]
-&gt; Maybe (PVAnalysis SPitch)
-&gt; Accuracy
-&gt; Accuracy
-&gt; String
-&gt; Accuracy
-&gt; Int
-&gt; Value
</span><a href="FileHandling.html#writeResultsToJSON"><span class="hs-identifier hs-var hs-var">writeResultsToJSON</span></a></span></span><span> </span><span id="local-6989586621679530120"><span class="annot"><span class="annottext">[Notes SPitch]
</span><a href="#local-6989586621679530120"><span class="hs-identifier hs-var">slices</span></a></span></span><span> </span><span id="local-6989586621679530119"><span class="annot"><span class="annottext">[ChordLabel]
</span><a href="#local-6989586621679530119"><span class="hs-identifier hs-var">chords</span></a></span></span><span> </span><span id="local-6989586621679530118"><span class="annot"><span class="annottext">Maybe (PVAnalysis SPitch)
</span><a href="#local-6989586621679530118"><span class="hs-identifier hs-var">derivation</span></a></span></span><span> </span><span id="local-6989586621679530117"><span class="annot"><span class="annottext">Accuracy
</span><a href="#local-6989586621679530117"><span class="hs-identifier hs-var">accuracy</span></a></span></span><span> </span><span id="local-6989586621679530116"><span class="annot"><span class="annottext">Accuracy
</span><a href="#local-6989586621679530116"><span class="hs-identifier hs-var">likelihood</span></a></span></span><span> </span><span id="local-6989586621679530115"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530115"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679530114"><span class="annot"><span class="annottext">Accuracy
</span><a href="#local-6989586621679530114"><span class="hs-identifier hs-var">runTime</span></a></span></span><span> </span><span id="local-6989586621679530113"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679530113"><span class="hs-identifier hs-var">reruns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">A.object</span></span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-special">[</span><span> </span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-comment">-- &quot;algorithm&quot; .= A.fromString name</span><span>
</span><span id="line-277"></span><span>     </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;slices&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span id="local-6989586621679530110"><span class="annot"><span class="annottext">MultiSet SPitch
</span><a href="#local-6989586621679530110"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. MultiSet a -&gt; [a]
</span><a href="Internal.MultiSet.html#toList"><span class="hs-identifier hs-var">MS.toList</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSet SPitch
</span><a href="#local-6989586621679530110"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Notes SPitch]
</span><a href="#local-6989586621679530120"><span class="hs-identifier hs-var">slices</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;chordLabels&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[ChordLabel]
</span><a href="#local-6989586621679530119"><span class="hs-identifier hs-var">chords</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;accuracy&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Accuracy
</span><a href="#local-6989586621679530117"><span class="hs-identifier hs-var">accuracy</span></a></span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;likelihood&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Accuracy
</span><a href="#local-6989586621679530116"><span class="hs-identifier hs-var">likelihood</span></a></span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-comment">-- , &quot;derivation&quot; .= derivation</span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;runTime&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Accuracy
</span><a href="#local-6989586621679530114"><span class="hs-identifier hs-var">runTime</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;reruns&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679530113"><span class="hs-identifier hs-var">reruns</span></a></span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="hs-comment">-- | Concatenates all results for a given piece into an object, inlucuding the piece and corpus in the JSON value.</span><span>
</span><span id="line-287"></span><span class="annot"><a href="FileHandling.html#concatResults"><span class="hs-identifier hs-type">concatResults</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Harmony.ChordLabel.html#ChordLabel"><span class="hs-identifier hs-type">ChordLabel</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">A.Value</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Value</span></span><span>
</span><span id="line-288"></span><span id="concatResults"><span class="annot"><span class="annottext">concatResults :: String
-&gt; String -&gt; String -&gt; String -&gt; [ChordLabel] -&gt; [Value] -&gt; Value
</span><a href="FileHandling.html#concatResults"><span class="hs-identifier hs-var hs-var">concatResults</span></a></span></span><span> </span><span id="local-6989586621679530107"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530107"><span class="hs-identifier hs-var">expId</span></a></span></span><span> </span><span id="local-6989586621679530106"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530106"><span class="hs-identifier hs-var">algoName</span></a></span></span><span> </span><span id="local-6989586621679530105"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530105"><span class="hs-identifier hs-var">corpus</span></a></span></span><span> </span><span id="local-6989586621679530104"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530104"><span class="hs-identifier hs-var">piece</span></a></span></span><span> </span><span id="local-6989586621679530103"><span class="annot"><span class="annottext">[ChordLabel]
</span><a href="#local-6989586621679530103"><span class="hs-identifier hs-var">trueLabels</span></a></span></span><span> </span><span id="local-6989586621679530102"><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621679530102"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">A.object</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;id&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Key
</span><span class="hs-identifier hs-var">A.fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530107"><span class="hs-identifier hs-var">expId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;algorithm&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Key
</span><span class="hs-identifier hs-var">A.fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530106"><span class="hs-identifier hs-var">algoName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;corpus&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Key
</span><span class="hs-identifier hs-var">A.fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530105"><span class="hs-identifier hs-var">corpus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;piece&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Key
</span><span class="hs-identifier hs-var">A.fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530104"><span class="hs-identifier hs-var">piece</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;results&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621679530102"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;groundTruth&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[ChordLabel]
</span><a href="#local-6989586621679530103"><span class="hs-identifier hs-var">trueLabels</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="hs-comment">-- | Write JSON value to the given file</span><span>
</span><span id="line-291"></span><span id="local-6989586621679530425"><span class="annot"><a href="FileHandling.html#writeJSONToFile"><span class="hs-identifier hs-type">writeJSONToFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621679530425"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679530425"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-292"></span><span id="writeJSONToFile"><span class="annot"><span class="annottext">writeJSONToFile :: forall a. ToJSON a =&gt; String -&gt; a -&gt; IO ()
</span><a href="FileHandling.html#writeJSONToFile"><span class="hs-identifier hs-var hs-var">writeJSONToFile</span></a></span></span><span> </span><span id="local-6989586621679530097"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530097"><span class="hs-identifier hs-var">filePath</span></a></span></span><span> </span><span id="local-6989586621679530096"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679530096"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-293"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">createDirectoryIfMissing</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><span class="hs-identifier hs-var">takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530097"><span class="hs-identifier hs-var">filePath</span></a></span><span>
</span><span id="line-294"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">BL.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679530097"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">A.encode</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679530096"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-comment">-- | Used when the algorithm fails. Contains NANs in all fields.</span><span>
</span><span id="line-297"></span><span id="local-6989586621679530422"><span class="annot"><a href="FileHandling.html#nullResultToJSON"><span class="hs-identifier hs-type">nullResultToJSON</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679530422"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679530422"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Value</span></span></span><span>
</span><span id="line-298"></span><span id="nullResultToJSON"><span class="annot"><span class="annottext">nullResultToJSON :: forall a. Show a =&gt; a -&gt; Value
</span><a href="FileHandling.html#nullResultToJSON"><span class="hs-identifier hs-var hs-var">nullResultToJSON</span></a></span></span><span> </span><span id="local-6989586621679530071"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679530071"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">A.object</span></span><span>
</span><span id="line-300"></span><span>      </span><span class="hs-special">[</span><span>
</span><span id="line-301"></span><span>      </span><span class="hs-comment">-- &quot;algorithm&quot; .= A.fromString (show a)</span><span>
</span><span id="line-302"></span><span>       </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;slices&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;chordLabels&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;accuracy&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>      </span><span class="hs-comment">-- , &quot;ops&quot; .= (Nothing :: Maybe )</span><span>
</span><span id="line-306"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;likelihood&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;reRuns&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;runTime&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-310"></span></pre></body></html>