<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">{- | This module contains -}</span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Heuristics</span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">(</span><span>
</span><span id="line-5"></span><span>    </span><span class="annot"><a href="Heuristics.html#applyHeuristic"><span class="hs-identifier">applyHeuristic</span></a></span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Heuristics.html#testHeuristic"><span class="hs-identifier">testHeuristic</span></a></span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Heuristics.html#testHeuristic%27"><span class="hs-identifier">testHeuristic'</span></a></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Heuristics.html#State"><span class="hs-identifier">State</span></a></span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-comment">-- LOGGING</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Logging</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Log</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Common.html"><span class="hs-identifier">Common</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">log</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Internal.MultiSet.html"><span class="hs-identifier">Internal.MultiSet</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MS</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PVGrammar.html"><span class="hs-identifier">PVGrammar</span></a></span><span> </span><span class="hs-keyword">hiding</span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PVGrammar.html#slicesFromFile"><span class="hs-identifier">slicesFromFile</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PVGrammar.Generate.html"><span class="hs-identifier">PVGrammar.Generate</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html"><span class="hs-identifier">PVGrammar.Parse</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldM</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ExceptT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runExceptT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwError</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.DoNotation</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Monad</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">log</span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lift</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">pure</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashSet</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromJust</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isNothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Musicology.Core</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Music</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Musicology.Pitch.Spelled</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="HeuristicParser.html"><span class="hs-identifier">HeuristicParser</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Harmony.html"><span class="hs-identifier">Harmony</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Harmony.ChordLabel.html"><span class="hs-identifier">Harmony.ChordLabel</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Harmony.Params.html"><span class="hs-identifier">Harmony.Params</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">type</span><span> </span><span id="State"><span class="annot"><a href="Heuristics.html#State"><span class="hs-identifier hs-var">State</span></a></span></span><span> </span><span id="local-6989586621679510271"><span class="annot"><a href="#local-6989586621679510271"><span class="hs-identifier hs-type">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="HeuristicParser.html#SearchState"><span class="hs-identifier hs-type">SearchState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510271"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510271"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510271"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#PVLeftmost"><span class="hs-identifier hs-type">PVLeftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510271"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="annot"><a href="Heuristics.html#applyHeuristic"><span class="hs-identifier hs-type">applyHeuristic</span></a></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Heuristics.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Heuristics.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Heuristics.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Heuristics.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-46"></span><span id="applyHeuristic"><span class="annot"><span class="annottext">applyHeuristic :: ((Maybe (State SPitch), State SPitch) -&gt; ExceptT String IO Double)
-&gt; (Maybe (State SPitch), State SPitch) -&gt; ExceptT String IO Double
</span><a href="Heuristics.html#applyHeuristic"><span class="hs-identifier hs-var hs-var">applyHeuristic</span></a></span></span><span> </span><span id="local-6989586621679510270"><span class="annot"><span class="annottext">(Maybe (State SPitch), State SPitch) -&gt; ExceptT String IO Double
</span><a href="#local-6989586621679510270"><span class="hs-identifier hs-var">heuristic</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679510269"><span class="annot"><span class="annottext">Maybe (State SPitch)
</span><a href="#local-6989586621679510269"><span class="hs-identifier hs-var">mprevState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510268"><span class="annot"><span class="annottext">State SPitch
</span><a href="#local-6989586621679510268"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><span class="annottext">(Maybe (State SPitch), State SPitch) -&gt; ExceptT String IO Double
</span><a href="#local-6989586621679510270"><span class="hs-identifier hs-var">heuristic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (State SPitch)
</span><a href="#local-6989586621679510269"><span class="hs-identifier hs-var">mprevState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">State SPitch
</span><a href="#local-6989586621679510268"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span id="testOp"><span class="annot"><span class="annottext">testOp :: ActionDouble ns tr (Split SPC) f h
</span><a href="Heuristics.html#testOp"><span class="hs-identifier hs-var hs-var">testOp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><span class="annottext">forall ns tr s f h.
(StartStop ns, Trans tr, ns, Trans tr, StartStop ns)
-&gt; LeftmostDouble s f h -&gt; ActionDouble ns tr s f h
</span><a href="HeuristicParser.html#ActionDouble"><span class="hs-identifier hs-var">ActionDouble</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s f h. s -&gt; LeftmostDouble s f h
</span><a href="Common.html#LMDoubleSplitLeft"><span class="hs-identifier hs-var">LMDoubleSplitLeft</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall n a. Writer (Split n) a -&gt; Split n
</span><a href="PVGrammar.Generate.html#mkSplit"><span class="hs-identifier hs-var">mkSplit</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-55"></span><span>      </span><span class="annot"><span class="annottext">forall n.
(Ord n, Hashable n) =&gt;
n -&gt; n -&gt; LeftOrnament -&gt; Bool -&gt; Writer (Split n) ()
</span><a href="PVGrammar.Generate.html#addToRight"><span class="hs-identifier hs-var">addToRight</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Accidental -&gt; SPC
</span><span class="hs-identifier hs-var">c'</span></span><span> </span><span class="annot"><span class="annottext">Accidental
</span><span class="hs-identifier hs-var">nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Accidental -&gt; SPC
</span><span class="hs-identifier hs-var">c'</span></span><span> </span><span class="annot"><span class="annottext">Accidental
</span><span class="hs-identifier hs-var">nat</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LeftOrnament
</span><a href="PVGrammar.html#LeftRepeat"><span class="hs-identifier hs-var">LeftRepeat</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span id="log"><span class="annot"><span class="annottext">log :: String -&gt; ExceptT String IO ()
</span><a href="Heuristics.html#log"><span class="hs-identifier hs-var hs-var">log</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Log.log</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | First Heuristic Prototype</span><span>
</span><span id="line-61"></span><span class="annot"><a href="Heuristics.html#testHeuristic"><span class="hs-identifier hs-type">testHeuristic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Heuristics.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Heuristics.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-62"></span><span id="testHeuristic"><span class="annot"><span class="annottext">testHeuristic :: (Maybe (State SPitch), State SPitch) -&gt; ExceptT String IO Double
</span><a href="Heuristics.html#testHeuristic"><span class="hs-identifier hs-var hs-var">testHeuristic</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679510235"><span class="annot"><span class="annottext">Maybe (State SPitch)
</span><a href="#local-6989586621679510235"><span class="hs-identifier hs-var">prevState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510234"><span class="annot"><span class="annottext">State SPitch
</span><a href="#local-6989586621679510234"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall es es' ns o. SearchState es es' ns o -&gt; Maybe o
</span><a href="HeuristicParser.html#getOpFromState"><span class="hs-identifier hs-var">getOpFromState</span></a></span><span> </span><span class="annot"><span class="annottext">State SPitch
</span><a href="#local-6989586621679510234"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Leftmost (Split SPitch) Freeze (Spread SPitch))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- Initial state</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679510231"><span class="annot"><span class="annottext">Leftmost (Split SPitch) Freeze (Spread SPitch)
</span><a href="#local-6989586621679510231"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-66"></span><span>      </span><span class="hs-keyword">do</span><span>
</span><span id="line-67"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ExceptT String IO ()
</span><a href="Heuristics.html#log"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;______________________________________________________&quot;</span></span><span>
</span><span id="line-68"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ExceptT String IO ()
</span><a href="Heuristics.html#log"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Prev State: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe (State SPitch)
</span><a href="#local-6989586621679510235"><span class="hs-identifier hs-var">prevState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ExceptT String IO ()
</span><a href="Heuristics.html#log"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Next State: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">State SPitch
</span><a href="#local-6989586621679510234"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Leftmost (Split SPitch) Freeze (Spread SPitch)
</span><a href="#local-6989586621679510231"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-72"></span><span>      </span><span class="hs-comment">-- Freezing</span><span>
</span><span id="line-73"></span><span>        </span><span class="annot"><a href="Common.html#LMDouble"><span class="hs-identifier hs-type">LMDouble</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMDoubleFreezeLeft"><span class="hs-identifier hs-type">LMDoubleFreezeLeft</span></a></span><span> </span><span id="local-6989586621679510227"><span class="annot"><span class="annottext">Freeze
</span><a href="#local-6989586621679510227"><span class="hs-identifier hs-var">freezeOp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><a href="Common.html#LMSingle"><span class="hs-identifier hs-type">LMSingle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMSingleFreeze"><span class="hs-identifier hs-type">LMSingleFreeze</span></a></span><span> </span><span id="local-6989586621679510224"><span class="annot"><span class="annottext">Freeze
</span><a href="#local-6989586621679510224"><span class="hs-identifier hs-var">freezeOp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>
</span><span id="line-75"></span><span>        </span><span class="annot"><a href="Common.html#LMDouble"><span class="hs-identifier hs-type">LMDouble</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMDoubleSpread"><span class="hs-identifier hs-type">LMDoubleSpread</span></a></span><span> </span><span id="local-6989586621679510222"><span class="annot"><span class="annottext">Spread SPitch
</span><a href="#local-6989586621679510222"><span class="hs-identifier hs-var">spreadOp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-76"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ExceptT String IO ()
</span><a href="Heuristics.html#log"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Considering an unspread&quot;</span></span><span>
</span><span id="line-77"></span><span>          </span><span class="hs-comment">-- res &lt;- getParentDouble (fromJust prevState)</span><span>
</span><span id="line-78"></span><span>          </span><span class="hs-comment">-- (_, childl, slcl, childr, slcr) &lt;- case res of</span><span>
</span><span id="line-79"></span><span>          </span><span class="hs-comment">--   (sl, childl, Inner slc, childr, Inner sr) -&gt; pure (sl, childl, slc, childr, sr)</span><span>
</span><span id="line-80"></span><span>          </span><span class="hs-comment">--   (_, _, Start, _, _) -&gt; throwError &quot;StartStop left of in spread&quot;</span><span>
</span><span id="line-81"></span><span>          </span><span class="hs-comment">--   (_, _, Stop, _, _) -&gt; throwError &quot;StartStop in left of spread&quot;</span><span>
</span><span id="line-82"></span><span>          </span><span class="hs-comment">--   (_, _, _, _, Start) -&gt; throwError &quot;StartStop in right of spread&quot;</span><span>
</span><span id="line-83"></span><span>          </span><span class="hs-comment">--   (_, _, _, _, Stop) -&gt; throwError &quot;StartStop in right of spread&quot;</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>          </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">30000</span></span><span>
</span><span id="line-86"></span><span>          </span><span class="hs-comment">-- scoreSpread slcl slcr spreadOp</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span>        </span><span class="annot"><a href="Common.html#LMSingle"><span class="hs-identifier hs-type">LMSingle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMSingleSplit"><span class="hs-identifier hs-type">LMSingleSplit</span></a></span><span> </span><span id="local-6989586621679510220"><span class="annot"><span class="annottext">Split SPitch
</span><a href="#local-6989586621679510220"><span class="hs-identifier hs-var">splitOp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-89"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ExceptT String IO ()
</span><a href="Heuristics.html#log"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Considering a single unsplit&quot;</span></span><span>
</span><span id="line-90"></span><span>          </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">10000</span></span><span>
</span><span id="line-91"></span><span>          </span><span class="hs-comment">-- (child, sr)</span><span>
</span><span id="line-92"></span><span>          </span><span class="hs-comment">-- let (slcl, parent) = getParentSingle state</span><span>
</span><span id="line-93"></span><span>          </span><span class="hs-comment">-- (slcl, parent, slcr, _, _) &lt;- getParentDouble (fromJust prevState)</span><span>
</span><span id="line-94"></span><span>          </span><span class="hs-comment">-- pure 10</span><span>
</span><span id="line-95"></span><span>          </span><span class="hs-comment">-- scoreSplit splitOp parent slcl slcl Stop</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>        </span><span class="hs-comment">-- Splitting Left</span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-comment">{-

            PrevState          ..=[ms]---tl---[sl]--tm--[sr]--tr--[send]..

                                             \  | /
                                              \ |/
                                                |  UnSplit 
                                                V
                                         
            state                   ..=[ms]--- top --[sr]--tr--[send]...
                                           cl\       /cr
                                               [sl]



          -}</span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><a href="Common.html#LMDouble"><span class="hs-identifier hs-type">LMDouble</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMDoubleSplitLeft"><span class="hs-identifier hs-type">LMDoubleSplitLeft</span></a></span><span> </span><span id="local-6989586621679510219"><span class="annot"><span class="annottext">Split SPitch
</span><a href="#local-6989586621679510219"><span class="hs-identifier hs-var">splitOp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-116"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ExceptT String IO ()
</span><a href="Heuristics.html#log"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Considering an unsplit left&quot;</span></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ExceptT String IO ()
</span><a href="Heuristics.html#log"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;parent slices&quot;</span></span><span>
</span><span id="line-121"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679510218"><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510218"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510217"><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510217"><span class="hs-identifier hs-var">slcl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510216"><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510216"><span class="hs-identifier hs-var">slcr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall ns.
State ns
-&gt; ExceptT
     String
     IO
     (StartStop (SliceWrapped (Notes ns)),
      StartStop (SliceWrapped (Notes ns)),
      StartStop (SliceWrapped (Notes ns)))
</span><a href="#local-6989586621679510215"><span class="hs-identifier hs-var">getParentSlices</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe (State SPitch)
</span><a href="#local-6989586621679510235"><span class="hs-identifier hs-var">prevState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ExceptT String IO ()
</span><a href="Heuristics.html#log"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;MidSlice: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510218"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-123"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ExceptT String IO ()
</span><a href="Heuristics.html#log"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;sl: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510217"><span class="hs-identifier hs-var">slcl</span></a></span><span>
</span><span id="line-124"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ExceptT String IO ()
</span><a href="Heuristics.html#log"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;sr: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510216"><span class="hs-identifier hs-var">slcr</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>          </span><span class="hs-keyword">let</span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679510214"><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510214"><span class="hs-identifier hs-var">childSlice</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510213"><span class="annot"><span class="annottext">Edges SPitch
</span><a href="#local-6989586621679510213"><span class="hs-identifier hs-var">parent</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Edges SPitch
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall d es' ns o.
SearchState d es' ns o
-&gt; (StartStop (SliceWrapped ns), d, SliceWrapped ns, d,
    StartStop (SliceWrapped ns))
</span><a href="#local-6989586621679510212"><span class="hs-identifier hs-var">getParentDouble</span></a></span><span> </span><span class="annot"><span class="annottext">State SPitch
</span><a href="#local-6989586621679510234"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-127"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ExceptT String IO ()
</span><a href="Heuristics.html#log"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ChildSlice: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510214"><span class="hs-identifier hs-var">childSlice</span></a></span><span>
</span><span id="line-128"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ExceptT String IO ()
</span><a href="Heuristics.html#log"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Edges SPitch
</span><a href="#local-6989586621679510213"><span class="hs-identifier hs-var">parent</span></a></span><span>
</span><span id="line-129"></span><span>          </span><span class="hs-comment">-- pure 5</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510214"><span class="hs-identifier hs-var">childSlice</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-132"></span><span>            </span><span class="annot"><a href="Common.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621679510210"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510210"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">-</span><span> </span><span class="annot"><span class="annottext">forall ns. SliceWrapped ns -&gt; Double
</span><a href="HeuristicParser.html#sLblProb"><span class="hs-identifier hs-var">sLblProb</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510210"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-133"></span><span>            </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">12</span></span><span>
</span><span id="line-134"></span><span>          </span><span class="annot"><span class="annottext">forall n a.
(Notation n, Show a) =&gt;
Split SPitch
-&gt; Edges n
-&gt; a
-&gt; StartStop (SliceWrapped (Notes n))
-&gt; StartStop (SliceWrapped (Notes n))
-&gt; ExceptT String IO Double
</span><a href="#local-6989586621679510208"><span class="hs-identifier hs-var">scoreSplit</span></a></span><span> </span><span class="annot"><span class="annottext">Split SPitch
</span><a href="#local-6989586621679510219"><span class="hs-identifier hs-var">splitOp</span></a></span><span> </span><span class="annot"><span class="annottext">Edges SPitch
</span><a href="#local-6989586621679510213"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510214"><span class="hs-identifier hs-var">childSlice</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510218"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510217"><span class="hs-identifier hs-var">slcl</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span>        </span><span class="hs-comment">-- Splitting Right</span><span>
</span><span id="line-137"></span><span>        </span><span class="hs-comment">{-
                                        split:
                ..=[mS]--tl---[slcl]---parent---[slcr]....
                                 cl\           /cr
                                    \         /
                                      [ slc ]
                                        split:
                ..=x--tl---[slcl]---parent------x-
                               cl\           /cr
                                  \         /
                                    [ slc ]
        -}</span><span>
</span><span id="line-149"></span><span>        </span><span class="annot"><a href="Common.html#LMDouble"><span class="hs-identifier hs-type">LMDouble</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMDoubleSplitRight"><span class="hs-identifier hs-type">LMDoubleSplitRight</span></a></span><span> </span><span id="local-6989586621679510206"><span class="annot"><span class="annottext">Split SPitch
</span><a href="#local-6989586621679510206"><span class="hs-identifier hs-var">splitOp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-150"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ExceptT String IO ()
</span><a href="Heuristics.html#log"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Considering an unsplit right&quot;</span></span><span>
</span><span id="line-151"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679510203"><span class="annot"><span class="annottext">sSlices :: [SliceWrapped (Notes SPitch)]
</span><a href="#local-6989586621679510203"><span class="hs-identifier hs-var hs-var">sSlices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall es es' ns o.
SearchState es es' ns o -&gt; Maybe [SliceWrapped ns]
</span><a href="HeuristicParser.html#getSlicesFromState"><span class="hs-identifier hs-var">getSlicesFromState</span></a></span><span> </span><span class="annot"><span class="annottext">State SPitch
</span><a href="#local-6989586621679510234"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-152"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679510197"><span class="annot"><span class="annottext">pSlices :: [SliceWrapped (Notes SPitch)]
</span><a href="#local-6989586621679510197"><span class="hs-identifier hs-var hs-var">pSlices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall es es' ns o.
SearchState es es' ns o -&gt; Maybe [SliceWrapped ns]
</span><a href="HeuristicParser.html#getSlicesFromState"><span class="hs-identifier hs-var">getSlicesFromState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe (State SPitch)
</span><a href="#local-6989586621679510235"><span class="hs-identifier hs-var">prevState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- DISGUSTING</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679510196"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510196"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510195"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510195"><span class="hs-identifier hs-var">slcl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510194"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510194"><span class="hs-identifier hs-var">slcr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-155"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[SliceWrapped (Notes SPitch)]
</span><a href="#local-6989586621679510203"><span class="hs-identifier hs-var">sSlices</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-156"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621679510193"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510193"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679510192"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510192"><span class="hs-identifier hs-var">slcl</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679510191"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510191"><span class="hs-identifier hs-var">slcr</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679510190"><span class="annot"><span class="annottext">[SliceWrapped (Notes SPitch)]
</span><a href="#local-6989586621679510190"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510193"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510192"><span class="hs-identifier hs-var">slcl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510191"><span class="hs-identifier hs-var">slcr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>                  </span><span class="annot"><span class="annottext">[SliceWrapped (Notes SPitch)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;idk&quot;</span></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679510189"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510189"><span class="hs-identifier hs-var">ms'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510188"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510188"><span class="hs-identifier hs-var">slcl'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510187"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510187"><span class="hs-identifier hs-var">slc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510186"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510186"><span class="hs-identifier hs-var">slcr'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-161"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[SliceWrapped (Notes SPitch)]
</span><a href="#local-6989586621679510197"><span class="hs-identifier hs-var">pSlices</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-162"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621679510185"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510185"><span class="hs-identifier hs-var">ms'</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679510184"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510184"><span class="hs-identifier hs-var">slcl'</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679510183"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510183"><span class="hs-identifier hs-var">slc</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679510182"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510182"><span class="hs-identifier hs-var">slcr'</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679510181"><span class="annot"><span class="annottext">[SliceWrapped (Notes SPitch)]
</span><a href="#local-6989586621679510181"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510185"><span class="hs-identifier hs-var">ms'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510184"><span class="hs-identifier hs-var">slcl'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510183"><span class="hs-identifier hs-var">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510182"><span class="hs-identifier hs-var">slcr'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>                  </span><span class="annot"><span class="annottext">[SliceWrapped (Notes SPitch)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;idk&quot;</span></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>          </span><span class="hs-comment">-- log $ show ms </span><span>
</span><span id="line-166"></span><span>          </span><span class="hs-comment">-- log $ show slcl </span><span>
</span><span id="line-167"></span><span>          </span><span class="hs-comment">-- log $ show slcr </span><span>
</span><span id="line-168"></span><span>          </span><span class="hs-comment">-- log $ show ms' </span><span>
</span><span id="line-169"></span><span>          </span><span class="hs-comment">-- log $ show slcl' </span><span>
</span><span id="line-170"></span><span>          </span><span class="hs-comment">-- log $ show slc </span><span>
</span><span id="line-171"></span><span>          </span><span class="hs-comment">-- log $ show slcr' </span><span>
</span><span id="line-172"></span><span>          </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">-</span><span> </span><span class="annot"><span class="annottext">forall ns. SliceWrapped ns -&gt; Double
</span><a href="HeuristicParser.html#sLblProb"><span class="hs-identifier hs-var">sLblProb</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510187"><span class="hs-identifier hs-var">slc</span></a></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>          </span><span class="hs-comment">-- (_,_, sl, _, child) &lt;- getParentDouble (fromJust prevState)</span><span>
</span><span id="line-175"></span><span>          </span><span class="hs-comment">-- (_, _, slcl, parent, slcr) &lt;- getParentDouble state</span><span>
</span><span id="line-176"></span><span>          </span><span class="hs-comment">-- pure 5</span><span>
</span><span id="line-177"></span><span>          </span><span class="hs-comment">-- scoreSplit splitOp parent child slcl slcr</span><span>
</span><span id="line-178"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-179"></span><span>    </span><span id="local-6989586621679510484"><span class="annot"><a href="#local-6989586621679510180"><span class="hs-identifier hs-type">getParentSlices'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Heuristics.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510484"><span class="hs-identifier hs-type">ns</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Heuristics.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510484"><span class="hs-identifier hs-type">ns</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510484"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510484"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621679510180"><span class="annot"><span class="annottext">getParentSlices' :: forall ns.
State ns
-&gt; State ns
-&gt; ExceptT String IO (StartStop (Notes ns), StartStop (Notes ns))
</span><a href="#local-6989586621679510180"><span class="hs-identifier hs-var hs-var">getParentSlices'</span></a></span></span><span> </span><span id="local-6989586621679510165"><span class="annot"><span class="annottext">State ns
</span><a href="#local-6989586621679510165"><span class="hs-identifier hs-var">prevState</span></a></span></span><span> </span><span id="local-6989586621679510164"><span class="annot"><span class="annottext">State ns
</span><a href="#local-6989586621679510164"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-181"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679510161"><span class="annot"><span class="annottext">sSlices :: [SliceWrapped (Notes ns)]
</span><a href="#local-6989586621679510161"><span class="hs-identifier hs-var hs-var">sSlices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall es es' ns o.
SearchState es es' ns o -&gt; Maybe [SliceWrapped ns]
</span><a href="HeuristicParser.html#getSlicesFromState"><span class="hs-identifier hs-var">getSlicesFromState</span></a></span><span> </span><span class="annot"><span class="annottext">State ns
</span><a href="#local-6989586621679510164"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-182"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679510160"><span class="annot"><span class="annottext">pSlices :: Maybe [SliceWrapped (Notes ns)]
</span><a href="#local-6989586621679510160"><span class="hs-identifier hs-var hs-var">pSlices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall es es' ns o.
SearchState es es' ns o -&gt; Maybe [SliceWrapped ns]
</span><a href="HeuristicParser.html#getSlicesFromState"><span class="hs-identifier hs-var">getSlicesFromState</span></a></span><span> </span><span class="annot"><span class="annottext">State ns
</span><a href="#local-6989586621679510165"><span class="hs-identifier hs-var">prevState</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>      </span><span class="hs-comment">-- =[mS]---[sl]</span><span>
</span><span id="line-185"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">State ns
</span><a href="#local-6989586621679510164"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-186"></span><span>        </span><span class="annot"><a href="HeuristicParser.html#SSSemiOpen"><span class="hs-identifier hs-type">SSSemiOpen</span></a></span><span> </span><span id="local-6989586621679510158"><span class="annot"><span class="annottext">Path (Maybe [Edge ns], Bool) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679510158"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679510157"><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679510157"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679510156"><span class="annot"><span class="annottext">Path (Trans (Edges ns)) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679510156"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679510155"><span class="annot"><span class="annottext">[PVLeftmost ns]
</span><a href="#local-6989586621679510155"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe [SliceWrapped (Notes ns)]
</span><a href="#local-6989586621679510160"><span class="hs-identifier hs-var">pSlices</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-187"></span><span>                                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679510154"><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679510154"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679510153"><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679510153"><span class="hs-identifier hs-var">sl</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679510152"><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679510152"><span class="hs-identifier hs-var">sr</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679510151"><span class="annot"><span class="annottext">[SliceWrapped (Notes ns)]
</span><a href="#local-6989586621679510151"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-188"></span><span>                                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">[SliceWrapped (Notes ns)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getParentSlices: not enough slices&quot;</span></span><span>
</span><span id="line-189"></span><span>                                </span><span class="annot"><span class="annottext">Maybe [SliceWrapped (Notes ns)]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-190"></span><span>        </span><span class="annot"><a href="HeuristicParser.html#SSOpen"><span class="hs-identifier hs-type">SSOpen</span></a></span><span> </span><span id="local-6989586621679510148"><span class="annot"><span class="annottext">Path (Trans (Edges ns)) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679510148"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679510147"><span class="annot"><span class="annottext">[PVLeftmost ns]
</span><a href="#local-6989586621679510147"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-191"></span><span>        </span><span class="annot"><a href="HeuristicParser.html#SSFrozen"><span class="hs-identifier hs-type">SSFrozen</span></a></span><span> </span><span id="local-6989586621679510145"><span class="annot"><span class="annottext">Path (Maybe [Edge ns], Bool) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679510145"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getting parent slice of frozen&quot;</span></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679510142"><span class="annot"><span class="annottext">p :: Path (Edges ns) (Notes ns)
</span><a href="#local-6989586621679510142"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall es es' ns o. SearchState es es' ns o -&gt; Maybe (Path es ns)
</span><a href="HeuristicParser.html#getPathFromState"><span class="hs-identifier hs-var">getPathFromState</span></a></span><span> </span><span class="annot"><span class="annottext">State ns
</span><a href="#local-6989586621679510164"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-194"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679510140"><span class="annot"><span class="annottext">slices :: [Notes ns]
</span><a href="#local-6989586621679510140"><span class="hs-identifier hs-var hs-var">slices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. Path a b -&gt; [b]
</span><a href="Common.html#pathBetweens"><span class="hs-identifier hs-var">pathBetweens</span></a></span><span> </span><span class="annot"><span class="annottext">Path (Edges ns) (Notes ns)
</span><a href="#local-6989586621679510142"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-195"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Notes ns]
</span><a href="#local-6989586621679510140"><span class="hs-identifier hs-var">slices</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679510138"><span class="annot"><span class="annottext">Notes ns
</span><a href="#local-6989586621679510138"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679510137"><span class="annot"><span class="annottext">Notes ns
</span><a href="#local-6989586621679510137"><span class="hs-identifier hs-var">sr</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679510136"><span class="annot"><span class="annottext">[Notes ns]
</span><a href="#local-6989586621679510136"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">Notes ns
</span><a href="#local-6989586621679510138"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">Notes ns
</span><a href="#local-6989586621679510137"><span class="hs-identifier hs-var">sr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>        </span><span class="annot"><span class="annottext">[Notes ns]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;How can you even unsplit if there arent two slices? Confusion&quot;</span></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-comment">-- Scoring Split</span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-comment">{-
                                  split:
                       ....[sl]-----parent---[sr]....
                             cl\           /cr
                                \         /
                               [ slc child ]
    -}</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span>    </span><span id="local-6989586621679510499"><span class="annot"><a href="#local-6989586621679510215"><span class="hs-identifier hs-type">getParentSlices</span></a></span><span>
</span><span id="line-209"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Heuristics.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510499"><span class="hs-identifier hs-type">ns</span></a></span><span>
</span><span id="line-210"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span>
</span><span id="line-211"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-212"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>
</span><span id="line-213"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510499"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510499"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510499"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>          </span><span class="hs-special">)</span></span><span>
</span><span id="line-217"></span><span>    </span><span id="local-6989586621679510215"><span class="annot"><span class="annottext">getParentSlices :: forall ns.
State ns
-&gt; ExceptT
     String
     IO
     (StartStop (SliceWrapped (Notes ns)),
      StartStop (SliceWrapped (Notes ns)),
      StartStop (SliceWrapped (Notes ns)))
</span><a href="#local-6989586621679510215"><span class="hs-identifier hs-var hs-var">getParentSlices</span></a></span></span><span> </span><span id="local-6989586621679510132"><span class="annot"><span class="annottext">State ns
</span><a href="#local-6989586621679510132"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-218"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679510129"><span class="annot"><span class="annottext">p :: Path (Edges ns) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679510129"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall es es' ns o.
SearchState es es' ns o -&gt; Maybe (Path es (SliceWrapped ns))
</span><a href="HeuristicParser.html#getPathFromState%27"><span class="hs-identifier hs-var">getPathFromState'</span></a></span><span> </span><span class="annot"><span class="annottext">State ns
</span><a href="#local-6989586621679510132"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-219"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679510127"><span class="annot"><span class="annottext">slices :: [SliceWrapped (Notes ns)]
</span><a href="#local-6989586621679510127"><span class="hs-identifier hs-var hs-var">slices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. Path a b -&gt; [b]
</span><a href="Common.html#pathBetweens"><span class="hs-identifier hs-var">pathBetweens</span></a></span><span> </span><span class="annot"><span class="annottext">Path (Edges ns) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679510129"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-220"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679510126"><span class="annot"><span class="annottext">midSlice :: StartStop (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679510126"><span class="hs-identifier hs-var hs-var">midSlice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall es es' ns o.
SearchState es es' ns o -&gt; Maybe [SliceWrapped ns]
</span><a href="HeuristicParser.html#getSlicesFromState"><span class="hs-identifier hs-var">getSlicesFromState</span></a></span><span> </span><span class="annot"><span class="annottext">State ns
</span><a href="#local-6989586621679510132"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-221"></span><span>                       </span><span class="annot"><span class="annottext">Maybe [SliceWrapped (Notes ns)]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span>
</span><span id="line-222"></span><span>                       </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679510125"><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679510125"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679510124"><span class="annot"><span class="annottext">[SliceWrapped (Notes ns)]
</span><a href="#local-6989586621679510124"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679510125"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[SliceWrapped (Notes ns)]
</span><a href="#local-6989586621679510127"><span class="hs-identifier hs-var">slices</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-225"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679510123"><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679510123"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679510122"><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679510122"><span class="hs-identifier hs-var">sr</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679510121"><span class="annot"><span class="annottext">[SliceWrapped (Notes ns)]
</span><a href="#local-6989586621679510121"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679510126"><span class="hs-identifier hs-var">midSlice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679510123"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679510122"><span class="hs-identifier hs-var">sr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>        </span><span class="annot"><span class="annottext">[SliceWrapped (Notes ns)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;How can you even unsplit if there arent two slices? Confusion&quot;</span></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621679510466"><span class="annot"><a href="#local-6989586621679510120"><span class="hs-identifier hs-type">getParentTrans</span></a></span><span>
</span><span id="line-229"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Heuristics.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510466"><span class="hs-identifier hs-type">ns</span></a></span><span>
</span><span id="line-230"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span>
</span><span id="line-231"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-232"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>
</span><span id="line-233"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510466"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510466"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-234"></span><span>    </span><span id="local-6989586621679510120"><span class="annot"><span class="annottext">getParentTrans :: forall ns.
State ns
-&gt; ExceptT String IO (Path (Edges ns) (SliceWrapped (Notes ns)))
</span><a href="#local-6989586621679510120"><span class="hs-identifier hs-var hs-var">getParentTrans</span></a></span></span><span> </span><span id="local-6989586621679510118"><span class="annot"><span class="annottext">State ns
</span><a href="#local-6989586621679510118"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-235"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679510115"><span class="annot"><span class="annottext">p :: Path (Edges ns) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679510115"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall es es' ns o.
SearchState es es' ns o -&gt; Maybe (Path es (SliceWrapped ns))
</span><a href="HeuristicParser.html#getPathFromState%27"><span class="hs-identifier hs-var">getPathFromState'</span></a></span><span> </span><span class="annot"><span class="annottext">State ns
</span><a href="#local-6989586621679510118"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-236"></span><span>      </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Path (Edges ns) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679510115"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>    </span><span id="local-6989586621679510464"><span class="annot"><a href="#local-6989586621679510114"><span class="hs-identifier hs-type">scoreSpread</span></a></span><span>
</span><span id="line-239"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Music.Notation</span></span><span> </span><span class="annot"><a href="#local-6989586621679510464"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510464"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510464"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PVGrammar.html#Spread"><span class="hs-identifier hs-type">Spread</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span>
</span><span id="line-243"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span></span><span>
</span><span id="line-244"></span><span>    </span><span id="local-6989586621679510114"><span class="annot"><span class="annottext">scoreSpread :: forall n.
Notation n =&gt;
SliceWrapped (Notes n)
-&gt; SliceWrapped (Notes n)
-&gt; Spread SPitch
-&gt; ExceptT String IO Double
</span><a href="#local-6989586621679510114"><span class="hs-identifier hs-var hs-var">scoreSpread</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span id="local-6989586621679510109"><span class="annot"><span class="annottext">Notes n
</span><a href="#local-6989586621679510109"><span class="hs-identifier hs-var">slcl</span></a></span></span><span> </span><span id="local-6989586621679510108"><span class="annot"><span class="annottext">lblL :: ChordLabel
</span><a href="#local-6989586621679510108"><span class="hs-identifier hs-var">lblL</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Harmony.ChordLabel.html#ChordLabel"><span class="hs-identifier hs-type">ChordLabel</span></a></span><span> </span><span id="local-6989586621679510106"><span class="annot"><span class="annottext">ChordType
</span><a href="#local-6989586621679510106"><span class="hs-identifier hs-var">ctl</span></a></span></span><span> </span><span id="local-6989586621679510105"><span class="annot"><span class="annottext">SPC
</span><a href="#local-6989586621679510105"><span class="hs-identifier hs-var">rl</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679510104"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679510104"><span class="hs-identifier hs-var">probL</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span id="local-6989586621679510103"><span class="annot"><span class="annottext">Notes n
</span><a href="#local-6989586621679510103"><span class="hs-identifier hs-var">slcr</span></a></span></span><span> </span><span id="local-6989586621679510102"><span class="annot"><span class="annottext">lblR :: ChordLabel
</span><a href="#local-6989586621679510102"><span class="hs-identifier hs-var">lblR</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Harmony.ChordLabel.html#ChordLabel"><span class="hs-identifier hs-type">ChordLabel</span></a></span><span> </span><span class="annot"><span class="annottext">ChordType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679510101"><span class="annot"><span class="annottext">SPC
</span><a href="#local-6989586621679510101"><span class="hs-identifier hs-var">rr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679510100"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679510100"><span class="hs-identifier hs-var">probR</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679510099"><span class="annot"><span class="annottext">spreadOp :: Spread SPitch
</span><a href="#local-6989586621679510099"><span class="hs-identifier hs-var">spreadOp</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#SpreadOp"><span class="hs-identifier hs-type">SpreadOp</span></a></span><span> </span><span id="local-6989586621679510097"><span class="annot"><span class="annottext">HashMap SPitch SpreadDirection
</span><a href="#local-6989586621679510097"><span class="hs-identifier hs-var">spreads</span></a></span></span><span> </span><span id="local-6989586621679510096"><span class="annot"><span class="annottext">Edges SPitch
</span><a href="#local-6989586621679510096"><span class="hs-identifier hs-var">edges</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-245"></span><span>      </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">3</span></span><span>
</span><span id="line-246"></span><span>     </span><span class="hs-comment">--  log &quot;Considering an unspread&quot;</span><span>
</span><span id="line-247"></span><span>     </span><span class="hs-comment">--  let slc = MS.fromList $ HM.keys spreads</span><span>
</span><span id="line-248"></span><span>     </span><span class="hs-comment">--  let slc' = Notes $ MS.map (transposeNote rl) slc</span><span>
</span><span id="line-249"></span><span>     </span><span class="hs-comment">--  log &quot;Left parent&quot;</span><span>
</span><span id="line-250"></span><span>     </span><span class="hs-comment">--  log $ show slcl</span><span>
</span><span id="line-251"></span><span>     </span><span class="hs-comment">--  log $ show lblL &lt;&gt; &quot; &quot; &lt;&gt; show probL</span><span>
</span><span id="line-252"></span><span>     </span><span class="hs-comment">--  log &quot;Right parent&quot;</span><span>
</span><span id="line-253"></span><span>     </span><span class="hs-comment">--  log $ show slcr</span><span>
</span><span id="line-254"></span><span>     </span><span class="hs-comment">--  log $ show lblR &lt;&gt; &quot; &quot; &lt;&gt; show probR</span><span>
</span><span id="line-255"></span><span>     </span><span class="hs-comment">--  log &quot;Child parent&quot;</span><span>
</span><span id="line-256"></span><span>     </span><span class="hs-comment">--  log $ show (MS.toList slc)</span><span>
</span><span id="line-257"></span><span>     </span><span class="hs-comment">--  let wu = sliceChordLogLikelihood params lblL slc'</span><span>
</span><span id="line-258"></span><span>     </span><span class="hs-comment">--  let ru = sliceChordLogLikelihood params lblL slc'</span><span>
</span><span id="line-259"></span><span>     </span><span class="hs-comment">--  let ml = probL</span><span>
</span><span id="line-260"></span><span>     </span><span class="hs-comment">--  let mr = probR</span><span>
</span><span id="line-261"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-262"></span><span>     </span><span class="hs-comment">--  let score = -(wu + ru + (ml + mr) / 2 )</span><span>
</span><span id="line-263"></span><span>     </span><span class="hs-comment">--  -- let score = - 4</span><span>
</span><span id="line-264"></span><span>     </span><span class="hs-comment">--  log $ &quot;score: &quot; &lt;&gt; show score</span><span>
</span><span id="line-265"></span><span>     </span><span class="hs-comment">--  pure score</span><span>
</span><span id="line-266"></span><span>     </span><span class="hs-comment">-- where</span><span>
</span><span id="line-267"></span><span>     </span><span class="hs-comment">--  mkLbl root chordType = ChordLabel chordType (spc (root - 14))</span><span>
</span><span id="line-268"></span><span>     </span><span class="hs-comment">--  go :: SpreadDirection -&gt; Double</span><span>
</span><span id="line-269"></span><span>     </span><span class="hs-comment">--  go = undefined</span><span>
</span><span id="line-270"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-271"></span><span>    </span><span id="local-6989586621679510492"><span id="local-6989586621679510493"><span class="annot"><a href="#local-6989586621679510208"><span class="hs-identifier hs-type">scoreSplit</span></a></span><span>
</span><span id="line-272"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Music.Notation</span></span><span> </span><span class="annot"><a href="#local-6989586621679510493"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679510492"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PVGrammar.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span>
</span><span id="line-274"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510493"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-275"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679510492"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-276"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510493"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510493"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span></span></span><span>
</span><span id="line-279"></span><span>    </span><span id="local-6989586621679510208"><span class="annot"><span class="annottext">scoreSplit :: forall n a.
(Notation n, Show a) =&gt;
Split SPitch
-&gt; Edges n
-&gt; a
-&gt; StartStop (SliceWrapped (Notes n))
-&gt; StartStop (SliceWrapped (Notes n))
-&gt; ExceptT String IO Double
</span><a href="#local-6989586621679510208"><span class="hs-identifier hs-var hs-var">scoreSplit</span></a></span></span><span>
</span><span id="line-280"></span><span>      </span><span id="local-6989586621679510091"><span class="annot"><span class="annottext">splitOp :: Split SPitch
</span><a href="#local-6989586621679510091"><span class="hs-identifier hs-var">splitOp</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#SplitOp"><span class="hs-identifier hs-type">SplitOp</span></a></span><span> </span><span id="local-6989586621679510089"><span class="annot"><span class="annottext">Map (Edge SPitch) [(SPitch, DoubleOrnament)]
</span><a href="#local-6989586621679510089"><span class="hs-identifier hs-var">splitRegs</span></a></span></span><span> </span><span id="local-6989586621679510088"><span class="annot"><span class="annottext">Map (InnerEdge SPitch) [(SPitch, PassingOrnament)]
</span><a href="#local-6989586621679510088"><span class="hs-identifier hs-var">splitPassings</span></a></span></span><span> </span><span id="local-6989586621679510087"><span class="annot"><span class="annottext">Map SPitch [(SPitch, RightOrnament)]
</span><a href="#local-6989586621679510087"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621679510086"><span class="annot"><span class="annottext">Map SPitch [(SPitch, LeftOrnament)]
</span><a href="#local-6989586621679510086"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span id="local-6989586621679510085"><span class="annot"><span class="annottext">HashSet (Edge SPitch)
</span><a href="#local-6989586621679510085"><span class="hs-identifier hs-var">keepl</span></a></span></span><span> </span><span id="local-6989586621679510084"><span class="annot"><span class="annottext">HashSet (Edge SPitch)
</span><a href="#local-6989586621679510084"><span class="hs-identifier hs-var">keepr</span></a></span></span><span> </span><span id="local-6989586621679510083"><span class="annot"><span class="annottext">MultiSet (InnerEdge SPitch)
</span><a href="#local-6989586621679510083"><span class="hs-identifier hs-var">passl</span></a></span></span><span> </span><span id="local-6989586621679510082"><span class="annot"><span class="annottext">MultiSet (InnerEdge SPitch)
</span><a href="#local-6989586621679510082"><span class="hs-identifier hs-var">passr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>      </span><span id="local-6989586621679510081"><span class="annot"><span class="annottext">parent :: Edges n
</span><a href="#local-6989586621679510081"><span class="hs-identifier hs-var">parent</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span id="local-6989586621679510079"><span class="annot"><span class="annottext">HashSet (Edge n)
</span><a href="#local-6989586621679510079"><span class="hs-identifier hs-var">topRegs</span></a></span></span><span> </span><span id="local-6989586621679510078"><span class="annot"><span class="annottext">MultiSet (InnerEdge n)
</span><a href="#local-6989586621679510078"><span class="hs-identifier hs-var">topPassings</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>      </span><span id="local-6989586621679510077"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679510077"><span class="hs-identifier hs-var">childSlice</span></a></span></span><span>
</span><span id="line-283"></span><span>      </span><span id="local-6989586621679510076"><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes n))
</span><a href="#local-6989586621679510076"><span class="hs-identifier hs-var">slcl</span></a></span></span><span>
</span><span id="line-284"></span><span>      </span><span id="local-6989586621679510075"><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes n))
</span><a href="#local-6989586621679510075"><span class="hs-identifier hs-var">slcr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>        </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>
</span><span id="line-286"></span><span>       </span><span class="hs-comment">--  lblL &lt;- case slcl of</span><span>
</span><span id="line-287"></span><span>       </span><span class="hs-comment">--    Start -&gt; pure Nothing</span><span>
</span><span id="line-288"></span><span>       </span><span class="hs-comment">--    Stop -&gt; throwError &quot;Stop on Left?&quot;</span><span>
</span><span id="line-289"></span><span>       </span><span class="hs-comment">--    Inner (SliceWrapped (Notes _) lbl prob) -&gt; pure $ Just (lbl, prob)</span><span>
</span><span id="line-290"></span><span>       </span><span class="hs-comment">--  lblR &lt;- case slcr of</span><span>
</span><span id="line-291"></span><span>       </span><span class="hs-comment">--    Start -&gt; throwError &quot;Start on Right?&quot;</span><span>
</span><span id="line-292"></span><span>       </span><span class="hs-comment">--    Stop -&gt; pure Nothing</span><span>
</span><span id="line-293"></span><span>       </span><span class="hs-comment">--    Inner (SliceWrapped (Notes _) lbl prob) -&gt; pure $ Just (lbl, prob)</span><span>
</span><span id="line-294"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-295"></span><span>       </span><span class="hs-comment">--  probsRS &lt;- mapM (scoreLeftOrnament lblR) (allOrnaments rs)kk</span><span>
</span><span id="line-296"></span><span>       </span><span class="hs-comment">--  probsLS &lt;- mapM (scoreRightOrnament lblL) (allOrnaments ls)</span><span>
</span><span id="line-297"></span><span>       </span><span class="hs-comment">--  probsRegs &lt;- mapM (scoreRegs lblL lblR) (allRegs splitRegs)</span><span>
</span><span id="line-298"></span><span>       </span><span class="hs-comment">--  probsPassings &lt;- mapM (scorePassing lblL lblR) (allPassings splitPassings)</span><span>
</span><span id="line-299"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-300"></span><span>       </span><span class="hs-comment">--  log $ &quot;\n\tOperation Contents:\n&quot; &lt;&gt; show splitOp</span><span>
</span><span id="line-301"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-302"></span><span>       </span><span class="hs-comment">--  log $ &quot;\nLeft parent slice: &quot; &lt;&gt; show slcl</span><span>
</span><span id="line-303"></span><span>       </span><span class="hs-comment">--  log $ &quot;Inferred Chord: &quot; &lt;&gt; show lblL</span><span>
</span><span id="line-304"></span><span>       </span><span class="hs-comment">--  log $ &quot;\nRight parent slice: &quot; &lt;&gt; show slcr</span><span>
</span><span id="line-305"></span><span>       </span><span class="hs-comment">--  log $ &quot;Inferred Chord: &quot; &lt;&gt; show lblR</span><span>
</span><span id="line-306"></span><span>       </span><span class="hs-comment">--  log $ &quot;\nChild slice: &quot; &lt;&gt; show childSlice</span><span>
</span><span id="line-307"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-308"></span><span>       </span><span class="hs-comment">--  log $ &quot;Left slice ornaments:&quot; &lt;&gt; showOps opLs</span><span>
</span><span id="line-309"></span><span>       </span><span class="hs-comment">--  log $ &quot;scores: &quot; &lt;&gt; show probsLS</span><span>
</span><span id="line-310"></span><span>       </span><span class="hs-comment">--  log $ &quot;Right slice ornaments:&quot; &lt;&gt; showOps opRs</span><span>
</span><span id="line-311"></span><span>       </span><span class="hs-comment">--  log $ &quot;scores: &quot; &lt;&gt; show probsRS</span><span>
</span><span id="line-312"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-313"></span><span>       </span><span class="hs-comment">--  log $ &quot;Regular edges:&quot; &lt;&gt; show (allRegs splitRegs)</span><span>
</span><span id="line-314"></span><span>       </span><span class="hs-comment">--  log $ &quot;scores: &quot; &lt;&gt; show probsRegs</span><span>
</span><span id="line-315"></span><span>       </span><span class="hs-comment">--  log $ &quot;Passing edges:&quot; &lt;&gt;  show (allPassings splitPassings)</span><span>
</span><span id="line-316"></span><span>       </span><span class="hs-comment">--  log $ &quot;scores: &quot; &lt;&gt; show probsPassings</span><span>
</span><span id="line-317"></span><span>       </span><span class="hs-comment">--  </span><span>
</span><span id="line-318"></span><span>       </span><span class="hs-comment">--  let aggregateProbs = probsRS &lt;&gt; probsLS &lt;&gt; probsRegs &lt;&gt; probsPassings</span><span>
</span><span id="line-319"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-320"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-321"></span><span>       </span><span class="hs-comment">--  log $ &quot;Operation scores: &quot; &lt;&gt; show aggregateProbs</span><span>
</span><span id="line-322"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-323"></span><span>       </span><span class="hs-comment">--  let score = -(sum aggregateProbs / fromIntegral (L.length aggregateProbs))</span><span>
</span><span id="line-324"></span><span>       </span><span class="hs-comment">--  log $ &quot;score: &quot; &lt;&gt; show score</span><span>
</span><span id="line-325"></span><span>       </span><span class="hs-comment">--  pure score</span><span>
</span><span id="line-326"></span><span>       </span><span class="hs-comment">-- where</span><span>
</span><span id="line-327"></span><span>       </span><span class="hs-comment">--  scoreRightOrnament</span><span>
</span><span id="line-328"></span><span>       </span><span class="hs-comment">--    :: Maybe (ChordLabel, Double)</span><span>
</span><span id="line-329"></span><span>       </span><span class="hs-comment">--    -&gt; (SPitch, (SPitch, RightOrnament))</span><span>
</span><span id="line-330"></span><span>       </span><span class="hs-comment">--    -&gt; ExceptT String IO Double</span><span>
</span><span id="line-331"></span><span>       </span><span class="hs-comment">--  scoreRightOrnament Nothing (n, (x, orn)) = throwError &quot;Right Ornament with no parent&quot;</span><span>
</span><span id="line-332"></span><span>       </span><span class="hs-comment">--  scoreRightOrnament (Just (lbl@(ChordLabel chordLbl root), prob)) (n, (x, orn)) = do</span><span>
</span><span id="line-333"></span><span>       </span><span class="hs-comment">--    log $ &quot;Scoring a right ornament: &quot; &lt;&gt; Music.showNotation n &lt;&gt; &quot;&lt;=&quot;&lt;&gt; Music.showNotation x</span><span>
</span><span id="line-334"></span><span>       </span><span class="hs-comment">--    let (n', x') = (transposeNote root n, transposeNote root x)</span><span>
</span><span id="line-335"></span><span>       </span><span class="hs-comment">--     in case orn of</span><span>
</span><span id="line-336"></span><span>       </span><span class="hs-comment">--          RightNeighbor -&gt; do</span><span>
</span><span id="line-337"></span><span>       </span><span class="hs-comment">--            log &quot;Right Neighbor&quot;</span><span>
</span><span id="line-338"></span><span>       </span><span class="hs-comment">--            log $ &quot;LBL: &quot; &lt;&gt; show (Just (lbl, prob))</span><span>
</span><span id="line-339"></span><span>       </span><span class="hs-comment">--            log $ &quot;Chord tone likelihood: &quot; &lt;&gt; show (chordToneLogLikelihood params lbl n')</span><span>
</span><span id="line-340"></span><span>       </span><span class="hs-comment">--            log $ &quot;Ornament tone likelihood: &quot; &lt;&gt; show (ornamentLogLikelihood params lbl x')</span><span>
</span><span id="line-341"></span><span>       </span><span class="hs-comment">--            pure $ chordToneLogLikelihood params lbl n' + ornamentLogLikelihood params lbl x'</span><span>
</span><span id="line-342"></span><span>       </span><span class="hs-comment">--          RightRepeat -&gt; do</span><span>
</span><span id="line-343"></span><span>       </span><span class="hs-comment">--            log &quot;Right Repeat&quot;</span><span>
</span><span id="line-344"></span><span>       </span><span class="hs-comment">--            log $ &quot;LBL: &quot; &lt;&gt; show (Just (lbl, prob))</span><span>
</span><span id="line-345"></span><span>       </span><span class="hs-comment">--            log $ &quot;Chord tone likelihood: &quot; &lt;&gt; show (chordToneLogLikelihood params lbl n')</span><span>
</span><span id="line-346"></span><span>       </span><span class="hs-comment">--            pure $ 2 * chordToneLogLikelihood params lbl n'</span><span>
</span><span id="line-347"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-348"></span><span>       </span><span class="hs-comment">--  scoreLeftOrnament</span><span>
</span><span id="line-349"></span><span>       </span><span class="hs-comment">--    :: Maybe (ChordLabel, Double)</span><span>
</span><span id="line-350"></span><span>       </span><span class="hs-comment">--    -&gt; (SPitch, (SPitch, LeftOrnament))</span><span>
</span><span id="line-351"></span><span>       </span><span class="hs-comment">--    -&gt; ExceptT String IO Double</span><span>
</span><span id="line-352"></span><span>       </span><span class="hs-comment">--  scoreLeftOrnament Nothing (n, (x, orn)) = throwError &quot;Left Ornament with no parent&quot;</span><span>
</span><span id="line-353"></span><span>       </span><span class="hs-comment">--  scoreLeftOrnament (Just (lbl@(ChordLabel&#160;chordType rootNote), prob)) (n, (x, orn)) = do</span><span>
</span><span id="line-354"></span><span>       </span><span class="hs-comment">--    log $ &quot;Scoring a left ornament: &quot; &lt;&gt; Music.showNotation x &lt;&gt; &quot;=&gt;&quot;&lt;&gt; Music.showNotation n</span><span>
</span><span id="line-355"></span><span>       </span><span class="hs-comment">--    let (n', x') = (transposeNote root n, transposeNote root x)</span><span>
</span><span id="line-356"></span><span>       </span><span class="hs-comment">--     in case orn of</span><span>
</span><span id="line-357"></span><span>       </span><span class="hs-comment">--          LeftNeighbor -&gt; do</span><span>
</span><span id="line-358"></span><span>       </span><span class="hs-comment">--            log &quot;Left Neighbor&quot;</span><span>
</span><span id="line-359"></span><span>       </span><span class="hs-comment">--            log $ &quot;LBL: &quot; &lt;&gt; show (Just (lbl, prob))</span><span>
</span><span id="line-360"></span><span>       </span><span class="hs-comment">--            log $ &quot;Chord tone likelihood: &quot; &lt;&gt; show (chordToneLogLikelihood params lbl n')</span><span>
</span><span id="line-361"></span><span>       </span><span class="hs-comment">--            log $ &quot;Ornament tone likelihood: &quot; &lt;&gt; show (ornamentLogLikelihood params lbl x')</span><span>
</span><span id="line-362"></span><span>       </span><span class="hs-comment">--            pure $ chordToneLogLikelihood params lbl n' + ornamentLogLikelihood params lbl x'</span><span>
</span><span id="line-363"></span><span>       </span><span class="hs-comment">--          LeftRepeat -&gt; do</span><span>
</span><span id="line-364"></span><span>       </span><span class="hs-comment">--            log &quot;Left Repeat&quot;</span><span>
</span><span id="line-365"></span><span>       </span><span class="hs-comment">--            log $ &quot;LBL: &quot; &lt;&gt; show (Just (lbl, prob))</span><span>
</span><span id="line-366"></span><span>       </span><span class="hs-comment">--            log $ &quot;Chord tone likelihood: &quot; &lt;&gt; show (chordToneLogLikelihood params lbl n')</span><span>
</span><span id="line-367"></span><span>       </span><span class="hs-comment">--            pure $ 2 * chordToneLogLikelihood params lbl n'</span><span>
</span><span id="line-368"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-369"></span><span>       </span><span class="hs-comment">--  scoreRegs Nothing _ ((x, y), (n, orn)) = throwError &quot;Attempted to score a regular edge without a chord label&quot;</span><span>
</span><span id="line-370"></span><span>       </span><span class="hs-comment">--  scoreRegs _ Nothing ((x, y), (n, orn)) = throwError &quot;Attempted to score a regular edge without a chord label&quot;</span><span>
</span><span id="line-371"></span><span>       </span><span class="hs-comment">--  scoreRegs (Just (lbll@(ChordLabel chordlbll rootl), probL)) (Just (lblr@(ChordLabel chordlblr rootr), probR)) ((Inner nl, Inner nr), (x, orn)) =</span><span>
</span><span id="line-372"></span><span>       </span><span class="hs-comment">--    let (nl', nr') = (transposeNote rootl nl, transposeNote rootr nr)</span><span>
</span><span id="line-373"></span><span>       </span><span class="hs-comment">--     in case orn of</span><span>
</span><span id="line-374"></span><span>       </span><span class="hs-comment">--          FullNeighbor -&gt;</span><span>
</span><span id="line-375"></span><span>       </span><span class="hs-comment">--            pure $</span><span>
</span><span id="line-376"></span><span>       </span><span class="hs-comment">--              (chordToneLogLikelihood params lbll nl' + chordToneLogLikelihood params lblr nr') / 2</span><span>
</span><span id="line-377"></span><span>       </span><span class="hs-comment">--                + ornamentLogLikelihoodDouble params lbll lblr x</span><span>
</span><span id="line-378"></span><span>       </span><span class="hs-comment">--          FullRepeat -&gt;</span><span>
</span><span id="line-379"></span><span>       </span><span class="hs-comment">--            pure $</span><span>
</span><span id="line-380"></span><span>       </span><span class="hs-comment">--              (chordToneLogLikelihood params lbll nl' + chordToneLogLikelihood params lblr nr') / 2</span><span>
</span><span id="line-381"></span><span>       </span><span class="hs-comment">--                + chordToneLogLikelihoodDouble params lbll lblr x</span><span>
</span><span id="line-382"></span><span>       </span><span class="hs-comment">--          RootNote -&gt; pure 0</span><span>
</span><span id="line-383"></span><span>       </span><span class="hs-comment">--          LeftRepeatOfRight -&gt; pure $ chordToneLogLikelihood params lblr nr'</span><span>
</span><span id="line-384"></span><span>       </span><span class="hs-comment">--          RightRepeatOfLeft -&gt; pure $ chordToneLogLikelihood params lblr nl'</span><span>
</span><span id="line-385"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-386"></span><span>       </span><span class="hs-comment">--  scorePassing Nothing _ ((x, y), (n, orn)) = throwError &quot;Attempted to score a passing edge without a chord label&quot;</span><span>
</span><span id="line-387"></span><span>       </span><span class="hs-comment">--  scorePassing _ Nothing ((x, y), (n, orn)) = throwError &quot;Attempted to score a passing edge without a chord label&quot;</span><span>
</span><span id="line-388"></span><span>       </span><span class="hs-comment">--  scorePassing (Just (lbll@(ChordLabel chordlbll rootl), probL)) (Just (lblr@(ChordLabel chordlblr rootr), probR)) ((nl, nr), (x, orn)) =</span><span>
</span><span id="line-389"></span><span>       </span><span class="hs-comment">--    let (nl', nr') = (transposeNote rootl nl, transposeNote rootr nr)</span><span>
</span><span id="line-390"></span><span>       </span><span class="hs-comment">--     in case orn of</span><span>
</span><span id="line-391"></span><span>       </span><span class="hs-comment">--          PassingLeft -&gt; pure $ ornamentLogLikelihood params lblr (transposeNote rootl x) + chordToneLogLikelihood params lblr nr'</span><span>
</span><span id="line-392"></span><span>       </span><span class="hs-comment">--          PassingMid -&gt; pure $ ornamentLogLikelihoodDouble params lbll lblr x + (chordToneLogLikelihood params lblr nr' + chordToneLogLikelihood params lblr nl') / 2</span><span>
</span><span id="line-393"></span><span>       </span><span class="hs-comment">--          PassingRight -&gt; pure $ ornamentLogLikelihood params lblr (transposeNote rootr x) + chordToneLogLikelihood params lbll nl'</span><span>
</span><span id="line-394"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-395"></span><span>       </span><span class="hs-comment">--  opLs = showL &lt;$&gt; M.toList ls</span><span>
</span><span id="line-396"></span><span>       </span><span class="hs-comment">--  opRs = showR &lt;$&gt; M.toList rs</span><span>
</span><span id="line-397"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-398"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-399"></span><span>       </span><span class="hs-comment">--  showOps ops = &quot;\n   &quot; &lt;&gt; L.intercalate &quot;\n   &quot; ops</span><span>
</span><span id="line-400"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-401"></span><span>       </span><span class="hs-comment">--  showEdge (p1, p2) = Music.showNotation p1 &lt;&gt; &quot;-&quot; &lt;&gt; Music.showNotation p2</span><span>
</span><span id="line-402"></span><span>       </span><span class="hs-comment">--  showEdges ts = &quot;{&quot; &lt;&gt; L.intercalate &quot;,&quot; (showEdge &lt;$&gt; S.toList ts) &lt;&gt; &quot;}&quot;</span><span>
</span><span id="line-403"></span><span>       </span><span class="hs-comment">--  showChild (p, o) = Music.showNotation p &lt;&gt; &quot;:&quot; &lt;&gt; show o</span><span>
</span><span id="line-404"></span><span>       </span><span class="hs-comment">--  showChildren cs = &quot;[&quot; &lt;&gt; L.intercalate &quot;,&quot; (showChild &lt;$&gt; cs) &lt;&gt; &quot;]&quot;</span><span>
</span><span id="line-405"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-406"></span><span>       </span><span class="hs-comment">--  showSplit (e, cs) = showEdge e &lt;&gt; &quot;=&gt;&quot; &lt;&gt; showChildren cs</span><span>
</span><span id="line-407"></span><span>       </span><span class="hs-comment">--  showL (p, lchilds) = Music.showNotation p &lt;&gt; &quot;=&gt;&quot; &lt;&gt; showChildren lchilds</span><span>
</span><span id="line-408"></span><span>       </span><span class="hs-comment">--  showR (p, rchilds) = showChildren rchilds &lt;&gt; &quot;&lt;=&quot; &lt;&gt; Music.showNotation p</span><span>
</span><span id="line-409"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-410"></span><span>       </span><span class="hs-comment">--  allOrnaments :: M.Map a [b] -&gt; [(a, b)]</span><span>
</span><span id="line-411"></span><span>       </span><span class="hs-comment">--  allOrnaments ornamentSet = do</span><span>
</span><span id="line-412"></span><span>       </span><span class="hs-comment">--    (parent, children) &lt;- M.toList ornamentSet</span><span>
</span><span id="line-413"></span><span>       </span><span class="hs-comment">--    child &lt;- children</span><span>
</span><span id="line-414"></span><span>       </span><span class="hs-comment">--    pure (parent, child)</span><span>
</span><span id="line-415"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-416"></span><span>       </span><span class="hs-comment">--  allRegs regSet = do</span><span>
</span><span id="line-417"></span><span>       </span><span class="hs-comment">--    (parent, children) &lt;- M.toList regSet</span><span>
</span><span id="line-418"></span><span>       </span><span class="hs-comment">--    child &lt;- children</span><span>
</span><span id="line-419"></span><span>       </span><span class="hs-comment">--    pure (parent, child)</span><span>
</span><span id="line-420"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-421"></span><span>       </span><span class="hs-comment">--  allPassings ornamentSet = do</span><span>
</span><span id="line-422"></span><span>       </span><span class="hs-comment">--    (parent, children) &lt;- M.toList ornamentSet</span><span>
</span><span id="line-423"></span><span>       </span><span class="hs-comment">--    child &lt;- children</span><span>
</span><span id="line-424"></span><span>       </span><span class="hs-comment">--    pure (parent, child)</span><span>
</span><span id="line-425"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-426"></span><span>       </span><span class="hs-comment">--  allOps opset = do</span><span>
</span><span id="line-427"></span><span>       </span><span class="hs-comment">--    (parent, children) &lt;- M.toList opset</span><span>
</span><span id="line-428"></span><span>       </span><span class="hs-comment">--    child &lt;- children</span><span>
</span><span id="line-429"></span><span>       </span><span class="hs-comment">--    pure (parent, child)</span><span>
</span><span id="line-430"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-431"></span><span>       </span><span class="hs-comment">--  applyRegs top ops = do</span><span>
</span><span id="line-432"></span><span>       </span><span class="hs-comment">--    (top', notes) &lt;- foldM (applyReg top) (top, MS.empty) $ allOps ops</span><span>
</span><span id="line-433"></span><span>       </span><span class="hs-comment">--    if S.null top'</span><span>
</span><span id="line-434"></span><span>       </span><span class="hs-comment">--      then pure notes</span><span>
</span><span id="line-435"></span><span>       </span><span class="hs-comment">--      else throwError $ &quot;did not use all terminal edges, remaining: &quot; &lt;&gt; showEdges top'</span><span>
</span><span id="line-436"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-437"></span><span>       </span><span class="hs-comment">--  applyReg topAll (top, notes) (parent, (note, _))</span><span>
</span><span id="line-438"></span><span>       </span><span class="hs-comment">--    | parent `S.member` topAll =</span><span>
</span><span id="line-439"></span><span>       </span><span class="hs-comment">--        pure (top', notes')</span><span>
</span><span id="line-440"></span><span>       </span><span class="hs-comment">--    | otherwise =</span><span>
</span><span id="line-441"></span><span>       </span><span class="hs-comment">--        throwError $</span><span>
</span><span id="line-442"></span><span>       </span><span class="hs-comment">--          &quot;used non-existing terminal edge\n  top=&quot;</span><span>
</span><span id="line-443"></span><span>       </span><span class="hs-comment">--            &lt;&gt; show parent</span><span>
</span><span id="line-444"></span><span>       </span><span class="hs-comment">--            &lt;&gt; &quot;\n  split=&quot;</span><span>
</span><span id="line-445"></span><span>       </span><span class="hs-comment">--            &lt;&gt; show splitOp</span><span>
</span><span id="line-446"></span><span>       </span><span class="hs-comment">--   where</span><span>
</span><span id="line-447"></span><span>       </span><span class="hs-comment">--    top' = S.delete parent top</span><span>
</span><span id="line-448"></span><span>       </span><span class="hs-comment">--    notes' = MS.insert note notes</span><span>
</span><span id="line-449"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-450"></span><span>       </span><span class="hs-comment">--  singleChild (_, (note, _)) = note</span><span>
</span><span id="line-451"></span><span>       </span><span class="hs-comment">--  collectNotes ops = MS.fromList $ singleChild &lt;$&gt; allOps ops</span><span>
</span><span id="line-452"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-453"></span><span>    </span><span id="local-6989586621679510495"><span id="local-6989586621679510496"><span id="local-6989586621679510497"><span id="local-6989586621679510498"><span class="annot"><a href="#local-6989586621679510212"><span class="hs-identifier hs-type">getParentDouble</span></a></span><span>
</span><span id="line-454"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="HeuristicParser.html#SearchState"><span class="hs-identifier hs-type">SearchState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510498"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510497"><span class="hs-identifier hs-type">es'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510496"><span class="hs-identifier hs-type">ns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510495"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-455"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510496"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">--midslice or start (in open case)</span><span>
</span><span id="line-456"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679510498"><span class="hs-identifier hs-type">d</span></a></span><span>                           </span><span class="hs-comment">-- tl</span><span>
</span><span id="line-457"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510496"><span class="hs-identifier hs-type">ns</span></a></span><span>             </span><span class="hs-comment">-- sl </span><span>
</span><span id="line-458"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679510498"><span class="hs-identifier hs-type">d</span></a></span><span>                           </span><span class="hs-comment">-- tm</span><span>
</span><span id="line-459"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510496"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span><span class="hs-comment">-- sr or stop (2 transitions only)</span><span>
</span><span id="line-460"></span><span>    </span><span id="local-6989586621679510212"><span class="annot"><span class="annottext">getParentDouble :: forall d es' ns o.
SearchState d es' ns o
-&gt; (StartStop (SliceWrapped ns), d, SliceWrapped ns, d,
    StartStop (SliceWrapped ns))
</span><a href="#local-6989586621679510212"><span class="hs-identifier hs-var hs-var">getParentDouble</span></a></span></span><span> </span><span id="local-6989586621679510068"><span class="annot"><span class="annottext">SearchState d es' ns o
</span><a href="#local-6989586621679510068"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SearchState d es' ns o
</span><a href="#local-6989586621679510068"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-461"></span><span>      </span><span class="annot"><a href="HeuristicParser.html#SSFrozen"><span class="hs-identifier hs-type">SSFrozen</span></a></span><span> </span><span class="annot"><span class="annottext">Path (Maybe es', Bool) (SliceWrapped ns)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal double operation&quot;</span></span><span> </span><span class="hs-comment">-- SSFrozen can only be the frist state.</span><span>
</span><span id="line-462"></span><span>      </span><span class="annot"><a href="HeuristicParser.html#SSOpen"><span class="hs-identifier hs-type">SSOpen</span></a></span><span> </span><span id="local-6989586621679510067"><span class="annot"><span class="annottext">Path (Trans d) (SliceWrapped ns)
</span><a href="#local-6989586621679510067"><span class="hs-identifier hs-var">open</span></a></span></span><span> </span><span id="local-6989586621679510066"><span class="annot"><span class="annottext">[o]
</span><a href="#local-6989586621679510066"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-463"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path (Trans d) (SliceWrapped ns)
</span><a href="#local-6989586621679510067"><span class="hs-identifier hs-var">open</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-464"></span><span>          </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span id="local-6989586621679510064"><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510064"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span id="local-6989586621679510063"><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510063"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span id="local-6989586621679510062"><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510062"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span id="local-6989586621679510061"><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510061"><span class="hs-identifier hs-var">sm</span></a></span></span><span> </span><span id="local-6989586621679510060"><span class="annot"><span class="annottext">Path (Trans d) (SliceWrapped ns)
</span><a href="#local-6989586621679510060"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510064"><span class="hs-identifier hs-var">tl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510063"><span class="hs-identifier hs-var">slice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510062"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510061"><span class="hs-identifier hs-var">sm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- SSOpen only case is a split from  two open transitions.</span><span>
</span><span id="line-465"></span><span>          </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span id="local-6989586621679510058"><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510058"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span id="local-6989586621679510057"><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510057"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#PathEnd"><span class="hs-identifier hs-type">PathEnd</span></a></span><span> </span><span id="local-6989586621679510055"><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510055"><span class="hs-identifier hs-var">tr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510058"><span class="hs-identifier hs-var">tl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510057"><span class="hs-identifier hs-var">slice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510055"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>          </span><span class="annot"><a href="Common.html#PathEnd"><span class="hs-identifier hs-type">PathEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Trans d
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;illegal double operation&quot;</span></span><span> </span><span class="hs-comment">-- SSOpen only case is a split from  two open transitions.</span><span>
</span><span id="line-467"></span><span>      </span><span class="annot"><a href="HeuristicParser.html#SSSemiOpen"><span class="hs-identifier hs-type">SSSemiOpen</span></a></span><span> </span><span id="local-6989586621679510054"><span class="annot"><span class="annottext">Path (Maybe es', Bool) (SliceWrapped ns)
</span><a href="#local-6989586621679510054"><span class="hs-identifier hs-var">frozen</span></a></span></span><span> </span><span id="local-6989586621679510053"><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510053"><span class="hs-identifier hs-var">midSlice</span></a></span></span><span> </span><span id="local-6989586621679510052"><span class="annot"><span class="annottext">Path (Trans d) (SliceWrapped ns)
</span><a href="#local-6989586621679510052"><span class="hs-identifier hs-var">open</span></a></span></span><span> </span><span id="local-6989586621679510051"><span class="annot"><span class="annottext">[o]
</span><a href="#local-6989586621679510051"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-468"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path (Trans d) (SliceWrapped ns)
</span><a href="#local-6989586621679510052"><span class="hs-identifier hs-var">open</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-comment">-- From two open transitions only</span><span>
</span><span id="line-469"></span><span>          </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span id="local-6989586621679510050"><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510050"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span id="local-6989586621679510049"><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510049"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span id="local-6989586621679510048"><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510048"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span id="local-6989586621679510047"><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510047"><span class="hs-identifier hs-var">sm</span></a></span></span><span> </span><span id="local-6989586621679510046"><span class="annot"><span class="annottext">Path (Trans d) (SliceWrapped ns)
</span><a href="#local-6989586621679510046"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510053"><span class="hs-identifier hs-var">midSlice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510050"><span class="hs-identifier hs-var">tl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510049"><span class="hs-identifier hs-var">slice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510048"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510047"><span class="hs-identifier hs-var">sm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- SSOpen only case is a split from  two open transitions.</span><span>
</span><span id="line-470"></span><span>          </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span id="local-6989586621679510045"><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510045"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span id="local-6989586621679510044"><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510044"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#PathEnd"><span class="hs-identifier hs-type">PathEnd</span></a></span><span> </span><span id="local-6989586621679510043"><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510043"><span class="hs-identifier hs-var">tr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510053"><span class="hs-identifier hs-var">midSlice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510045"><span class="hs-identifier hs-var">tl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510044"><span class="hs-identifier hs-var">slice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510043"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- SSOpen only case is a split from  two open transitions.</span><span>
</span><span id="line-471"></span><span>          </span><span class="annot"><a href="Common.html#PathEnd"><span class="hs-identifier hs-type">PathEnd</span></a></span><span> </span><span id="local-6989586621679510042"><span class="annot"><span class="annottext">Trans d
</span><a href="#local-6989586621679510042"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal double operation in the SSSemiOpen case&quot;</span></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span>    </span><span id="local-6989586621679510441"><span id="local-6989586621679510442"><span id="local-6989586621679510443"><span id="local-6989586621679510444"><span class="annot"><a href="#local-6989586621679510041"><span class="hs-identifier hs-type">getParentSingle</span></a></span><span>
</span><span id="line-474"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="HeuristicParser.html#SearchState"><span class="hs-identifier hs-type">SearchState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510444"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510443"><span class="hs-identifier hs-type">es'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510442"><span class="hs-identifier hs-type">ns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510441"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-475"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510442"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">--midslice or startstop</span><span>
</span><span id="line-476"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679510444"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span><span>                          </span><span class="hs-comment">--tl</span><span>
</span><span id="line-477"></span><span>    </span><span id="local-6989586621679510041"><span class="annot"><span class="annottext">getParentSingle :: forall b es' ns o.
SearchState b es' ns o -&gt; (StartStop (SliceWrapped ns), b)
</span><a href="#local-6989586621679510041"><span class="hs-identifier hs-var hs-var">getParentSingle</span></a></span></span><span> </span><span id="local-6989586621679510034"><span class="annot"><span class="annottext">SearchState b es' ns o
</span><a href="#local-6989586621679510034"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SearchState b es' ns o
</span><a href="#local-6989586621679510034"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-478"></span><span>      </span><span class="annot"><a href="HeuristicParser.html#SSFrozen"><span class="hs-identifier hs-type">SSFrozen</span></a></span><span> </span><span class="annot"><span class="annottext">Path (Maybe es', Bool) (SliceWrapped ns)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal single operation&quot;</span></span><span> </span><span class="hs-comment">-- SSFrozen can only be the frist state.</span><span>
</span><span id="line-479"></span><span>      </span><span class="annot"><a href="HeuristicParser.html#SSOpen"><span class="hs-identifier hs-type">SSOpen</span></a></span><span> </span><span id="local-6989586621679510033"><span class="annot"><span class="annottext">Path (Trans b) (SliceWrapped ns)
</span><a href="#local-6989586621679510033"><span class="hs-identifier hs-var">open</span></a></span></span><span> </span><span id="local-6989586621679510032"><span class="annot"><span class="annottext">[o]
</span><a href="#local-6989586621679510032"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-480"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path (Trans b) (SliceWrapped ns)
</span><a href="#local-6989586621679510033"><span class="hs-identifier hs-var">open</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-481"></span><span>          </span><span class="annot"><a href="Common.html#PathEnd"><span class="hs-identifier hs-type">PathEnd</span></a></span><span> </span><span id="local-6989586621679510031"><span class="annot"><span class="annottext">Trans b
</span><a href="#local-6989586621679510031"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans b
</span><a href="#local-6989586621679510031"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- SSOpen only case is a split from  two open transitions.</span><span>
</span><span id="line-482"></span><span>          </span><span class="annot"><span class="annottext">Path (Trans b) (SliceWrapped ns)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal single &quot;</span></span><span> </span><span class="hs-comment">-- illegal state</span><span>
</span><span id="line-483"></span><span>      </span><span class="annot"><a href="HeuristicParser.html#SSSemiOpen"><span class="hs-identifier hs-type">SSSemiOpen</span></a></span><span> </span><span id="local-6989586621679510030"><span class="annot"><span class="annottext">Path (Maybe es', Bool) (SliceWrapped ns)
</span><a href="#local-6989586621679510030"><span class="hs-identifier hs-var">frozen</span></a></span></span><span> </span><span id="local-6989586621679510029"><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510029"><span class="hs-identifier hs-var">midSlice</span></a></span></span><span> </span><span id="local-6989586621679510028"><span class="annot"><span class="annottext">Path (Trans b) (SliceWrapped ns)
</span><a href="#local-6989586621679510028"><span class="hs-identifier hs-var">open</span></a></span></span><span> </span><span id="local-6989586621679510027"><span class="annot"><span class="annottext">[o]
</span><a href="#local-6989586621679510027"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-484"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path (Trans b) (SliceWrapped ns)
</span><a href="#local-6989586621679510028"><span class="hs-identifier hs-var">open</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-comment">-- From two open transitions only</span><span>
</span><span id="line-485"></span><span>          </span><span class="annot"><a href="Common.html#PathEnd"><span class="hs-identifier hs-type">PathEnd</span></a></span><span> </span><span id="local-6989586621679510026"><span class="annot"><span class="annottext">Trans b
</span><a href="#local-6989586621679510026"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679510029"><span class="hs-identifier hs-var">midSlice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans b
</span><a href="#local-6989586621679510026"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>          </span><span class="annot"><span class="annottext">Path (Trans b) (SliceWrapped ns)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal single&quot;</span></span><span> </span><span class="hs-comment">-- illegal state</span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span class="annot"><a href="Heuristics.html#testHeuristic%27"><span class="hs-identifier hs-type">testHeuristic'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Heuristics.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Heuristics.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SPitch</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-490"></span><span id="testHeuristic%27"><span class="annot"><span class="annottext">testHeuristic' :: (Maybe (State SPitch), State SPitch) -&gt; ExceptT String IO Double
</span><a href="Heuristics.html#testHeuristic%27"><span class="hs-identifier hs-var hs-var">testHeuristic'</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679510025"><span class="annot"><span class="annottext">Maybe (State SPitch)
</span><a href="#local-6989586621679510025"><span class="hs-identifier hs-var">prevState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510024"><span class="annot"><span class="annottext">State SPitch
</span><a href="#local-6989586621679510024"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall es es' ns o. SearchState es es' ns o -&gt; Maybe o
</span><a href="HeuristicParser.html#getOpFromState"><span class="hs-identifier hs-var">getOpFromState</span></a></span><span> </span><span class="annot"><span class="annottext">State SPitch
</span><a href="#local-6989586621679510024"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-492"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Leftmost (Split SPitch) Freeze (Spread SPitch))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- Initial state</span><span>
</span><span id="line-493"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679510023"><span class="annot"><span class="annottext">Leftmost (Split SPitch) Freeze (Spread SPitch)
</span><a href="#local-6989586621679510023"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-494"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ExceptT String IO ()
</span><a href="Heuristics.html#log"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Prev State: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe (State SPitch)
</span><a href="#local-6989586621679510025"><span class="hs-identifier hs-var">prevState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ExceptT String IO ()
</span><a href="Heuristics.html#log"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Next State: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">State SPitch
</span><a href="#local-6989586621679510024"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-496"></span><span>      </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Leftmost (Split SPitch) Freeze (Spread SPitch)
</span><a href="#local-6989586621679510023"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-497"></span><span>      </span><span class="hs-comment">-- Freezing</span><span>
</span><span id="line-498"></span><span>        </span><span class="annot"><a href="Common.html#LMDouble"><span class="hs-identifier hs-type">LMDouble</span></a></span><span> </span><span id="local-6989586621679510022"><span class="annot"><span class="annottext">LeftmostDouble (Split SPitch) Freeze (Spread SPitch)
</span><a href="#local-6989586621679510022"><span class="hs-identifier hs-var">doubleOp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-499"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679510019"><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510019"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510018"><span class="annot"><span class="annottext">Edges SPitch
</span><a href="#local-6989586621679510018"><span class="hs-identifier hs-var">tl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510017"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510017"><span class="hs-identifier hs-var">sl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510016"><span class="annot"><span class="annottext">Edges SPitch
</span><a href="#local-6989586621679510016"><span class="hs-identifier hs-var">tm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510015"><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510015"><span class="hs-identifier hs-var">sr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ns.
State ns
-&gt; (StartStop (SliceWrapped (Notes ns)), Edges ns,
    SliceWrapped (Notes ns), Edges ns,
    StartStop (SliceWrapped (Notes ns)))
</span><a href="#local-6989586621679510014"><span class="hs-identifier hs-var">getParentDouble</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe (State SPitch)
</span><a href="#local-6989586621679510025"><span class="hs-identifier hs-var">prevState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-500"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LeftmostDouble (Split SPitch) Freeze (Spread SPitch)
</span><a href="#local-6989586621679510022"><span class="hs-identifier hs-var">doubleOp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-501"></span><span>              </span><span class="annot"><a href="Common.html#LMDoubleFreezeLeft"><span class="hs-identifier hs-type">LMDoubleFreezeLeft</span></a></span><span> </span><span id="local-6989586621679510013"><span class="annot"><span class="annottext">Freeze
</span><a href="#local-6989586621679510013"><span class="hs-identifier hs-var">freezeOp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>
</span><span id="line-502"></span><span>              </span><span class="annot"><a href="Common.html#LMDoubleSpread"><span class="hs-identifier hs-type">LMDoubleSpread</span></a></span><span> </span><span id="local-6989586621679510012"><span class="annot"><span class="annottext">Spread SPitch
</span><a href="#local-6989586621679510012"><span class="hs-identifier hs-var">spreadOp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-503"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679510011"><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510011"><span class="hs-identifier hs-var">ms'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510010"><span class="annot"><span class="annottext">Edges SPitch
</span><a href="#local-6989586621679510010"><span class="hs-identifier hs-var">topl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510009"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510009"><span class="hs-identifier hs-var">stop</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510008"><span class="annot"><span class="annottext">Edges SPitch
</span><a href="#local-6989586621679510008"><span class="hs-identifier hs-var">topr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679510007"><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510007"><span class="hs-identifier hs-var">send</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ns.
State ns
-&gt; (StartStop (SliceWrapped (Notes ns)), Edges ns,
    SliceWrapped (Notes ns), Edges ns,
    StartStop (SliceWrapped (Notes ns)))
</span><a href="#local-6989586621679510014"><span class="hs-identifier hs-var">getParentDouble</span></a></span><span> </span><span class="annot"><span class="annottext">State SPitch
</span><a href="#local-6989586621679510024"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-504"></span><span>                    </span><span id="local-6989586621679510006"><span class="annot"><span class="annottext">slcL :: Maybe (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510006"><span class="hs-identifier hs-var hs-var">slcL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510017"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-505"></span><span>                             </span><span id="local-6989586621679510005"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510005"><span class="hs-identifier hs-var">sliceWrapped</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510005"><span class="hs-identifier hs-var">sliceWrapped</span></a></span><span>
</span><span id="line-506"></span><span>                    </span><span id="local-6989586621679510002"><span class="annot"><span class="annottext">slcR :: Maybe (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510002"><span class="hs-identifier hs-var hs-var">slcR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510015"><span class="hs-identifier hs-var">sr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-507"></span><span>                             </span><span class="annot"><a href="Common.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621679510001"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510001"><span class="hs-identifier hs-var">sliceWrapped</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510001"><span class="hs-identifier hs-var">sliceWrapped</span></a></span><span>
</span><span id="line-508"></span><span>                             </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nothing inside&quot;</span></span><span>
</span><span id="line-509"></span><span>                  </span><span class="hs-keyword">in</span><span>
</span><span id="line-510"></span><span>                  </span><span class="annot"><span class="annottext">forall {a} {n} {p} {p} {p}. Num a =&gt; Spread n -&gt; p -&gt; p -&gt; p -&gt; a
</span><a href="#local-6989586621679510000"><span class="hs-identifier hs-var">scoreSpread</span></a></span><span> </span><span class="annot"><span class="annottext">Spread SPitch
</span><a href="#local-6989586621679510012"><span class="hs-identifier hs-var">spreadOp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510006"><span class="hs-identifier hs-var">slcL</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679510009"><span class="hs-identifier hs-var">stop</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679510002"><span class="hs-identifier hs-var">slcR</span></a></span><span>
</span><span id="line-511"></span><span>              </span><span class="annot"><a href="Common.html#LMDoubleSplitLeft"><span class="hs-identifier hs-type">LMDoubleSplitLeft</span></a></span><span> </span><span id="local-6989586621679509999"><span class="annot"><span class="annottext">Split SPitch
</span><a href="#local-6989586621679509999"><span class="hs-identifier hs-var">splitOp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-512"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679509998"><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679509998"><span class="hs-identifier hs-var">ms'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679509997"><span class="annot"><span class="annottext">Edges SPitch
</span><a href="#local-6989586621679509997"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679509996"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679509996"><span class="hs-identifier hs-var">sr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679509995"><span class="annot"><span class="annottext">Edges SPitch
</span><a href="#local-6989586621679509995"><span class="hs-identifier hs-var">tr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679509994"><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679509994"><span class="hs-identifier hs-var">send</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ns.
State ns
-&gt; (StartStop (SliceWrapped (Notes ns)), Edges ns,
    SliceWrapped (Notes ns), Edges ns,
    StartStop (SliceWrapped (Notes ns)))
</span><a href="#local-6989586621679510014"><span class="hs-identifier hs-var">getParentDouble</span></a></span><span> </span><span class="annot"><span class="annottext">State SPitch
</span><a href="#local-6989586621679510024"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-513"></span><span>                    </span><span id="local-6989586621679509991"><span class="annot"><span class="annottext">slcL :: Maybe (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679509991"><span class="hs-identifier hs-var hs-var">slcL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679509998"><span class="hs-identifier hs-var">ms'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-514"></span><span>                             </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-515"></span><span>                             </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="Common.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Stop on left&quot;</span></span><span>
</span><span id="line-516"></span><span>                             </span><span class="annot"><a href="Common.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621679509990"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679509990"><span class="hs-identifier hs-var">sliceWrapped</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679509990"><span class="hs-identifier hs-var">sliceWrapped</span></a></span><span>
</span><span id="line-517"></span><span>                    </span><span id="local-6989586621679509989"><span class="annot"><span class="annottext">slcR :: Maybe (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679509989"><span class="hs-identifier hs-var hs-var">slcR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679509996"><span class="hs-identifier hs-var">sr'</span></a></span><span>
</span><span id="line-518"></span><span>                  </span><span class="hs-keyword">in</span><span>
</span><span id="line-519"></span><span>                  </span><span class="annot"><span class="annottext">forall {a} {ns} {p} {ns}.
Num a =&gt;
Split SPitch
-&gt; Maybe (SliceWrapped ns) -&gt; p -&gt; Maybe (SliceWrapped ns) -&gt; a
</span><a href="#local-6989586621679509988"><span class="hs-identifier hs-var">scoreSplit</span></a></span><span> </span><span class="annot"><span class="annottext">Split SPitch
</span><a href="#local-6989586621679509999"><span class="hs-identifier hs-var">splitOp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679509991"><span class="hs-identifier hs-var">slcL</span></a></span><span> </span><span class="annot"><span class="annottext">Edges SPitch
</span><a href="#local-6989586621679509997"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679509989"><span class="hs-identifier hs-var">slcR</span></a></span><span>
</span><span id="line-520"></span><span>              </span><span class="annot"><a href="Common.html#LMDoubleSplitRight"><span class="hs-identifier hs-type">LMDoubleSplitRight</span></a></span><span>
</span><span id="line-521"></span><span>                </span><span id="local-6989586621679509987"><span class="annot"><span class="annottext">Split SPitch
</span><a href="#local-6989586621679509987"><span class="hs-identifier hs-var">splitOp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-522"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679509986"><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679509986"><span class="hs-identifier hs-var">ms'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679509985"><span class="annot"><span class="annottext">Edges SPitch
</span><a href="#local-6989586621679509985"><span class="hs-identifier hs-var">tl'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679509984"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679509984"><span class="hs-identifier hs-var">sl'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679509983"><span class="annot"><span class="annottext">Edges SPitch
</span><a href="#local-6989586621679509983"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679509982"><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679509982"><span class="hs-identifier hs-var">send</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ns.
State ns
-&gt; (StartStop (SliceWrapped (Notes ns)), Edges ns,
    SliceWrapped (Notes ns), Edges ns,
    StartStop (SliceWrapped (Notes ns)))
</span><a href="#local-6989586621679510014"><span class="hs-identifier hs-var">getParentDouble</span></a></span><span> </span><span class="annot"><span class="annottext">State SPitch
</span><a href="#local-6989586621679510024"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-523"></span><span>                    </span><span id="local-6989586621679509981"><span class="annot"><span class="annottext">slcL :: Maybe (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679509981"><span class="hs-identifier hs-var hs-var">slcL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679509984"><span class="hs-identifier hs-var">sl'</span></a></span><span>
</span><span id="line-524"></span><span>                    </span><span id="local-6989586621679509978"><span class="annot"><span class="annottext">slcR :: Maybe (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679509978"><span class="hs-identifier hs-var hs-var">slcR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679509982"><span class="hs-identifier hs-var">send</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-525"></span><span>                             </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="Common.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-526"></span><span>                             </span><span class="annot"><span class="annottext">StartStop (SliceWrapped (Notes SPitch))
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Start at on the right&quot;</span></span><span>
</span><span id="line-527"></span><span>                             </span><span class="annot"><a href="Common.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621679509977"><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679509977"><span class="hs-identifier hs-var">sliceWrapped</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes SPitch)
</span><a href="#local-6989586621679509977"><span class="hs-identifier hs-var">sliceWrapped</span></a></span><span>
</span><span id="line-528"></span><span>                  </span><span class="hs-keyword">in</span><span>
</span><span id="line-529"></span><span>                  </span><span class="annot"><span class="annottext">forall {a} {ns} {p} {ns}.
Num a =&gt;
Split SPitch
-&gt; Maybe (SliceWrapped ns) -&gt; p -&gt; Maybe (SliceWrapped ns) -&gt; a
</span><a href="#local-6989586621679509988"><span class="hs-identifier hs-var">scoreSplit</span></a></span><span> </span><span class="annot"><span class="annottext">Split SPitch
</span><a href="#local-6989586621679509987"><span class="hs-identifier hs-var">splitOp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679509981"><span class="hs-identifier hs-var">slcL</span></a></span><span> </span><span class="annot"><span class="annottext">Edges SPitch
</span><a href="#local-6989586621679509983"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SliceWrapped (Notes SPitch))
</span><a href="#local-6989586621679509978"><span class="hs-identifier hs-var">slcR</span></a></span><span>
</span><span id="line-530"></span><span>        </span><span class="annot"><a href="Common.html#LMSingle"><span class="hs-identifier hs-type">LMSingle</span></a></span><span> </span><span id="local-6989586621679509976"><span class="annot"><span class="annottext">LeftmostSingle (Split SPitch) Freeze
</span><a href="#local-6989586621679509976"><span class="hs-identifier hs-var">singleOp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-531"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LeftmostSingle (Split SPitch) Freeze
</span><a href="#local-6989586621679509976"><span class="hs-identifier hs-var">singleOp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-532"></span><span>            </span><span class="annot"><a href="Common.html#LMSingleFreeze"><span class="hs-identifier hs-type">LMSingleFreeze</span></a></span><span> </span><span id="local-6989586621679509975"><span class="annot"><span class="annottext">Freeze
</span><a href="#local-6989586621679509975"><span class="hs-identifier hs-var">freezeOp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>
</span><span id="line-533"></span><span>            </span><span class="annot"><a href="Common.html#LMSingleSplit"><span class="hs-identifier hs-type">LMSingleSplit</span></a></span><span> </span><span id="local-6989586621679509974"><span class="annot"><span class="annottext">Split SPitch
</span><a href="#local-6989586621679509974"><span class="hs-identifier hs-var">splitOp</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">10</span></span><span>
</span><span id="line-534"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span class="hs-comment">-- slcL :: Maybe (SliceWrapped (Notes SPitch))</span><span>
</span><span id="line-537"></span><span>    </span><span class="hs-comment">-- scoreSplit :: Split n -&gt; Maybe (SliceWrapped (Notes SPitch)) -&gt;  -&gt; Maybe (SliceWrapped (Notes SPitch)) -&gt; a1</span><span>
</span><span id="line-538"></span><span>    </span><span id="local-6989586621679509988"><span class="annot"><span class="annottext">scoreSplit :: Split SPitch
-&gt; Maybe (SliceWrapped ns) -&gt; p -&gt; Maybe (SliceWrapped ns) -&gt; a
</span><a href="#local-6989586621679509988"><span class="hs-identifier hs-var hs-var">scoreSplit</span></a></span></span><span>
</span><span id="line-539"></span><span>      </span><span id="local-6989586621679509971"><span class="annot"><span class="annottext">splitOp :: Split SPitch
</span><a href="#local-6989586621679509971"><span class="hs-identifier hs-var">splitOp</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PVGrammar.html#SplitOp"><span class="hs-identifier hs-type">SplitOp</span></a></span><span> </span><span id="local-6989586621679509970"><span class="annot"><span class="annottext">Map (Edge SPitch) [(SPitch, DoubleOrnament)]
</span><a href="#local-6989586621679509970"><span class="hs-identifier hs-var">splitReg</span></a></span></span><span> </span><span id="local-6989586621679509969"><span class="annot"><span class="annottext">Map (InnerEdge SPitch) [(SPitch, PassingOrnament)]
</span><a href="#local-6989586621679509969"><span class="hs-identifier hs-var">splitPass</span></a></span></span><span> </span><span id="local-6989586621679509968"><span class="annot"><span class="annottext">Map SPitch [(SPitch, RightOrnament)]
</span><a href="#local-6989586621679509968"><span class="hs-identifier hs-var">fromLeft</span></a></span></span><span> </span><span id="local-6989586621679509967"><span class="annot"><span class="annottext">Map SPitch [(SPitch, LeftOrnament)]
</span><a href="#local-6989586621679509967"><span class="hs-identifier hs-var">fromRight</span></a></span></span><span> </span><span id="local-6989586621679509966"><span class="annot"><span class="annottext">HashSet (Edge SPitch)
</span><a href="#local-6989586621679509966"><span class="hs-identifier hs-var">keepLeft</span></a></span></span><span> </span><span id="local-6989586621679509965"><span class="annot"><span class="annottext">HashSet (Edge SPitch)
</span><a href="#local-6989586621679509965"><span class="hs-identifier hs-var">keepRight</span></a></span></span><span> </span><span id="local-6989586621679509964"><span class="annot"><span class="annottext">MultiSet (InnerEdge SPitch)
</span><a href="#local-6989586621679509964"><span class="hs-identifier hs-var">passLeft</span></a></span></span><span> </span><span id="local-6989586621679509963"><span class="annot"><span class="annottext">MultiSet (InnerEdge SPitch)
</span><a href="#local-6989586621679509963"><span class="hs-identifier hs-var">passRight</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>      </span><span id="local-6989586621679509962"><span class="annot"><span class="annottext">Maybe (SliceWrapped ns)
</span><a href="#local-6989586621679509962"><span class="hs-identifier hs-var">slcL</span></a></span></span><span>
</span><span id="line-541"></span><span>      </span><span id="local-6989586621679509961"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679509961"><span class="hs-identifier hs-var">top</span></a></span></span><span>
</span><span id="line-542"></span><span>      </span><span id="local-6989586621679509960"><span class="annot"><span class="annottext">Maybe (SliceWrapped ns)
</span><a href="#local-6989586621679509960"><span class="hs-identifier hs-var">slcR</span></a></span></span><span>
</span><span id="line-543"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679509959"><span class="annot"><span class="annottext">probsRS :: [Double]
</span><a href="#local-6989586621679509959"><span class="hs-identifier hs-var hs-var">probsRS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(SPitch, (SPitch, RightOrnament)) -&gt; Double
</span><a href="#local-6989586621679509958"><span class="hs-identifier hs-var">scoreFromLeft</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Map a [b] -&gt; [(a, b)]
</span><a href="#local-6989586621679509957"><span class="hs-identifier hs-var">allEdges</span></a></span><span> </span><span class="annot"><span class="annottext">Map SPitch [(SPitch, RightOrnament)]
</span><a href="#local-6989586621679509968"><span class="hs-identifier hs-var">fromLeft</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span>              </span><span id="local-6989586621679509956"><span class="annot"><span class="annottext">probsLS :: [Double]
</span><a href="#local-6989586621679509956"><span class="hs-identifier hs-var hs-var">probsLS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(SPitch, (SPitch, LeftOrnament)) -&gt; Double
</span><a href="#local-6989586621679509955"><span class="hs-identifier hs-var">scoreFromRight</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Map a [b] -&gt; [(a, b)]
</span><a href="#local-6989586621679509957"><span class="hs-identifier hs-var">allEdges</span></a></span><span> </span><span class="annot"><span class="annottext">Map SPitch [(SPitch, LeftOrnament)]
</span><a href="#local-6989586621679509967"><span class="hs-identifier hs-var">fromRight</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>              </span><span id="local-6989586621679509953"><span class="annot"><span class="annottext">probsRegs :: [Double]
</span><a href="#local-6989586621679509953"><span class="hs-identifier hs-var hs-var">probsRegs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall {a} {a} {b} {a} {b}. Num a =&gt; ((a, b), (a, b)) -&gt; a
</span><a href="#local-6989586621679509952"><span class="hs-identifier hs-var">scoreReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Map a [b] -&gt; [(a, b)]
</span><a href="#local-6989586621679509951"><span class="hs-identifier hs-var">allRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Edge SPitch) [(SPitch, DoubleOrnament)]
</span><a href="#local-6989586621679509970"><span class="hs-identifier hs-var">splitReg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span>              </span><span id="local-6989586621679509949"><span class="annot"><span class="annottext">probsPassings :: [Double]
</span><a href="#local-6989586621679509949"><span class="hs-identifier hs-var hs-var">probsPassings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall {a} {a} {b} {a} {b}. Num a =&gt; ((a, b), (a, b)) -&gt; a
</span><a href="#local-6989586621679509948"><span class="hs-identifier hs-var">scorePass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Map a [b] -&gt; [(a, b)]
</span><a href="#local-6989586621679509947"><span class="hs-identifier hs-var">allPassings</span></a></span><span> </span><span class="annot"><span class="annottext">Map (InnerEdge SPitch) [(SPitch, PassingOrnament)]
</span><a href="#local-6989586621679509969"><span class="hs-identifier hs-var">splitPass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>              </span><span class="hs-comment">-- probsPassLeft = map scorePassLeft (passLeft)</span><span>
</span><span id="line-548"></span><span>              </span><span id="local-6989586621679509943"><span class="annot"><span class="annottext">aggregatePros :: [Double]
</span><a href="#local-6989586621679509943"><span class="hs-identifier hs-var hs-var">aggregatePros</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679509959"><span class="hs-identifier hs-var">probsRS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679509956"><span class="hs-identifier hs-var">probsLS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679509953"><span class="hs-identifier hs-var">probsRegs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679509949"><span class="hs-identifier hs-var">probsPassings</span></a></span><span>
</span><span id="line-549"></span><span>           </span><span class="hs-keyword">in</span><span>
</span><span id="line-550"></span><span>             </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">4</span></span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-554"></span><span>        </span><span id="local-6989586621679509952"><span class="annot"><span class="annottext">scoreReg :: ((a, b), (a, b)) -&gt; a
</span><a href="#local-6989586621679509952"><span class="hs-identifier hs-var hs-var">scoreReg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679509940"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679509940"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679509939"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679509939"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679509938"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679509938"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679509937"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679509937"><span class="hs-identifier hs-var">orn</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">10</span></span><span>
</span><span id="line-555"></span><span>        </span><span id="local-6989586621679509948"><span class="annot"><span class="annottext">scorePass :: ((a, b), (a, b)) -&gt; a
</span><a href="#local-6989586621679509948"><span class="hs-identifier hs-var hs-var">scorePass</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679509934"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679509934"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679509933"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679509933"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679509932"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679509932"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679509931"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679509931"><span class="hs-identifier hs-var">orn</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">10</span></span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span>        </span><span id="local-6989586621679509955"><span class="annot"><span class="annottext">scoreFromRight :: (SPitch, (SPitch, LeftOrnament)) -&gt; Double
</span><a href="#local-6989586621679509955"><span class="hs-identifier hs-var hs-var">scoreFromRight</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679509926"><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679509926"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679509925"><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679509925"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679509924"><span class="annot"><span class="annottext">LeftOrnament
</span><a href="#local-6989586621679509924"><span class="hs-identifier hs-var">orn</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-558"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (SliceWrapped ns)
</span><a href="#local-6989586621679509960"><span class="hs-identifier hs-var">slcR</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span>
</span><span id="line-559"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span id="local-6989586621679509923"><span class="annot"><span class="annottext">ns
</span><a href="#local-6989586621679509923"><span class="hs-identifier hs-var">slc</span></a></span></span><span> </span><span id="local-6989586621679509922"><span class="annot"><span class="annottext">ChordLabel
</span><a href="#local-6989586621679509922"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621679509921"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679509921"><span class="hs-identifier hs-var">prob</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LeftOrnament
</span><a href="#local-6989586621679509924"><span class="hs-identifier hs-var">orn</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span>
</span><span id="line-560"></span><span>              </span><span class="annot"><span class="annottext">LeftOrnament
</span><a href="PVGrammar.html#LeftNeighbor"><span class="hs-identifier hs-var">LeftNeighbor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChordLabel -&gt; SPitch -&gt; Double
</span><a href="Harmony.html#ornamentLogLikelihood"><span class="hs-identifier hs-var">ornamentLogLikelihood</span></a></span><span> </span><span class="annot"><span class="annottext">ChordLabel
</span><a href="#local-6989586621679509922"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679509925"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ChordLabel -&gt; SPitch -&gt; Double
</span><a href="Harmony.html#chordToneLogLikelihood"><span class="hs-identifier hs-var">chordToneLogLikelihood</span></a></span><span> </span><span class="annot"><span class="annottext">ChordLabel
</span><a href="#local-6989586621679509922"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679509926"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-561"></span><span>              </span><span class="annot"><span class="annottext">LeftOrnament
</span><a href="PVGrammar.html#LeftRepeat"><span class="hs-identifier hs-var">LeftRepeat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">ChordLabel -&gt; SPitch -&gt; Double
</span><a href="Harmony.html#chordToneLogLikelihood"><span class="hs-identifier hs-var">chordToneLogLikelihood</span></a></span><span> </span><span class="annot"><span class="annottext">ChordLabel
</span><a href="#local-6989586621679509922"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679509925"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-562"></span><span>            </span><span class="annot"><span class="annottext">Maybe (SliceWrapped ns)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1000</span></span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span>        </span><span id="local-6989586621679509958"><span class="annot"><span class="annottext">scoreFromLeft :: (SPitch, (SPitch, RightOrnament)) -&gt; Double
</span><a href="#local-6989586621679509958"><span class="hs-identifier hs-var hs-var">scoreFromLeft</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679509911"><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679509911"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679509910"><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679509910"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679509909"><span class="annot"><span class="annottext">RightOrnament
</span><a href="#local-6989586621679509909"><span class="hs-identifier hs-var">orn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-565"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (SliceWrapped ns)
</span><a href="#local-6989586621679509962"><span class="hs-identifier hs-var">slcL</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span>
</span><span id="line-566"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span id="local-6989586621679509908"><span class="annot"><span class="annottext">ns
</span><a href="#local-6989586621679509908"><span class="hs-identifier hs-var">slc</span></a></span></span><span> </span><span id="local-6989586621679509907"><span class="annot"><span class="annottext">ChordLabel
</span><a href="#local-6989586621679509907"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621679509906"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679509906"><span class="hs-identifier hs-var">prob</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RightOrnament
</span><a href="#local-6989586621679509909"><span class="hs-identifier hs-var">orn</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span>
</span><span id="line-567"></span><span>              </span><span class="annot"><span class="annottext">RightOrnament
</span><a href="PVGrammar.html#RightNeighbor"><span class="hs-identifier hs-var">RightNeighbor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChordLabel -&gt; SPitch -&gt; Double
</span><a href="Harmony.html#ornamentLogLikelihood"><span class="hs-identifier hs-var">ornamentLogLikelihood</span></a></span><span> </span><span class="annot"><span class="annottext">ChordLabel
</span><a href="#local-6989586621679509907"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679509910"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ChordLabel -&gt; SPitch -&gt; Double
</span><a href="Harmony.html#chordToneLogLikelihood"><span class="hs-identifier hs-var">chordToneLogLikelihood</span></a></span><span> </span><span class="annot"><span class="annottext">ChordLabel
</span><a href="#local-6989586621679509907"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679509911"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-568"></span><span>              </span><span class="annot"><span class="annottext">RightOrnament
</span><a href="PVGrammar.html#RightRepeat"><span class="hs-identifier hs-var">RightRepeat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">ChordLabel -&gt; SPitch -&gt; Double
</span><a href="Harmony.html#chordToneLogLikelihood"><span class="hs-identifier hs-var">chordToneLogLikelihood</span></a></span><span> </span><span class="annot"><span class="annottext">ChordLabel
</span><a href="#local-6989586621679509907"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">SPitch
</span><a href="#local-6989586621679509910"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-569"></span><span>            </span><span class="annot"><span class="annottext">Maybe (SliceWrapped ns)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1000</span></span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span>        </span><span class="hs-comment">-- scorePassLeft (x,y) = 10</span><span>
</span><span id="line-572"></span><span>        </span><span class="hs-comment">-- scorePassRight (x,y) = 10</span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span>       </span><span class="hs-comment">--  scoreRightOrnament</span><span>
</span><span id="line-575"></span><span>       </span><span class="hs-comment">--    :: Maybe (ChordLabel, Double)</span><span>
</span><span id="line-576"></span><span>       </span><span class="hs-comment">--    -&gt; (SPitch, (SPitch, RightOrnament))</span><span>
</span><span id="line-577"></span><span>       </span><span class="hs-comment">--    -&gt; ExceptT String IO Double</span><span>
</span><span id="line-578"></span><span>       </span><span class="hs-comment">--  scoreRightOrnament Nothing (n, (x, orn)) = throwError &quot;Right Ornament with no parent&quot;</span><span>
</span><span id="line-579"></span><span>       </span><span class="hs-comment">--  scoreRightOrnament (Just (lbl@(ChordLabel chordLbl root), prob)) (n, (x, orn)) = do</span><span>
</span><span id="line-580"></span><span>       </span><span class="hs-comment">--    log $ &quot;Scoring a right ornament: &quot; &lt;&gt; Music.showNotation n &lt;&gt; &quot;&lt;=&quot;&lt;&gt; Music.showNotation x</span><span>
</span><span id="line-581"></span><span>       </span><span class="hs-comment">--    let (n', x') = (transposeNote root n, transposeNote root x)</span><span>
</span><span id="line-582"></span><span>       </span><span class="hs-comment">--     in case orn of</span><span>
</span><span id="line-583"></span><span>       </span><span class="hs-comment">--          RightNeighbor -&gt; do</span><span>
</span><span id="line-584"></span><span>       </span><span class="hs-comment">--            log &quot;Right Neighbor&quot;</span><span>
</span><span id="line-585"></span><span>       </span><span class="hs-comment">--            log $ &quot;LBL: &quot; &lt;&gt; show (Just (lbl, prob))</span><span>
</span><span id="line-586"></span><span>       </span><span class="hs-comment">--            log $ &quot;Chord tone likelihood: &quot; &lt;&gt; show (chordToneLogLikelihood params lbl n')</span><span>
</span><span id="line-587"></span><span>       </span><span class="hs-comment">--            log $ &quot;Ornament tone likelihood: &quot; &lt;&gt; show (ornamentLogLikelihood params lbl x')</span><span>
</span><span id="line-588"></span><span>       </span><span class="hs-comment">--            pure $ chordToneLogLikelihood params lbl n' + ornamentLogLikelihood params lbl x'</span><span>
</span><span id="line-589"></span><span>       </span><span class="hs-comment">--          RightRepeat -&gt; do</span><span>
</span><span id="line-590"></span><span>       </span><span class="hs-comment">--            log &quot;Right Repeat&quot;</span><span>
</span><span id="line-591"></span><span>       </span><span class="hs-comment">--            log $ &quot;LBL: &quot; &lt;&gt; show (Just (lbl, prob))</span><span>
</span><span id="line-592"></span><span>       </span><span class="hs-comment">--            log $ &quot;Chord tone likelihood: &quot; &lt;&gt; show (chordToneLogLikelihood params lbl n')</span><span>
</span><span id="line-593"></span><span>       </span><span class="hs-comment">--            pure $ 2 * chordToneLogLikelihood params lbl n'</span><span>
</span><span id="line-594"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-595"></span><span>       </span><span class="hs-comment">--  scoreLeftOrnament</span><span>
</span><span id="line-596"></span><span>       </span><span class="hs-comment">--    :: Maybe (ChordLabel, Double)</span><span>
</span><span id="line-597"></span><span>       </span><span class="hs-comment">--    -&gt; (SPitch, (SPitch, LeftOrnament))</span><span>
</span><span id="line-598"></span><span>       </span><span class="hs-comment">--    -&gt; ExceptT String IO Double</span><span>
</span><span id="line-599"></span><span>       </span><span class="hs-comment">--  scoreLeftOrnament Nothing (n, (x, orn)) = throwError &quot;Left Ornament with no parent&quot;</span><span>
</span><span id="line-600"></span><span>       </span><span class="hs-comment">--  scoreLeftOrnament (Just (lbl@(ChordLabel&#160;chordType rootNote), prob)) (n, (x, orn)) = do</span><span>
</span><span id="line-601"></span><span>       </span><span class="hs-comment">--    log $ &quot;Scoring a left ornament: &quot; &lt;&gt; Music.showNotation x &lt;&gt; &quot;=&gt;&quot;&lt;&gt; Music.showNotation n</span><span>
</span><span id="line-602"></span><span>       </span><span class="hs-comment">--    let (n', x') = (transposeNote root n, transposeNote root x)</span><span>
</span><span id="line-603"></span><span>       </span><span class="hs-comment">--     in case orn of</span><span>
</span><span id="line-604"></span><span>       </span><span class="hs-comment">--          LeftNeighbor -&gt; do</span><span>
</span><span id="line-605"></span><span>       </span><span class="hs-comment">--            log &quot;Left Neighbor&quot;</span><span>
</span><span id="line-606"></span><span>       </span><span class="hs-comment">--            log $ &quot;LBL: &quot; &lt;&gt; show (Just (lbl, prob))</span><span>
</span><span id="line-607"></span><span>       </span><span class="hs-comment">--            log $ &quot;Chord tone likelihood: &quot; &lt;&gt; show (chordToneLogLikelihood params lbl n')</span><span>
</span><span id="line-608"></span><span>       </span><span class="hs-comment">--            log $ &quot;Ornament tone likelihood: &quot; &lt;&gt; show (ornamentLogLikelihood params lbl x')</span><span>
</span><span id="line-609"></span><span>       </span><span class="hs-comment">--            pure $ chordToneLogLikelihood params lbl n' + ornamentLogLikelihood params lbl x'</span><span>
</span><span id="line-610"></span><span>       </span><span class="hs-comment">--          LeftRepeat -&gt; do</span><span>
</span><span id="line-611"></span><span>       </span><span class="hs-comment">--            log &quot;Left Repeat&quot;</span><span>
</span><span id="line-612"></span><span>       </span><span class="hs-comment">--            log $ &quot;LBL: &quot; &lt;&gt; show (Just (lbl, prob))</span><span>
</span><span id="line-613"></span><span>       </span><span class="hs-comment">--            log $ &quot;Chord tone likelihood: &quot; &lt;&gt; show (chordToneLogLikelihood params lbl n')</span><span>
</span><span id="line-614"></span><span>       </span><span class="hs-comment">--            pure $ 2 * chordToneLogLikelihood params lbl n'</span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span>    </span><span id="local-6989586621679510000"><span class="annot"><span class="annottext">scoreSpread :: Spread n -&gt; p -&gt; p -&gt; p -&gt; a
</span><a href="#local-6989586621679510000"><span class="hs-identifier hs-var hs-var">scoreSpread</span></a></span></span><span>
</span><span id="line-617"></span><span>      </span><span id="local-6989586621679509901"><span class="annot"><span class="annottext">spreadOp :: Spread n
</span><a href="#local-6989586621679509901"><span class="hs-identifier hs-var">spreadOp</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#SpreadOp"><span class="hs-identifier hs-type">SpreadOp</span></a></span><span> </span><span id="local-6989586621679509900"><span class="annot"><span class="annottext">HashMap n SpreadDirection
</span><a href="#local-6989586621679509900"><span class="hs-identifier hs-var">spreads</span></a></span></span><span> </span><span id="local-6989586621679509899"><span class="annot"><span class="annottext">Edges n
</span><a href="#local-6989586621679509899"><span class="hs-identifier hs-var">edge</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>      </span><span id="local-6989586621679509898"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679509898"><span class="hs-identifier hs-var">slcL</span></a></span></span><span>
</span><span id="line-619"></span><span>      </span><span id="local-6989586621679509897"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679509897"><span class="hs-identifier hs-var">slc</span></a></span></span><span>
</span><span id="line-620"></span><span>      </span><span id="local-6989586621679509896"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679509896"><span class="hs-identifier hs-var">slcR</span></a></span></span><span>
</span><span id="line-621"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">10</span></span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span>    </span><span id="local-6989586621679510436"><span class="annot"><a href="#local-6989586621679510014"><span class="hs-identifier hs-type">getParentDouble</span></a></span><span>
</span><span id="line-624"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Heuristics.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510436"><span class="hs-identifier hs-type">ns</span></a></span><span>
</span><span id="line-625"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510436"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">--midslice or start (in open case)</span><span>
</span><span id="line-626"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510436"><span class="hs-identifier hs-type">ns</span></a></span><span>                           </span><span class="hs-comment">-- tl</span><span>
</span><span id="line-627"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510436"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span>             </span><span class="hs-comment">-- sl </span><span>
</span><span id="line-628"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span>  </span><span class="annot"><a href="#local-6989586621679510436"><span class="hs-identifier hs-type">ns</span></a></span><span>                           </span><span class="hs-comment">-- tm</span><span>
</span><span id="line-629"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679510436"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span></span><span class="hs-comment">-- sr or stop (2 transitions only)</span><span>
</span><span id="line-630"></span><span>    </span><span id="local-6989586621679510014"><span class="annot"><span class="annottext">getParentDouble :: forall ns.
State ns
-&gt; (StartStop (SliceWrapped (Notes ns)), Edges ns,
    SliceWrapped (Notes ns), Edges ns,
    StartStop (SliceWrapped (Notes ns)))
</span><a href="#local-6989586621679510014"><span class="hs-identifier hs-var hs-var">getParentDouble</span></a></span></span><span> </span><span id="local-6989586621679509889"><span class="annot"><span class="annottext">State ns
</span><a href="#local-6989586621679509889"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">State ns
</span><a href="#local-6989586621679509889"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-631"></span><span>      </span><span class="annot"><a href="HeuristicParser.html#SSFrozen"><span class="hs-identifier hs-type">SSFrozen</span></a></span><span> </span><span class="annot"><span class="annottext">Path (Maybe [Edge ns], Bool) (SliceWrapped (Notes ns))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal double operation&quot;</span></span><span> </span><span class="hs-comment">-- SSFrozen can only be the frist state.</span><span>
</span><span id="line-632"></span><span>      </span><span class="annot"><a href="HeuristicParser.html#SSOpen"><span class="hs-identifier hs-type">SSOpen</span></a></span><span> </span><span id="local-6989586621679509888"><span class="annot"><span class="annottext">Path (Trans (Edges ns)) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679509888"><span class="hs-identifier hs-var">open</span></a></span></span><span> </span><span id="local-6989586621679509887"><span class="annot"><span class="annottext">[PVLeftmost ns]
</span><a href="#local-6989586621679509887"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-633"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path (Trans (Edges ns)) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679509888"><span class="hs-identifier hs-var">open</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-634"></span><span>          </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span id="local-6989586621679509886"><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509886"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span id="local-6989586621679509885"><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679509885"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span id="local-6989586621679509884"><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509884"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span id="local-6989586621679509883"><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679509883"><span class="hs-identifier hs-var">sm</span></a></span></span><span> </span><span id="local-6989586621679509882"><span class="annot"><span class="annottext">Path (Trans (Edges ns)) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679509882"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509886"><span class="hs-identifier hs-var">tl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679509885"><span class="hs-identifier hs-var">slice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509884"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679509883"><span class="hs-identifier hs-var">sm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- SSOpen only case is a split from  two open transitions.</span><span>
</span><span id="line-635"></span><span>          </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span id="local-6989586621679509881"><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509881"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span id="local-6989586621679509880"><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679509880"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#PathEnd"><span class="hs-identifier hs-type">PathEnd</span></a></span><span> </span><span id="local-6989586621679509879"><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509879"><span class="hs-identifier hs-var">tr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509881"><span class="hs-identifier hs-var">tl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679509880"><span class="hs-identifier hs-var">slice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509879"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-636"></span><span>          </span><span class="annot"><a href="Common.html#PathEnd"><span class="hs-identifier hs-type">PathEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Trans (Edges ns)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;illegal double operation&quot;</span></span><span> </span><span class="hs-comment">-- SSOpen only case is a split from  two open transitions.</span><span>
</span><span id="line-637"></span><span>      </span><span class="annot"><a href="HeuristicParser.html#SSSemiOpen"><span class="hs-identifier hs-type">SSSemiOpen</span></a></span><span> </span><span id="local-6989586621679509878"><span class="annot"><span class="annottext">Path (Maybe [Edge ns], Bool) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679509878"><span class="hs-identifier hs-var">frozen</span></a></span></span><span> </span><span id="local-6989586621679509877"><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679509877"><span class="hs-identifier hs-var">midSlice</span></a></span></span><span> </span><span id="local-6989586621679509876"><span class="annot"><span class="annottext">Path (Trans (Edges ns)) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679509876"><span class="hs-identifier hs-var">open</span></a></span></span><span> </span><span id="local-6989586621679509875"><span class="annot"><span class="annottext">[PVLeftmost ns]
</span><a href="#local-6989586621679509875"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-638"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path (Trans (Edges ns)) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679509876"><span class="hs-identifier hs-var">open</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-comment">-- From two open transitions only</span><span>
</span><span id="line-639"></span><span>          </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span id="local-6989586621679509874"><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509874"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span id="local-6989586621679509873"><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679509873"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span id="local-6989586621679509872"><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509872"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span id="local-6989586621679509871"><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679509871"><span class="hs-identifier hs-var">sm</span></a></span></span><span> </span><span id="local-6989586621679509870"><span class="annot"><span class="annottext">Path (Trans (Edges ns)) (SliceWrapped (Notes ns))
</span><a href="#local-6989586621679509870"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679509877"><span class="hs-identifier hs-var">midSlice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509874"><span class="hs-identifier hs-var">tl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679509873"><span class="hs-identifier hs-var">slice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509872"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679509871"><span class="hs-identifier hs-var">sm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- SSOpen only case is a split from  two open transitions.</span><span>
</span><span id="line-640"></span><span>          </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span id="local-6989586621679509869"><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509869"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span id="local-6989586621679509868"><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679509868"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#PathEnd"><span class="hs-identifier hs-type">PathEnd</span></a></span><span> </span><span id="local-6989586621679509867"><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509867"><span class="hs-identifier hs-var">tr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679509877"><span class="hs-identifier hs-var">midSlice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509869"><span class="hs-identifier hs-var">tl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SliceWrapped (Notes ns)
</span><a href="#local-6989586621679509868"><span class="hs-identifier hs-var">slice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509867"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- SSOpen only case is a split from  two open transitions.</span><span>
</span><span id="line-641"></span><span>          </span><span class="annot"><a href="Common.html#PathEnd"><span class="hs-identifier hs-type">PathEnd</span></a></span><span> </span><span id="local-6989586621679509866"><span class="annot"><span class="annottext">Trans (Edges ns)
</span><a href="#local-6989586621679509866"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal double operation in the SSSemiOpen case&quot;</span></span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span>    </span><span id="local-6989586621679509862"><span id="local-6989586621679509863"><span id="local-6989586621679509864"><span id="local-6989586621679509865"><span class="annot"><a href="#local-6989586621679509861"><span class="hs-identifier hs-type">getParentSingle</span></a></span><span>
</span><span id="line-644"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="HeuristicParser.html#SearchState"><span class="hs-identifier hs-type">SearchState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679509865"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679509864"><span class="hs-identifier hs-type">es'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679509863"><span class="hs-identifier hs-type">ns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679509862"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-645"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HeuristicParser.html#SliceWrapped"><span class="hs-identifier hs-type">SliceWrapped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679509863"><span class="hs-identifier hs-type">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">--midslice or startstop</span><span>
</span><span id="line-646"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679509865"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span><span>                          </span><span class="hs-comment">--tl</span><span>
</span><span id="line-647"></span><span>    </span><span id="local-6989586621679509861"><span class="annot"><span class="annottext">getParentSingle :: forall b es' ns o.
SearchState b es' ns o -&gt; (StartStop (SliceWrapped ns), b)
</span><a href="#local-6989586621679509861"><span class="hs-identifier hs-var hs-var">getParentSingle</span></a></span></span><span> </span><span id="local-6989586621679509854"><span class="annot"><span class="annottext">SearchState b es' ns o
</span><a href="#local-6989586621679509854"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SearchState b es' ns o
</span><a href="#local-6989586621679509854"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-648"></span><span>      </span><span class="annot"><a href="HeuristicParser.html#SSFrozen"><span class="hs-identifier hs-type">SSFrozen</span></a></span><span> </span><span class="annot"><span class="annottext">Path (Maybe es', Bool) (SliceWrapped ns)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal single operation&quot;</span></span><span> </span><span class="hs-comment">-- SSFrozen can only be the frist state.</span><span>
</span><span id="line-649"></span><span>      </span><span class="annot"><a href="HeuristicParser.html#SSOpen"><span class="hs-identifier hs-type">SSOpen</span></a></span><span> </span><span id="local-6989586621679509853"><span class="annot"><span class="annottext">Path (Trans b) (SliceWrapped ns)
</span><a href="#local-6989586621679509853"><span class="hs-identifier hs-var">open</span></a></span></span><span> </span><span id="local-6989586621679509852"><span class="annot"><span class="annottext">[o]
</span><a href="#local-6989586621679509852"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-650"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path (Trans b) (SliceWrapped ns)
</span><a href="#local-6989586621679509853"><span class="hs-identifier hs-var">open</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-651"></span><span>          </span><span class="annot"><a href="Common.html#PathEnd"><span class="hs-identifier hs-type">PathEnd</span></a></span><span> </span><span id="local-6989586621679509851"><span class="annot"><span class="annottext">Trans b
</span><a href="#local-6989586621679509851"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans b
</span><a href="#local-6989586621679509851"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- SSOpen only case is a split from  two open transitions.</span><span>
</span><span id="line-652"></span><span>          </span><span class="annot"><span class="annottext">Path (Trans b) (SliceWrapped ns)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal single &quot;</span></span><span> </span><span class="hs-comment">-- illegal state</span><span>
</span><span id="line-653"></span><span>      </span><span class="annot"><a href="HeuristicParser.html#SSSemiOpen"><span class="hs-identifier hs-type">SSSemiOpen</span></a></span><span> </span><span id="local-6989586621679509850"><span class="annot"><span class="annottext">Path (Maybe es', Bool) (SliceWrapped ns)
</span><a href="#local-6989586621679509850"><span class="hs-identifier hs-var">frozen</span></a></span></span><span> </span><span id="local-6989586621679509849"><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679509849"><span class="hs-identifier hs-var">midSlice</span></a></span></span><span> </span><span id="local-6989586621679509848"><span class="annot"><span class="annottext">Path (Trans b) (SliceWrapped ns)
</span><a href="#local-6989586621679509848"><span class="hs-identifier hs-var">open</span></a></span></span><span> </span><span id="local-6989586621679509847"><span class="annot"><span class="annottext">[o]
</span><a href="#local-6989586621679509847"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-654"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path (Trans b) (SliceWrapped ns)
</span><a href="#local-6989586621679509848"><span class="hs-identifier hs-var">open</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-comment">-- From two open transitions only</span><span>
</span><span id="line-655"></span><span>          </span><span class="annot"><a href="Common.html#PathEnd"><span class="hs-identifier hs-type">PathEnd</span></a></span><span> </span><span id="local-6989586621679509846"><span class="annot"><span class="annottext">Trans b
</span><a href="#local-6989586621679509846"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">SliceWrapped ns
</span><a href="#local-6989586621679509849"><span class="hs-identifier hs-var">midSlice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall es. Trans es -&gt; es
</span><a href="HeuristicParser.html#tContent"><span class="hs-identifier hs-var">tContent</span></a></span><span> </span><span class="annot"><span class="annottext">Trans b
</span><a href="#local-6989586621679509846"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>          </span><span class="annot"><span class="annottext">Path (Trans b) (SliceWrapped ns)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal single&quot;</span></span><span> </span><span class="hs-comment">-- illegal state</span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span>    </span><span id="local-6989586621679510422"><span id="local-6989586621679510423"><span class="annot"><a href="#local-6989586621679509957"><span class="hs-identifier hs-type">allEdges</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679510423"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679510422"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679510423"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679510422"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-659"></span><span>    </span><span id="local-6989586621679509957"><span class="annot"><span class="annottext">allEdges :: forall a b. Map a [b] -&gt; [(a, b)]
</span><a href="#local-6989586621679509957"><span class="hs-identifier hs-var hs-var">allEdges</span></a></span></span><span> </span><span id="local-6989586621679509839"><span class="annot"><span class="annottext">Map a [b]
</span><a href="#local-6989586621679509839"><span class="hs-identifier hs-var">ornamentSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-660"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679509838"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679509838"><span class="hs-identifier hs-var">parent</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679509837"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679509837"><span class="hs-identifier hs-var">children</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">Map a [b]
</span><a href="#local-6989586621679509839"><span class="hs-identifier hs-var">ornamentSet</span></a></span><span>
</span><span id="line-661"></span><span>      </span><span id="local-6989586621679509835"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679509835"><span class="hs-identifier hs-var">child</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679509837"><span class="hs-identifier hs-var">children</span></a></span><span>
</span><span id="line-662"></span><span>      </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679509838"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679509835"><span class="hs-identifier hs-var">child</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span>    </span><span id="local-6989586621679509833"><span id="local-6989586621679509834"><span class="annot"><a href="#local-6989586621679509951"><span class="hs-identifier hs-type">allRegs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679509834"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679509833"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679509834"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679509833"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-665"></span><span>    </span><span id="local-6989586621679509951"><span class="annot"><span class="annottext">allRegs :: forall a b. Map a [b] -&gt; [(a, b)]
</span><a href="#local-6989586621679509951"><span class="hs-identifier hs-var hs-var">allRegs</span></a></span></span><span> </span><span id="local-6989586621679509828"><span class="annot"><span class="annottext">Map a [b]
</span><a href="#local-6989586621679509828"><span class="hs-identifier hs-var">regSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-666"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679509827"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679509827"><span class="hs-identifier hs-var">parent</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679509826"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679509826"><span class="hs-identifier hs-var">children</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">Map a [b]
</span><a href="#local-6989586621679509828"><span class="hs-identifier hs-var">regSet</span></a></span><span>
</span><span id="line-667"></span><span>      </span><span id="local-6989586621679509825"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679509825"><span class="hs-identifier hs-var">child</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679509826"><span class="hs-identifier hs-var">children</span></a></span><span>
</span><span id="line-668"></span><span>      </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679509827"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679509825"><span class="hs-identifier hs-var">child</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span>    </span><span id="local-6989586621679509947"><span class="annot"><span class="annottext">allPassings :: Map a [b] -&gt; [(a, b)]
</span><a href="#local-6989586621679509947"><span class="hs-identifier hs-var hs-var">allPassings</span></a></span></span><span> </span><span id="local-6989586621679509820"><span class="annot"><span class="annottext">Map a [b]
</span><a href="#local-6989586621679509820"><span class="hs-identifier hs-var">ornamentSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-671"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679509819"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679509819"><span class="hs-identifier hs-var">parent</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679509818"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679509818"><span class="hs-identifier hs-var">children</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">Map a [b]
</span><a href="#local-6989586621679509820"><span class="hs-identifier hs-var">ornamentSet</span></a></span><span>
</span><span id="line-672"></span><span>      </span><span id="local-6989586621679509817"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679509817"><span class="hs-identifier hs-var">child</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679509818"><span class="hs-identifier hs-var">children</span></a></span><span>
</span><span id="line-673"></span><span>      </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679509819"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679509817"><span class="hs-identifier hs-var">child</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span>    </span><span id="local-6989586621679509812"><span class="annot"><span class="annottext">allOps :: Map a [b] -&gt; [(a, b)]
</span><a href="#local-6989586621679509812"><span class="hs-identifier hs-var hs-var">allOps</span></a></span></span><span> </span><span id="local-6989586621679509811"><span class="annot"><span class="annottext">Map a [b]
</span><a href="#local-6989586621679509811"><span class="hs-identifier hs-var">opset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-676"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679509810"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679509810"><span class="hs-identifier hs-var">parent</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679509809"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679509809"><span class="hs-identifier hs-var">children</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">Map a [b]
</span><a href="#local-6989586621679509811"><span class="hs-identifier hs-var">opset</span></a></span><span>
</span><span id="line-677"></span><span>      </span><span id="local-6989586621679509808"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679509808"><span class="hs-identifier hs-var">child</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679509809"><span class="hs-identifier hs-var">children</span></a></span><span>
</span><span id="line-678"></span><span>      </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679509810"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679509808"><span class="hs-identifier hs-var">child</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span>    </span><span id="local-6989586621679509804"><span class="annot"><span class="annottext">allInnerEdges :: MultiSet (a, b) -&gt; [(a, b)]
</span><a href="#local-6989586621679509804"><span class="hs-identifier hs-var hs-var">allInnerEdges</span></a></span></span><span> </span><span id="local-6989586621679509803"><span class="annot"><span class="annottext">MultiSet (a, b)
</span><a href="#local-6989586621679509803"><span class="hs-identifier hs-var">opset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-681"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679509802"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679509802"><span class="hs-identifier hs-var">parent</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679509801"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679509801"><span class="hs-identifier hs-var">child</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. MultiSet a -&gt; [a]
</span><a href="Internal.MultiSet.html#toList"><span class="hs-identifier hs-var">MS.toList</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSet (a, b)
</span><a href="#local-6989586621679509803"><span class="hs-identifier hs-var">opset</span></a></span><span>
</span><span id="line-682"></span><span>      </span><span class="annot"><span class="annottext">forall (x :: * -&gt; *) a. PureSyntax x =&gt; a -&gt; x a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679509802"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679509801"><span class="hs-identifier hs-var">child</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-683"></span></pre></body></html>