<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">{- | This module contains functions for visualizing derivations using LaTeX and TikZ.
 These functions are generic over slice and transition contents and are thus somewhat limited.
 For protovoice derivations,
 an alternative to plotting a derivation would be to export an 'Analysis' to JSON
 and view it interactively in the
 [protovoice annotation tool](https://dcmlab.github.io/protovoice-annotation-tool/)
 (not implemented yet).

 Plotting happens in two steps.
 First, a the derivation is &quot;replayed&quot; using a (generic or grammar-specific) &quot;player&quot;
 to construct a 'DerivationGraph',
 which contains all graphical objects and their positions explicitly.
 The 'DerivationGraph' can then be plotted using different backends
 (currently only TikZ, but a diagrams/SVG backed would be useful too).
-}</span><span>
</span><span id="line-18"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Display</span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier">DerivationGraph</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier">DerivSlice</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier">DerivTrans</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Replaying Derivations</span></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#replayDerivation"><span class="hs-identifier">replayDerivation</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#replayDerivation%27"><span class="hs-identifier">replayDerivation'</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#replayDerivationFull"><span class="hs-identifier">replayDerivationFull</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#unfoldDerivation"><span class="hs-identifier">unfoldDerivation</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#unfoldDerivation%27"><span class="hs-identifier">unfoldDerivation'</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Derivation Players</span></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier">DerivationPlayer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#derivationPlayerUnit"><span class="hs-identifier">derivationPlayerUnit</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#derivationPlayerEmpty"><span class="hs-identifier">derivationPlayerEmpty</span></a></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#Empty"><span class="hs-identifier">Empty</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Plotting Derivation Graphs with TikZ</span></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#tikzDerivationGraph"><span class="hs-identifier">tikzDerivationGraph</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#tikzPic"><span class="hs-identifier">tikzPic</span></a></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#tikzStandalone"><span class="hs-identifier">tikzStandalone</span></a></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#writeGraph"><span class="hs-identifier">writeGraph</span></a></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#writeGraphs"><span class="hs-identifier">writeGraphs</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#viewGraph"><span class="hs-identifier">viewGraph</span></a></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#viewGraphs"><span class="hs-identifier">viewGraphs</span></a></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Common.html"><span class="hs-identifier">Common</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mzero</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ST</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.IO</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Process</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">callCommand</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">bimap</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IsString</span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-comment">-- derivation graphs</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- =================</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">-- | A slice together with a depth and an ID</span><span>
</span><span id="line-67"></span><span class="hs-keyword">data</span><span> </span><span id="DerivSlice"><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-var">DerivSlice</span></a></span></span><span> </span><span id="local-6989586621679465414"><span class="annot"><a href="#local-6989586621679465414"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DerivSlice"><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-var">DerivSlice</span></a></span></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="dslDepth"><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslDepth"><span class="hs-identifier hs-var hs-var">dslDepth</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dslId"><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var hs-var">dslId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dslContent"><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; StartStop slc
</span><a href="Display.html#dslContent"><span class="hs-identifier hs-var hs-var">dslContent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465414"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679464995"><span id="local-6989586621679465002"><span class="annot"><span class="annottext">DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
forall slc. Eq slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
$c/= :: forall slc. Eq slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
== :: DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
$c== :: forall slc. Eq slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464967"><span id="local-6989586621679464969"><span id="local-6989586621679464972"><span id="local-6989586621679464975"><span id="local-6989586621679464978"><span id="local-6989586621679464983"><span id="local-6989586621679464990"><span class="annot"><span class="annottext">DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
DerivSlice slc -&gt; DerivSlice slc -&gt; Ordering
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall {slc}. Ord slc =&gt; Eq (DerivSlice slc)
forall slc. Ord slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
forall slc. Ord slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Ordering
forall slc.
Ord slc =&gt;
DerivSlice slc -&gt; DerivSlice slc -&gt; DerivSlice slc
min :: DerivSlice slc -&gt; DerivSlice slc -&gt; DerivSlice slc
$cmin :: forall slc.
Ord slc =&gt;
DerivSlice slc -&gt; DerivSlice slc -&gt; DerivSlice slc
max :: DerivSlice slc -&gt; DerivSlice slc -&gt; DerivSlice slc
$cmax :: forall slc.
Ord slc =&gt;
DerivSlice slc -&gt; DerivSlice slc -&gt; DerivSlice slc
&gt;= :: DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
$c&gt;= :: forall slc. Ord slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
&gt; :: DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
$c&gt; :: forall slc. Ord slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
&lt;= :: DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
$c&lt;= :: forall slc. Ord slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
&lt; :: DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
$c&lt; :: forall slc. Ord slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
compare :: DerivSlice slc -&gt; DerivSlice slc -&gt; Ordering
$ccompare :: forall slc. Ord slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464954"><span id="local-6989586621679464956"><span id="local-6989586621679464964"><span class="annot"><span class="annottext">Int -&gt; DerivSlice slc -&gt; ShowS
forall slc. Show slc =&gt; Int -&gt; DerivSlice slc -&gt; ShowS
forall slc. Show slc =&gt; [DerivSlice slc] -&gt; ShowS
forall slc. Show slc =&gt; DerivSlice slc -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [DerivSlice slc] -&gt; ShowS
$cshowList :: forall slc. Show slc =&gt; [DerivSlice slc] -&gt; ShowS
show :: DerivSlice slc -&gt; String
$cshow :: forall slc. Show slc =&gt; DerivSlice slc -&gt; String
showsPrec :: Int -&gt; DerivSlice slc -&gt; ShowS
$cshowsPrec :: forall slc. Show slc =&gt; Int -&gt; DerivSlice slc -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- | A transition between two 'DerivSlice's.</span><span>
</span><span id="line-75"></span><span class="hs-keyword">type</span><span> </span><span id="DerivTrans"><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier hs-var">DerivTrans</span></a></span></span><span> </span><span id="local-6989586621679464952"><span class="annot"><a href="#local-6989586621679464952"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679464951"><span class="annot"><a href="#local-6989586621679464951"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464952"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679464951"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464952"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">{- | A derivation graph.
 Contains the graphical objects of a derivation plot
 as well as intermediate information that is used during a replay.
-}</span><span>
</span><span id="line-81"></span><span class="hs-keyword">data</span><span> </span><span id="DerivationGraph"><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-var">DerivationGraph</span></a></span></span><span> </span><span id="local-6989586621679465402"><span class="annot"><a href="#local-6989586621679465402"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679465401"><span class="annot"><a href="#local-6989586621679465401"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DGraph"><span class="annot"><a href="Display.html#DGraph"><span class="hs-identifier hs-var">DGraph</span></a></span></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="dgNextId"><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; Int
</span><a href="Display.html#dgNextId"><span class="hs-identifier hs-var hs-var">dgNextId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-comment">-- ^ a counter for generating new IDs (used during replay)</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dgSlices"><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; Set (DerivSlice slc)
</span><a href="Display.html#dgSlices"><span class="hs-identifier hs-var hs-var">dgSlices</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465402"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-comment">-- ^ the positioned slices of the derivation graph</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dgTransitions"><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; Set (DerivTrans slc tr)
</span><a href="Display.html#dgTransitions"><span class="hs-identifier hs-var hs-var">dgTransitions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier hs-type">DerivTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465402"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465401"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-comment">-- ^ the positioned transitionn in the derivation graph</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dgHoriEdges"><span class="annot"><span class="annottext">forall slc tr.
DerivationGraph slc tr -&gt; Set (DerivSlice slc, DerivSlice slc)
</span><a href="Display.html#dgHoriEdges"><span class="hs-identifier hs-var hs-var">dgHoriEdges</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465402"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465402"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-comment">-- ^ the &quot;horizontalization&quot; edges</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-comment">-- (connecting the parent slice of a spread to its children)</span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dgOpen"><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; [DerivTrans slc tr]
</span><a href="Display.html#dgOpen"><span class="hs-identifier hs-var hs-var">dgOpen</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier hs-type">DerivTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465402"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465401"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-comment">-- ^ the open transitions of the current surface</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dgFrozen"><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; [DerivTrans slc tr]
</span><a href="Display.html#dgFrozen"><span class="hs-identifier hs-var hs-var">dgFrozen</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier hs-type">DerivTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465402"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465401"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-comment">-- ^ the frozen transitions of the current surface in reverse order</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dgRoot"><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; [DerivTrans slc tr]
</span><a href="Display.html#dgRoot"><span class="hs-identifier hs-var hs-var">dgRoot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier hs-type">DerivTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465402"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465401"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-comment">-- ^ the root transitions</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679464927"><span id="local-6989586621679464941"><span class="annot"><span class="annottext">DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall slc tr.
(Eq slc, Eq tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
/= :: DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
$c/= :: forall slc tr.
(Eq slc, Eq tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
== :: DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
$c== :: forall slc tr.
(Eq slc, Eq tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464884"><span id="local-6989586621679464886"><span id="local-6989586621679464889"><span id="local-6989586621679464892"><span id="local-6989586621679464895"><span id="local-6989586621679464907"><span id="local-6989586621679464921"><span class="annot"><span class="annottext">DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Ordering
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall {slc} {tr}. (Ord slc, Ord tr) =&gt; Eq (DerivationGraph slc tr)
forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Ordering
forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr
-&gt; DerivationGraph slc tr -&gt; DerivationGraph slc tr
min :: DerivationGraph slc tr
-&gt; DerivationGraph slc tr -&gt; DerivationGraph slc tr
$cmin :: forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr
-&gt; DerivationGraph slc tr -&gt; DerivationGraph slc tr
max :: DerivationGraph slc tr
-&gt; DerivationGraph slc tr -&gt; DerivationGraph slc tr
$cmax :: forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr
-&gt; DerivationGraph slc tr -&gt; DerivationGraph slc tr
&gt;= :: DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
$c&gt;= :: forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
&gt; :: DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
$c&gt; :: forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
&lt;= :: DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
$c&lt;= :: forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
&lt; :: DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
$c&lt; :: forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
compare :: DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Ordering
$ccompare :: forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464863"><span id="local-6989586621679464865"><span id="local-6989586621679464880"><span class="annot"><span class="annottext">Int -&gt; DerivationGraph slc tr -&gt; ShowS
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall slc tr.
(Show slc, Show tr) =&gt;
Int -&gt; DerivationGraph slc tr -&gt; ShowS
forall slc tr.
(Show slc, Show tr) =&gt;
[DerivationGraph slc tr] -&gt; ShowS
forall slc tr.
(Show slc, Show tr) =&gt;
DerivationGraph slc tr -&gt; String
showList :: [DerivationGraph slc tr] -&gt; ShowS
$cshowList :: forall slc tr.
(Show slc, Show tr) =&gt;
[DerivationGraph slc tr] -&gt; ShowS
show :: DerivationGraph slc tr -&gt; String
$cshow :: forall slc tr.
(Show slc, Show tr) =&gt;
DerivationGraph slc tr -&gt; String
showsPrec :: Int -&gt; DerivationGraph slc tr -&gt; ShowS
$cshowsPrec :: forall slc tr.
(Show slc, Show tr) =&gt;
Int -&gt; DerivationGraph slc tr -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- | Alias for the type of a monadic action during derivation replay.</span><span>
</span><span id="line-101"></span><span class="hs-keyword">type</span><span> </span><span id="DerivationOp"><span class="annot"><a href="Display.html#DerivationOp"><span class="hs-identifier hs-var">DerivationOp</span></a></span></span><span> </span><span id="local-6989586621679464860"><span class="annot"><a href="#local-6989586621679464860"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679464859"><span class="annot"><a href="#local-6989586621679464859"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST.StateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464860"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464859"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">-- | Removes and returns an open transition from the current surface.</span><span>
</span><span id="line-104"></span><span id="local-6989586621679465362"><span id="local-6989586621679465363"><span class="annot"><a href="Display.html#popOpen"><span class="hs-identifier hs-type">popOpen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Display.html#DerivationOp"><span class="hs-identifier hs-type">DerivationOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465363"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465362"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier hs-type">DerivTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465363"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465362"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-105"></span><span id="popOpen"><span class="annot"><span class="annottext">popOpen :: forall slc tr. DerivationOp slc tr (DerivTrans slc tr)
</span><a href="Display.html#popOpen"><span class="hs-identifier hs-var hs-var">popOpen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>  </span><span id="local-6989586621679464837"><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464837"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">ST.get</span></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; [DerivTrans slc tr]
</span><a href="Display.html#dgOpen"><span class="hs-identifier hs-var">dgOpen</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464837"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-109"></span><span>    </span><span id="local-6989586621679464835"><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679464835"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679464834"><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464834"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-110"></span><span>      </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">ST.put</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464837"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dgOpen :: [DerivTrans slc tr]
</span><a href="Display.html#dgOpen"><span class="hs-identifier hs-var">dgOpen</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464834"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-111"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679464835"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- | Adds a list of new open transitions to the current surface and the derivation graph.</span><span>
</span><span id="line-114"></span><span id="local-6989586621679465334"><span id="local-6989586621679465335"><span class="annot"><a href="Display.html#pushOpen"><span class="hs-identifier hs-type">pushOpen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465335"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465334"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier hs-type">DerivTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465335"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465334"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationOp"><span class="hs-identifier hs-type">DerivationOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465335"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465334"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-115"></span><span id="pushOpen"><span class="annot"><span class="annottext">pushOpen :: forall slc tr.
(Ord slc, Ord tr) =&gt;
[DerivTrans slc tr] -&gt; DerivationOp slc tr ()
</span><a href="Display.html#pushOpen"><span class="hs-identifier hs-var hs-var">pushOpen</span></a></span></span><span> </span><span id="local-6989586621679464825"><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464825"><span class="hs-identifier hs-var">newts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-116"></span><span>  </span><span id="local-6989586621679464824"><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464824"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">ST.get</span></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679464815"><span class="annot"><span class="annottext">trans' :: Set (DerivTrans slc tr)
</span><a href="#local-6989586621679464815"><span class="hs-identifier hs-var hs-var">trans'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464825"><span class="hs-identifier hs-var">newts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; Set (DerivTrans slc tr)
</span><a href="Display.html#dgTransitions"><span class="hs-identifier hs-var">dgTransitions</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464824"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-118"></span><span>      </span><span id="local-6989586621679464811"><span class="annot"><span class="annottext">surf' :: [DerivTrans slc tr]
</span><a href="#local-6989586621679464811"><span class="hs-identifier hs-var hs-var">surf'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464825"><span class="hs-identifier hs-var">newts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; [DerivTrans slc tr]
</span><a href="Display.html#dgOpen"><span class="hs-identifier hs-var">dgOpen</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464824"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">ST.put</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464824"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dgTransitions :: Set (DerivTrans slc tr)
</span><a href="Display.html#dgTransitions"><span class="hs-identifier hs-var">dgTransitions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (DerivTrans slc tr)
</span><a href="#local-6989586621679464815"><span class="hs-identifier hs-var">trans'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dgOpen :: [DerivTrans slc tr]
</span><a href="Display.html#dgOpen"><span class="hs-identifier hs-var">dgOpen</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464811"><span class="hs-identifier hs-var">surf'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-comment">-- | Adds a frozen transition to the current surface and the derivation graph.</span><span>
</span><span id="line-122"></span><span id="local-6989586621679465323"><span id="local-6989586621679465324"><span class="annot"><a href="Display.html#pushClosed"><span class="hs-identifier hs-type">pushClosed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465324"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465323"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier hs-type">DerivTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465324"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465323"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationOp"><span class="hs-identifier hs-type">DerivationOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465324"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465323"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-123"></span><span id="pushClosed"><span class="annot"><span class="annottext">pushClosed :: forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivTrans slc tr -&gt; DerivationOp slc tr ()
</span><a href="Display.html#pushClosed"><span class="hs-identifier hs-var hs-var">pushClosed</span></a></span></span><span> </span><span id="local-6989586621679464803"><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679464803"><span class="hs-identifier hs-var">newt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-124"></span><span>  </span><span id="local-6989586621679464802"><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464802"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">ST.get</span></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679464796"><span class="annot"><span class="annottext">trans' :: Set (DerivTrans slc tr)
</span><a href="#local-6989586621679464796"><span class="hs-identifier hs-var hs-var">trans'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.insert</span></span><span> </span><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679464803"><span class="hs-identifier hs-var">newt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; Set (DerivTrans slc tr)
</span><a href="Display.html#dgTransitions"><span class="hs-identifier hs-var">dgTransitions</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464802"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-126"></span><span>      </span><span id="local-6989586621679464794"><span class="annot"><span class="annottext">frozen' :: [DerivTrans slc tr]
</span><a href="#local-6989586621679464794"><span class="hs-identifier hs-var hs-var">frozen'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679464803"><span class="hs-identifier hs-var">newt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; [DerivTrans slc tr]
</span><a href="Display.html#dgFrozen"><span class="hs-identifier hs-var">dgFrozen</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464802"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">ST.put</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464802"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dgTransitions :: Set (DerivTrans slc tr)
</span><a href="Display.html#dgTransitions"><span class="hs-identifier hs-var">dgTransitions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (DerivTrans slc tr)
</span><a href="#local-6989586621679464796"><span class="hs-identifier hs-var">trans'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dgFrozen :: [DerivTrans slc tr]
</span><a href="Display.html#dgFrozen"><span class="hs-identifier hs-var">dgFrozen</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464794"><span class="hs-identifier hs-var">frozen'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-comment">-- | Adds a new slice to the derivation graph.</span><span>
</span><span id="line-130"></span><span id="local-6989586621679465317"><span id="local-6989586621679465318"><span class="annot"><a href="Display.html#addSlice"><span class="hs-identifier hs-type">addSlice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465318"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679465318"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationOp"><span class="hs-identifier hs-type">DerivationOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465318"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465317"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465318"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-131"></span><span id="addSlice"><span class="annot"><span class="annottext">addSlice :: forall slc tr.
Ord slc =&gt;
slc -&gt; Int -&gt; DerivationOp slc tr (DerivSlice slc)
</span><a href="Display.html#addSlice"><span class="hs-identifier hs-var hs-var">addSlice</span></a></span></span><span> </span><span id="local-6989586621679464781"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464781"><span class="hs-identifier hs-var">sliceContent</span></a></span></span><span> </span><span id="local-6989586621679464780"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464780"><span class="hs-identifier hs-var">depth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-132"></span><span>  </span><span id="local-6989586621679464779"><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464779"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">ST.get</span></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679464778"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679464778"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; Int
</span><a href="Display.html#dgNextId"><span class="hs-identifier hs-var">dgNextId</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464779"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-134"></span><span>      </span><span id="local-6989586621679464777"><span class="annot"><span class="annottext">newSlice :: DerivSlice slc
</span><a href="#local-6989586621679464777"><span class="hs-identifier hs-var hs-var">newSlice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall slc. Int -&gt; Int -&gt; StartStop slc -&gt; DerivSlice slc
</span><a href="Display.html#DerivSlice"><span class="hs-identifier hs-var">DerivSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464780"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464778"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464781"><span class="hs-identifier hs-var">sliceContent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>      </span><span id="local-6989586621679464773"><span class="annot"><span class="annottext">slices' :: Set (DerivSlice slc)
</span><a href="#local-6989586621679464773"><span class="hs-identifier hs-var hs-var">slices'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.insert</span></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464777"><span class="hs-identifier hs-var">newSlice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; Set (DerivSlice slc)
</span><a href="Display.html#dgSlices"><span class="hs-identifier hs-var">dgSlices</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464779"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">ST.put</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464779"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dgNextId :: Int
</span><a href="Display.html#dgNextId"><span class="hs-identifier hs-var">dgNextId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464778"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dgSlices :: Set (DerivSlice slc)
</span><a href="Display.html#dgSlices"><span class="hs-identifier hs-var">dgSlices</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (DerivSlice slc)
</span><a href="#local-6989586621679464773"><span class="hs-identifier hs-var">slices'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464777"><span class="hs-identifier hs-var">newSlice</span></a></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-comment">-- | Adds a new horizontalization edge to the derivation graph.</span><span>
</span><span id="line-140"></span><span id="local-6989586621679465311"><span id="local-6989586621679465312"><span class="annot"><a href="Display.html#addHoriEdge"><span class="hs-identifier hs-type">addHoriEdge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465312"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465312"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465312"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationOp"><span class="hs-identifier hs-type">DerivationOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465312"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465311"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-141"></span><span id="addHoriEdge"><span class="annot"><span class="annottext">addHoriEdge :: forall slc tr.
Ord slc =&gt;
(DerivSlice slc, DerivSlice slc) -&gt; DerivationOp slc tr ()
</span><a href="Display.html#addHoriEdge"><span class="hs-identifier hs-var hs-var">addHoriEdge</span></a></span></span><span> </span><span id="local-6989586621679464765"><span class="annot"><span class="annottext">(DerivSlice slc, DerivSlice slc)
</span><a href="#local-6989586621679464765"><span class="hs-identifier hs-var">edge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-142"></span><span>  </span><span id="local-6989586621679464764"><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464764"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">ST.get</span></span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679464759"><span class="annot"><span class="annottext">horis' :: Set (DerivSlice slc, DerivSlice slc)
</span><a href="#local-6989586621679464759"><span class="hs-identifier hs-var hs-var">horis'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.insert</span></span><span> </span><span class="annot"><span class="annottext">(DerivSlice slc, DerivSlice slc)
</span><a href="#local-6989586621679464765"><span class="hs-identifier hs-var">edge</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall slc tr.
DerivationGraph slc tr -&gt; Set (DerivSlice slc, DerivSlice slc)
</span><a href="Display.html#dgHoriEdges"><span class="hs-identifier hs-var">dgHoriEdges</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464764"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">ST.put</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464764"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dgHoriEdges :: Set (DerivSlice slc, DerivSlice slc)
</span><a href="Display.html#dgHoriEdges"><span class="hs-identifier hs-var">dgHoriEdges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (DerivSlice slc, DerivSlice slc)
</span><a href="#local-6989586621679464759"><span class="hs-identifier hs-var">horis'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">{- | A derivation player.
 Contains functions for replaying derivations of a particular grammar,
 i.e. for deriving child elements from parent elements.
-}</span><span>
</span><span id="line-150"></span><span class="hs-keyword">data</span><span> </span><span id="DerivationPlayer"><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-var">DerivationPlayer</span></a></span></span><span> </span><span id="local-6989586621679465308"><span class="annot"><a href="#local-6989586621679465308"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679465307"><span class="annot"><a href="#local-6989586621679465307"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679465306"><span class="annot"><a href="#local-6989586621679465306"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span id="local-6989586621679465305"><span class="annot"><a href="#local-6989586621679465305"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679465304"><span class="annot"><a href="#local-6989586621679465304"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DerivationPlayer"><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-var">DerivationPlayer</span></a></span></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="dpTopTrans"><span class="annot"><span class="annottext">forall s f h slc tr. DerivationPlayer s f h slc tr -&gt; tr
</span><a href="Display.html#dpTopTrans"><span class="hs-identifier hs-var hs-var">dpTopTrans</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679465304"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-comment">-- ^ the grammars default starting transition for @&#8906;&#8212;&#8212;&#8905;@</span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dpSplit"><span class="annot"><span class="annottext">forall s f h slc tr.
DerivationPlayer s f h slc tr
-&gt; s -&gt; tr -&gt; Either String (tr, slc, tr)
</span><a href="Display.html#dpSplit"><span class="hs-identifier hs-var hs-var">dpSplit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679465308"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679465304"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679465304"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679465305"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679465304"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-comment">-- ^ replay a split operation</span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dpFreeze"><span class="annot"><span class="annottext">forall s f h slc tr.
DerivationPlayer s f h slc tr -&gt; f -&gt; tr -&gt; Either String tr
</span><a href="Display.html#dpFreeze"><span class="hs-identifier hs-var hs-var">dpFreeze</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679465307"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679465304"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679465304"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-comment">-- ^ replay a freeze operation</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dpSpread"><span class="annot"><span class="annottext">forall s f h slc tr.
DerivationPlayer s f h slc tr
-&gt; h -&gt; tr -&gt; slc -&gt; tr -&gt; Either String (tr, slc, tr, slc, tr)
</span><a href="Display.html#dpSpread"><span class="hs-identifier hs-var hs-var">dpSpread</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679465306"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679465304"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679465305"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679465304"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679465304"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679465305"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679465304"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679465305"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679465304"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-comment">-- ^ replay a spread operation</span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-comment">-- | Replays a single derivation step and applies it to the derivation graph.</span><span>
</span><span id="line-162"></span><span id="local-6989586621679465278"><span id="local-6989586621679465279"><span id="local-6989586621679465280"><span id="local-6989586621679465281"><span id="local-6989586621679465282"><span class="annot"><a href="Display.html#replayDerivationStep"><span class="hs-identifier hs-type">replayDerivationStep</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465282"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465281"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-type">DerivationPlayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465280"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465279"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465278"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465282"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465281"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-comment">-- ^ the derivation player</span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#Leftmost"><span class="hs-identifier hs-type">Leftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465280"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465279"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465278"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-comment">-- ^ the operation to be applied</span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationOp"><span class="hs-identifier hs-type">DerivationOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465282"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465281"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-169"></span><span id="replayDerivationStep"><span class="annot"><span class="annottext">replayDerivationStep :: forall slc tr s f h.
(Ord slc, Ord tr) =&gt;
DerivationPlayer s f h slc tr
-&gt; Leftmost s f h -&gt; DerivationOp slc tr ()
</span><a href="Display.html#replayDerivationStep"><span class="hs-identifier hs-var hs-var">replayDerivationStep</span></a></span></span><span> </span><span id="local-6989586621679464750"><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464750"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Leftmost s f h
-&gt; StateT (DerivationGraph slc tr) (Either String) ()
</span><a href="#local-6989586621679464749"><span class="hs-identifier hs-var">applyRule</span></a></span><span>
</span><span id="line-170"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-171"></span><span>  </span><span id="local-6989586621679464749"><span class="annot"><span class="annottext">applyRule :: Leftmost s f h
-&gt; StateT (DerivationGraph slc tr) (Either String) ()
</span><a href="#local-6989586621679464749"><span class="hs-identifier hs-var hs-var">applyRule</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMSplitLeft"><span class="hs-identifier hs-type">LMSplitLeft</span></a></span><span> </span><span id="local-6989586621679464698"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679464698"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679464697"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464697"><span class="hs-identifier hs-var">pl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464696"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464696"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464695"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464695"><span class="hs-identifier hs-var">pr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall slc tr. DerivationOp slc tr (DerivTrans slc tr)
</span><a href="Display.html#popOpen"><span class="hs-identifier hs-var">popOpen</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679464694"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464694"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464693"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464693"><span class="hs-identifier hs-var">cm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464692"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464692"><span class="hs-identifier hs-var">cr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s f h slc tr.
DerivationPlayer s f h slc tr
-&gt; s -&gt; tr -&gt; Either String (tr, slc, tr)
</span><a href="Display.html#dpSplit"><span class="hs-identifier hs-var">dpSplit</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464750"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679464698"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464696"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span id="local-6989586621679464691"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464691"><span class="hs-identifier hs-var">sm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall slc tr.
Ord slc =&gt;
slc -&gt; Int -&gt; DerivationOp slc tr (DerivSlice slc)
</span><a href="Display.html#addSlice"><span class="hs-identifier hs-var">addSlice</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464693"><span class="hs-identifier hs-var">cm</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslDepth"><span class="hs-identifier hs-var">dslDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464697"><span class="hs-identifier hs-var">pl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslDepth"><span class="hs-identifier hs-var">dslDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464695"><span class="hs-identifier hs-var">pr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><span class="annottext">forall slc tr.
(Ord slc, Ord tr) =&gt;
[DerivTrans slc tr] -&gt; DerivationOp slc tr ()
</span><a href="Display.html#pushOpen"><span class="hs-identifier hs-var">pushOpen</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464697"><span class="hs-identifier hs-var">pl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464694"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464691"><span class="hs-identifier hs-var">sm</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464691"><span class="hs-identifier hs-var">sm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464692"><span class="hs-identifier hs-var">cr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464695"><span class="hs-identifier hs-var">pr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><a href="#local-6989586621679464749"><span class="hs-identifier hs-var">applyRule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMSplitOnly"><span class="hs-identifier hs-type">LMSplitOnly</span></a></span><span> </span><span id="local-6989586621679464688"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679464688"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Leftmost s f h
-&gt; StateT (DerivationGraph slc tr) (Either String) ()
</span><a href="#local-6989586621679464749"><span class="hs-identifier hs-var">applyRule</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s f h. s -&gt; Leftmost s f h
</span><a href="Common.html#LMSplitLeft"><span class="hs-identifier hs-var">LMSplitLeft</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679464688"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-177"></span><span>  </span><span class="annot"><a href="#local-6989586621679464749"><span class="hs-identifier hs-var">applyRule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMSplitRight"><span class="hs-identifier hs-type">LMSplitRight</span></a></span><span> </span><span id="local-6989586621679464686"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679464686"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>    </span><span id="local-6989586621679464685"><span class="annot"><span class="annottext">(DerivSlice slc, tr, DerivSlice slc)
</span><a href="#local-6989586621679464685"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall slc tr. DerivationOp slc tr (DerivTrans slc tr)
</span><a href="Display.html#popOpen"><span class="hs-identifier hs-var">popOpen</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679464684"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464684"><span class="hs-identifier hs-var">pl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464683"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464683"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464682"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464682"><span class="hs-identifier hs-var">pr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall slc tr. DerivationOp slc tr (DerivTrans slc tr)
</span><a href="Display.html#popOpen"><span class="hs-identifier hs-var">popOpen</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679464681"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464681"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464680"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464680"><span class="hs-identifier hs-var">cm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464679"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464679"><span class="hs-identifier hs-var">cr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s f h slc tr.
DerivationPlayer s f h slc tr
-&gt; s -&gt; tr -&gt; Either String (tr, slc, tr)
</span><a href="Display.html#dpSplit"><span class="hs-identifier hs-var">dpSplit</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464750"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679464686"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464683"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621679464678"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464678"><span class="hs-identifier hs-var">sm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall slc tr.
Ord slc =&gt;
slc -&gt; Int -&gt; DerivationOp slc tr (DerivSlice slc)
</span><a href="Display.html#addSlice"><span class="hs-identifier hs-var">addSlice</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464680"><span class="hs-identifier hs-var">cm</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslDepth"><span class="hs-identifier hs-var">dslDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464684"><span class="hs-identifier hs-var">pl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslDepth"><span class="hs-identifier hs-var">dslDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464682"><span class="hs-identifier hs-var">pr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="annottext">forall slc tr.
(Ord slc, Ord tr) =&gt;
[DerivTrans slc tr] -&gt; DerivationOp slc tr ()
</span><a href="Display.html#pushOpen"><span class="hs-identifier hs-var">pushOpen</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(DerivSlice slc, tr, DerivSlice slc)
</span><a href="#local-6989586621679464685"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464684"><span class="hs-identifier hs-var">pl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464681"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464678"><span class="hs-identifier hs-var">sm</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464678"><span class="hs-identifier hs-var">sm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464679"><span class="hs-identifier hs-var">cr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464682"><span class="hs-identifier hs-var">pr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><a href="#local-6989586621679464749"><span class="hs-identifier hs-var">applyRule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMFreezeLeft"><span class="hs-identifier hs-type">LMFreezeLeft</span></a></span><span> </span><span id="local-6989586621679464676"><span class="annot"><span class="annottext">f
</span><a href="#local-6989586621679464676"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679464675"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464675"><span class="hs-identifier hs-var">pl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464674"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464674"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464673"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464673"><span class="hs-identifier hs-var">pr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall slc tr. DerivationOp slc tr (DerivTrans slc tr)
</span><a href="Display.html#popOpen"><span class="hs-identifier hs-var">popOpen</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621679464672"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464672"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s f h slc tr.
DerivationPlayer s f h slc tr -&gt; f -&gt; tr -&gt; Either String tr
</span><a href="Display.html#dpFreeze"><span class="hs-identifier hs-var">dpFreeze</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464750"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span class="annot"><span class="annottext">f
</span><a href="#local-6989586621679464676"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464674"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><span class="annottext">forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivTrans slc tr -&gt; DerivationOp slc tr ()
</span><a href="Display.html#pushClosed"><span class="hs-identifier hs-var">pushClosed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464675"><span class="hs-identifier hs-var">pl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464672"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464673"><span class="hs-identifier hs-var">pr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><a href="#local-6989586621679464749"><span class="hs-identifier hs-var">applyRule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMFreezeOnly"><span class="hs-identifier hs-type">LMFreezeOnly</span></a></span><span> </span><span id="local-6989586621679464670"><span class="annot"><span class="annottext">f
</span><a href="#local-6989586621679464670"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Leftmost s f h
-&gt; StateT (DerivationGraph slc tr) (Either String) ()
</span><a href="#local-6989586621679464749"><span class="hs-identifier hs-var">applyRule</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall f s h. f -&gt; Leftmost s f h
</span><a href="Common.html#LMFreezeLeft"><span class="hs-identifier hs-var">LMFreezeLeft</span></a></span><span> </span><span class="annot"><span class="annottext">f
</span><a href="#local-6989586621679464670"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><a href="#local-6989586621679464749"><span class="hs-identifier hs-var">applyRule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMSpread"><span class="hs-identifier hs-type">LMSpread</span></a></span><span> </span><span id="local-6989586621679464668"><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621679464668"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679464667"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464667"><span class="hs-identifier hs-var">lpl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464666"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464666"><span class="hs-identifier hs-var">lpt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464665"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464665"><span class="hs-identifier hs-var">pm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall slc tr. DerivationOp slc tr (DerivTrans slc tr)
</span><a href="Display.html#popOpen"><span class="hs-identifier hs-var">popOpen</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464664"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464664"><span class="hs-identifier hs-var">rpt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464663"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464663"><span class="hs-identifier hs-var">rpr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall slc tr. DerivationOp slc tr (DerivTrans slc tr)
</span><a href="Display.html#popOpen"><span class="hs-identifier hs-var">popOpen</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679464658"><span class="annot"><span class="annottext">depth' :: Int
</span><a href="#local-6989586621679464658"><span class="hs-identifier hs-var hs-var">depth'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslDepth"><span class="hs-identifier hs-var">dslDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464667"><span class="hs-identifier hs-var">lpl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslDepth"><span class="hs-identifier hs-var">dslDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464665"><span class="hs-identifier hs-var">pm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslDepth"><span class="hs-identifier hs-var">dslDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464663"><span class="hs-identifier hs-var">rpr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621679464657"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464657"><span class="hs-identifier hs-var">pmInner</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a -&gt; Either String a
</span><a href="Common.html#getInnerE"><span class="hs-identifier hs-var">getInnerE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; StartStop slc
</span><a href="Display.html#dslContent"><span class="hs-identifier hs-var">dslContent</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464665"><span class="hs-identifier hs-var">pm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679464655"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464655"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464654"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464654"><span class="hs-identifier hs-var">lc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464653"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464653"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464652"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464652"><span class="hs-identifier hs-var">rc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464651"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464651"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s f h slc tr.
DerivationPlayer s f h slc tr
-&gt; h -&gt; tr -&gt; slc -&gt; tr -&gt; Either String (tr, slc, tr, slc, tr)
</span><a href="Display.html#dpSpread"><span class="hs-identifier hs-var">dpSpread</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464750"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621679464668"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464666"><span class="hs-identifier hs-var">lpt</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464657"><span class="hs-identifier hs-var">pmInner</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464664"><span class="hs-identifier hs-var">rpt</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span id="local-6989586621679464650"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464650"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall slc tr.
Ord slc =&gt;
slc -&gt; Int -&gt; DerivationOp slc tr (DerivSlice slc)
</span><a href="Display.html#addSlice"><span class="hs-identifier hs-var">addSlice</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464654"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464658"><span class="hs-identifier hs-var">depth'</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span id="local-6989586621679464649"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464649"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall slc tr.
Ord slc =&gt;
slc -&gt; Int -&gt; DerivationOp slc tr (DerivSlice slc)
</span><a href="Display.html#addSlice"><span class="hs-identifier hs-var">addSlice</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464652"><span class="hs-identifier hs-var">rc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464658"><span class="hs-identifier hs-var">depth'</span></a></span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><span class="annottext">forall slc tr.
Ord slc =&gt;
(DerivSlice slc, DerivSlice slc) -&gt; DerivationOp slc tr ()
</span><a href="Display.html#addHoriEdge"><span class="hs-identifier hs-var">addHoriEdge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464665"><span class="hs-identifier hs-var">pm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464650"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="annottext">forall slc tr.
Ord slc =&gt;
(DerivSlice slc, DerivSlice slc) -&gt; DerivationOp slc tr ()
</span><a href="Display.html#addHoriEdge"><span class="hs-identifier hs-var">addHoriEdge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464665"><span class="hs-identifier hs-var">pm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464649"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="annottext">forall slc tr.
(Ord slc, Ord tr) =&gt;
[DerivTrans slc tr] -&gt; DerivationOp slc tr ()
</span><a href="Display.html#pushOpen"><span class="hs-identifier hs-var">pushOpen</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464667"><span class="hs-identifier hs-var">lpl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464655"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464650"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464650"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464653"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464649"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464649"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464651"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464663"><span class="hs-identifier hs-var">rpr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">-- | Creates the initial state of the derivation graph.</span><span>
</span><span id="line-201"></span><span id="local-6989586621679465258"><span id="local-6989586621679465259"><span class="annot"><a href="Display.html#initialGraph"><span class="hs-identifier hs-type">initialGraph</span></a></span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465259"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465258"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465258"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465259"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-comment">-- DerivationPlayer s f h slc tr</span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465259"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465258"><span class="hs-identifier hs-type">tr</span></a></span></span></span><span>
</span><span id="line-205"></span><span id="initialGraph"><span class="annot"><span class="annottext">initialGraph :: forall slc tr.
(Ord slc, Ord tr) =&gt;
Path tr slc -&gt; DerivationGraph slc tr
</span><a href="Display.html#initialGraph"><span class="hs-identifier hs-var hs-var">initialGraph</span></a></span></span><span> </span><span id="local-6989586621679464641"><span class="annot"><span class="annottext">Path tr slc
</span><a href="#local-6989586621679464641"><span class="hs-identifier hs-var">topPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-206"></span><span>  </span><span class="annot"><span class="annottext">forall slc tr.
Int
-&gt; Set (DerivSlice slc)
-&gt; Set (DerivTrans slc tr)
-&gt; Set (DerivSlice slc, DerivSlice slc)
-&gt; [DerivTrans slc tr]
-&gt; [DerivTrans slc tr]
-&gt; [DerivTrans slc tr]
-&gt; DerivationGraph slc tr
</span><a href="Display.html#DGraph"><span class="hs-identifier hs-var">DGraph</span></a></span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Path a b -&gt; Int
</span><a href="Common.html#pathLen"><span class="hs-identifier hs-var">pathLen</span></a></span><span> </span><span class="annot"><span class="annottext">Path tr slc
</span><a href="#local-6989586621679464641"><span class="hs-identifier hs-var">topPath</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">[DerivSlice slc]
</span><a href="#local-6989586621679464639"><span class="hs-identifier hs-var">topSlices</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464638"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><span class="annottext">forall a. Set a
</span><span class="hs-identifier hs-var">S.empty</span></span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464638"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464638"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-214"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-comment">-- collect initial slices (+ Start / Stop)</span><span>
</span><span id="line-216"></span><span>  </span><span id="local-6989586621679464633"><span class="annot"><span class="annottext">topContents :: [StartStop slc]
</span><a href="#local-6989586621679464633"><span class="hs-identifier hs-var hs-var">topContents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Path a b -&gt; [b]
</span><a href="Common.html#pathBetweens"><span class="hs-identifier hs-var">pathBetweens</span></a></span><span> </span><span class="annot"><span class="annottext">Path tr slc
</span><a href="#local-6989586621679464641"><span class="hs-identifier hs-var">topPath</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall a. StartStop a
</span><a href="Common.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-comment">-- assign depth=0 and running IDs to initial slices</span><span>
</span><span id="line-218"></span><span>  </span><span id="local-6989586621679464639"><span class="annot"><span class="annottext">topSlices :: [DerivSlice slc]
</span><a href="#local-6989586621679464639"><span class="hs-identifier hs-var hs-var">topSlices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. Int -&gt; Int -&gt; StartStop slc -&gt; DerivSlice slc
</span><a href="Display.html#DerivSlice"><span class="hs-identifier hs-var">DerivSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[StartStop slc]
</span><a href="#local-6989586621679464633"><span class="hs-identifier hs-var">topContents</span></a></span><span>
</span><span id="line-219"></span><span>  </span><span id="local-6989586621679464638"><span class="annot"><span class="annottext">top :: [DerivTrans slc tr]
</span><a href="#local-6989586621679464638"><span class="hs-identifier hs-var hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><span class="hs-identifier hs-var">zip3</span></span><span> </span><span class="annot"><span class="annottext">[DerivSlice slc]
</span><a href="#local-6989586621679464639"><span class="hs-identifier hs-var">topSlices</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Path a b -&gt; [a]
</span><a href="Common.html#pathArounds"><span class="hs-identifier hs-var">pathArounds</span></a></span><span> </span><span class="annot"><span class="annottext">Path tr slc
</span><a href="#local-6989586621679464641"><span class="hs-identifier hs-var">topPath</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[DerivSlice slc]
</span><a href="#local-6989586621679464639"><span class="hs-identifier hs-var">topSlices</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-comment">-- | Replay a derivation from @n@ top-level transitions.</span><span>
</span><span id="line-222"></span><span id="local-6989586621679465232"><span id="local-6989586621679465233"><span id="local-6989586621679465234"><span id="local-6989586621679465235"><span id="local-6989586621679465236"><span id="local-6989586621679465237"><span class="annot"><a href="Display.html#replayDerivation%27"><span class="hs-identifier hs-type">replayDerivation'</span></a></span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679465237"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465236"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465235"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465235"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465236"><span class="hs-identifier hs-type">slc</span></a></span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-comment">-- ^ the starting point of the derivation</span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-type">DerivationPlayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465234"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465233"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465232"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465236"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465235"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-comment">-- ^ the derivation player</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679465237"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Leftmost"><span class="hs-identifier hs-type">Leftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465234"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465233"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465232"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-comment">-- ^ the derivation</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465236"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465235"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-231"></span><span id="replayDerivation%27"><span class="annot"><span class="annottext">replayDerivation' :: forall (t :: * -&gt; *) slc tr s f h.
(Foldable t, Ord slc, Ord tr) =&gt;
Path tr slc
-&gt; DerivationPlayer s f h slc tr
-&gt; t (Leftmost s f h)
-&gt; Either String (DerivationGraph slc tr)
</span><a href="Display.html#replayDerivation%27"><span class="hs-identifier hs-var hs-var">replayDerivation'</span></a></span></span><span> </span><span id="local-6989586621679464611"><span class="annot"><span class="annottext">Path tr slc
</span><a href="#local-6989586621679464611"><span class="hs-identifier hs-var">topPath</span></a></span></span><span> </span><span id="local-6989586621679464610"><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464610"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span id="local-6989586621679464609"><span class="annot"><span class="annottext">t (Leftmost s f h)
</span><a href="#local-6989586621679464609"><span class="hs-identifier hs-var">deriv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-232"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m s
</span><span class="hs-identifier hs-var">ST.execStateT</span></span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc tr s f h.
(Ord slc, Ord tr) =&gt;
DerivationPlayer s f h slc tr
-&gt; Leftmost s f h -&gt; DerivationOp slc tr ()
</span><a href="Display.html#replayDerivationStep"><span class="hs-identifier hs-var">replayDerivationStep</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464610"><span class="hs-identifier hs-var">player</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t (Leftmost s f h)
</span><a href="#local-6989586621679464609"><span class="hs-identifier hs-var">deriv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc tr.
(Ord slc, Ord tr) =&gt;
Path tr slc -&gt; DerivationGraph slc tr
</span><a href="Display.html#initialGraph"><span class="hs-identifier hs-var">initialGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Path tr slc
</span><a href="#local-6989586621679464611"><span class="hs-identifier hs-var">topPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-comment">-- | Replay a derivation from @&#8906;&#8212;&#8212;&#8905;@.</span><span>
</span><span id="line-237"></span><span id="local-6989586621679465213"><span id="local-6989586621679465214"><span id="local-6989586621679465215"><span id="local-6989586621679465216"><span id="local-6989586621679465217"><span id="local-6989586621679465218"><span class="annot"><a href="Display.html#replayDerivation"><span class="hs-identifier hs-type">replayDerivation</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679465218"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465217"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465216"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-type">DerivationPlayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465215"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465214"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465213"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465217"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465216"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-comment">-- ^ the derivation player</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679465218"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Leftmost"><span class="hs-identifier hs-type">Leftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465215"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465214"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465213"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-comment">-- ^ the derivation</span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465217"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465216"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-244"></span><span id="replayDerivation"><span class="annot"><span class="annottext">replayDerivation :: forall (t :: * -&gt; *) slc tr s f h.
(Foldable t, Ord slc, Ord tr) =&gt;
DerivationPlayer s f h slc tr
-&gt; t (Leftmost s f h) -&gt; Either String (DerivationGraph slc tr)
</span><a href="Display.html#replayDerivation"><span class="hs-identifier hs-var hs-var">replayDerivation</span></a></span></span><span> </span><span id="local-6989586621679464600"><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464600"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) slc tr s f h.
(Foldable t, Ord slc, Ord tr) =&gt;
Path tr slc
-&gt; DerivationPlayer s f h slc tr
-&gt; t (Leftmost s f h)
-&gt; Either String (DerivationGraph slc tr)
</span><a href="Display.html#replayDerivation%27"><span class="hs-identifier hs-var">replayDerivation'</span></a></span><span> </span><span class="annot"><span class="annottext">forall {between}. Path tr between
</span><a href="#local-6989586621679464599"><span class="hs-identifier hs-var">topPath</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464600"><span class="hs-identifier hs-var">player</span></a></span><span>
</span><span id="line-245"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-246"></span><span>  </span><span id="local-6989586621679464599"><span class="annot"><span class="annottext">topPath :: Path tr between
</span><a href="#local-6989586621679464599"><span class="hs-identifier hs-var hs-var">topPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall around between. around -&gt; Path around between
</span><a href="Common.html#PathEnd"><span class="hs-identifier hs-var">PathEnd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s f h slc tr. DerivationPlayer s f h slc tr -&gt; tr
</span><a href="Display.html#dpTopTrans"><span class="hs-identifier hs-var">dpTopTrans</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464600"><span class="hs-identifier hs-var">player</span></a></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="hs-comment">{- | Replay a derivation from @&#8906;&#8212;&#8212;&#8905;@
 and ensure that the dervation is complete (freezing all transitions).
 Return an error message if not.
-}</span><span>
</span><span id="line-252"></span><span id="local-6989586621679464592"><span id="local-6989586621679464593"><span id="local-6989586621679464594"><span id="local-6989586621679464595"><span id="local-6989586621679464596"><span id="local-6989586621679464597"><span class="annot"><a href="Display.html#replayDerivationFull"><span class="hs-identifier hs-type">replayDerivationFull</span></a></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679464597"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679464596"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679464595"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-type">DerivationPlayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464594"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464593"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464592"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464596"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464595"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-comment">-- ^ the derivation player</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679464597"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Leftmost"><span class="hs-identifier hs-type">Leftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464594"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464593"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464592"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-comment">-- ^ the derivation</span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464596"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464595"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-259"></span><span id="replayDerivationFull"><span class="annot"><span class="annottext">replayDerivationFull :: forall (t :: * -&gt; *) slc tr s f h.
(Foldable t, Ord slc, Ord tr) =&gt;
DerivationPlayer s f h slc tr
-&gt; t (Leftmost s f h) -&gt; Either String (DerivationGraph slc tr)
</span><a href="Display.html#replayDerivationFull"><span class="hs-identifier hs-var hs-var">replayDerivationFull</span></a></span></span><span> </span><span id="local-6989586621679464579"><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464579"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span id="local-6989586621679464578"><span class="annot"><span class="annottext">t (Leftmost s f h)
</span><a href="#local-6989586621679464578"><span class="hs-identifier hs-var">deriv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-260"></span><span>  </span><span id="local-6989586621679464577"><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464577"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) slc tr s f h.
(Foldable t, Ord slc, Ord tr) =&gt;
DerivationPlayer s f h slc tr
-&gt; t (Leftmost s f h) -&gt; Either String (DerivationGraph slc tr)
</span><a href="Display.html#replayDerivation"><span class="hs-identifier hs-var">replayDerivation</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464579"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span class="annot"><span class="annottext">t (Leftmost s f h)
</span><a href="#local-6989586621679464578"><span class="hs-identifier hs-var">deriv</span></a></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">L.null</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; [DerivTrans slc tr]
</span><a href="Display.html#dgOpen"><span class="hs-identifier hs-var">dgOpen</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464577"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464577"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Not all open transitions have been frozen!&quot;</span></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="hs-comment">-- TODO: this should work with foldM and a Foldable input:</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="hs-comment">{- | Replays a derivation from @n@ top-level transitions
 and returns every intermediate derivation graph.
-}</span><span>
</span><span id="line-270"></span><span id="local-6989586621679465188"><span id="local-6989586621679465189"><span id="local-6989586621679465190"><span id="local-6989586621679465191"><span id="local-6989586621679465192"><span class="annot"><a href="Display.html#unfoldDerivation%27"><span class="hs-identifier hs-type">unfoldDerivation'</span></a></span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465192"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465191"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465191"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465192"><span class="hs-identifier hs-type">slc</span></a></span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-comment">-- ^ the starting point of the derivation</span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-type">DerivationPlayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465190"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465189"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465188"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465192"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465191"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-comment">-- ^ the derivation player</span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Common.html#Leftmost"><span class="hs-identifier hs-type">Leftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465190"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465189"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465188"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-comment">-- ^ the derivation</span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465192"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465191"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span></span></span><span>
</span><span id="line-279"></span><span id="unfoldDerivation%27"><span class="annot"><span class="annottext">unfoldDerivation' :: forall slc tr s f h.
(Ord slc, Ord tr) =&gt;
Path tr slc
-&gt; DerivationPlayer s f h slc tr
-&gt; [Leftmost s f h]
-&gt; [Either String (DerivationGraph slc tr)]
</span><a href="Display.html#unfoldDerivation%27"><span class="hs-identifier hs-var hs-var">unfoldDerivation'</span></a></span></span><span> </span><span id="local-6989586621679464571"><span class="annot"><span class="annottext">Path tr slc
</span><a href="#local-6989586621679464571"><span class="hs-identifier hs-var">topPath</span></a></span></span><span> </span><span id="local-6989586621679464570"><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464570"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
-&gt; [Either String (DerivationGraph slc tr)]
-&gt; [Leftmost s f h]
-&gt; [Either String (DerivationGraph slc tr)]
</span><a href="#local-6989586621679464569"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc tr.
(Ord slc, Ord tr) =&gt;
Path tr slc -&gt; DerivationGraph slc tr
</span><a href="Display.html#initialGraph"><span class="hs-identifier hs-var">initialGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Path tr slc
</span><a href="#local-6989586621679464571"><span class="hs-identifier hs-var">topPath</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-280"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-281"></span><span>  </span><span id="local-6989586621679464569"><span class="annot"><span class="annottext">go :: DerivationGraph slc tr
-&gt; [Either String (DerivationGraph slc tr)]
-&gt; [Leftmost s f h]
-&gt; [Either String (DerivationGraph slc tr)]
</span><a href="#local-6989586621679464569"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679464565"><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464565"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621679464564"><span class="annot"><span class="annottext">[Either String (DerivationGraph slc tr)]
</span><a href="#local-6989586621679464564"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464565"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Either String (DerivationGraph slc tr)]
</span><a href="#local-6989586621679464564"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><a href="#local-6989586621679464569"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679464563"><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464563"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621679464562"><span class="annot"><span class="annottext">[Either String (DerivationGraph slc tr)]
</span><a href="#local-6989586621679464562"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679464561"><span class="annot"><span class="annottext">Leftmost s f h
</span><a href="#local-6989586621679464561"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679464560"><span class="annot"><span class="annottext">[Leftmost s f h]
</span><a href="#local-6989586621679464560"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m s
</span><span class="hs-identifier hs-var">ST.execStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc tr s f h.
(Ord slc, Ord tr) =&gt;
DerivationPlayer s f h slc tr
-&gt; Leftmost s f h -&gt; DerivationOp slc tr ()
</span><a href="Display.html#replayDerivationStep"><span class="hs-identifier hs-var">replayDerivationStep</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464570"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span class="annot"><span class="annottext">Leftmost s f h
</span><a href="#local-6989586621679464561"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464563"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-284"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679464559"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679464559"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679464559"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Either String (DerivationGraph slc tr)]
</span><a href="#local-6989586621679464562"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-285"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679464558"><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464558"><span class="hs-identifier hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
-&gt; [Either String (DerivationGraph slc tr)]
-&gt; [Leftmost s f h]
-&gt; [Either String (DerivationGraph slc tr)]
</span><a href="#local-6989586621679464569"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464558"><span class="hs-identifier hs-var">g'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464563"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Either String (DerivationGraph slc tr)]
</span><a href="#local-6989586621679464562"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Leftmost s f h]
</span><a href="#local-6989586621679464560"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="hs-comment">{- | Replays a derivation from @&#8906;&#8212;&#8212;&#8905;@
 and returns every intermediate derivation graph.
-}</span><span>
</span><span id="line-290"></span><span id="local-6989586621679465178"><span id="local-6989586621679465179"><span id="local-6989586621679465180"><span id="local-6989586621679465181"><span id="local-6989586621679465182"><span class="annot"><a href="Display.html#unfoldDerivation"><span class="hs-identifier hs-type">unfoldDerivation</span></a></span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465182"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679465181"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-type">DerivationPlayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465180"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465179"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465178"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465182"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465181"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-comment">-- ^ the derivation player</span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Common.html#Leftmost"><span class="hs-identifier hs-type">Leftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465180"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465179"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465178"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-comment">-- ^ the derivation</span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465182"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465181"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span></span></span><span>
</span><span id="line-297"></span><span id="unfoldDerivation"><span class="annot"><span class="annottext">unfoldDerivation :: forall slc tr s f h.
(Ord slc, Ord tr) =&gt;
DerivationPlayer s f h slc tr
-&gt; [Leftmost s f h] -&gt; [Either String (DerivationGraph slc tr)]
</span><a href="Display.html#unfoldDerivation"><span class="hs-identifier hs-var hs-var">unfoldDerivation</span></a></span></span><span> </span><span id="local-6989586621679464553"><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464553"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall slc tr s f h.
(Ord slc, Ord tr) =&gt;
Path tr slc
-&gt; DerivationPlayer s f h slc tr
-&gt; [Leftmost s f h]
-&gt; [Either String (DerivationGraph slc tr)]
</span><a href="Display.html#unfoldDerivation%27"><span class="hs-identifier hs-var">unfoldDerivation'</span></a></span><span> </span><span class="annot"><span class="annottext">forall {between}. Path tr between
</span><a href="#local-6989586621679464552"><span class="hs-identifier hs-var">topPath</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464553"><span class="hs-identifier hs-var">player</span></a></span><span>
</span><span id="line-298"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-299"></span><span>  </span><span id="local-6989586621679464552"><span class="annot"><span class="annottext">topPath :: Path tr between
</span><a href="#local-6989586621679464552"><span class="hs-identifier hs-var hs-var">topPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall around between. around -&gt; Path around between
</span><a href="Common.html#PathEnd"><span class="hs-identifier hs-var">PathEnd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s f h slc tr. DerivationPlayer s f h slc tr -&gt; tr
</span><a href="Display.html#dpTopTrans"><span class="hs-identifier hs-var">dpTopTrans</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679464553"><span class="hs-identifier hs-var">player</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="hs-comment">{- | A derivation player that uses @()@ for slice and transition contents.
 The actual derivation operations are ignored, so only the outer structure is produced.
-}</span><span>
</span><span id="line-304"></span><span id="local-6989586621679465169"><span id="local-6989586621679465170"><span id="local-6989586621679465171"><span class="annot"><a href="Display.html#derivationPlayerUnit"><span class="hs-identifier hs-type">derivationPlayerUnit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-type">DerivationPlayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465171"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465170"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465169"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-305"></span><span id="derivationPlayerUnit"><span class="annot"><span class="annottext">derivationPlayerUnit :: forall s f h. DerivationPlayer s f h () ()
</span><a href="Display.html#derivationPlayerUnit"><span class="hs-identifier hs-var hs-var">derivationPlayerUnit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s f h slc tr.
tr
-&gt; (s -&gt; tr -&gt; Either String (tr, slc, tr))
-&gt; (f -&gt; tr -&gt; Either String tr)
-&gt; (h -&gt; tr -&gt; slc -&gt; tr -&gt; Either String (tr, slc, tr, slc, tr))
-&gt; DerivationPlayer s f h slc tr
</span><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-var">DerivationPlayer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall {p} {p} {a}. p -&gt; p -&gt; Either a ((), (), ())
</span><a href="#local-6989586621679464551"><span class="hs-identifier hs-var">usplit</span></a></span><span> </span><span class="annot"><span class="annottext">forall {p} {p} {a}. p -&gt; p -&gt; Either a ()
</span><a href="#local-6989586621679464550"><span class="hs-identifier hs-var">ufreeze</span></a></span><span> </span><span class="annot"><span class="annottext">forall {p} {p} {p} {p} {a}.
p -&gt; p -&gt; p -&gt; p -&gt; Either a ((), (), (), (), ())
</span><a href="#local-6989586621679464549"><span class="hs-identifier hs-var">uspread</span></a></span><span>
</span><span id="line-306"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-307"></span><span>  </span><span id="local-6989586621679464551"><span class="annot"><span class="annottext">usplit :: p -&gt; p -&gt; Either a ((), (), ())
</span><a href="#local-6989586621679464551"><span class="hs-identifier hs-var hs-var">usplit</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>  </span><span id="local-6989586621679464550"><span class="annot"><span class="annottext">ufreeze :: p -&gt; p -&gt; Either a ()
</span><a href="#local-6989586621679464550"><span class="hs-identifier hs-var hs-var">ufreeze</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>  </span><span id="local-6989586621679464549"><span class="annot"><span class="annottext">uspread :: p -&gt; p -&gt; p -&gt; p -&gt; Either a ((), (), (), (), ())
</span><a href="#local-6989586621679464549"><span class="hs-identifier hs-var hs-var">uspread</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="hs-comment">-- | A helper type that is like @()@ but has a 'Show' instance that returns the empty string.</span><span>
</span><span id="line-312"></span><span class="hs-keyword">data</span><span> </span><span id="Empty"><span class="annot"><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Empty"><span class="annot"><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span></span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679464544"><span id="local-6989586621679464546"><span class="annot"><span class="annottext">Empty -&gt; Empty -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Empty -&gt; Empty -&gt; Bool
$c/= :: Empty -&gt; Empty -&gt; Bool
== :: Empty -&gt; Empty -&gt; Bool
$c== :: Empty -&gt; Empty -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464525"><span id="local-6989586621679464527"><span id="local-6989586621679464530"><span id="local-6989586621679464533"><span id="local-6989586621679464536"><span id="local-6989586621679464538"><span id="local-6989586621679464540"><span class="annot"><span class="annottext">Eq Empty
Empty -&gt; Empty -&gt; Bool
Empty -&gt; Empty -&gt; Ordering
Empty -&gt; Empty -&gt; Empty
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: Empty -&gt; Empty -&gt; Empty
$cmin :: Empty -&gt; Empty -&gt; Empty
max :: Empty -&gt; Empty -&gt; Empty
$cmax :: Empty -&gt; Empty -&gt; Empty
&gt;= :: Empty -&gt; Empty -&gt; Bool
$c&gt;= :: Empty -&gt; Empty -&gt; Bool
&gt; :: Empty -&gt; Empty -&gt; Bool
$c&gt; :: Empty -&gt; Empty -&gt; Bool
&lt;= :: Empty -&gt; Empty -&gt; Bool
$c&lt;= :: Empty -&gt; Empty -&gt; Bool
&lt; :: Empty -&gt; Empty -&gt; Bool
$c&lt; :: Empty -&gt; Empty -&gt; Bool
compare :: Empty -&gt; Empty -&gt; Ordering
$ccompare :: Empty -&gt; Empty -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679464520"><span id="local-6989586621679464523"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Display.html#Empty"><span class="hs-identifier hs-type">Empty</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-316"></span><span>  </span><span id="local-6989586621679464519"><span class="annot"><span class="annottext">show :: Empty -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span class="hs-comment">{- | A derivation player that uses 'Empty' for slice and transition content.
 The actual derivation operations are ignored, so only the outer structure is produced.
-}</span><span>
</span><span id="line-321"></span><span id="local-6989586621679465155"><span id="local-6989586621679465156"><span id="local-6989586621679465157"><span class="annot"><a href="Display.html#derivationPlayerEmpty"><span class="hs-identifier hs-type">derivationPlayerEmpty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-type">DerivationPlayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465157"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465156"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465155"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="Display.html#Empty"><span class="hs-identifier hs-type">Empty</span></a></span><span> </span><span class="annot"><a href="Display.html#Empty"><span class="hs-identifier hs-type">Empty</span></a></span></span></span></span><span>
</span><span id="line-322"></span><span id="derivationPlayerEmpty"><span class="annot"><span class="annottext">derivationPlayerEmpty :: forall s f h. DerivationPlayer s f h Empty Empty
</span><a href="Display.html#derivationPlayerEmpty"><span class="hs-identifier hs-var hs-var">derivationPlayerEmpty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s f h slc tr.
tr
-&gt; (s -&gt; tr -&gt; Either String (tr, slc, tr))
-&gt; (f -&gt; tr -&gt; Either String tr)
-&gt; (h -&gt; tr -&gt; slc -&gt; tr -&gt; Either String (tr, slc, tr, slc, tr))
-&gt; DerivationPlayer s f h slc tr
</span><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-var">DerivationPlayer</span></a></span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span> </span><span class="annot"><span class="annottext">forall {p} {p} {a}. p -&gt; p -&gt; Either a (Empty, Empty, Empty)
</span><a href="#local-6989586621679464517"><span class="hs-identifier hs-var">nsplit</span></a></span><span> </span><span class="annot"><span class="annottext">forall {p} {p} {a}. p -&gt; p -&gt; Either a Empty
</span><a href="#local-6989586621679464516"><span class="hs-identifier hs-var">nfreeze</span></a></span><span> </span><span class="annot"><span class="annottext">forall {p} {p} {p} {p} {a}.
p -&gt; p -&gt; p -&gt; p -&gt; Either a (Empty, Empty, Empty, Empty, Empty)
</span><a href="#local-6989586621679464515"><span class="hs-identifier hs-var">nspread</span></a></span><span>
</span><span id="line-323"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-324"></span><span>  </span><span id="local-6989586621679464517"><span class="annot"><span class="annottext">nsplit :: p -&gt; p -&gt; Either a (Empty, Empty, Empty)
</span><a href="#local-6989586621679464517"><span class="hs-identifier hs-var hs-var">nsplit</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>  </span><span id="local-6989586621679464516"><span class="annot"><span class="annottext">nfreeze :: p -&gt; p -&gt; Either a Empty
</span><a href="#local-6989586621679464516"><span class="hs-identifier hs-var hs-var">nfreeze</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-326"></span><span>  </span><span id="local-6989586621679464515"><span class="annot"><span class="annottext">nspread :: p -&gt; p -&gt; p -&gt; p -&gt; Either a (Empty, Empty, Empty, Empty, Empty)
</span><a href="#local-6989586621679464515"><span class="hs-identifier hs-var hs-var">nspread</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-comment">-- plotting derivation graphs</span><span>
</span><span id="line-329"></span><span class="hs-comment">-- ==========================</span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="hs-comment">-- | Convert a derivation graph into a series of TikZ commands.</span><span>
</span><span id="line-332"></span><span id="local-6989586621679465142"><span id="local-6989586621679465143"><span class="annot"><a href="Display.html#tikzDerivationGraph"><span class="hs-identifier hs-type">tikzDerivationGraph</span></a></span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679465143"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679465142"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679465143"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-comment">-- ^ a function for displaying slice contents</span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679465142"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-comment">-- ^ a function for displaying transitions contents</span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465143"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465142"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-comment">-- ^ the derivation graph</span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span></span></span><span>
</span><span id="line-341"></span><span id="tikzDerivationGraph"><span class="annot"><span class="annottext">tikzDerivationGraph :: forall slc tr.
(Eq slc, Eq tr) =&gt;
(slc -&gt; Text) -&gt; (tr -&gt; Text) -&gt; DerivationGraph slc tr -&gt; Text
</span><a href="Display.html#tikzDerivationGraph"><span class="hs-identifier hs-var hs-var">tikzDerivationGraph</span></a></span></span><span> </span><span id="local-6989586621679464500"><span class="annot"><span class="annottext">slc -&gt; Text
</span><a href="#local-6989586621679464500"><span class="hs-identifier hs-var">showS</span></a></span></span><span> </span><span id="local-6989586621679464499"><span class="annot"><span class="annottext">tr -&gt; Text
</span><a href="#local-6989586621679464499"><span class="hs-identifier hs-var">showT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DGraph"><span class="hs-identifier hs-type">DGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679464498"><span class="annot"><span class="annottext">Set (DerivSlice slc)
</span><a href="#local-6989586621679464498"><span class="hs-identifier hs-var">slices</span></a></span></span><span> </span><span id="local-6989586621679464497"><span class="annot"><span class="annottext">Set (DerivTrans slc tr)
</span><a href="#local-6989586621679464497"><span class="hs-identifier hs-var">trans</span></a></span></span><span> </span><span id="local-6989586621679464496"><span class="annot"><span class="annottext">Set (DerivSlice slc, DerivSlice slc)
</span><a href="#local-6989586621679464496"><span class="hs-identifier hs-var">horis</span></a></span></span><span> </span><span id="local-6989586621679464495"><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464495"><span class="hs-identifier hs-var">openTrans</span></a></span></span><span> </span><span id="local-6989586621679464494"><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464494"><span class="hs-identifier hs-var">frozenTrans</span></a></span></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-342"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span>
</span><span id="line-343"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {slc} {slc} {slc}.
(Show slc, Show slc, Show slc, Num slc) =&gt;
(slc, slc, slc, StartStop slc) -&gt; Text
</span><a href="#local-6989586621679464492"><span class="hs-identifier hs-var">showNode</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Double, Int, Int, StartStop slc)]
</span><a href="#local-6989586621679464491"><span class="hs-identifier hs-var">tikzNodes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {slc} {slc}.
((DerivSlice slc, tr, DerivSlice slc), Bool) -&gt; Text
</span><a href="#local-6989586621679464490"><span class="hs-identifier hs-var">showTrans</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(DerivTrans slc tr, Bool)]
</span><a href="#local-6989586621679464489"><span class="hs-identifier hs-var">trans'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {slc} {slc}. (DerivSlice slc, DerivSlice slc) -&gt; Text
</span><a href="#local-6989586621679464488"><span class="hs-identifier hs-var">showHori</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">Set (DerivSlice slc, DerivSlice slc)
</span><a href="#local-6989586621679464496"><span class="hs-identifier hs-var">horis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-349"></span><span>  </span><span id="local-6989586621679465130"><span class="annot"><a href="#local-6989586621679464486"><span class="hs-identifier hs-type">showText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679465130"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679465130"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span></span><span>
</span><span id="line-350"></span><span>  </span><span id="local-6989586621679464486"><span class="annot"><span class="annottext">showText :: forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="#local-6989586621679464486"><span class="hs-identifier hs-var hs-var">showText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span>
</span><span id="line-351"></span><span>  </span><span class="hs-comment">-- printing nodes and edges</span><span>
</span><span id="line-352"></span><span>  </span><span id="local-6989586621679464479"><span class="annot"><span class="annottext">showSlice :: StartStop slc -&gt; Text
</span><a href="#local-6989586621679464479"><span class="hs-identifier hs-var hs-var">showSlice</span></a></span></span><span> </span><span class="annot"><span class="annottext">StartStop slc
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;$\\rtimes$&quot;</span></span><span>
</span><span id="line-353"></span><span>  </span><span class="annot"><a href="#local-6989586621679464479"><span class="hs-identifier hs-var">showSlice</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop slc
</span><a href="Common.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;$\\ltimes$&quot;</span></span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><a href="#local-6989586621679464479"><span class="hs-identifier hs-var">showSlice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621679464478"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464478"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">slc -&gt; Text
</span><a href="#local-6989586621679464500"><span class="hs-identifier hs-var">showS</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464478"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-355"></span><span>  </span><span id="local-6989586621679464492"><span class="annot"><span class="annottext">showNode :: (slc, slc, slc, StartStop slc) -&gt; Text
</span><a href="#local-6989586621679464492"><span class="hs-identifier hs-var hs-var">showNode</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679464455"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464455"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464454"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464454"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464453"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464453"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464452"><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679464452"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-356"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\\node[slice] (slice&quot;</span></span><span>
</span><span id="line-357"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="#local-6989586621679464486"><span class="hs-identifier hs-var">showText</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464453"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-358"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) at (&quot;</span></span><span>
</span><span id="line-359"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="#local-6989586621679464486"><span class="hs-identifier hs-var">showText</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464455"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-360"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span>
</span><span id="line-361"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="#local-6989586621679464486"><span class="hs-identifier hs-var">showText</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679464454"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) {&quot;</span></span><span>
</span><span id="line-363"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StartStop slc -&gt; Text
</span><a href="#local-6989586621679464479"><span class="hs-identifier hs-var">showSlice</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679464452"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-364"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;};&quot;</span></span><span>
</span><span id="line-365"></span><span>  </span><span id="local-6989586621679464490"><span class="annot"><span class="annottext">showTrans :: ((DerivSlice slc, tr, DerivSlice slc), Bool) -&gt; Text
</span><a href="#local-6989586621679464490"><span class="hs-identifier hs-var hs-var">showTrans</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679464434"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464434"><span class="hs-identifier hs-var">nl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464433"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464433"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464432"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464432"><span class="hs-identifier hs-var">nr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464431"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679464431"><span class="hs-identifier hs-var">frozen</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-366"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\\draw[transition,&quot;</span></span><span>
</span><span id="line-367"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679464431"><span class="hs-identifier hs-var">frozen</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;terminal&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;non-terminal&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;] (slice&quot;</span></span><span>
</span><span id="line-369"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="#local-6989586621679464486"><span class="hs-identifier hs-var">showText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var">dslId</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464434"><span class="hs-identifier hs-var">nl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) -- (slice&quot;</span></span><span>
</span><span id="line-371"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="#local-6989586621679464486"><span class="hs-identifier hs-var">showText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var">dslId</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464432"><span class="hs-identifier hs-var">nr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) node[midway,below,sloped] {&quot;</span></span><span>
</span><span id="line-373"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">tr -&gt; Text
</span><a href="#local-6989586621679464499"><span class="hs-identifier hs-var">showT</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679464433"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-374"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;};&quot;</span></span><span>
</span><span id="line-375"></span><span>  </span><span id="local-6989586621679464488"><span class="annot"><span class="annottext">showHori :: (DerivSlice slc, DerivSlice slc) -&gt; Text
</span><a href="#local-6989586621679464488"><span class="hs-identifier hs-var hs-var">showHori</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679464421"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464421"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464420"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464420"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-376"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\\draw[hori] (slice&quot;</span></span><span>
</span><span id="line-377"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="#local-6989586621679464486"><span class="hs-identifier hs-var">showText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var">dslId</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464421"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) -- (slice&quot;</span></span><span>
</span><span id="line-379"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="#local-6989586621679464486"><span class="hs-identifier hs-var">showText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var">dslId</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679464420"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;);&quot;</span></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-comment">-- helpers</span><span>
</span><span id="line-382"></span><span>  </span><span id="local-6989586621679464419"><span class="annot"><span class="annottext">leftNode :: (a, b, c) -&gt; a
</span><a href="#local-6989586621679464419"><span class="hs-identifier hs-var hs-var">leftNode</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679464418"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679464418"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679464418"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-383"></span><span>  </span><span id="local-6989586621679464417"><span class="annot"><span class="annottext">rightNode :: (a, b, c) -&gt; c
</span><a href="#local-6989586621679464417"><span class="hs-identifier hs-var hs-var">rightNode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464416"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679464416"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679464416"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-comment">-- computing node locations</span><span>
</span><span id="line-385"></span><span>  </span><span id="local-6989586621679464411"><span class="annot"><span class="annottext">nodeChildren :: Map Int [Int]
</span><a href="#local-6989586621679464411"><span class="hs-identifier hs-var hs-var">nodeChildren</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-386"></span><span>    </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromListWith</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">(++)</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var">dslId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var">dslId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">Set (DerivSlice slc, DerivSlice slc)
</span><a href="#local-6989586621679464496"><span class="hs-identifier hs-var">horis</span></a></span><span>
</span><span id="line-387"></span><span>  </span><span id="local-6989586621679464408"><span class="annot"><span class="annottext">surface :: [DerivTrans slc tr]
</span><a href="#local-6989586621679464408"><span class="hs-identifier hs-var hs-var">surface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464494"><span class="hs-identifier hs-var">frozenTrans</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464495"><span class="hs-identifier hs-var">openTrans</span></a></span><span>
</span><span id="line-388"></span><span>  </span><span id="local-6989586621679464489"><span class="annot"><span class="annottext">trans' :: [(DerivTrans slc tr, Bool)]
</span><a href="#local-6989586621679464489"><span class="hs-identifier hs-var hs-var">trans'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679464399"><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679464399"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679464399"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679464399"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`L.elem`</span></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464494"><span class="hs-identifier hs-var">frozenTrans</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">Set (DerivTrans slc tr)
</span><a href="#local-6989586621679464497"><span class="hs-identifier hs-var">trans</span></a></span><span>
</span><span id="line-389"></span><span>  </span><span id="local-6989586621679464395"><span class="annot"><span class="annottext">surfaceNodes :: [Int]
</span><a href="#local-6989586621679464395"><span class="hs-identifier hs-var hs-var">surfaceNodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var">dslId</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {a} {b} {c}. (a, b, c) -&gt; a
</span><a href="#local-6989586621679464419"><span class="hs-identifier hs-var">leftNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464408"><span class="hs-identifier hs-var">surface</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall {a} {b} {c}. (a, b, c) -&gt; c
</span><a href="#local-6989586621679464417"><span class="hs-identifier hs-var">rightNode</span></a></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679464408"><span class="hs-identifier hs-var">surface</span></a></span><span>
</span><span id="line-390"></span><span>  </span><span id="local-6989586621679464391"><span class="annot"><span class="annottext">allNodes :: [Int]
</span><a href="#local-6989586621679464391"><span class="hs-identifier hs-var hs-var">allNodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var">dslId</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.sortOn</span></span><span> </span><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslDepth"><span class="hs-identifier hs-var">dslDepth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">Set (DerivSlice slc)
</span><a href="#local-6989586621679464498"><span class="hs-identifier hs-var">slices</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-comment">-- compute x locations</span><span>
</span><span id="line-392"></span><span>  </span><span id="local-6989586621679464386"><span class="annot"><span class="annottext">xloc :: Map Int Double
</span><a href="#local-6989586621679464386"><span class="hs-identifier hs-var hs-var">xloc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">forall {a}. Fractional a =&gt; Map Int a -&gt; Int -&gt; Map Int a
</span><a href="#local-6989586621679464385"><span class="hs-identifier hs-var">findX</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Double
</span><a href="#local-6989586621679464384"><span class="hs-identifier hs-var">xlocInit</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679464391"><span class="hs-identifier hs-var">allNodes</span></a></span><span>
</span><span id="line-393"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-394"></span><span>    </span><span id="local-6989586621679464384"><span class="annot"><span class="annottext">xlocInit :: Map Int Double
</span><a href="#local-6989586621679464384"><span class="hs-identifier hs-var hs-var">xlocInit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679464395"><span class="hs-identifier hs-var">surfaceNodes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-395"></span><span>    </span><span id="local-6989586621679464368"><span class="annot"><span class="annottext">mean :: t a -&gt; a
</span><a href="#local-6989586621679464368"><span class="hs-identifier hs-var hs-var">mean</span></a></span></span><span> </span><span id="local-6989586621679464367"><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621679464367"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621679464367"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621679464367"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-comment">-- findX :: M.Map Int Double -&gt; Int -&gt; M.Map Int Double</span><span>
</span><span id="line-397"></span><span>    </span><span id="local-6989586621679464385"><span class="annot"><span class="annottext">findX :: Map Int a -&gt; Int -&gt; Map Int a
</span><a href="#local-6989586621679464385"><span class="hs-identifier hs-var hs-var">findX</span></a></span></span><span> </span><span id="local-6989586621679464360"><span class="annot"><span class="annottext">Map Int a
</span><a href="#local-6989586621679464360"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621679464359"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464359"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464359"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int a
</span><a href="#local-6989586621679464360"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-398"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Int a
</span><a href="#local-6989586621679464360"><span class="hs-identifier hs-var">locs</span></a></span><span>
</span><span id="line-399"></span><span>      </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-400"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679464356"><span class="annot"><span class="annottext">children :: [Int]
</span><a href="#local-6989586621679464356"><span class="hs-identifier hs-var hs-var">children</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Int [Int]
</span><a href="#local-6989586621679464411"><span class="hs-identifier hs-var">nodeChildren</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464359"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-401"></span><span>            </span><span id="local-6989586621679464352"><span class="annot"><span class="annottext">childxs :: [a]
</span><a href="#local-6989586621679464352"><span class="hs-identifier hs-var hs-var">childxs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679464351"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464351"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Int a -&gt; Int -&gt; Map Int a
</span><a href="#local-6989586621679464385"><span class="hs-identifier hs-var">findX</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int a
</span><a href="#local-6989586621679464360"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464351"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464351"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679464356"><span class="hs-identifier hs-var">children</span></a></span><span>
</span><span id="line-402"></span><span>            </span><span id="local-6989586621679464348"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621679464348"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {a} {t :: * -&gt; *}. (Fractional a, Foldable t) =&gt; t a -&gt; a
</span><a href="#local-6989586621679464368"><span class="hs-identifier hs-var">mean</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679464352"><span class="hs-identifier hs-var">childxs</span></a></span><span>
</span><span id="line-403"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464359"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679464348"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int a
</span><a href="#local-6989586621679464360"><span class="hs-identifier hs-var">locs</span></a></span><span>
</span><span id="line-404"></span><span>  </span><span id="local-6989586621679464491"><span class="annot"><span class="annottext">tikzNodes :: [(Double, Int, Int, StartStop slc)]
</span><a href="#local-6989586621679464491"><span class="hs-identifier hs-var hs-var">tikzNodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {slc}. DerivSlice slc -&gt; (Double, Int, Int, StartStop slc)
</span><a href="#local-6989586621679464345"><span class="hs-identifier hs-var">mkNode</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">Set (DerivSlice slc)
</span><a href="#local-6989586621679464498"><span class="hs-identifier hs-var">slices</span></a></span><span>
</span><span id="line-405"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-406"></span><span>    </span><span id="local-6989586621679464345"><span class="annot"><span class="annottext">mkNode :: DerivSlice slc -&gt; (Double, Int, Int, StartStop slc)
</span><a href="#local-6989586621679464345"><span class="hs-identifier hs-var hs-var">mkNode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span id="local-6989586621679464343"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464343"><span class="hs-identifier hs-var">depth</span></a></span></span><span> </span><span id="local-6989586621679464342"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464342"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679464341"><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679464341"><span class="hs-identifier hs-var">content</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Int Double
</span><a href="#local-6989586621679464386"><span class="hs-identifier hs-var">xloc</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464342"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464343"><span class="hs-identifier hs-var">depth</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679464342"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679464341"><span class="hs-identifier hs-var">content</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="hs-comment">-- | Wraps TikZ commands in a @tikzpicture@ environment.</span><span>
</span><span id="line-409"></span><span id="local-6989586621679465081"><span class="annot"><a href="Display.html#tikzPic"><span class="hs-identifier hs-type">tikzPic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="#local-6989586621679465081"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsString</span></span><span> </span><span class="annot"><a href="#local-6989586621679465081"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679465081"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679465081"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-410"></span><span id="tikzPic"><span class="annot"><span class="annottext">tikzPic :: forall a. (Semigroup a, IsString a) =&gt; a -&gt; a
</span><a href="Display.html#tikzPic"><span class="hs-identifier hs-var hs-var">tikzPic</span></a></span></span><span> </span><span id="local-6989586621679464334"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679464334"><span class="hs-identifier hs-var">content</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-411"></span><span>  </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;\\begin{tikzpicture}\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679464334"><span class="hs-identifier hs-var">content</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;\n\\end{tikzpicture}&quot;</span></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span class="hs-comment">{- | Wraps latex code (e.g. a @tikzpicture@) in a complete standalone document.
 This environment includes default styles for slices, transitions, and hori edges.
-}</span><span>
</span><span id="line-416"></span><span id="local-6989586621679465079"><span class="annot"><a href="Display.html#tikzStandalone"><span class="hs-identifier hs-type">tikzStandalone</span></a></span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="#local-6989586621679465079"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsString</span></span><span> </span><span class="annot"><a href="#local-6989586621679465079"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-comment">-- ^ a flag for using the the @varwidth@ option of @standalone@ (needed for multiline content)</span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679465079"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-comment">-- ^ the document content</span><span>
</span><span id="line-422"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679465079"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-423"></span><span id="tikzStandalone"><span class="annot"><span class="annottext">tikzStandalone :: forall a. (Semigroup a, IsString a) =&gt; Bool -&gt; a -&gt; a
</span><a href="Display.html#tikzStandalone"><span class="hs-identifier hs-var hs-var">tikzStandalone</span></a></span></span><span> </span><span id="local-6989586621679464322"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679464322"><span class="hs-identifier hs-var">varwidth</span></a></span></span><span> </span><span id="local-6989586621679464321"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679464321"><span class="hs-identifier hs-var">content</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;\\documentclass&quot;</span></span><span>
</span><span id="line-425"></span><span>    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679464322"><span class="hs-identifier hs-var">varwidth</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;[varwidth]&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;{standalone}\n\
       \\\usepackage[svgnames]{xcolor}\n\
       \\\usepackage{tikz}\n\
       \\\usepackage{amssymb}\n\
       \\\begin{document}\n\
       \\\tikzstyle{slice} = [rectangle,draw,fill=WhiteSmoke,semithick,minimum size=0.4cm,inner xsep=0,inner ysep=3pt,align=center]\n\
       \\\tikzstyle{transition} = [line width=2pt,draw=lightgray]\n\
       \\\tikzstyle{non-terminal} = []\n\
       \\\tikzstyle{terminal} = [double]\n\
       \\\tikzstyle{hori} = [lightgray,dashed,line width=2pt]\n\n&quot;</span></span><span>
</span><span id="line-436"></span><span>    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679464321"><span class="hs-identifier hs-var">content</span></a></span><span>
</span><span id="line-437"></span><span>    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;\n\\end{document}&quot;</span></span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="hs-comment">-- | Write a single derivation graph to a @tex@ file.</span><span>
</span><span id="line-440"></span><span id="local-6989586621679465076"><span id="local-6989586621679465077"><span class="annot"><a href="Display.html#writeGraph"><span class="hs-identifier hs-type">writeGraph</span></a></span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679465077"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679465077"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679465076"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679465076"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465077"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465076"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-442"></span><span id="writeGraph"><span class="annot"><span class="annottext">writeGraph :: forall slc tr.
(Show slc, Eq slc, Eq tr, Show tr) =&gt;
String -&gt; DerivationGraph slc tr -&gt; IO ()
</span><a href="Display.html#writeGraph"><span class="hs-identifier hs-var hs-var">writeGraph</span></a></span></span><span> </span><span id="local-6989586621679464307"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679464307"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621679464306"><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464306"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-443"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679464307"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-444"></span><span>    </span><span class="annot"><span class="annottext">forall a. (Semigroup a, IsString a) =&gt; Bool -&gt; a -&gt; a
</span><a href="Display.html#tikzStandalone"><span class="hs-identifier hs-var">tikzStandalone</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-445"></span><span>      </span><span class="annot"><span class="annottext">forall a. (Semigroup a, IsString a) =&gt; a -&gt; a
</span><a href="Display.html#tikzPic"><span class="hs-identifier hs-var">tikzPic</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-446"></span><span>        </span><span class="annot"><span class="annottext">forall slc tr.
(Eq slc, Eq tr) =&gt;
(slc -&gt; Text) -&gt; (tr -&gt; Text) -&gt; DerivationGraph slc tr -&gt; Text
</span><a href="Display.html#tikzDerivationGraph"><span class="hs-identifier hs-var">tikzDerivationGraph</span></a></span><span>
</span><span id="line-447"></span><span>          </span><span class="annot"><span class="annottext">forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="Common.html#showTexT"><span class="hs-identifier hs-var">showTexT</span></a></span><span>
</span><span id="line-448"></span><span>          </span><span class="annot"><span class="annottext">forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="Common.html#showTexT"><span class="hs-identifier hs-var">showTexT</span></a></span><span>
</span><span id="line-449"></span><span>          </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464306"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span class="hs-comment">-- | Write a single derivation graph to a @tex@ file and compile the file using @pdflatex@.</span><span>
</span><span id="line-452"></span><span id="local-6989586621679465072"><span id="local-6989586621679465073"><span class="annot"><a href="Display.html#viewGraph"><span class="hs-identifier hs-type">viewGraph</span></a></span><span>
</span><span id="line-453"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679465073"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679465072"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679465073"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679465072"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465073"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465072"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-454"></span><span id="viewGraph"><span class="annot"><span class="annottext">viewGraph :: forall slc tr.
(Eq slc, Eq tr, Show slc, Show tr) =&gt;
String -&gt; DerivationGraph slc tr -&gt; IO ()
</span><a href="Display.html#viewGraph"><span class="hs-identifier hs-var hs-var">viewGraph</span></a></span></span><span> </span><span id="local-6989586621679464290"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679464290"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621679464289"><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464289"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-455"></span><span>  </span><span class="annot"><span class="annottext">forall slc tr.
(Show slc, Eq slc, Eq tr, Show tr) =&gt;
String -&gt; DerivationGraph slc tr -&gt; IO ()
</span><a href="Display.html#writeGraph"><span class="hs-identifier hs-var">writeGraph</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679464290"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679464289"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-456"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">callCommand</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pdflatex &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679464290"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span class="hs-comment">-- | Write a several derivation graphs to a @tex@ file.</span><span>
</span><span id="line-459"></span><span id="local-6989586621679465068"><span id="local-6989586621679465069"><span class="annot"><a href="Display.html#writeGraphs"><span class="hs-identifier hs-type">writeGraphs</span></a></span><span>
</span><span id="line-460"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679465069"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679465068"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679465068"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679465069"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465068"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679465069"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-461"></span><span id="writeGraphs"><span class="annot"><span class="annottext">writeGraphs :: forall tr slc.
(Show tr, Show slc, Eq slc, Eq tr) =&gt;
String -&gt; [DerivationGraph slc tr] -&gt; IO ()
</span><a href="Display.html#writeGraphs"><span class="hs-identifier hs-var hs-var">writeGraphs</span></a></span></span><span> </span><span id="local-6989586621679464274"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679464274"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621679464273"><span class="annot"><span class="annottext">[DerivationGraph slc tr]
</span><a href="#local-6989586621679464273"><span class="hs-identifier hs-var">gs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-462"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679464274"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-463"></span><span>    </span><span class="annot"><span class="annottext">forall a. (Semigroup a, IsString a) =&gt; Bool -&gt; a -&gt; a
</span><a href="Display.html#tikzStandalone"><span class="hs-identifier hs-var">tikzStandalone</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-464"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-465"></span><span>        </span><span class="annot"><span class="annottext">forall a. (Semigroup a, IsString a) =&gt; a -&gt; a
</span><a href="Display.html#tikzPic"><span class="hs-identifier hs-var">tikzPic</span></a></span><span>
</span><span id="line-466"></span><span>          </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall slc tr.
(Eq slc, Eq tr) =&gt;
(slc -&gt; Text) -&gt; (tr -&gt; Text) -&gt; DerivationGraph slc tr -&gt; Text
</span><a href="Display.html#tikzDerivationGraph"><span class="hs-identifier hs-var">tikzDerivationGraph</span></a></span><span> </span><span class="annot"><span class="annottext">forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="Common.html#showTexT"><span class="hs-identifier hs-var">showTexT</span></a></span><span> </span><span class="annot"><span class="annottext">forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="Common.html#showTexT"><span class="hs-identifier hs-var">showTexT</span></a></span><span>
</span><span id="line-467"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[DerivationGraph slc tr]
</span><a href="#local-6989586621679464273"><span class="hs-identifier hs-var">gs</span></a></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span class="hs-comment">-- | Write a several derivation graphs to a @tex@ file and compile the file using @pdflatex@.</span><span>
</span><span id="line-470"></span><span id="local-6989586621679464271"><span id="local-6989586621679464272"><span class="annot"><a href="Display.html#viewGraphs"><span class="hs-identifier hs-type">viewGraphs</span></a></span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679464272"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679464271"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679464271"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679464272"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464271"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464272"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-472"></span><span id="viewGraphs"><span class="annot"><span class="annottext">viewGraphs :: forall tr slc.
(Show tr, Show slc, Eq slc, Eq tr) =&gt;
String -&gt; [DerivationGraph slc tr] -&gt; IO ()
</span><a href="Display.html#viewGraphs"><span class="hs-identifier hs-var hs-var">viewGraphs</span></a></span></span><span> </span><span id="local-6989586621679464258"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679464258"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621679464257"><span class="annot"><span class="annottext">[DerivationGraph slc tr]
</span><a href="#local-6989586621679464257"><span class="hs-identifier hs-var">gs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-473"></span><span>  </span><span class="annot"><span class="annottext">forall tr slc.
(Show tr, Show slc, Eq slc, Eq tr) =&gt;
String -&gt; [DerivationGraph slc tr] -&gt; IO ()
</span><a href="Display.html#writeGraphs"><span class="hs-identifier hs-var">writeGraphs</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679464258"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">[DerivationGraph slc tr]
</span><a href="#local-6989586621679464257"><span class="hs-identifier hs-var">gs</span></a></span><span>
</span><span id="line-474"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">callCommand</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pdflatex &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679464258"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-475"></span></pre></body></html>