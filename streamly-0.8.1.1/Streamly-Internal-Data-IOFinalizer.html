<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Streamly.Internal.Data.IOFinalizer</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">streamly-0.8.1.1: Dataflow programming and declarative concurrency</span><ul class="links" id="page-menu"><li><a href="src/Streamly.Internal.Data.IOFinalizer.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) 2020 Composewell Technologies and Contributors</td></tr><tr><th>License</th><td>BSD-3-Clause</td></tr><tr><th>Maintainer</th><td>streamly@composewell.com</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Portability</th><td>GHC</td></tr><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Streamly.Internal.Data.IOFinalizer</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>A value associated with an IO action that is automatically called whenever
 the value is garbage collected.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:IOFinalizer">IOFinalizer</a></li><li class="src short"><a href="#v:newIOFinalizer">newIOFinalizer</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m) =&gt; m a -&gt; m <a href="Streamly-Internal-Data-IOFinalizer.html#t:IOFinalizer" title="Streamly.Internal.Data.IOFinalizer">IOFinalizer</a></li><li class="src short"><a href="#v:runIOFinalizer">runIOFinalizer</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-IOFinalizer.html#t:IOFinalizer" title="Streamly.Internal.Data.IOFinalizer">IOFinalizer</a> -&gt; m ()</li><li class="src short"><a href="#v:clearingIOFinalizer">clearingIOFinalizer</a> :: <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m =&gt; <a href="Streamly-Internal-Data-IOFinalizer.html#t:IOFinalizer" title="Streamly.Internal.Data.IOFinalizer">IOFinalizer</a> -&gt; m a -&gt; m a</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:IOFinalizer" class="def">IOFinalizer</a> <a href="src/Streamly.Internal.Data.IOFinalizer.html#IOFinalizer" class="link">Source</a> <a href="#t:IOFinalizer" class="selflink">#</a></p><div class="doc"><p>An <code><a href="Streamly-Internal-Data-IOFinalizer.html#t:IOFinalizer" title="Streamly.Internal.Data.IOFinalizer">IOFinalizer</a></code> has an associated IO action that is automatically called
 whenever the finalizer is garbage collected. The action can be run and
 cleared prematurely.</p><p>You can hold a reference to the finalizer in your data structure, if the
 data structure gets garbage collected the finalizer will be called.</p><p>It is implemented using <code><a href="../base-4.16.4.0/Data-IORef.html#v:mkWeakIORef" title="Data.IORef">mkWeakIORef</a></code>.</p><p><em>Pre-release</em></p></div></div><div class="top"><p class="src"><a id="v:newIOFinalizer" class="def">newIOFinalizer</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m) =&gt; m a -&gt; m <a href="Streamly-Internal-Data-IOFinalizer.html#t:IOFinalizer" title="Streamly.Internal.Data.IOFinalizer">IOFinalizer</a> <a href="src/Streamly.Internal.Data.IOFinalizer.html#newIOFinalizer" class="link">Source</a> <a href="#v:newIOFinalizer" class="selflink">#</a></p><div class="doc"><p>Create a finalizer that calls the supplied function automatically when the
 it is garbage collected.</p><p>/The finalizer is always run using the state of the monad that is captured
 at the time of calling <code>newFinalizer</code>./</p><p>Note: To run it on garbage collection we have no option but to use the monad
 state captured at some earlier point of time.  For the case when the
 finalizer is run manually before GC we could run it with the current state
 of the monad but we want to keep both the cases consistent.</p><p><em>Pre-release</em></p></div></div><div class="top"><p class="src"><a id="v:runIOFinalizer" class="def">runIOFinalizer</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-IOFinalizer.html#t:IOFinalizer" title="Streamly.Internal.Data.IOFinalizer">IOFinalizer</a> -&gt; m () <a href="src/Streamly.Internal.Data.IOFinalizer.html#runIOFinalizer" class="link">Source</a> <a href="#v:runIOFinalizer" class="selflink">#</a></p><div class="doc"><p>Run the action associated with the finalizer and deactivate it so that it
 never runs again.  Note, the finalizing action runs with async exceptions
 masked.</p><p><em>Pre-release</em></p></div></div><div class="top"><p class="src"><a id="v:clearingIOFinalizer" class="def">clearingIOFinalizer</a> :: <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m =&gt; <a href="Streamly-Internal-Data-IOFinalizer.html#t:IOFinalizer" title="Streamly.Internal.Data.IOFinalizer">IOFinalizer</a> -&gt; m a -&gt; m a <a href="src/Streamly.Internal.Data.IOFinalizer.html#clearingIOFinalizer" class="link">Source</a> <a href="#v:clearingIOFinalizer" class="selflink">#</a></p><div class="doc"><p>Run an action clearing the finalizer atomically wrt async exceptions. The
 action is run with async exceptions masked.</p><p><em>Pre-release</em></p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.26.0</p></div></body></html>