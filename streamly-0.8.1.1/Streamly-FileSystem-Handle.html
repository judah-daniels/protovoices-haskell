<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Streamly.FileSystem.Handle</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">streamly-0.8.1.1: Dataflow programming and declarative concurrency</span><ul class="links" id="page-menu"><li><a href="src/Streamly.FileSystem.Handle.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) 2018 Composewell Technologies</td></tr><tr><th>License</th><td>BSD3</td></tr><tr><th>Maintainer</th><td>streamly@composewell.com</td></tr><tr><th>Stability</th><td>released</td></tr><tr><th>Portability</th><td>GHC</td></tr><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Streamly.FileSystem.Handle</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Singleton IO</a></li><li><a href="#g:2">Streaming IO</a><ul><li><a href="#g:3">Reading</a></li><li><a href="#g:4">Writing</a></li></ul></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import qualified Streamly.FileSystem.Handle as Handle
</code></strong></pre><p>Read and write byte streams and array streams to and from file handles
 (<code>Handle</code>).</p><p>The <code>TextEncoding</code>, <code>NewLineMode</code>, and <code>Buffering</code> options of the underlying
 GHC <code>Handle</code> are ignored by these APIs. Please use <code>Streamly.Unicode.*</code>
 modules for encoding and decoding a byte stream, use stream splitting
 operations in <a href="Streamly-Prelude.html">Streamly.Prelude</a> to create a stream of lines or to split the
 input stream on any other type of boundaries.</p><p>To set the read or write start position use <code>hSeek</code> on the <code>Handle</code>, the
 <code><a href="Streamly-Prelude.html#v:before" title="Streamly.Prelude">before</a></code> combinator may be used to do that on a streaming
 combinator.  To restrict the length of read or write use the stream trimming
 operations like <code><a href="Streamly-Prelude.html#v:take" title="Streamly.Prelude">take</a></code>.</p><p>Note that a <code>Handle</code> is inherently stateful, therefore, we cannot use these
 APIs from multiple threads without serialization; reading or writing in one
 thread would affect the file position for other threads.</p><p>For additional, experimental APIs take a look at
 <a href="Streamly-Internal-FileSystem-Handle.html">Streamly.Internal.FileSystem.Handle</a> module.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:getChunk">getChunk</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a> -&gt; m (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a>)</li><li class="src short"><a href="#v:putChunk">putChunk</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a> -&gt; <a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> a -&gt; m ()</li><li class="src short"><a href="#v:read">read</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a></li><li class="src short"><a href="#v:readWithBufferOf">readWithBufferOf</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m (<a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a>, <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a>) <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a></li><li class="src short"><a href="#v:readChunks">readChunks</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a> (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a>)</li><li class="src short"><a href="#v:readChunksWithBufferOf">readChunksWithBufferOf</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m (<a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a>, <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a>) (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a>)</li><li class="src short"><a href="#v:write">write</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> ()</li><li class="src short"><a href="#v:writeWithBufferOf">writeWithBufferOf</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> ()</li><li class="src short"><a href="#v:writeChunks">writeChunks</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> a) ()</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Singleton IO</h1></a><div class="doc"><p>Read or write a single buffer.</p></div><div class="top"><p class="src"><a id="v:getChunk" class="def">getChunk</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a> -&gt; m (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a>) <a href="src/Streamly.Internal.FileSystem.Handle.html#getChunk" class="link">Source</a> <a href="#v:getChunk" class="selflink">#</a></p><div class="doc"><p>Read a <code>ByteArray</code> consisting of one or more bytes from a file handle. If
 no data is available on the handle it blocks until at least one byte becomes
 available. If any data is available then it immediately returns that data
 without blocking. As a result of this behavior, it may read less than or
 equal to the size requested.</p><p><em>Since: 0.8.1</em></p></div></div><div class="top"><p class="src"><a id="v:putChunk" class="def">putChunk</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a> -&gt; <a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> a -&gt; m () <a href="src/Streamly.Internal.FileSystem.Handle.html#putChunk" class="link">Source</a> <a href="#v:putChunk" class="selflink">#</a></p><div class="doc"><p>Write an <code><a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a></code> to a file handle.</p><p><em>Since: 0.8.1</em></p></div></div><a href="#g:2" id="g:2"><h1>Streaming IO</h1></a><div class="doc"><p>Read or write a stream of data to or from a file or device
 sequentially.</p><p>Read requests to the IO device are performed in chunks limited to a
 maximum size of <code><a href="Streamly-Internal-System-IO.html#v:defaultChunkSize" title="Streamly.Internal.System.IO">defaultChunkSize</a></code>.  Note
 that the size of the actual chunks in the resulting stream may be less
 than the <code>defaultChunkSize</code> but it can never exceed it.  If the whole
 stream is not consumed, it is possible that we may have read slightly
 more from the IO device than what the consumer needed.</p><p>Unless specified otherwise in the API, writes are collected into chunks
 of <code><a href="Streamly-Internal-System-IO.html#v:defaultChunkSize" title="Streamly.Internal.System.IO">defaultChunkSize</a></code> before they are
 written to the IO device.</p></div><a href="#g:3" id="g:3"><h2>Reading</h2></a><div class="doc"><p><code>TextEncoding</code>, <code>NewLineMode</code>, and <code>Buffering</code> options of the
 underlying handle are ignored. The read occurs from the current seek
 position of the file handle. The stream ends as soon as EOF is
 encountered.</p></div><div class="top"><p class="src"><a id="v:read" class="def">read</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> <a href="src/Streamly.Internal.FileSystem.Handle.html#read" class="link">Source</a> <a href="#v:read" class="selflink">#</a></p><div class="doc"><p>Unfolds a file handle into a byte stream. IO requests to the device are
 performed in sizes of
 <code><a href="Streamly-Internal-Data-Array-Foreign-Type.html#v:defaultChunkSize" title="Streamly.Internal.Data.Array.Foreign.Type">defaultChunkSize</a></code>.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>read = Unfold.many Handle.readChunks Array.read
</code></strong></pre><p><em>Since: 0.7.0</em></p></div></div><div class="top"><p class="src"><a id="v:readWithBufferOf" class="def">readWithBufferOf</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m (<a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a>, <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a>) <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> <a href="src/Streamly.Internal.FileSystem.Handle.html#readWithBufferOf" class="link">Source</a> <a href="#v:readWithBufferOf" class="selflink">#</a></p><div class="doc"><p>Unfolds the tuple <code>(bufsize, handle)</code> into a byte stream, read requests
 to the IO device are performed using buffers of <code>bufsize</code>.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>readWithBufferOf = Unfold.many Handle.readChunksWithBufferOf Array.read
</code></strong></pre><p><em>Since: 0.7.0</em></p></div></div><div class="top"><p class="src"><a id="v:readChunks" class="def">readChunks</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a> (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a>) <a href="src/Streamly.Internal.FileSystem.Handle.html#readChunks" class="link">Source</a> <a href="#v:readChunks" class="selflink">#</a></p><div class="doc"><p>Unfolds a handle into a stream of <code><a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a></code> arrays. Requests to the IO
 device are performed using a buffer of size
 <code><a href="Streamly-Internal-Data-Array-Foreign-Type.html#v:defaultChunkSize" title="Streamly.Internal.Data.Array.Foreign.Type">defaultChunkSize</a></code>. The
 size of arrays in the resulting stream are therefore less than or equal to
 <code><a href="Streamly-Internal-Data-Array-Foreign-Type.html#v:defaultChunkSize" title="Streamly.Internal.Data.Array.Foreign.Type">defaultChunkSize</a></code>.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>readChunks = Unfold.supplyFirst IO.defaultChunkSize Handle.readChunksWithBufferOf
</code></strong></pre><p><em>Since: 0.7.0</em></p></div></div><div class="top"><p class="src"><a id="v:readChunksWithBufferOf" class="def">readChunksWithBufferOf</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m (<a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a>, <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a>) (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a>) <a href="src/Streamly.Internal.FileSystem.Handle.html#readChunksWithBufferOf" class="link">Source</a> <a href="#v:readChunksWithBufferOf" class="selflink">#</a></p><div class="doc"><p>Unfold the tuple <code>(bufsize, handle)</code> into a stream of <code><a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a></code> arrays.
 Read requests to the IO device are performed using a buffer of size
 <code>bufsize</code>.  The size of an array in the resulting stream is always less than
 or equal to <code>bufsize</code>.</p><p><em>Since: 0.7.0</em></p></div></div><a href="#g:4" id="g:4"><h2>Writing</h2></a><div class="doc"><p><code>TextEncoding</code>, <code>NewLineMode</code>, and <code>Buffering</code> options of the
 underlying handle are ignored. The write occurs from the current seek
 position of the file handle.  The write behavior depends on the <code>IOMode</code>
 of the handle.</p></div><div class="top"><p class="src"><a id="v:write" class="def">write</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> () <a href="src/Streamly.Internal.FileSystem.Handle.html#write" class="link">Source</a> <a href="#v:write" class="selflink">#</a></p><div class="doc"><p>Write a byte stream to a file handle. Accumulates the input in chunks of
 up to <code><a href="Streamly-Internal-Data-Array-Foreign-Type.html#v:defaultChunkSize" title="Streamly.Internal.Data.Array.Foreign.Type">defaultChunkSize</a></code> before writing
 to the IO device.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>write = Handle.writeWithBufferOf IO.defaultChunkSize
</code></strong></pre><p><em>Since: 0.7.0</em></p></div></div><div class="top"><p class="src"><a id="v:writeWithBufferOf" class="def">writeWithBufferOf</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> () <a href="src/Streamly.Internal.FileSystem.Handle.html#writeWithBufferOf" class="link">Source</a> <a href="#v:writeWithBufferOf" class="selflink">#</a></p><div class="doc"><p><code>writeWithBufferOf reqSize handle</code> writes the input stream to <code>handle</code>.
 Bytes in the input stream are collected into a buffer until we have a chunk
 of <code>reqSize</code> and then written to the IO device.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>writeWithBufferOf n h = Fold.chunksOf n (Array.writeNUnsafe n) (Handle.writeChunks h)
</code></strong></pre><p><em>Since: 0.7.0</em></p></div></div><div class="top"><p class="src"><a id="v:writeChunks" class="def">writeChunks</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/System-IO.html#t:Handle" title="System.IO">Handle</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> a) () <a href="src/Streamly.Internal.FileSystem.Handle.html#writeChunks" class="link">Source</a> <a href="#v:writeChunks" class="selflink">#</a></p><div class="doc"><p>Write a stream of arrays to a handle. Each array in the stream is written
 to the device as a separate IO request.</p><p>writeChunks h = Fold.drainBy (Handle.putChunk h)</p><p><em>Since: 0.7.0</em></p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.26.0</p></div></body></html>