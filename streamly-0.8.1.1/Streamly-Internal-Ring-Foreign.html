<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Streamly.Internal.Ring.Foreign</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">streamly-0.8.1.1: Dataflow programming and declarative concurrency</span><ul class="links" id="page-menu"><li><a href="src/Streamly.Internal.Ring.Foreign.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) 2019 Composewell Technologies</td></tr><tr><th>License</th><td>BSD3</td></tr><tr><th>Maintainer</th><td>streamly@composewell.com</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Portability</th><td>GHC</td></tr><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Streamly.Internal.Ring.Foreign</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Type</a></li><li><a href="#g:2">Construction</a></li><li><a href="#g:3">Random writes</a></li><li><a href="#g:4">Unfolds</a></li><li><a href="#g:5">Random reads</a></li><li><a href="#g:6">Size</a></li><li><a href="#g:7">Casting</a></li><li><a href="#g:8">Folds</a></li><li><a href="#g:9">Stream of Arrays</a></li><li><a href="#g:10">Fast Byte Comparisons</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>A ring array is a circular mutable array.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:Ring">Ring</a> a = <a href="#v:Ring">Ring</a> {<ul class="subs"><li><a href="#v:ringStart">ringStart</a> :: !(<a href="../base-4.16.4.0/Foreign-ForeignPtr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a)</li><li><a href="#v:ringBound">ringBound</a> :: !(<a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a)</li></ul>}</li><li class="src short"><a href="#v:new">new</a> :: <span class="keyword">forall</span> a. <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a, <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a)</li><li class="src short"><a href="#v:newRing">newRing</a> :: <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; m (<a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a)</li><li class="src short"><a href="#v:writeN">writeN</a> :: <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m a (<a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a)</li><li class="src short"><a href="#v:advance">advance</a> :: <span class="keyword">forall</span> a. <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a</li><li class="src short"><a href="#v:moveBy">moveBy</a> :: <span class="keyword">forall</span> a. <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a</li><li class="src short"><a href="#v:startOf">startOf</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a</li><li class="src short"><a href="#v:unsafeInsert">unsafeInsert</a> :: <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; a -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a)</li><li class="src short"><a href="#v:slide">slide</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; a -&gt; m (<a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a)</li><li class="src short"><a href="#v:putIndex">putIndex</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; a -&gt; m ()</li><li class="src short"><a href="#v:modifyIndex">modifyIndex</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; (a -&gt; (a, b)) -&gt; m b</li><li class="src short"><a href="#v:read">read</a> :: <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m (<a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a) a</li><li class="src short"><a href="#v:readRev">readRev</a> :: <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) a</li><li class="src short"><a href="#v:getIndex">getIndex</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; m a</li><li class="src short"><a href="#v:getIndexUnsafe">getIndexUnsafe</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; m a</li><li class="src short"><a href="#v:getIndexRev">getIndexRev</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; m a</li><li class="src short"><a href="#v:length">length</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:byteLength">byteLength</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:byteCapacity">byteCapacity</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:bytesFree">bytesFree</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:cast">cast</a> :: <span class="keyword">forall</span> a b. <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> b =&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> b)</li><li class="src short"><a href="#v:castUnsafe">castUnsafe</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> b</li><li class="src short"><a href="#v:asBytes">asBytes</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a></li><li class="src short"><a href="#v:fromArray">fromArray</a> :: <a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a -&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a</li><li class="src short"><a href="#v:unsafeFoldRing">unsafeFoldRing</a> :: <span class="keyword">forall</span> a b. <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; b</li><li class="src short"><a href="#v:unsafeFoldRingM">unsafeFoldRingM</a> :: <span class="keyword">forall</span> m a b. (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; (b -&gt; a -&gt; m b) -&gt; b -&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; m b</li><li class="src short"><a href="#v:unsafeFoldRingFullM">unsafeFoldRingFullM</a> :: <span class="keyword">forall</span> m a b. (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; (b -&gt; a -&gt; m b) -&gt; b -&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; m b</li><li class="src short"><a href="#v:unsafeFoldRingNM">unsafeFoldRingNM</a> :: <span class="keyword">forall</span> m a b. (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; (b -&gt; a -&gt; m b) -&gt; b -&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; m b</li><li class="src short"><a href="#v:ringsOf">ringsOf</a> :: <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m a -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a)</li><li class="src short"><a href="#v:unsafeEqArray">unsafeEqArray</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> a -&gt; <a href="../base-4.16.4.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li class="src short"><a href="#v:unsafeEqArrayN">unsafeEqArrayN</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.16.4.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Type</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Ring" class="def">Ring</a> a <a href="src/Streamly.Internal.Ring.Foreign.html#Ring" class="link">Source</a> <a href="#t:Ring" class="selflink">#</a></p><div class="doc"><p>A ring buffer is a mutable array of fixed size. Initially the array is
 empty, with ringStart pointing at the start of allocated memory. We call the
 next location to be written in the ring as ringHead. Initially ringHead ==
 ringStart. When the first item is added, ringHead points to ringStart +
 sizeof item. When the buffer becomes full ringHead would wrap around to
 ringStart. When the buffer is full, ringHead always points at the oldest
 item in the ring and the newest item added always overwrites the oldest
 item.</p><p>When using it we should keep in mind that a ringBuffer is a mutable data
 structure. We should not leak out references to it for immutable use.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Ring" class="def">Ring</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:ringStart" class="def">ringStart</a> :: !(<a href="../base-4.16.4.0/Foreign-ForeignPtr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a)</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:ringBound" class="def">ringBound</a> :: !(<a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a)</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><a href="#g:2" id="g:2"><h1>Construction</h1></a><div class="top"><p class="src"><a id="v:new" class="def">new</a> :: <span class="keyword">forall</span> a. <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a, <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a) <a href="src/Streamly.Internal.Ring.Foreign.html#new" class="link">Source</a> <a href="#v:new" class="selflink">#</a></p><div class="doc"><p>Create a new ringbuffer and return the ring buffer and the ringHead.
 Returns the ring and the ringHead, the ringHead is same as ringStart.</p></div></div><div class="top"><p class="src"><a id="v:newRing" class="def">newRing</a> :: <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; m (<a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a) <a href="src/Streamly.Internal.Ring.Foreign.html#newRing" class="link">Source</a> <a href="#v:newRing" class="selflink">#</a></p><div class="doc"><p><code>newRing count</code> allocates an empty array that can hold <code>count</code> items.  The
 memory of the array is uninitialized and the allocation is aligned as per
 the <code><a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a></code> instance of the type.</p><p><em>Unimplemented</em></p></div></div><div class="top"><p class="src"><a id="v:writeN" class="def">writeN</a> :: <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m a (<a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a) <a href="src/Streamly.Internal.Ring.Foreign.html#writeN" class="link">Source</a> <a href="#v:writeN" class="selflink">#</a></p><div class="doc"><p><code>writeN n</code> is a rolling fold that keeps the last n elements of the stream
 in a ring array.</p><p><em>Unimplemented</em></p></div></div><div class="top"><p class="src"><a id="v:advance" class="def">advance</a> :: <span class="keyword">forall</span> a. <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a <a href="src/Streamly.Internal.Ring.Foreign.html#advance" class="link">Source</a> <a href="#v:advance" class="selflink">#</a></p><div class="doc"><p>Advance the ringHead by 1 item, wrap around if we hit the end of the
 array.</p></div></div><div class="top"><p class="src"><a id="v:moveBy" class="def">moveBy</a> :: <span class="keyword">forall</span> a. <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a <a href="src/Streamly.Internal.Ring.Foreign.html#moveBy" class="link">Source</a> <a href="#v:moveBy" class="selflink">#</a></p><div class="doc"><p>Move the ringHead by n items. The direction depends on the sign on whether
 n is positive or negative. Wrap around if we hit the beginning or end of the
 array.</p></div></div><div class="top"><p class="src"><a id="v:startOf" class="def">startOf</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a <a href="src/Streamly.Internal.Ring.Foreign.html#startOf" class="link">Source</a> <a href="#v:startOf" class="selflink">#</a></p><div class="doc"><p>Get the first address of the ring as a pointer.</p></div></div><a href="#g:3" id="g:3"><h1>Random writes</h1></a><div class="top"><p class="src"><a id="v:unsafeInsert" class="def">unsafeInsert</a> :: <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; a -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a) <a href="src/Streamly.Internal.Ring.Foreign.html#unsafeInsert" class="link">Source</a> <a href="#v:unsafeInsert" class="selflink">#</a></p><div class="doc"><p>Insert an item at the head of the ring, when the ring is full this
 replaces the oldest item in the ring with the new item. This is unsafe
 beause ringHead supplied is not verified to be within the Ring. Also,
 the ringStart foreignPtr must be guaranteed to be alive by the caller.</p></div></div><div class="top"><p class="src"><a id="v:slide" class="def">slide</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; a -&gt; m (<a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a) <a href="src/Streamly.Internal.Ring.Foreign.html#slide" class="link">Source</a> <a href="#v:slide" class="selflink">#</a></p><div class="doc"><p>Insert an item at the head of the ring, when the ring is full this
 replaces the oldest item in the ring with the new item.</p><p><em>Unimplemented</em></p></div></div><div class="top"><p class="src"><a id="v:putIndex" class="def">putIndex</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; a -&gt; m () <a href="src/Streamly.Internal.Ring.Foreign.html#putIndex" class="link">Source</a> <a href="#v:putIndex" class="selflink">#</a></p><div class="doc"><p><em>O(1)</em> Write the given element at the given index in the ring array.
 Performs in-place mutation of the array.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>putIndex arr ix val = Ring.modifyIndex arr ix (const (val, ()))
</code></strong></pre><p><em>Unimplemented</em></p></div></div><div class="top"><p class="src"><a id="v:modifyIndex" class="def">modifyIndex</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; (a -&gt; (a, b)) -&gt; m b <a href="src/Streamly.Internal.Ring.Foreign.html#modifyIndex" class="link">Source</a> <a href="#v:modifyIndex" class="selflink">#</a></p><div class="doc"><p>Modify a given index of a ring array using a modifier function.</p><p><em>Unimplemented</em></p></div></div><a href="#g:4" id="g:4"><h1>Unfolds</h1></a><div class="top"><p class="src"><a id="v:read" class="def">read</a> :: <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m (<a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a) a <a href="src/Streamly.Internal.Ring.Foreign.html#read" class="link">Source</a> <a href="#v:read" class="selflink">#</a></p><div class="doc"><p>Unfold a ring array into a stream.</p><p><em>Unimplemented</em></p></div></div><div class="top"><p class="src"><a id="v:readRev" class="def">readRev</a> :: <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) a <a href="src/Streamly.Internal.Ring.Foreign.html#readRev" class="link">Source</a> <a href="#v:readRev" class="selflink">#</a></p><div class="doc"><p>Unfold a ring array into a stream in reverse order.</p><p><em>Unimplemented</em></p></div></div><a href="#g:5" id="g:5"><h1>Random reads</h1></a><div class="top"><p class="src"><a id="v:getIndex" class="def">getIndex</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; m a <a href="src/Streamly.Internal.Ring.Foreign.html#getIndex" class="link">Source</a> <a href="#v:getIndex" class="selflink">#</a></p><div class="doc"><p><em>O(1)</em> Lookup the element at the given index. Index starts from 0.</p></div></div><div class="top"><p class="src"><a id="v:getIndexUnsafe" class="def">getIndexUnsafe</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; m a <a href="src/Streamly.Internal.Ring.Foreign.html#getIndexUnsafe" class="link">Source</a> <a href="#v:getIndexUnsafe" class="selflink">#</a></p><div class="doc"><p>Return the element at the specified index without checking the bounds.</p><p>Unsafe because it does not check the bounds of the ring array.</p></div></div><div class="top"><p class="src"><a id="v:getIndexRev" class="def">getIndexRev</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; m a <a href="src/Streamly.Internal.Ring.Foreign.html#getIndexRev" class="link">Source</a> <a href="#v:getIndexRev" class="selflink">#</a></p><div class="doc"><p><em>O(1)</em> Lookup the element at the given index from the end of the array.
 Index starts from 0.</p><p>Slightly faster than computing the forward index and using getIndex.</p></div></div><a href="#g:6" id="g:6"><h1>Size</h1></a><div class="top"><p class="src"><a id="v:length" class="def">length</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Streamly.Internal.Ring.Foreign.html#length" class="link">Source</a> <a href="#v:length" class="selflink">#</a></p><div class="doc"><p><em>O(1)</em> Get the length of the array i.e. the number of elements in the
 array.</p><p>Note that <code><a href="Streamly-Internal-Ring-Foreign.html#v:byteLength" title="Streamly.Internal.Ring.Foreign">byteLength</a></code> is less expensive than this operation, as <code><a href="Streamly-Internal-Ring-Foreign.html#v:length" title="Streamly.Internal.Ring.Foreign">length</a></code>
 involves a costly division operation.</p><p><em>Unimplemented</em></p></div></div><div class="top"><p class="src"><a id="v:byteLength" class="def">byteLength</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Streamly.Internal.Ring.Foreign.html#byteLength" class="link">Source</a> <a href="#v:byteLength" class="selflink">#</a></p><div class="doc"><p><em>O(1)</em> Get the byte length of the array.</p><p><em>Unimplemented</em></p></div></div><div class="top"><p class="src"><a id="v:byteCapacity" class="def">byteCapacity</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Streamly.Internal.Ring.Foreign.html#byteCapacity" class="link">Source</a> <a href="#v:byteCapacity" class="selflink">#</a></p><div class="doc"><p>Get the total capacity of an array. An array may have space reserved
 beyond the current used length of the array.</p><p><em>Pre-release</em></p></div></div><div class="top"><p class="src"><a id="v:bytesFree" class="def">bytesFree</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Streamly.Internal.Ring.Foreign.html#bytesFree" class="link">Source</a> <a href="#v:bytesFree" class="selflink">#</a></p><div class="doc"><p>The remaining capacity in the array for appending more elements without
 reallocation.</p><p><em>Pre-release</em></p></div></div><a href="#g:7" id="g:7"><h1>Casting</h1></a><div class="top"><p class="src"><a id="v:cast" class="def">cast</a> :: <span class="keyword">forall</span> a b. <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> b =&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> b) <a href="src/Streamly.Internal.Ring.Foreign.html#cast" class="link">Source</a> <a href="#v:cast" class="selflink">#</a></p><div class="doc"><p>Cast an array having elements of type <code>a</code> into an array having elements of
 type <code>b</code>. The length of the array should be a multiple of the size of the
 target element otherwise <code><a href="../base-4.16.4.0/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code> is returned.</p><p><em>Pre-release</em></p></div></div><div class="top"><p class="src"><a id="v:castUnsafe" class="def">castUnsafe</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> b <a href="src/Streamly.Internal.Ring.Foreign.html#castUnsafe" class="link">Source</a> <a href="#v:castUnsafe" class="selflink">#</a></p><div class="doc"><p>Cast an array having elements of type <code>a</code> into an array having elements of
 type <code>b</code>. The array size must be a multiple of the size of type <code>b</code>.</p><p><em>Unimplemented</em></p></div></div><div class="top"><p class="src"><a id="v:asBytes" class="def">asBytes</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> <a href="src/Streamly.Internal.Ring.Foreign.html#asBytes" class="link">Source</a> <a href="#v:asBytes" class="selflink">#</a></p><div class="doc"><p>Cast an <code>Array a</code> into an <code>Array Word8</code>.</p><p><em>Unimplemented</em></p></div></div><div class="top"><p class="src"><a id="v:fromArray" class="def">fromArray</a> :: <a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a -&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a <a href="src/Streamly.Internal.Ring.Foreign.html#fromArray" class="link">Source</a> <a href="#v:fromArray" class="selflink">#</a></p><div class="doc"><p>Cast a mutable array to a ring array.</p></div></div><a href="#g:8" id="g:8"><h1>Folds</h1></a><div class="top"><p class="src"><a id="v:unsafeFoldRing" class="def">unsafeFoldRing</a> :: <span class="keyword">forall</span> a b. <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; b <a href="src/Streamly.Internal.Ring.Foreign.html#unsafeFoldRing" class="link">Source</a> <a href="#v:unsafeFoldRing" class="selflink">#</a></p><div class="doc"><p>Fold the buffer starting from ringStart up to the given <code><a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a></code> using a pure
 step function. This is useful to fold the items in the ring when the ring is
 not full. The supplied pointer is usually the end of the ring.</p><p>Unsafe because the supplied Ptr is not checked to be in range.</p></div></div><div class="top"><p class="src"><a id="v:unsafeFoldRingM" class="def">unsafeFoldRingM</a> :: <span class="keyword">forall</span> m a b. (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; (b -&gt; a -&gt; m b) -&gt; b -&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; m b <a href="src/Streamly.Internal.Ring.Foreign.html#unsafeFoldRingM" class="link">Source</a> <a href="#v:unsafeFoldRingM" class="selflink">#</a></p><div class="doc"><p>Like unsafeFoldRing but with a monadic step function.</p></div></div><div class="top"><p class="src"><a id="v:unsafeFoldRingFullM" class="def">unsafeFoldRingFullM</a> :: <span class="keyword">forall</span> m a b. (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; (b -&gt; a -&gt; m b) -&gt; b -&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; m b <a href="src/Streamly.Internal.Ring.Foreign.html#unsafeFoldRingFullM" class="link">Source</a> <a href="#v:unsafeFoldRingFullM" class="selflink">#</a></p><div class="doc"><p>Fold the entire length of a ring buffer starting at the supplied ringHead
 pointer.  Assuming the supplied ringHead pointer points to the oldest item,
 this would fold the ring starting from the oldest item to the newest item in
 the ring.</p><p>Note, this will crash on ring of 0 size.</p></div></div><div class="top"><p class="src"><a id="v:unsafeFoldRingNM" class="def">unsafeFoldRingNM</a> :: <span class="keyword">forall</span> m a b. (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; (b -&gt; a -&gt; m b) -&gt; b -&gt; <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; m b <a href="src/Streamly.Internal.Ring.Foreign.html#unsafeFoldRingNM" class="link">Source</a> <a href="#v:unsafeFoldRingNM" class="selflink">#</a></p><div class="doc"><p>Fold <code>Int</code> items in the ring starting at <code>Ptr a</code>.  Won't fold more
 than the length of the ring.</p><p>Note, this will crash on ring of 0 size.</p></div></div><a href="#g:9" id="g:9"><h1>Stream of Arrays</h1></a><div class="top"><p class="src"><a id="v:ringsOf" class="def">ringsOf</a> :: <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m a -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) <a href="src/Streamly.Internal.Ring.Foreign.html#ringsOf" class="link">Source</a> <a href="#v:ringsOf" class="selflink">#</a></p><div class="doc"><p><code>ringsOf n stream</code> groups the input stream into a stream of
 ring arrays of size n. Each ring is a sliding window of size n.</p><p><em>Unimplemented</em></p></div></div><a href="#g:10" id="g:10"><h1>Fast Byte Comparisons</h1></a><div class="top"><p class="src"><a id="v:unsafeEqArray" class="def">unsafeEqArray</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> a -&gt; <a href="../base-4.16.4.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="src/Streamly.Internal.Ring.Foreign.html#unsafeEqArray" class="link">Source</a> <a href="#v:unsafeEqArray" class="selflink">#</a></p><div class="doc"><p>Byte compare the entire length of ringBuffer with the given array,
 starting at the supplied ringHead pointer.  Returns true if the Array and
 the ringBuffer have identical contents.</p><p>This is unsafe because the ringHead Ptr is not checked to be in range. The
 supplied array must be equal to or bigger than the ringBuffer, ARRAY BOUNDS
 ARE NOT CHECKED.</p></div></div><div class="top"><p class="src"><a id="v:unsafeEqArrayN" class="def">unsafeEqArrayN</a> :: <a href="Streamly-Internal-Ring-Foreign.html#t:Ring" title="Streamly.Internal.Ring.Foreign">Ring</a> a -&gt; <a href="../base-4.16.4.0/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> a -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.16.4.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="src/Streamly.Internal.Ring.Foreign.html#unsafeEqArrayN" class="link">Source</a> <a href="#v:unsafeEqArrayN" class="selflink">#</a></p><div class="doc"><p>Like <code><a href="Streamly-Internal-Ring-Foreign.html#v:unsafeEqArray" title="Streamly.Internal.Ring.Foreign">unsafeEqArray</a></code> but compares only N bytes instead of entire length of
 the ring buffer. This is unsafe because the ringHead Ptr is not checked to
 be in range.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.26.0</p></div></body></html>