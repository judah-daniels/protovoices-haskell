<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Streamly.Network.Socket</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">streamly-0.8.1.1: Dataflow programming and declarative concurrency</span><ul class="links" id="page-menu"><li><a href="src/Streamly.Network.Socket.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) 2018 Composewell Technologies</td></tr><tr><th>License</th><td>BSD-3-Clause</td></tr><tr><th>Maintainer</th><td>streamly@composewell.com</td></tr><tr><th>Stability</th><td>released</td></tr><tr><th>Portability</th><td>GHC</td></tr><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Streamly.Network.Socket</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Socket Specification</a></li><li><a href="#g:2">Accept Connections</a></li><li><a href="#g:3">Read</a></li><li><a href="#g:4">Write</a></li><li><a href="#g:5">Exceptions</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module provides Array and stream based socket operations to connect to
 remote hosts, to receive connections from remote hosts, and to read and
 write streams and arrays of bytes to and from network sockets.</p><p>For basic socket types and operations please consult the <code>Network.Socket</code>
 module of the <a href="http://hackage.haskell.org/package/network">network</a> package.</p><h1>Examples</h1><p>To write a server, use the <code><a href="Streamly-Network-Socket.html#v:accept" title="Streamly.Network.Socket">accept</a></code> unfold to start listening for
 connections from clients.  <code><a href="Streamly-Network-Socket.html#v:accept" title="Streamly.Network.Socket">accept</a></code> supplies a stream of connected sockets.
 We can map an effectful action on this socket stream to handle the
 connections. The action would typically use socket reading and writing
 operations to communicate with the remote host. We can read/write a stream
 of bytes or a stream of chunks of bytes (<code>Array</code>).</p><p>Following is a short example of a concurrent echo server.  Please note that
 this example can be written even more succinctly by using higher level
 operations from <a href="Streamly-Network-Inet-TCP.html">Streamly.Network.Inet.TCP</a> module.</p><pre>{-# LANGUAGE FlexibleContexts #-}

import Data.Function ((&amp;))
import Network.Socket
import Streamly.Network.Socket (SockSpec(..))

import qualified Streamly.Prelude as Stream
import qualified Streamly.Network.Socket as Socket

main = do
    let spec = SockSpec
               { sockFamily = AF_INET
               , sockType   = Stream
               , sockProto  = defaultProtocol
               , sockOpts   = []
               }
        addr = SockAddrInet 8090 (tupleToHostAddress (0,0,0,0))
     in server spec addr

    where

    server spec addr =
          Stream.unfold Socket.accept (maxListenQueue, spec, addr) -- ParallelT IO Socket
        &amp; Stream.mapM (Socket.forSocketM echo)                     -- ParallelT IO ()
        &amp; Stream.fromParallel                                      -- SerialT IO ()
        &amp; Stream.drain                                             -- IO ()

    echo sk =
          Stream.unfold Socket.readChunks sk  -- SerialT IO (Array Word8)
        &amp; Stream.fold (Socket.writeChunks sk) -- IO ()
</pre><h1>Programmer Notes</h1><p>Read IO requests to connected stream sockets are performed in chunks of
 <code><a href="Streamly-Internal-Data-Array-Foreign-Type.html#v:defaultChunkSize" title="Streamly.Internal.Data.Array.Foreign.Type">defaultChunkSize</a></code>.  Unless
 specified otherwise in the API, writes are collected into chunks of
 <code><a href="Streamly-Internal-Data-Array-Foreign-Type.html#v:defaultChunkSize" title="Streamly.Internal.Data.Array.Foreign.Type">defaultChunkSize</a></code> before they are
 written to the socket. APIs are provided to control the chunking behavior.</p><pre>import qualified Streamly.Network.Socket as Socket</pre><h1>See Also</h1><ul><li><a href="Streamly-Internal-Network-Socket.html">Streamly.Internal.Network.Socket</a></li><li><a href="http://hackage.haskell.org/package/network">network</a></li></ul></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:SockSpec">SockSpec</a> = <a href="#v:SockSpec">SockSpec</a> {<ul class="subs"><li><a href="#v:sockFamily">sockFamily</a> :: !<a href="../network-3.1.2.7/Network-Socket.html#t:Family" title="Network.Socket">Family</a></li><li><a href="#v:sockType">sockType</a> :: !<a href="../network-3.1.2.7/Network-Socket.html#t:SocketType" title="Network.Socket">SocketType</a></li><li><a href="#v:sockProto">sockProto</a> :: !<a href="../network-3.1.2.7/Network-Socket.html#t:ProtocolNumber" title="Network.Socket">ProtocolNumber</a></li><li><a href="#v:sockOpts">sockOpts</a> :: ![(<a href="../network-3.1.2.7/Network-Socket.html#t:SocketOption" title="Network.Socket">SocketOption</a>, <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a>)]</li></ul>}</li><li class="src short"><a href="#v:accept">accept</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m (<a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a>, <a href="Streamly-Network-Socket.html#t:SockSpec" title="Streamly.Network.Socket">SockSpec</a>, <a href="../network-3.1.2.7/Network-Socket.html#t:SockAddr" title="Network.Socket">SockAddr</a>) <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a></li><li class="src short"><a href="#v:read">read</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a></li><li class="src short"><a href="#v:readWithBufferOf">readWithBufferOf</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m (<a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a>, <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a>) <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a></li><li class="src short"><a href="#v:readChunks">readChunks</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a>)</li><li class="src short"><a href="#v:readChunksWithBufferOf">readChunksWithBufferOf</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m (<a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a>, <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a>) (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a>)</li><li class="src short"><a href="#v:readChunk">readChunk</a> :: <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a>)</li><li class="src short"><a href="#v:write">write</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> ()</li><li class="src short"><a href="#v:writeWithBufferOf">writeWithBufferOf</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> ()</li><li class="src short"><a href="#v:writeChunks">writeChunks</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> a) ()</li><li class="src short"><a href="#v:writeChunksWithBufferOf">writeChunksWithBufferOf</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> a) ()</li><li class="src short"><a href="#v:writeChunk">writeChunk</a> :: <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; <a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> a -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:forSocketM">forSocketM</a> :: (<a href="../exceptions-0.10.4/Control-Monad-Catch.html#t:MonadMask" title="Control.Monad.Catch">MonadMask</a> m, <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m) =&gt; (<a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; m ()) -&gt; <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; m ()</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Socket Specification</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:SockSpec" class="def">SockSpec</a> <a href="src/Streamly.Internal.Network.Socket.html#SockSpec" class="link">Source</a> <a href="#t:SockSpec" class="selflink">#</a></p><div class="doc"><p>Specify the socket protocol details.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:SockSpec" class="def">SockSpec</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:sockFamily" class="def">sockFamily</a> :: !<a href="../network-3.1.2.7/Network-Socket.html#t:Family" title="Network.Socket">Family</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:sockType" class="def">sockType</a> :: !<a href="../network-3.1.2.7/Network-Socket.html#t:SocketType" title="Network.Socket">SocketType</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:sockProto" class="def">sockProto</a> :: !<a href="../network-3.1.2.7/Network-Socket.html#t:ProtocolNumber" title="Network.Socket">ProtocolNumber</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:sockOpts" class="def">sockOpts</a> :: ![(<a href="../network-3.1.2.7/Network-Socket.html#t:SocketOption" title="Network.Socket">SocketOption</a>, <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a>)]</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><a href="#g:2" id="g:2"><h1>Accept Connections</h1></a><div class="top"><p class="src"><a id="v:accept" class="def">accept</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m (<a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a>, <a href="Streamly-Network-Socket.html#t:SockSpec" title="Streamly.Network.Socket">SockSpec</a>, <a href="../network-3.1.2.7/Network-Socket.html#t:SockAddr" title="Network.Socket">SockAddr</a>) <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> <a href="src/Streamly.Internal.Network.Socket.html#accept" class="link">Source</a> <a href="#v:accept" class="selflink">#</a></p><div class="doc"><p>Unfold a three tuple <code>(listenQLen, spec, addr)</code> into a stream of connected
 protocol sockets corresponding to incoming connections. <code>listenQLen</code> is the
 maximum number of pending connections in the backlog. <code>spec</code> is the socket
 protocol and options specification and <code>addr</code> is the protocol address where
 the server listens for incoming connections.</p><p><em>Since: 0.7.0</em></p></div></div><a href="#g:3" id="g:3"><h1>Read</h1></a><div class="top"><p class="src"><a id="v:read" class="def">read</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> <a href="src/Streamly.Internal.Network.Socket.html#read" class="link">Source</a> <a href="#v:read" class="selflink">#</a></p><div class="doc"><p>Unfolds a <code><a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a></code> into a byte stream.  IO requests to the socket are
 performed in sizes of
 <code><a href="Streamly-Internal-Data-Array-Foreign-Type.html#v:defaultChunkSize" title="Streamly.Internal.Data.Array.Foreign.Type">defaultChunkSize</a></code>.</p><p><em>Since: 0.7.0</em></p></div></div><div class="top"><p class="src"><a id="v:readWithBufferOf" class="def">readWithBufferOf</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m (<a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a>, <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a>) <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> <a href="src/Streamly.Internal.Network.Socket.html#readWithBufferOf" class="link">Source</a> <a href="#v:readWithBufferOf" class="selflink">#</a></p><div class="doc"><p>Unfolds the tuple <code>(bufsize, socket)</code> into a byte stream, read requests
 to the socket are performed using buffers of <code>bufsize</code>.</p><p><em>Since: 0.7.0</em></p></div></div><div class="top"><p class="src"><a id="v:readChunks" class="def">readChunks</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a>) <a href="src/Streamly.Internal.Network.Socket.html#readChunks" class="link">Source</a> <a href="#v:readChunks" class="selflink">#</a></p><div class="doc"><p>Unfolds a socket into a stream of <code><a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a></code> arrays. Requests to the socket
 are performed using a buffer of size
 <code><a href="Streamly-Internal-Data-Array-Foreign-Type.html#v:defaultChunkSize" title="Streamly.Internal.Data.Array.Foreign.Type">defaultChunkSize</a></code>. The
 size of arrays in the resulting stream are therefore less than or equal to
 <code><a href="Streamly-Internal-Data-Array-Foreign-Type.html#v:defaultChunkSize" title="Streamly.Internal.Data.Array.Foreign.Type">defaultChunkSize</a></code>.</p><p><em>Since: 0.7.0</em></p></div></div><div class="top"><p class="src"><a id="v:readChunksWithBufferOf" class="def">readChunksWithBufferOf</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="Streamly-Internal-Data-Unfold-Type.html#t:Unfold" title="Streamly.Internal.Data.Unfold.Type">Unfold</a> m (<a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a>, <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a>) (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a>) <a href="src/Streamly.Internal.Network.Socket.html#readChunksWithBufferOf" class="link">Source</a> <a href="#v:readChunksWithBufferOf" class="selflink">#</a></p><div class="doc"><p>Unfold the tuple <code>(bufsize, socket)</code> into a stream of <code><a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a></code> arrays.
 Read requests to the socket are performed using a buffer of size <code>bufsize</code>.
 The size of an array in the resulting stream is always less than or equal to
 <code>bufsize</code>.</p><p><em>Since: 0.7.0</em></p></div></div><div class="top"><p class="src"><a id="v:readChunk" class="def">readChunk</a> :: <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a>) <a href="src/Streamly.Internal.Network.Socket.html#readChunk" class="link">Source</a> <a href="#v:readChunk" class="selflink">#</a></p><div class="doc"><p>Read a byte array from a file handle up to a maximum of the requested
 size. If no data is available on the handle it blocks until some data
 becomes available. If data is available then it immediately returns that
 data without blocking.</p><p><em>Since: 0.8.0</em></p></div></div><a href="#g:4" id="g:4"><h1>Write</h1></a><div class="top"><p class="src"><a id="v:write" class="def">write</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> () <a href="src/Streamly.Internal.Network.Socket.html#write" class="link">Source</a> <a href="#v:write" class="selflink">#</a></p><div class="doc"><p>Write a byte stream to a socket. Accumulates the input in chunks of
 up to <code><a href="Streamly-Internal-System-IO.html#v:defaultChunkSize" title="Streamly.Internal.System.IO">defaultChunkSize</a></code> bytes before writing.</p><pre>write = <code><a href="Streamly-Network-Socket.html#v:writeWithBufferOf" title="Streamly.Network.Socket">writeWithBufferOf</a></code> <code><a href="Streamly-Internal-System-IO.html#v:defaultChunkSize" title="Streamly.Internal.System.IO">defaultChunkSize</a></code>
</pre><p><em>Since: 0.7.0</em></p></div></div><div class="top"><p class="src"><a id="v:writeWithBufferOf" class="def">writeWithBufferOf</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m <a href="../base-4.16.4.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> () <a href="src/Streamly.Internal.Network.Socket.html#writeWithBufferOf" class="link">Source</a> <a href="#v:writeWithBufferOf" class="selflink">#</a></p><div class="doc"><p>Write a byte stream to a socket. Accumulates the input in chunks of
 specified number of bytes before writing.</p><p><em>Since: 0.7.0</em></p></div></div><div class="top"><p class="src"><a id="v:writeChunks" class="def">writeChunks</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> a) () <a href="src/Streamly.Internal.Network.Socket.html#writeChunks" class="link">Source</a> <a href="#v:writeChunks" class="selflink">#</a></p><div class="doc"><p>Write a stream of arrays to a socket.  Each array in the stream is written
 to the socket as a separate IO request.</p><p><em>Since: 0.7.0</em></p></div></div><div class="top"><p class="src"><a id="v:writeChunksWithBufferOf" class="def">writeChunksWithBufferOf</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> a) () <a href="src/Streamly.Internal.Network.Socket.html#writeChunksWithBufferOf" class="link">Source</a> <a href="#v:writeChunksWithBufferOf" class="selflink">#</a></p><div class="doc"><p><code>writeChunksWithBufferOf bufsize socket</code> writes a stream of arrays to
 <code>socket</code> after coalescing the adjacent arrays in chunks of <code>bufsize</code>.
 Multiple arrays are coalesed as long as the total size remains below the
 specified size.  It never splits an array, if a single array is bigger than
 the specified size it emitted as it is.</p><p><em>Since: 0.8.0</em></p></div></div><div class="top"><p class="src"><a id="v:writeChunk" class="def">writeChunk</a> :: <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; <a href="Streamly-Internal-Data-Array-Foreign-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Type">Array</a> a -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Streamly.Internal.Network.Socket.html#writeChunk" class="link">Source</a> <a href="#v:writeChunk" class="selflink">#</a></p><div class="doc"><p>Write an Array to a file handle.</p><p><em>Since: 0.8.0</em></p></div></div><a href="#g:5" id="g:5"><h1>Exceptions</h1></a><div class="top"><p class="src"><a id="v:forSocketM" class="def">forSocketM</a> :: (<a href="../exceptions-0.10.4/Control-Monad-Catch.html#t:MonadMask" title="Control.Monad.Catch">MonadMask</a> m, <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m) =&gt; (<a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; m ()) -&gt; <a href="../network-3.1.2.7/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; m () <a href="src/Streamly.Internal.Network.Socket.html#forSocketM" class="link">Source</a> <a href="#v:forSocketM" class="selflink">#</a></p><div class="doc"><p><code><code><a href="Streamly-Network-Socket.html#v:forSocketM" title="Streamly.Network.Socket">forSocketM</a></code> action socket</code> runs the monadic computation <code>action</code> passing
 the socket handle to it.  The handle will be closed on exit from
 <code><a href="Streamly-Network-Socket.html#v:forSocketM" title="Streamly.Network.Socket">forSocketM</a></code>, whether by normal termination or by raising an exception.  If
 closing the handle raises an exception, then this exception will be raised
 by <code><a href="Streamly-Network-Socket.html#v:forSocketM" title="Streamly.Network.Socket">forSocketM</a></code> rather than any exception raised by <code>action</code>.</p><p><em>Since: 0.8.0</em></p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.26.0</p></div></body></html>