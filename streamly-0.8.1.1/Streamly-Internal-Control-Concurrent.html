<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Streamly.Internal.Control.Concurrent</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">streamly-0.8.1.1: Dataflow programming and declarative concurrency</span><ul class="links" id="page-menu"><li><a href="src/Streamly.Internal.Control.Concurrent.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) 2017 Composewell Technologies</td></tr><tr><th>License</th><td>BSD-3-Clause</td></tr><tr><th>Maintainer</th><td>streamly@composewell.com</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Portability</th><td>GHC</td></tr><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Streamly.Internal.Control.Concurrent</p></div><div id="description"><p class="caption">Description</p><div class="doc empty">&nbsp;</div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">type</span> <a href="#t:MonadAsync">MonadAsync</a> m = (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m, <a href="../exceptions-0.10.4/Control-Monad-Catch.html#t:MonadThrow" title="Control.Monad.Catch">MonadThrow</a> m)</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:RunInIO">RunInIO</a> m = <a href="#v:RunInIO">RunInIO</a> {<ul class="subs"><li><a href="#v:runInIO">runInIO</a> :: <span class="keyword">forall</span> b. m b -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:StM" title="Control.Monad.Trans.Control">StM</a> m b)</li></ul>}</li><li class="src short"><a href="#v:captureMonadState">captureMonadState</a> :: <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m =&gt; m (<a href="Streamly-Internal-Control-Concurrent.html#t:RunInIO" title="Streamly.Internal.Control.Concurrent">RunInIO</a> m)</li><li class="src short"><a href="#v:doFork">doFork</a> :: <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m =&gt; m () -&gt; <a href="Streamly-Internal-Control-Concurrent.html#t:RunInIO" title="Streamly.Internal.Control.Concurrent">RunInIO</a> m -&gt; (<a href="../base-4.16.4.0/Control-Exception.html#t:SomeException" title="Control.Exception">SomeException</a> -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; m <a href="../base-4.16.4.0/Control-Concurrent.html#t:ThreadId" title="Control.Concurrent">ThreadId</a></li><li class="src short"><a href="#v:fork">fork</a> :: <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m =&gt; m () -&gt; m <a href="../base-4.16.4.0/Control-Concurrent.html#t:ThreadId" title="Control.Concurrent">ThreadId</a></li><li class="src short"><a href="#v:forkManaged">forkManaged</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m) =&gt; m () -&gt; m <a href="../base-4.16.4.0/Control-Concurrent.html#t:ThreadId" title="Control.Concurrent">ThreadId</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:MonadAsync" class="def">MonadAsync</a> m = (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m, <a href="../exceptions-0.10.4/Control-Monad-Catch.html#t:MonadThrow" title="Control.Monad.Catch">MonadThrow</a> m) <a href="src/Streamly.Internal.Control.Concurrent.html#MonadAsync" class="link">Source</a> <a href="#t:MonadAsync" class="selflink">#</a></p><div class="doc"><p>A monad that can perform concurrent or parallel IO operations. Streams
 that can be composed concurrently require the underlying monad to be
 <code><a href="Streamly-Internal-Control-Concurrent.html#t:MonadAsync" title="Streamly.Internal.Control.Concurrent">MonadAsync</a></code>.</p><p><em>Since: 0.1.0 (<a href="Streamly.html">Streamly</a>)</em></p><p><em>Since: 0.8.0</em></p></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:RunInIO" class="def">RunInIO</a> m <a href="src/Streamly.Internal.Control.Concurrent.html#RunInIO" class="link">Source</a> <a href="#t:RunInIO" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:RunInIO" class="def">RunInIO</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:runInIO" class="def">runInIO</a> :: <span class="keyword">forall</span> b. m b -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:StM" title="Control.Monad.Trans.Control">StM</a> m b)</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:captureMonadState" class="def">captureMonadState</a> :: <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m =&gt; m (<a href="Streamly-Internal-Control-Concurrent.html#t:RunInIO" title="Streamly.Internal.Control.Concurrent">RunInIO</a> m) <a href="src/Streamly.Internal.Control.Concurrent.html#captureMonadState" class="link">Source</a> <a href="#v:captureMonadState" class="selflink">#</a></p><div class="doc"><p>When we run computations concurrently, we completely isolate the state of
 the concurrent computations from the parent computation.  The invariant is
 that we should never be running two concurrent computations in the same
 thread without using the runInIO function.  Also, we should never be running
 a concurrent computation in the parent thread, otherwise it may affect the
 state of the parent which is against the defined semantics of concurrent
 execution.</p></div></div><div class="top"><p class="src"><a id="v:doFork" class="def">doFork</a> :: <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m =&gt; m () -&gt; <a href="Streamly-Internal-Control-Concurrent.html#t:RunInIO" title="Streamly.Internal.Control.Concurrent">RunInIO</a> m -&gt; (<a href="../base-4.16.4.0/Control-Exception.html#t:SomeException" title="Control.Exception">SomeException</a> -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; m <a href="../base-4.16.4.0/Control-Concurrent.html#t:ThreadId" title="Control.Concurrent">ThreadId</a> <a href="src/Streamly.Internal.Control.Concurrent.html#doFork" class="link">Source</a> <a href="#v:doFork" class="selflink">#</a></p><div class="doc"><p>Fork a thread to run the given computation, installing the provided
 exception handler. Lifted to any monad with 'MonadBaseControl IO m'
 capability.</p><p>TODO: the RunInIO argument can be removed, we can directly pass the action
 as &quot;mrun action&quot; instead.</p></div></div><div class="top"><p class="src"><a id="v:fork" class="def">fork</a> :: <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m =&gt; m () -&gt; m <a href="../base-4.16.4.0/Control-Concurrent.html#t:ThreadId" title="Control.Concurrent">ThreadId</a> <a href="src/Streamly.Internal.Control.Concurrent.html#fork" class="link">Source</a> <a href="#v:fork" class="selflink">#</a></p><div class="doc"><p><code><a href="Streamly-Internal-Control-Concurrent.html#v:fork" title="Streamly.Internal.Control.Concurrent">fork</a></code> lifted to any monad with 'MonadBaseControl IO m' capability.</p></div></div><div class="top"><p class="src"><a id="v:forkManaged" class="def">forkManaged</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m) =&gt; m () -&gt; m <a href="../base-4.16.4.0/Control-Concurrent.html#t:ThreadId" title="Control.Concurrent">ThreadId</a> <a href="src/Streamly.Internal.Control.Concurrent.html#forkManaged" class="link">Source</a> <a href="#v:forkManaged" class="selflink">#</a></p><div class="doc"><p>Fork a thread that is automatically killed as soon as the reference to the
 returned threadId is garbage collected.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.26.0</p></div></body></html>