<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Streamly.Internal.Data.Array.Stream.Mut.Foreign</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">streamly-0.8.1.1: Dataflow programming and declarative concurrency</span><ul class="links" id="page-menu"><li><a href="src/Streamly.Internal.Data.Array.Stream.Mut.Foreign.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) 2019 Composewell Technologies</td></tr><tr><th>License</th><td>BSD3-3-Clause</td></tr><tr><th>Maintainer</th><td>streamly@composewell.com</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Portability</th><td>GHC</td></tr><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Streamly.Internal.Data.Array.Stream.Mut.Foreign</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Generation</a></li><li><a href="#g:2">Compaction</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Combinators to efficiently manipulate streams of mutable arrays.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:arraysOf">arraysOf</a> :: (<a href="Streamly-Internal-Data-Stream-IsStream-Type.html#t:IsStream" title="Streamly.Internal.Data.Stream.IsStream.Type">IsStream</a> t, <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; t m a -&gt; t m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a)</li><li class="src short"><a href="#v:packArraysChunksOf">packArraysChunksOf</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Data-Stream-StreamD-Type.html#t:Stream" title="Streamly.Internal.Data.Stream.StreamD.Type">Stream</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) -&gt; <a href="Streamly-Internal-Data-Stream-StreamD-Type.html#t:Stream" title="Streamly.Internal.Data.Stream.StreamD.Type">Stream</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a)</li><li class="src short"><span class="keyword">data</span> <a href="#t:SpliceState">SpliceState</a> s arr<ul class="subs"><li>= <a href="#v:SpliceInitial">SpliceInitial</a> s</li><li>| <a href="#v:SpliceBuffering">SpliceBuffering</a> s arr</li><li>| <a href="#v:SpliceYielding">SpliceYielding</a> arr (<a href="Streamly-Internal-Data-Array-Stream-Mut-Foreign.html#t:SpliceState" title="Streamly.Internal.Data.Array.Stream.Mut.Foreign">SpliceState</a> s arr)</li><li>| <a href="#v:SpliceFinish">SpliceFinish</a></li></ul></li><li class="src short"><a href="#v:lpackArraysChunksOf">lpackArraysChunksOf</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) () -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) ()</li><li class="src short"><a href="#v:compact">compact</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a)</li><li class="src short"><a href="#v:compactLE">compactLE</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a)</li><li class="src short"><a href="#v:compactEQ">compactEQ</a> :: <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a)</li><li class="src short"><a href="#v:compactGE">compactGE</a> :: <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a)</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Generation</h1></a><div class="top"><p class="src"><a id="v:arraysOf" class="def">arraysOf</a> :: (<a href="Streamly-Internal-Data-Stream-IsStream-Type.html#t:IsStream" title="Streamly.Internal.Data.Stream.IsStream.Type">IsStream</a> t, <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; t m a -&gt; t m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) <a href="src/Streamly.Internal.Data.Array.Stream.Mut.Foreign.html#arraysOf" class="link">Source</a> <a href="#v:arraysOf" class="selflink">#</a></p><div class="doc"><p><code>arraysOf n stream</code> groups the elements in the input stream into arrays of
 <code>n</code> elements each.</p><p>Same as the following but may be more efficient:</p><pre>arraysOf n = Stream.foldMany (MArray.writeN n)</pre><p><em>Pre-release</em></p></div></div><a href="#g:2" id="g:2"><h1>Compaction</h1></a><div class="top"><p class="src"><a id="v:packArraysChunksOf" class="def">packArraysChunksOf</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Data-Stream-StreamD-Type.html#t:Stream" title="Streamly.Internal.Data.Stream.StreamD.Type">Stream</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) -&gt; <a href="Streamly-Internal-Data-Stream-StreamD-Type.html#t:Stream" title="Streamly.Internal.Data.Stream.StreamD.Type">Stream</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) <a href="src/Streamly.Internal.Data.Array.Stream.Mut.Foreign.html#packArraysChunksOf" class="link">Source</a> <a href="#v:packArraysChunksOf" class="selflink">#</a></p><div class="doc"><p>This mutates the first array (if it has space) to append values from the
 second one. This would work for immutable arrays as well because an
 immutable array never has space so a new array is allocated instead of
 mutating it.</p><p>| Coalesce adjacent arrays in incoming stream to form bigger arrays of a
 maximum specified size. Note that if a single array is bigger than the
 specified size we do not split it to fit. When we coalesce multiple arrays
 if the size would exceed the specified size we do not coalesce therefore the
 actual array size may be less than the specified chunk size.</p><p><em>Since: 0.7.0</em></p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:SpliceState" class="def">SpliceState</a> s arr <a href="src/Streamly.Internal.Data.Array.Stream.Mut.Foreign.html#SpliceState" class="link">Source</a> <a href="#t:SpliceState" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:SpliceInitial" class="def">SpliceInitial</a> s</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:SpliceBuffering" class="def">SpliceBuffering</a> s arr</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:SpliceYielding" class="def">SpliceYielding</a> arr (<a href="Streamly-Internal-Data-Array-Stream-Mut-Foreign.html#t:SpliceState" title="Streamly.Internal.Data.Array.Stream.Mut.Foreign">SpliceState</a> s arr)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:SpliceFinish" class="def">SpliceFinish</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><a id="v:lpackArraysChunksOf" class="def">lpackArraysChunksOf</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) () -&gt; <a href="Streamly-Internal-Data-Fold-Type.html#t:Fold" title="Streamly.Internal.Data.Fold.Type">Fold</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) () <a href="src/Streamly.Internal.Data.Array.Stream.Mut.Foreign.html#lpackArraysChunksOf" class="link">Source</a> <a href="#v:lpackArraysChunksOf" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:compact" class="def">compact</a> :: (<a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.16.4.0/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a) =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) <a href="src/Streamly.Internal.Data.Array.Stream.Mut.Foreign.html#compact" class="link">Source</a> <a href="#v:compact" class="selflink">#</a></p><div class="doc"><p>Coalesce adjacent arrays in incoming stream to form bigger arrays of a
 maximum specified size in bytes.</p><p><em>Internal</em></p></div></div><div class="top"><p class="src"><a id="v:compactLE" class="def">compactLE</a> :: <a href="../base-4.16.4.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) <a href="src/Streamly.Internal.Data.Array.Stream.Mut.Foreign.html#compactLE" class="link">Source</a> <a href="#v:compactLE" class="selflink">#</a></p><div class="doc"><p>Coalesce adjacent arrays in incoming stream to form bigger arrays of a
 maximum specified size in bytes.</p><p><em>Internal</em></p></div></div><div class="top"><p class="src"><a id="v:compactEQ" class="def">compactEQ</a> :: <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) <a href="src/Streamly.Internal.Data.Array.Stream.Mut.Foreign.html#compactEQ" class="link">Source</a> <a href="#v:compactEQ" class="selflink">#</a></p><div class="doc"><p>Like <code><a href="Streamly-Internal-Data-Array-Stream-Mut-Foreign.html#v:compactLE" title="Streamly.Internal.Data.Array.Stream.Mut.Foreign">compactLE</a></code> but generates arrays of exactly equal to the size
 specified except for the last array in the stream which could be shorter.</p><p><em>Unimplemented</em></p></div></div><div class="top"><p class="src"><a id="v:compactGE" class="def">compactGE</a> :: <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) -&gt; <a href="Streamly-Internal-Data-Stream-Serial.html#t:SerialT" title="Streamly.Internal.Data.Stream.Serial">SerialT</a> m (<a href="Streamly-Internal-Data-Array-Foreign-Mut-Type.html#t:Array" title="Streamly.Internal.Data.Array.Foreign.Mut.Type">Array</a> a) <a href="src/Streamly.Internal.Data.Array.Stream.Mut.Foreign.html#compactGE" class="link">Source</a> <a href="#v:compactGE" class="selflink">#</a></p><div class="doc"><p>Like <code><a href="Streamly-Internal-Data-Array-Stream-Mut-Foreign.html#v:compactLE" title="Streamly.Internal.Data.Array.Stream.Mut.Foreign">compactLE</a></code> but generates arrays of size greater than or equal to the
 specified except for the last array in the stream which could be shorter.</p><p><em>Unimplemented</em></p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.26.0</p></div></body></html>