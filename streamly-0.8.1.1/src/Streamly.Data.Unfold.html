<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-cpp">#include &quot;inline.hs&quot;
</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Module      : Streamly.Data.Unfold</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Copyright   : (c) 2019 Composewell Technologies</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- License     : BSD3</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Maintainer  : streamly@composewell.com</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Stability   : released</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Portability : GHC</span><span>
</span><span id="line-10"></span><span class="hs-comment">--</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- An 'Unfold' is a source or a producer of a stream of values.  It takes a</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- seed value as an input and unfolds it into a sequence of values.</span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Streamly.Data.Fold as Fold</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Streamly.Data.Unfold as Unfold</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Streamly.Prelude as Stream</span><span>
</span><span id="line-17"></span><span class="hs-comment">--</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- For example, the 'fromList' Unfold generates a stream of values from a</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- supplied list.  Unfolds can be converted to 'Streamly.Prelude.SerialT'</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- stream using the Stream.unfold operation.</span><span>
</span><span id="line-21"></span><span class="hs-comment">--</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- &gt;&gt;&gt; stream = Stream.unfold Unfold.fromList [1..100]</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.sum stream</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- 5050</span><span>
</span><span id="line-25"></span><span class="hs-comment">--</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- All the serial stream generation operations in &quot;Streamly.Prelude&quot;</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- can be expressed using unfolds:</span><span>
</span><span id="line-28"></span><span class="hs-comment">--</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- &gt; Stream.fromList = Stream.unfold Unfold.fromList [1..100]</span><span>
</span><span id="line-30"></span><span class="hs-comment">--</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- Conceptually, an 'Unfold' is just like &quot;Data.List.unfoldr&quot;. Let us write a</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- step function to unfold a list using &quot;Data.List.unfoldr&quot;:</span><span>
</span><span id="line-33"></span><span class="hs-comment">--</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- &gt;&gt;&gt; :{</span><span>
</span><span id="line-35"></span><span class="hs-comment">--  f [] = Nothing</span><span>
</span><span id="line-36"></span><span class="hs-comment">--  f (x:xs) = Just (x, xs)</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- :}</span><span>
</span><span id="line-38"></span><span class="hs-comment">--</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- &gt;&gt;&gt; Data.List.unfoldr f [1,2,3]</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- [1,2,3]</span><span>
</span><span id="line-41"></span><span class="hs-comment">--</span><span>
</span><span id="line-42"></span><span class="hs-comment">-- Unfold.unfoldr is just the same, it uses the same step function:</span><span>
</span><span id="line-43"></span><span class="hs-comment">--</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.unfold (Unfold.unfoldr f) [1,2,3]</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- [1,2,3]</span><span>
</span><span id="line-46"></span><span class="hs-comment">--</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- The input of an unfold can be transformed using 'lmap':</span><span>
</span><span id="line-48"></span><span class="hs-comment">--</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- &gt;&gt;&gt; u = Unfold.lmap (fmap (+1)) Unfold.fromList</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.unfold u [1..5]</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- [2,3,4,5,6]</span><span>
</span><span id="line-52"></span><span class="hs-comment">--</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- 'Unfold' streams can be transformed using transformation combinators. For</span><span>
</span><span id="line-54"></span><span class="hs-comment">-- example, to retain only the first two elements of an unfold:</span><span>
</span><span id="line-55"></span><span class="hs-comment">--</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- &gt;&gt;&gt; u = Unfold.take 2 Unfold.fromList</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.unfold u [1..100]</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- [1,2]</span><span>
</span><span id="line-59"></span><span class="hs-comment">--</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- Multiple unfolds can be combined in several interesting ways. For example,</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- to generate nested looping as in imperative languages (also known as cross</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- product of the two streams):</span><span>
</span><span id="line-63"></span><span class="hs-comment">--</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- &gt;&gt;&gt; u1 = Unfold.lmap fst Unfold.fromList</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- &gt;&gt;&gt; u2 = Unfold.lmap snd Unfold.fromList</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- &gt;&gt;&gt; u = Unfold.crossWith (,) u1 u2</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.unfold u ([1,2,3], [4,5,6])</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- [(1,4),(1,5),(1,6),(2,4),(2,5),(2,6),(3,4),(3,5),(3,6)]</span><span>
</span><span id="line-69"></span><span class="hs-comment">--</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- Nested loops using unfolds provide C like performance due to complete stream</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- fusion.</span><span>
</span><span id="line-72"></span><span class="hs-comment">--</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- Please see &quot;Streamly.Internal.Data.Unfold&quot; for additional @Pre-release@</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- functions.</span><span>
</span><span id="line-75"></span><span class="hs-comment">--</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- = Unfolds vs. Streams</span><span>
</span><span id="line-77"></span><span class="hs-comment">--</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- Unfolds' raison d'etre is their efficiency in nested stream operations due</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- to complete stream fusion.  'Streamly.Prelude.concatMap' or the 'Monad'</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- instance of streams use stream generation operations of the shape @a -&gt; t m</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- b@ and then flatten the resulting stream.  This implementation is more</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- powerful but does not allow for complete stream fusion.  Unfolds provide</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- less powerful but more efficient 'Streamly.Prelude.unfoldMany', 'many' and</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- 'crossWith' operations as an alternative to a subset of use cases of</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- 'concatMap' and 'Applicative' stream operations.</span><span>
</span><span id="line-86"></span><span class="hs-comment">--</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- &quot;Streamly.Prelude&quot; exports polymorphic stream generation operations that</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- provide the same functionality as unfolds in this module.  Since unfolds can</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- be easily converted to streams, several modules in streamly provide only</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- unfolds for serial stream generation.  We cannot use unfolds exclusively for</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- stream generation as they do not support concurrency.</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Streamly.Data.Unfold</span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Unfold Type</span></span><span>
</span><span id="line-96"></span><span>      </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier">Unfold</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Unfolds</span></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-comment">-- One to one correspondence with</span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-comment">-- &quot;Streamly.Internal.Data.Stream.IsStream.Generate&quot;</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Basic Constructors</span></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#unfoldrM"><span class="hs-identifier">unfoldrM</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#unfoldr"><span class="hs-identifier">unfoldr</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#function"><span class="hs-identifier">function</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#functionM"><span class="hs-identifier">functionM</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Generators</span></span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Generate a monadic stream from a seed.</span></span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.html#repeatM"><span class="hs-identifier">repeatM</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.html#replicateM"><span class="hs-identifier">replicateM</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.html#iterateM"><span class="hs-identifier">iterateM</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** From Containers</span></span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.html#fromList"><span class="hs-identifier">fromList</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.html#fromListM"><span class="hs-identifier">fromListM</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.html#fromStream"><span class="hs-identifier">fromStream</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Combinators</span></span><span>
</span><span id="line-120"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Mapping on Input</span></span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#lmap"><span class="hs-identifier">lmap</span></a></span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#lmapM"><span class="hs-identifier">lmapM</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Mapping on Output</span></span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.html#mapM"><span class="hs-identifier">mapM</span></a></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Filtering</span></span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#takeWhileM"><span class="hs-identifier">takeWhileM</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#takeWhile"><span class="hs-identifier">takeWhile</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.html#take"><span class="hs-identifier">take</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.html#filter"><span class="hs-identifier">filter</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.html#filterM"><span class="hs-identifier">filterM</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.html#drop"><span class="hs-identifier">drop</span></a></span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.html#dropWhile"><span class="hs-identifier">dropWhile</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.html#dropWhileM"><span class="hs-identifier">dropWhileM</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Zipping</span></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#zipWith"><span class="hs-identifier">zipWith</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Cross Product</span></span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#crossWith"><span class="hs-identifier">crossWith</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Nesting</span></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#many"><span class="hs-identifier">many</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span class="hs-keyword">where</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">concat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">map</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">takeWhile</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">take</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">filter</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">const</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">drop</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">dropWhile</span></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipWith</span></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.html"><span class="hs-identifier">Streamly.Internal.Data.Unfold</span></a></span><span>
</span><span id="line-153"></span></pre></body></html>