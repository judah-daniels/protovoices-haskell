<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wno-redundant-constraints #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Module      : Streamly.Internal.Data.Stream.IsStream.Expand</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Copyright   : (c) 2017 Composewell Technologies</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- License     : BSD-3-Clause</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Maintainer  : streamly@composewell.com</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Stability   : experimental</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Portability : GHC</span><span>
</span><span id="line-10"></span><span class="hs-comment">--</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Expand a stream by combining two or more streams or by combining streams</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- with unfolds.</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Streamly.Internal.Data.Stream.IsStream.Expand</span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Binary Combinators (Linear)</span></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-comment">-- | Functions ending in the shape:</span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-comment">-- @t m a -&gt; t m a -&gt; t m a@.</span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-comment">-- The functions in this section have a linear or flat n-ary combining</span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-comment">-- characterstics. It means that when combined @n@ times (e.g. @a `serial`</span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-comment">-- b `serial` c ...@) the resulting expression will have an @O(n)@</span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-comment">-- complexity (instead O(n^2) for pair wise combinators described in the</span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-comment">-- next section. These functions can be used efficiently with</span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-comment">-- 'concatMapWith' et. al.  combinators that combine streams in a linear</span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-comment">-- fashion (contrast with 'concatPairsWith' which combines streams as a</span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-comment">-- binary tree).</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span>      </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#serial"><span class="hs-identifier">serial</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#ahead"><span class="hs-identifier">ahead</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#async"><span class="hs-identifier">async</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#wAsync"><span class="hs-identifier">wAsync</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#parallel"><span class="hs-identifier">parallel</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#parallelFst"><span class="hs-identifier">parallelFst</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#parallelMin"><span class="hs-identifier">parallelMin</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Binary Combinators (Pair Wise)</span></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-comment">-- | Like the functions in the section above these functions also combine</span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-comment">-- two streams into a single stream but when used @n@ times linearly they</span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-comment">-- exhibit O(n^2) complexity. They are best combined in a binary tree</span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-comment">-- fashion using 'concatPairsWith' giving a @n * log n@ complexity.  Avoid</span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-comment">-- using these with 'concatMapWith' when combining a large or infinite</span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-comment">-- number of streams.</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Append</span></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#append"><span class="hs-identifier">append</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** wSerial</span></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-comment">-- | 'wSerial' is a CPS based stream interleaving functions. Use</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-comment">-- 'concatPairsWith wSerial' to interleave @n@ streams uniformly. It can be</span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-comment">-- used with 'concatMapWith' as well, however, the interleaving behavior of</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-comment">-- @n@ streams would be asymmetric giving exponentially more weightage to</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-comment">-- streams that come earlier in the composition.</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#wSerial"><span class="hs-identifier">wSerial</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.Serial.html#wSerialFst"><span class="hs-identifier">Serial.wSerialFst</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.Serial.html#wSerialMin"><span class="hs-identifier">Serial.wSerialMin</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Interleave</span></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-comment">-- | 'interleave' is like 'wSerial'  but using a direct style</span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-comment">-- implementation instead of CPS. It is faster than 'wSerial' due to stream</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-comment">-- fusion but has worse efficiency when used with 'concatMapWith' for large</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-comment">-- number of streams.</span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interleave"><span class="hs-identifier">interleave</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interleaveMin"><span class="hs-identifier">interleaveMin</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interleaveSuffix"><span class="hs-identifier">interleaveSuffix</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interleaveInfix"><span class="hs-identifier">interleaveInfix</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Round Robin</span></span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#roundrobin"><span class="hs-identifier">roundrobin</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Zip</span></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#zipWith"><span class="hs-identifier">zipWith</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#zipWithM"><span class="hs-identifier">zipWithM</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#zipAsyncWith"><span class="hs-identifier">zipAsyncWith</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#zipAsyncWithM"><span class="hs-identifier">zipAsyncWithM</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Merge</span></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-comment">-- , merge</span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeBy"><span class="hs-identifier">mergeBy</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeByM"><span class="hs-identifier">mergeByM</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeByMFused"><span class="hs-identifier">mergeByMFused</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeAsyncBy"><span class="hs-identifier">mergeAsyncBy</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeAsyncByM"><span class="hs-identifier">mergeAsyncByM</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Combine Streams and Unfolds</span></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-comment">-- |</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-comment">-- Expand a stream by repeatedly using an unfold and merging the resulting</span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-comment">-- streams.  Functions generally ending in the shape:</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-comment">-- @Unfold m a b -&gt; t m a -&gt; t m b@</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Append Many (Unfold)</span></span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Unfold and flatten streams.</span></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#unfoldMany"><span class="hs-identifier">unfoldMany</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#unfoldManyInterleave"><span class="hs-identifier">unfoldManyInterleave</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#unfoldManyRoundRobin"><span class="hs-identifier">unfoldManyRoundRobin</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Interpose</span></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-comment">-- | Insert effects between streams. Like unfoldMany but intersperses an</span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-comment">-- effect between the streams. A special case of gintercalate.</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interpose"><span class="hs-identifier">interpose</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interposeSuffix"><span class="hs-identifier">interposeSuffix</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-comment">-- , interposeBy</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Intercalate</span></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-comment">-- | Insert Streams between Streams.</span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-comment">-- Like unfoldMany but intersperses streams from another source between</span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-comment">-- the streams from the first source.</span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#intercalate"><span class="hs-identifier">intercalate</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#intercalateSuffix"><span class="hs-identifier">intercalateSuffix</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#gintercalate"><span class="hs-identifier">gintercalate</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#gintercalateSuffix"><span class="hs-identifier">gintercalateSuffix</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Append Many (concatMap)</span></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-comment">-- | Map and serially append streams. 'concatMapM' is a generalization of</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-comment">-- the binary append operation to append many streams.</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#concatMapM"><span class="hs-identifier">concatMapM</span></a></span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#concatMap"><span class="hs-identifier">concatMap</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#concatM"><span class="hs-identifier">concatM</span></a></span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#concat"><span class="hs-identifier">concat</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Flatten Containers</span></span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-comment">-- | Flatten 'Foldable' containers using the binary stream merging</span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-comment">-- operations.</span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#concatFoldableWith"><span class="hs-identifier">IsStream.concatFoldableWith</span></a></span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#concatMapFoldableWith"><span class="hs-identifier">IsStream.concatMapFoldableWith</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#concatForFoldableWith"><span class="hs-identifier">IsStream.concatForFoldableWith</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="hs-comment">-- * ConcatMapWith</span></span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-comment">-- | Map and flatten a stream like 'concatMap' but using a custom binary</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-comment">-- stream merging combinator instead of just appending the streams.  The</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-comment">-- merging occurs sequentially, it works efficiently for 'serial', 'async',</span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-comment">-- 'ahead' like merge operations where we consume one stream before the</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-comment">-- next or in case of 'wAsync' or 'parallel' where we consume all streams</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-comment">-- simultaneously anyway.</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-comment">-- However, in cases where the merging consumes streams in a round robin</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-comment">-- fashion, a pair wise merging using 'concatPairsWith' would be more</span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-comment">-- efficient. These cases include operations like 'mergeBy' or 'zipWith'.</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#concatMapWith"><span class="hs-identifier">IsStream.concatMapWith</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#bindWith"><span class="hs-identifier">IsStream.bindWith</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#concatSmapMWith"><span class="hs-identifier">concatSmapMWith</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><span class="hs-comment">-- * ConcatPairsWith</span></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-comment">-- | See the notes about suitable merge functions in the 'concatMapWith'</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-comment">-- section.</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#concatPairsWith"><span class="hs-identifier">concatPairsWith</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><span class="hs-comment">-- * IterateMap</span></span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Map and flatten Trees of Streams</span></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#iterateMapWith"><span class="hs-identifier">iterateMapWith</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#iterateSmapMWith"><span class="hs-identifier">iterateSmapMWith</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#iterateMapLeftsWith"><span class="hs-identifier">iterateMapLeftsWith</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Deprecated</span></span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#concatUnfold"><span class="hs-identifier">concatUnfold</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#%3C%3D%3E"><span class="hs-operator">(&lt;=&gt;)</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#%3C%7C"><span class="hs-operator">(&lt;|)</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;inline.hs&quot;
</span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Control.Concurrent.html"><span class="hs-identifier">Streamly.Internal.Control.Concurrent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Control.Concurrent.html#MonadAsync"><span class="hs-identifier">MonadAsync</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.Ahead.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.Ahead</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.Ahead.html#aheadK"><span class="hs-identifier">aheadK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.Async.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.Async</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.Async.html#asyncK"><span class="hs-identifier">asyncK</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.Async.html#wAsyncK"><span class="hs-identifier">wAsyncK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Common.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.IsStream.Common</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#concatM"><span class="hs-identifier">concatM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#concatMapM"><span class="hs-identifier">concatMapM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#concatMap"><span class="hs-identifier">concatMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#smapM"><span class="hs-identifier">smapM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#fromPure"><span class="hs-identifier">fromPure</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#fromEffect"><span class="hs-identifier">fromEffect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#parallelFst"><span class="hs-identifier">parallelFst</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#zipWith"><span class="hs-identifier">zipWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#zipWithM"><span class="hs-identifier">zipWithM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.IsStream.Type</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier">IsStream</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier">fromStreamD</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier">toStreamD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html"><span class="hs-identifier">Streamly.Internal.Data.Unfold.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier">Unfold</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.IsStream.Type</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IsStream</span></span><span>
</span><span id="line-178"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.Parallel.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.Parallel</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Par</span></span><span>
</span><span id="line-179"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.Serial.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.Serial</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Serial</span></span><span>
</span><span id="line-180"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.StreamD</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">D</span></span><span>
</span><span id="line-181"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamK.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.StreamK</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">K</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamK.html#mergeBy"><span class="hs-identifier">mergeBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamK.html#mergeByM"><span class="hs-identifier">mergeByM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamK.Type.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.StreamK.Type</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">K</span></span><span>
</span><span id="line-183"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.Zip.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.Zip</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Zip</span></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">concat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">concatMap</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipWith</span></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="hs-comment">-- $setup</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- &gt;&gt;&gt; :m</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- &gt;&gt;&gt; import Control.Concurrent (threadDelay)</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.IORef</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- &gt;&gt;&gt; import Prelude hiding (zipWith, concatMap, concat)</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Streamly.Prelude as Stream</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Streamly.Internal.Data.Stream.IsStream as Stream</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Streamly.Data.Fold as Fold</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Streamly.Internal.Data.Fold as Fold</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Streamly.Internal.Data.Unfold as Unfold</span><span>
</span><span id="line-197"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Streamly.Internal.Data.Parser as Parser</span><span>
</span><span id="line-198"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Streamly.Data.Array.Foreign as Array</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- &gt;&gt;&gt; :{</span><span>
</span><span id="line-200"></span><span class="hs-comment">--  delay n = do</span><span>
</span><span id="line-201"></span><span class="hs-comment">--      threadDelay (n * 1000000)   -- sleep for n seconds</span><span>
</span><span id="line-202"></span><span class="hs-comment">--      putStrLn (show n ++ &quot; sec&quot;) -- print &quot;n sec&quot;</span><span>
</span><span id="line-203"></span><span class="hs-comment">--      return n                    -- IO Int</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- :}</span><span>
</span><span id="line-205"></span><span class="hs-comment">--</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- Appending</span><span>
</span><span id="line-209"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-comment">-- XXX Reconcile the names &quot;serial&quot; and &quot;append&quot;.</span><span>
</span><span id="line-212"></span><span class="hs-comment">--</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- | Append the outputs of two streams, yielding all the elements from the</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- first stream and then yielding all the elements from the second stream.</span><span>
</span><span id="line-215"></span><span class="hs-comment">--</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- IMPORTANT NOTE: This could be 100x faster than @serial/&lt;&gt;@ for appending a</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- few (say 100) streams because it can fuse via stream fusion. However, it</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- does not scale for a large number of streams (say 1000s) and becomes</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- qudartically slow. Therefore use this for custom appending of a few streams</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- but use 'concatMap' or 'concatMapWith serial' for appending @n@ streams or</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- infinite containers of streams.</span><span>
</span><span id="line-222"></span><span class="hs-comment">--</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-224"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#append"><span class="hs-pragma hs-type">append</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-225"></span><span id="local-6989586621679424721"><span id="local-6989586621679424722"><span id="local-6989586621679424724"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#append"><span class="hs-identifier hs-type">append</span></a></span><span> </span><span class="hs-glyph">::</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424724"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424722"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424724"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424722"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424721"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424724"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424722"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424721"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424724"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424722"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424721"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-226"></span><span id="append"><span class="annot"><span class="annottext">append :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) b.
(IsStream t, Monad m) =&gt;
t m b -&gt; t m b -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#append"><span class="hs-identifier hs-var hs-var">append</span></a></span></span><span> </span><span id="local-6989586621679424358"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424358"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424357"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424357"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Monad m =&gt;
Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Nesting.html#append"><span class="hs-identifier hs-var">D.append</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424358"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424357"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">6</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#serial"><span class="hs-operator hs-type">`serial`</span></a></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="hs-comment">-- | Appends two streams sequentially, yielding all elements from the first</span><span>
</span><span id="line-231"></span><span class="hs-comment">-- stream, and then all elements from the second stream.</span><span>
</span><span id="line-232"></span><span class="hs-comment">--</span><span>
</span><span id="line-233"></span><span class="hs-comment">-- &gt;&gt;&gt; import Streamly.Prelude (serial)</span><span>
</span><span id="line-234"></span><span class="hs-comment">-- &gt;&gt;&gt; stream1 = Stream.fromList [1,2]</span><span>
</span><span id="line-235"></span><span class="hs-comment">-- &gt;&gt;&gt; stream2 = Stream.fromList [3,4]</span><span>
</span><span id="line-236"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ stream1 `serial` stream2</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- [1,2,3,4]</span><span>
</span><span id="line-238"></span><span class="hs-comment">--</span><span>
</span><span id="line-239"></span><span class="hs-comment">-- This operation can be used to fold an infinite lazy container of streams.</span><span>
</span><span id="line-240"></span><span class="hs-comment">--</span><span>
</span><span id="line-241"></span><span class="hs-comment">-- /Since: 0.2.0 (&quot;Streamly&quot;)/</span><span>
</span><span id="line-242"></span><span class="hs-comment">--</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-244"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#serial"><span class="hs-pragma hs-type">serial</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-245"></span><span id="local-6989586621679424703"><span id="local-6989586621679424704"><span id="local-6989586621679424705"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#serial"><span class="hs-identifier hs-type">serial</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424705"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424705"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424704"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424703"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424705"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424704"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424703"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424705"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424704"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424703"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-246"></span><span id="serial"><span class="annot"><span class="annottext">serial :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#serial"><span class="hs-identifier hs-var hs-var">serial</span></a></span></span><span> </span><span id="local-6989586621679424351"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424351"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424350"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424350"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStream"><span class="hs-identifier hs-var">fromStream</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamK.Type.html#serial"><span class="hs-identifier hs-var">K.serial</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424351"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424350"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-249"></span><span class="hs-comment">-- Interleaving</span><span>
</span><span id="line-250"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">6</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#wSerial"><span class="hs-operator hs-type">`wSerial`</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="hs-comment">-- XXX doc duplicated from Stream.Serial module.</span><span>
</span><span id="line-255"></span><span class="hs-comment">--</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- | Interleaves two streams, yielding one element from each stream</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- alternately.  When one stream stops the rest of the other stream is used in</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- the output stream.</span><span>
</span><span id="line-259"></span><span class="hs-comment">--</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- &gt;&gt;&gt; import Streamly.Prelude (wSerial)</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- &gt;&gt;&gt; stream1 = Stream.fromList [1,2]</span><span>
</span><span id="line-262"></span><span class="hs-comment">-- &gt;&gt;&gt; stream2 = Stream.fromList [3,4]</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.fromWSerial $ stream1 `wSerial` stream2</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- [1,3,2,4]</span><span>
</span><span id="line-265"></span><span class="hs-comment">--</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- Note, for singleton streams 'wSerial' and 'serial' are identical.</span><span>
</span><span id="line-267"></span><span class="hs-comment">--</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- Note that this operation cannot be used to fold a container of infinite</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- streams but it can be used for very large streams as the state that it needs</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- to maintain is proportional to the logarithm of the number of streams.</span><span>
</span><span id="line-271"></span><span class="hs-comment">--</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-273"></span><span class="hs-comment">--</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- /Since: 0.2.0 (&quot;Streamly&quot;)/</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-comment">-- Scheduling Notes:</span><span>
</span><span id="line-277"></span><span class="hs-comment">--</span><span>
</span><span id="line-278"></span><span class="hs-comment">-- Note that evaluation of @a \`wSerial` b \`wSerial` c@ does not interleave</span><span>
</span><span id="line-279"></span><span class="hs-comment">-- @a@, @b@ and @c@ with equal priority.  This expression is equivalent to @a</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- \`wSerial` (b \`wSerial` c)@, therefore, it fairly interleaves @a@ with the</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- result of @b \`wSerial` c@.  For example, @Stream.fromList [1,2] \`wSerial`</span><span>
</span><span id="line-282"></span><span class="hs-comment">-- Stream.fromList [3,4] \`wSerial` Stream.fromList [5,6]@ would result in</span><span>
</span><span id="line-283"></span><span class="hs-comment">-- [1,3,2,5,4,6].  In other words, the leftmost stream gets the same scheduling</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- priority as the rest of the streams taken together. The same is true for</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- each subexpression on the right.</span><span>
</span><span id="line-286"></span><span class="hs-comment">--</span><span>
</span><span id="line-287"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#wSerial"><span class="hs-pragma hs-type">wSerial</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-288"></span><span id="local-6989586621679424344"><span id="local-6989586621679424345"><span id="local-6989586621679424346"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#wSerial"><span class="hs-identifier hs-type">wSerial</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424346"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424346"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424345"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424344"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424346"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424345"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424344"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424346"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424345"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424344"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-289"></span><span id="wSerial"><span class="annot"><span class="annottext">wSerial :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#wSerial"><span class="hs-identifier hs-var hs-var">wSerial</span></a></span></span><span> </span><span id="local-6989586621679424339"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424339"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424338"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424338"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStream"><span class="hs-identifier hs-var">fromStream</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.Serial.html#wSerialK"><span class="hs-identifier hs-var">Serial.wSerialK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424339"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424338"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">5</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#%3C%3D%3E"><span class="hs-operator hs-type">&lt;=&gt;</span></a></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-comment">-- | Same as 'wSerial'.</span><span>
</span><span id="line-294"></span><span class="hs-comment">--</span><span>
</span><span id="line-295"></span><span class="hs-comment">-- @since 0.1.0</span><span>
</span><span id="line-296"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&lt;=&gt;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">&quot;Please use 'wSerial' instead.&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-297"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&lt;=&gt;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-298"></span><span id="local-6989586621679424334"><span id="local-6989586621679424335"><span id="local-6989586621679424336"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#%3C%3D%3E"><span class="hs-operator hs-type">(&lt;=&gt;)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424336"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424336"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424335"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424334"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424336"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424335"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424334"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424336"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424335"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424334"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-299"></span><span id="%3C%3D%3E"><span class="annot"><span class="annottext">&lt;=&gt; :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#%3C%3D%3E"><span class="hs-operator hs-var hs-var">(&lt;=&gt;)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#wSerial"><span class="hs-identifier hs-var">wSerial</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="hs-comment">-- XXX Same as 'wSerial'. We should perhaps rename wSerial to interleave.</span><span>
</span><span id="line-302"></span><span class="hs-comment">-- XXX Document the interleaving behavior of side effects in all the</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- interleaving combinators.</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- XXX Write time-domain equivalents of these. In the time domain we can</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- interleave two streams such that the value of second stream is always taken</span><span>
</span><span id="line-306"></span><span class="hs-comment">-- from its last value even if no new value is being yielded, like</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- zipWithLatest. It would be something like interleaveWithLatest.</span><span>
</span><span id="line-308"></span><span class="hs-comment">--</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- | Interleaves the outputs of two streams, yielding elements from each stream</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- alternately, starting from the first stream. If any of the streams finishes</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- early the other stream continues alone until it too finishes.</span><span>
</span><span id="line-312"></span><span class="hs-comment">--</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- &gt;&gt;&gt; :set -XOverloadedStrings</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Functor.Identity (Identity)</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.interleave &quot;ab&quot; &quot;,,,,&quot; :: Stream.SerialT Identity Char</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- fromList &quot;a,b,,,&quot;</span><span>
</span><span id="line-317"></span><span class="hs-comment">--</span><span>
</span><span id="line-318"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.interleave &quot;abcd&quot; &quot;,,&quot; :: Stream.SerialT Identity Char</span><span>
</span><span id="line-319"></span><span class="hs-comment">-- fromList &quot;a,b,cd&quot;</span><span>
</span><span id="line-320"></span><span class="hs-comment">--</span><span>
</span><span id="line-321"></span><span class="hs-comment">-- 'interleave' is dual to 'interleaveMin', it can be called @interleaveMax@.</span><span>
</span><span id="line-322"></span><span class="hs-comment">--</span><span>
</span><span id="line-323"></span><span class="hs-comment">-- Do not use at scale in concatMapWith.</span><span>
</span><span id="line-324"></span><span class="hs-comment">--</span><span>
</span><span id="line-325"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-326"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interleave"><span class="hs-pragma hs-type">interleave</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-327"></span><span id="local-6989586621679424329"><span id="local-6989586621679424330"><span id="local-6989586621679424331"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interleave"><span class="hs-identifier hs-type">interleave</span></a></span><span> </span><span class="hs-glyph">::</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424331"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424330"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424331"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424330"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424329"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424331"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424330"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424329"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424331"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424330"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424329"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-328"></span><span id="interleave"><span class="annot"><span class="annottext">interleave :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) b.
(IsStream t, Monad m) =&gt;
t m b -&gt; t m b -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interleave"><span class="hs-identifier hs-var hs-var">interleave</span></a></span></span><span> </span><span id="local-6989586621679424319"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424319"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424318"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424318"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Monad m =&gt;
Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Nesting.html#interleave"><span class="hs-identifier hs-var">D.interleave</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424319"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424318"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="hs-comment">-- | Interleaves the outputs of two streams, yielding elements from each stream</span><span>
</span><span id="line-331"></span><span class="hs-comment">-- alternately, starting from the first stream. As soon as the first stream</span><span>
</span><span id="line-332"></span><span class="hs-comment">-- finishes, the output stops, discarding the remaining part of the second</span><span>
</span><span id="line-333"></span><span class="hs-comment">-- stream. In this case, the last element in the resulting stream would be from</span><span>
</span><span id="line-334"></span><span class="hs-comment">-- the second stream. If the second stream finishes early then the first stream</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- still continues to yield elements until it finishes.</span><span>
</span><span id="line-336"></span><span class="hs-comment">--</span><span>
</span><span id="line-337"></span><span class="hs-comment">-- &gt;&gt;&gt; :set -XOverloadedStrings</span><span>
</span><span id="line-338"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Functor.Identity (Identity)</span><span>
</span><span id="line-339"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.interleaveSuffix &quot;abc&quot; &quot;,,,,&quot; :: Stream.SerialT Identity Char</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- fromList &quot;a,b,c,&quot;</span><span>
</span><span id="line-341"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.interleaveSuffix &quot;abc&quot; &quot;,&quot; :: Stream.SerialT Identity Char</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- fromList &quot;a,bc&quot;</span><span>
</span><span id="line-343"></span><span class="hs-comment">--</span><span>
</span><span id="line-344"></span><span class="hs-comment">-- 'interleaveSuffix' is a dual of 'interleaveInfix'.</span><span>
</span><span id="line-345"></span><span class="hs-comment">--</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- Do not use at scale in concatMapWith.</span><span>
</span><span id="line-347"></span><span class="hs-comment">--</span><span>
</span><span id="line-348"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-349"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interleaveSuffix"><span class="hs-pragma hs-type">interleaveSuffix</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-350"></span><span id="local-6989586621679424314"><span id="local-6989586621679424315"><span id="local-6989586621679424316"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interleaveSuffix"><span class="hs-identifier hs-type">interleaveSuffix</span></a></span><span> </span><span class="hs-glyph">::</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424316"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424315"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424316"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424315"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424314"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424316"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424315"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424314"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424316"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424315"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424314"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-351"></span><span id="interleaveSuffix"><span class="annot"><span class="annottext">interleaveSuffix :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) b.
(IsStream t, Monad m) =&gt;
t m b -&gt; t m b -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interleaveSuffix"><span class="hs-identifier hs-var hs-var">interleaveSuffix</span></a></span></span><span> </span><span id="local-6989586621679424304"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424304"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424303"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424303"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Monad m =&gt;
Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Nesting.html#interleaveSuffix"><span class="hs-identifier hs-var">D.interleaveSuffix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424304"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424303"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="hs-comment">-- | Interleaves the outputs of two streams, yielding elements from each stream</span><span>
</span><span id="line-355"></span><span class="hs-comment">-- alternately, starting from the first stream and ending at the first stream.</span><span>
</span><span id="line-356"></span><span class="hs-comment">-- If the second stream is longer than the first, elements from the second</span><span>
</span><span id="line-357"></span><span class="hs-comment">-- stream are infixed with elements from the first stream. If the first stream</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- is longer then it continues yielding elements even after the second stream</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- has finished.</span><span>
</span><span id="line-360"></span><span class="hs-comment">--</span><span>
</span><span id="line-361"></span><span class="hs-comment">-- &gt;&gt;&gt; :set -XOverloadedStrings</span><span>
</span><span id="line-362"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Functor.Identity (Identity)</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.interleaveInfix &quot;abc&quot; &quot;,,,,&quot; :: Stream.SerialT Identity Char</span><span>
</span><span id="line-364"></span><span class="hs-comment">-- fromList &quot;a,b,c&quot;</span><span>
</span><span id="line-365"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.interleaveInfix &quot;abc&quot; &quot;,&quot; :: Stream.SerialT Identity Char</span><span>
</span><span id="line-366"></span><span class="hs-comment">-- fromList &quot;a,bc&quot;</span><span>
</span><span id="line-367"></span><span class="hs-comment">--</span><span>
</span><span id="line-368"></span><span class="hs-comment">-- 'interleaveInfix' is a dual of 'interleaveSuffix'.</span><span>
</span><span id="line-369"></span><span class="hs-comment">--</span><span>
</span><span id="line-370"></span><span class="hs-comment">-- Do not use at scale in concatMapWith.</span><span>
</span><span id="line-371"></span><span class="hs-comment">--</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-373"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interleaveInfix"><span class="hs-pragma hs-type">interleaveInfix</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-374"></span><span id="local-6989586621679424299"><span id="local-6989586621679424300"><span id="local-6989586621679424301"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interleaveInfix"><span class="hs-identifier hs-type">interleaveInfix</span></a></span><span> </span><span class="hs-glyph">::</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424301"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424300"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424301"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424300"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424299"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424301"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424300"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424299"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424301"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424300"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424299"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-375"></span><span id="interleaveInfix"><span class="annot"><span class="annottext">interleaveInfix :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) b.
(IsStream t, Monad m) =&gt;
t m b -&gt; t m b -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interleaveInfix"><span class="hs-identifier hs-var hs-var">interleaveInfix</span></a></span></span><span> </span><span id="local-6989586621679424289"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424289"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424288"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424288"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-376"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Monad m =&gt;
Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Nesting.html#interleaveInfix"><span class="hs-identifier hs-var">D.interleaveInfix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424289"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424288"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="hs-comment">-- | Interleaves the outputs of two streams, yielding elements from each stream</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- alternately, starting from the first stream. The output stops as soon as any</span><span>
</span><span id="line-380"></span><span class="hs-comment">-- of the two streams finishes, discarding the remaining part of the other</span><span>
</span><span id="line-381"></span><span class="hs-comment">-- stream. The last element of the resulting stream would be from the longer</span><span>
</span><span id="line-382"></span><span class="hs-comment">-- stream.</span><span>
</span><span id="line-383"></span><span class="hs-comment">--</span><span>
</span><span id="line-384"></span><span class="hs-comment">-- &gt;&gt;&gt; :set -XOverloadedStrings</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Functor.Identity (Identity)</span><span>
</span><span id="line-386"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.interleaveMin &quot;ab&quot; &quot;,,,,&quot; :: Stream.SerialT Identity Char</span><span>
</span><span id="line-387"></span><span class="hs-comment">-- fromList &quot;a,b,&quot;</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.interleaveMin &quot;abcd&quot; &quot;,,&quot; :: Stream.SerialT Identity Char</span><span>
</span><span id="line-389"></span><span class="hs-comment">-- fromList &quot;a,b,c&quot;</span><span>
</span><span id="line-390"></span><span class="hs-comment">--</span><span>
</span><span id="line-391"></span><span class="hs-comment">-- 'interleaveMin' is dual to 'interleave'.</span><span>
</span><span id="line-392"></span><span class="hs-comment">--</span><span>
</span><span id="line-393"></span><span class="hs-comment">-- Do not use at scale in concatMapWith.</span><span>
</span><span id="line-394"></span><span class="hs-comment">--</span><span>
</span><span id="line-395"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-396"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interleaveMin"><span class="hs-pragma hs-type">interleaveMin</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-397"></span><span id="local-6989586621679424284"><span id="local-6989586621679424285"><span id="local-6989586621679424286"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interleaveMin"><span class="hs-identifier hs-type">interleaveMin</span></a></span><span> </span><span class="hs-glyph">::</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424286"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424285"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424286"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424285"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424284"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424286"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424285"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424284"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424286"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424285"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424284"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-398"></span><span id="interleaveMin"><span class="annot"><span class="annottext">interleaveMin :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) b.
(IsStream t, Monad m) =&gt;
t m b -&gt; t m b -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interleaveMin"><span class="hs-identifier hs-var hs-var">interleaveMin</span></a></span></span><span> </span><span id="local-6989586621679424274"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424274"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424273"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424273"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Monad m =&gt;
Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Nesting.html#interleaveMin"><span class="hs-identifier hs-var">D.interleaveMin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424274"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424273"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-401"></span><span class="hs-comment">-- Scheduling</span><span>
</span><span id="line-402"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span class="hs-comment">-- | Schedule the execution of two streams in a fair round-robin manner,</span><span>
</span><span id="line-405"></span><span class="hs-comment">-- executing each stream once, alternately. Execution of a stream may not</span><span>
</span><span id="line-406"></span><span class="hs-comment">-- necessarily result in an output, a stream may chose to @Skip@ producing an</span><span>
</span><span id="line-407"></span><span class="hs-comment">-- element until later giving the other stream a chance to run. Therefore, this</span><span>
</span><span id="line-408"></span><span class="hs-comment">-- combinator fairly interleaves the execution of two streams rather than</span><span>
</span><span id="line-409"></span><span class="hs-comment">-- fairly interleaving the output of the two streams. This can be useful in</span><span>
</span><span id="line-410"></span><span class="hs-comment">-- co-operative multitasking without using explicit threads. This can be used</span><span>
</span><span id="line-411"></span><span class="hs-comment">-- as an alternative to `async`.</span><span>
</span><span id="line-412"></span><span class="hs-comment">--</span><span>
</span><span id="line-413"></span><span class="hs-comment">-- Do not use at scale in concatMapWith.</span><span>
</span><span id="line-414"></span><span class="hs-comment">--</span><span>
</span><span id="line-415"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-416"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#roundrobin"><span class="hs-pragma hs-type">roundrobin</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-417"></span><span id="local-6989586621679424269"><span id="local-6989586621679424270"><span id="local-6989586621679424271"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#roundrobin"><span class="hs-identifier hs-type">roundrobin</span></a></span><span> </span><span class="hs-glyph">::</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424271"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424270"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424271"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424270"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424269"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424271"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424270"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424269"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424271"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424270"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424269"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-418"></span><span id="roundrobin"><span class="annot"><span class="annottext">roundrobin :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) b.
(IsStream t, Monad m) =&gt;
t m b -&gt; t m b -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#roundrobin"><span class="hs-identifier hs-var hs-var">roundrobin</span></a></span></span><span> </span><span id="local-6989586621679424259"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424259"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424258"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424258"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Monad m =&gt;
Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Nesting.html#roundRobin"><span class="hs-identifier hs-var">D.roundRobin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424259"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424258"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">6</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#async"><span class="hs-operator hs-type">`async`</span></a></span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="hs-comment">-- | Merges two streams, both the streams may be evaluated concurrently,</span><span>
</span><span id="line-423"></span><span class="hs-comment">-- outputs from both are used as they arrive:</span><span>
</span><span id="line-424"></span><span class="hs-comment">--</span><span>
</span><span id="line-425"></span><span class="hs-comment">-- &gt;&gt;&gt; import Streamly.Prelude (async)</span><span>
</span><span id="line-426"></span><span class="hs-comment">-- &gt;&gt;&gt; stream1 = Stream.fromEffect (delay 4)</span><span>
</span><span id="line-427"></span><span class="hs-comment">-- &gt;&gt;&gt; stream2 = Stream.fromEffect (delay 2)</span><span>
</span><span id="line-428"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ stream1 `async` stream2</span><span>
</span><span id="line-429"></span><span class="hs-comment">-- 2 sec</span><span>
</span><span id="line-430"></span><span class="hs-comment">-- 4 sec</span><span>
</span><span id="line-431"></span><span class="hs-comment">-- [2,4]</span><span>
</span><span id="line-432"></span><span class="hs-comment">--</span><span>
</span><span id="line-433"></span><span class="hs-comment">-- Multiple streams can be combined. With enough threads, all of them can be</span><span>
</span><span id="line-434"></span><span class="hs-comment">-- scheduled simultaneously:</span><span>
</span><span id="line-435"></span><span class="hs-comment">--</span><span>
</span><span id="line-436"></span><span class="hs-comment">-- &gt;&gt;&gt; stream3 = Stream.fromEffect (delay 1)</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ stream1 `async` stream2 `async` stream3</span><span>
</span><span id="line-438"></span><span class="hs-comment">-- ...</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- [1,2,4]</span><span>
</span><span id="line-440"></span><span class="hs-comment">--</span><span>
</span><span id="line-441"></span><span class="hs-comment">-- With 2 threads, only two can be scheduled at a time, when one of those</span><span>
</span><span id="line-442"></span><span class="hs-comment">-- finishes, the third one gets scheduled:</span><span>
</span><span id="line-443"></span><span class="hs-comment">--</span><span>
</span><span id="line-444"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.maxThreads 2 $ stream1 `async` stream2 `async` stream3</span><span>
</span><span id="line-445"></span><span class="hs-comment">-- ...</span><span>
</span><span id="line-446"></span><span class="hs-comment">-- [2,1,4]</span><span>
</span><span id="line-447"></span><span class="hs-comment">--</span><span>
</span><span id="line-448"></span><span class="hs-comment">-- With a single thread, it becomes serial:</span><span>
</span><span id="line-449"></span><span class="hs-comment">--</span><span>
</span><span id="line-450"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.maxThreads 1 $ stream1 `async` stream2 `async` stream3</span><span>
</span><span id="line-451"></span><span class="hs-comment">-- ...</span><span>
</span><span id="line-452"></span><span class="hs-comment">-- [4,2,1]</span><span>
</span><span id="line-453"></span><span class="hs-comment">--</span><span>
</span><span id="line-454"></span><span class="hs-comment">-- Only streams are scheduled for async evaluation, how actions within a</span><span>
</span><span id="line-455"></span><span class="hs-comment">-- stream are evaluated depends on the stream type. If it is a concurrent</span><span>
</span><span id="line-456"></span><span class="hs-comment">-- stream they will be evaluated concurrently.</span><span>
</span><span id="line-457"></span><span class="hs-comment">--</span><span>
</span><span id="line-458"></span><span class="hs-comment">-- In the following example, both the streams are scheduled for concurrent</span><span>
</span><span id="line-459"></span><span class="hs-comment">-- evaluation but each individual stream is evaluated serially:</span><span>
</span><span id="line-460"></span><span class="hs-comment">--</span><span>
</span><span id="line-461"></span><span class="hs-comment">-- &gt;&gt;&gt; stream1 = Stream.fromListM $ Prelude.map delay [3,3] -- SerialT IO Int</span><span>
</span><span id="line-462"></span><span class="hs-comment">-- &gt;&gt;&gt; stream2 = Stream.fromListM $ Prelude.map delay [1,1] -- SerialT IO Int</span><span>
</span><span id="line-463"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ stream1 `async` stream2 -- IO [Int]</span><span>
</span><span id="line-464"></span><span class="hs-comment">-- ...</span><span>
</span><span id="line-465"></span><span class="hs-comment">-- [1,1,3,3]</span><span>
</span><span id="line-466"></span><span class="hs-comment">--</span><span>
</span><span id="line-467"></span><span class="hs-comment">-- If total threads are 2, the third stream is scheduled only after one of the</span><span>
</span><span id="line-468"></span><span class="hs-comment">-- first two has finished:</span><span>
</span><span id="line-469"></span><span class="hs-comment">--</span><span>
</span><span id="line-470"></span><span class="hs-comment">-- &gt; stream3 = Stream.fromListM $ Prelude.map delay [2,2] -- SerialT IO Int</span><span>
</span><span id="line-471"></span><span class="hs-comment">-- &gt; Stream.toList $ Stream.maxThreads 2 $ stream1 `async` stream2 `async` stream3 -- IO [Int]</span><span>
</span><span id="line-472"></span><span class="hs-comment">-- ...</span><span>
</span><span id="line-473"></span><span class="hs-comment">-- [1,1,3,2,3,2]</span><span>
</span><span id="line-474"></span><span class="hs-comment">--</span><span>
</span><span id="line-475"></span><span class="hs-comment">-- Thus 'async' goes deep in first few streams rather than going wide in all</span><span>
</span><span id="line-476"></span><span class="hs-comment">-- streams. It prefers to evaluate the leftmost streams as much as possible.</span><span>
</span><span id="line-477"></span><span class="hs-comment">-- Because of this behavior, 'async' can be safely used to fold an infinite</span><span>
</span><span id="line-478"></span><span class="hs-comment">-- lazy container of streams.</span><span>
</span><span id="line-479"></span><span class="hs-comment">--</span><span>
</span><span id="line-480"></span><span class="hs-comment">-- /Since: 0.2.0 (&quot;Streamly&quot;)/</span><span>
</span><span id="line-481"></span><span class="hs-comment">--</span><span>
</span><span id="line-482"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-483"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#async"><span class="hs-pragma hs-type">async</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-484"></span><span id="local-6989586621679424669"><span id="local-6989586621679424671"><span id="local-6989586621679424672"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#async"><span class="hs-identifier hs-type">async</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424672"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Control.Concurrent.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424671"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424672"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424671"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424669"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424672"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424671"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424669"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424672"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424671"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424669"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-485"></span><span id="async"><span class="annot"><span class="annottext">async :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, MonadAsync m) =&gt;
t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#async"><span class="hs-identifier hs-var hs-var">async</span></a></span></span><span> </span><span id="local-6989586621679424250"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424250"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424249"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424249"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStream"><span class="hs-identifier hs-var">fromStream</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadAsync m =&gt;
Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.Async.html#asyncK"><span class="hs-identifier hs-var">asyncK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424250"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424249"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span class="hs-comment">-- | Same as 'async'.</span><span>
</span><span id="line-488"></span><span class="hs-comment">--</span><span>
</span><span id="line-489"></span><span class="hs-comment">-- @since 0.1.0</span><span>
</span><span id="line-490"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&lt;|</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">&quot;Please use 'async' instead.&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-491"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&lt;|</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-492"></span><span id="local-6989586621679424246"><span id="local-6989586621679424247"><span id="local-6989586621679424248"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#%3C%7C"><span class="hs-operator hs-type">(&lt;|)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424248"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Control.Concurrent.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424247"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424248"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424247"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424246"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424248"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424247"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424246"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424248"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424247"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424246"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-493"></span><span id="%3C%7C"><span class="annot"><span class="annottext">&lt;| :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, MonadAsync m) =&gt;
t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#%3C%7C"><span class="hs-operator hs-var hs-var">(&lt;|)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, MonadAsync m) =&gt;
t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#async"><span class="hs-identifier hs-var">async</span></a></span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">6</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#wAsync"><span class="hs-operator hs-type">`wAsync`</span></a></span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span class="hs-comment">-- | For singleton streams, 'wAsync' is the same as 'async'.  See 'async' for</span><span>
</span><span id="line-498"></span><span class="hs-comment">-- singleton stream behavior. For multi-element streams, while 'async' is left</span><span>
</span><span id="line-499"></span><span class="hs-comment">-- biased i.e. it tries to evaluate the left side stream as much as possible,</span><span>
</span><span id="line-500"></span><span class="hs-comment">-- 'wAsync' tries to schedule them both fairly. In other words, 'async' goes</span><span>
</span><span id="line-501"></span><span class="hs-comment">-- deep while 'wAsync' goes wide. However, outputs are always used as they</span><span>
</span><span id="line-502"></span><span class="hs-comment">-- arrive.</span><span>
</span><span id="line-503"></span><span class="hs-comment">--</span><span>
</span><span id="line-504"></span><span class="hs-comment">-- With a single thread, 'async' starts behaving like 'serial' while 'wAsync'</span><span>
</span><span id="line-505"></span><span class="hs-comment">-- starts behaving like 'wSerial'.</span><span>
</span><span id="line-506"></span><span class="hs-comment">--</span><span>
</span><span id="line-507"></span><span class="hs-comment">-- &gt;&gt;&gt; import Streamly.Prelude (async, wAsync)</span><span>
</span><span id="line-508"></span><span class="hs-comment">-- &gt;&gt;&gt; stream1 = Stream.fromList [1,2,3]</span><span>
</span><span id="line-509"></span><span class="hs-comment">-- &gt;&gt;&gt; stream2 = Stream.fromList [4,5,6]</span><span>
</span><span id="line-510"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.fromAsync $ Stream.maxThreads 1 $ stream1 `async` stream2</span><span>
</span><span id="line-511"></span><span class="hs-comment">-- [1,2,3,4,5,6]</span><span>
</span><span id="line-512"></span><span class="hs-comment">--</span><span>
</span><span id="line-513"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.fromWAsync $ Stream.maxThreads 1 $ stream1 `wAsync` stream2</span><span>
</span><span id="line-514"></span><span class="hs-comment">-- [1,4,2,5,3,6]</span><span>
</span><span id="line-515"></span><span class="hs-comment">--</span><span>
</span><span id="line-516"></span><span class="hs-comment">-- With two threads available, and combining three streams:</span><span>
</span><span id="line-517"></span><span class="hs-comment">--</span><span>
</span><span id="line-518"></span><span class="hs-comment">-- &gt;&gt;&gt; stream3 = Stream.fromList [7,8,9]</span><span>
</span><span id="line-519"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.fromAsync $ Stream.maxThreads 2 $ stream1 `async` stream2 `async` stream3</span><span>
</span><span id="line-520"></span><span class="hs-comment">-- [1,2,3,4,5,6,7,8,9]</span><span>
</span><span id="line-521"></span><span class="hs-comment">--</span><span>
</span><span id="line-522"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.fromWAsync $ Stream.maxThreads 2 $ stream1 `wAsync` stream2 `wAsync` stream3</span><span>
</span><span id="line-523"></span><span class="hs-comment">-- [1,4,2,7,5,3,8,6,9]</span><span>
</span><span id="line-524"></span><span class="hs-comment">--</span><span>
</span><span id="line-525"></span><span class="hs-comment">-- This operation cannot be used to fold an infinite lazy container of streams,</span><span>
</span><span id="line-526"></span><span class="hs-comment">-- because it schedules all the streams in a round robin manner.</span><span>
</span><span id="line-527"></span><span class="hs-comment">--</span><span>
</span><span id="line-528"></span><span class="hs-comment">-- Note that 'WSerialT' and single threaded 'WAsyncT' both interleave streams</span><span>
</span><span id="line-529"></span><span class="hs-comment">-- but the exact scheduling is slightly different in both cases.</span><span>
</span><span id="line-530"></span><span class="hs-comment">--</span><span>
</span><span id="line-531"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-532"></span><span class="hs-comment">--</span><span>
</span><span id="line-533"></span><span class="hs-comment">-- /Since: 0.2.0 (&quot;Streamly&quot;)/</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span class="hs-comment">-- Scheduling details:</span><span>
</span><span id="line-536"></span><span class="hs-comment">--</span><span>
</span><span id="line-537"></span><span class="hs-comment">-- This is how the execution of the above example proceeds:</span><span>
</span><span id="line-538"></span><span class="hs-comment">--</span><span>
</span><span id="line-539"></span><span class="hs-comment">-- 1. The scheduler queue is initialized with @[S.fromList [1,2,3],</span><span>
</span><span id="line-540"></span><span class="hs-comment">-- (S.fromList [4,5,6]) \&lt;&gt; (S.fromList [7,8,9])]@ assuming the head of the</span><span>
</span><span id="line-541"></span><span class="hs-comment">-- queue is represented by the  rightmost item.</span><span>
</span><span id="line-542"></span><span class="hs-comment">-- 2. @S.fromList [1,2,3]@ is executed, yielding the element @1@ and putting</span><span>
</span><span id="line-543"></span><span class="hs-comment">-- @[2,3]@ at the back of the scheduler queue. The scheduler queue now looks</span><span>
</span><span id="line-544"></span><span class="hs-comment">-- like @[(S.fromList [4,5,6]) \&lt;&gt; (S.fromList [7,8,9]), S.fromList [2,3]]@.</span><span>
</span><span id="line-545"></span><span class="hs-comment">-- 3. Now @(S.fromList [4,5,6]) \&lt;&gt; (S.fromList [7,8,9])@ is picked up for</span><span>
</span><span id="line-546"></span><span class="hs-comment">-- execution, @S.fromList [7,8,9]@ is added at the back of the queue and</span><span>
</span><span id="line-547"></span><span class="hs-comment">-- @S.fromList [4,5,6]@ is executed, yielding the element @4@ and adding</span><span>
</span><span id="line-548"></span><span class="hs-comment">-- @S.fromList [5,6]@ at the back of the queue. The queue now looks like</span><span>
</span><span id="line-549"></span><span class="hs-comment">-- @[S.fromList [2,3], S.fromList [7,8,9], S.fromList [5,6]]@.</span><span>
</span><span id="line-550"></span><span class="hs-comment">-- 4. Note that the scheduler queue expands by one more stream component in</span><span>
</span><span id="line-551"></span><span class="hs-comment">-- every pass because one more @&lt;&gt;@ is broken down into two components. At this</span><span>
</span><span id="line-552"></span><span class="hs-comment">-- point there are no more @&lt;&gt;@ operations to be broken down further and the</span><span>
</span><span id="line-553"></span><span class="hs-comment">-- queue has reached its maximum size. Now these streams are scheduled in</span><span>
</span><span id="line-554"></span><span class="hs-comment">-- round-robin fashion yielding @[2,7,5,3,8,6,9]@.</span><span>
</span><span id="line-555"></span><span class="hs-comment">--</span><span>
</span><span id="line-556"></span><span class="hs-comment">-- As we see above, in a right associated expression composed with @&lt;&gt;@, only</span><span>
</span><span id="line-557"></span><span class="hs-comment">-- one @&lt;&gt;@ operation is broken down into two components in one execution,</span><span>
</span><span id="line-558"></span><span class="hs-comment">-- therefore, if we have @n@ streams composed using @&lt;&gt;@ it will take @n@</span><span>
</span><span id="line-559"></span><span class="hs-comment">-- scheduler passes to expand the whole expression.  By the time @n-th@</span><span>
</span><span id="line-560"></span><span class="hs-comment">-- component is added to the scheduler queue, the first component would have</span><span>
</span><span id="line-561"></span><span class="hs-comment">-- received @n@ scheduler passes.</span><span>
</span><span id="line-562"></span><span class="hs-comment">--</span><span>
</span><span id="line-563"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#wAsync"><span class="hs-pragma hs-type">wAsync</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-564"></span><span id="local-6989586621679424239"><span id="local-6989586621679424240"><span id="local-6989586621679424241"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#wAsync"><span class="hs-identifier hs-type">wAsync</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424241"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Control.Concurrent.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424240"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424241"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424240"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424239"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424241"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424240"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424239"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424241"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424240"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424239"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-565"></span><span id="wAsync"><span class="annot"><span class="annottext">wAsync :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, MonadAsync m) =&gt;
t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#wAsync"><span class="hs-identifier hs-var hs-var">wAsync</span></a></span></span><span> </span><span id="local-6989586621679424232"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424232"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424231"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424231"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStream"><span class="hs-identifier hs-var">fromStream</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadAsync m =&gt;
Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.Async.html#wAsyncK"><span class="hs-identifier hs-var">wAsyncK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424232"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424231"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">6</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#ahead"><span class="hs-operator hs-type">`ahead`</span></a></span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span class="hs-comment">-- | Appends two streams, both the streams may be evaluated concurrently but</span><span>
</span><span id="line-570"></span><span class="hs-comment">-- the outputs are used in the same order as the corresponding actions in the</span><span>
</span><span id="line-571"></span><span class="hs-comment">-- original streams, side effects will happen in the order in which the streams</span><span>
</span><span id="line-572"></span><span class="hs-comment">-- are evaluated:</span><span>
</span><span id="line-573"></span><span class="hs-comment">--</span><span>
</span><span id="line-574"></span><span class="hs-comment">-- &gt;&gt;&gt; import Streamly.Prelude (ahead, SerialT)</span><span>
</span><span id="line-575"></span><span class="hs-comment">-- &gt;&gt;&gt; stream1 = Stream.fromEffect (delay 4) :: SerialT IO Int</span><span>
</span><span id="line-576"></span><span class="hs-comment">-- &gt;&gt;&gt; stream2 = Stream.fromEffect (delay 2) :: SerialT IO Int</span><span>
</span><span id="line-577"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ stream1 `ahead` stream2 :: IO [Int]</span><span>
</span><span id="line-578"></span><span class="hs-comment">-- 2 sec</span><span>
</span><span id="line-579"></span><span class="hs-comment">-- 4 sec</span><span>
</span><span id="line-580"></span><span class="hs-comment">-- [4,2]</span><span>
</span><span id="line-581"></span><span class="hs-comment">--</span><span>
</span><span id="line-582"></span><span class="hs-comment">-- Multiple streams can be combined. With enough threads, all of them can be</span><span>
</span><span id="line-583"></span><span class="hs-comment">-- scheduled simultaneously:</span><span>
</span><span id="line-584"></span><span class="hs-comment">--</span><span>
</span><span id="line-585"></span><span class="hs-comment">-- &gt;&gt;&gt; stream3 = Stream.fromEffect (delay 1)</span><span>
</span><span id="line-586"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ stream1 `ahead` stream2 `ahead` stream3</span><span>
</span><span id="line-587"></span><span class="hs-comment">-- 1 sec</span><span>
</span><span id="line-588"></span><span class="hs-comment">-- 2 sec</span><span>
</span><span id="line-589"></span><span class="hs-comment">-- 4 sec</span><span>
</span><span id="line-590"></span><span class="hs-comment">-- [4,2,1]</span><span>
</span><span id="line-591"></span><span class="hs-comment">--</span><span>
</span><span id="line-592"></span><span class="hs-comment">-- With 2 threads, only two can be scheduled at a time, when one of those</span><span>
</span><span id="line-593"></span><span class="hs-comment">-- finishes, the third one gets scheduled:</span><span>
</span><span id="line-594"></span><span class="hs-comment">--</span><span>
</span><span id="line-595"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.maxThreads 2 $ stream1 `ahead` stream2 `ahead` stream3</span><span>
</span><span id="line-596"></span><span class="hs-comment">-- 2 sec</span><span>
</span><span id="line-597"></span><span class="hs-comment">-- 1 sec</span><span>
</span><span id="line-598"></span><span class="hs-comment">-- 4 sec</span><span>
</span><span id="line-599"></span><span class="hs-comment">-- [4,2,1]</span><span>
</span><span id="line-600"></span><span class="hs-comment">--</span><span>
</span><span id="line-601"></span><span class="hs-comment">-- Only streams are scheduled for ahead evaluation, how actions within a stream</span><span>
</span><span id="line-602"></span><span class="hs-comment">-- are evaluated depends on the stream type. If it is a concurrent stream they</span><span>
</span><span id="line-603"></span><span class="hs-comment">-- will be evaluated concurrently. It may not make much sense combining serial</span><span>
</span><span id="line-604"></span><span class="hs-comment">-- streams using 'ahead'.</span><span>
</span><span id="line-605"></span><span class="hs-comment">--</span><span>
</span><span id="line-606"></span><span class="hs-comment">-- 'ahead' can be safely used to fold an infinite lazy container of streams.</span><span>
</span><span id="line-607"></span><span class="hs-comment">--</span><span>
</span><span id="line-608"></span><span class="hs-comment">-- /Since: 0.3.0 (&quot;Streamly&quot;)/</span><span>
</span><span id="line-609"></span><span class="hs-comment">--</span><span>
</span><span id="line-610"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-611"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#ahead"><span class="hs-pragma hs-type">ahead</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-612"></span><span id="local-6989586621679424228"><span id="local-6989586621679424229"><span id="local-6989586621679424230"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#ahead"><span class="hs-identifier hs-type">ahead</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424230"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Control.Concurrent.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424229"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424230"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424229"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424228"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424230"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424229"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424228"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424230"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424229"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424228"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-613"></span><span id="ahead"><span class="annot"><span class="annottext">ahead :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, MonadAsync m) =&gt;
t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#ahead"><span class="hs-identifier hs-var hs-var">ahead</span></a></span></span><span> </span><span id="local-6989586621679424221"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424221"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424220"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424220"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStream"><span class="hs-identifier hs-var">fromStream</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadAsync m =&gt;
Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.Ahead.html#aheadK"><span class="hs-identifier hs-var">aheadK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424221"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424220"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>
</span><span id="line-615"></span><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">6</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#parallel"><span class="hs-operator hs-type">`parallel`</span></a></span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span class="hs-comment">-- | Like 'Streamly.Prelude.async' except that the execution is much more</span><span>
</span><span id="line-618"></span><span class="hs-comment">-- strict. There is no limit on the number of threads. While</span><span>
</span><span id="line-619"></span><span class="hs-comment">-- 'Streamly.Prelude.async' may not schedule a stream if there is no demand</span><span>
</span><span id="line-620"></span><span class="hs-comment">-- from the consumer, 'parallel' always evaluates both the streams immediately.</span><span>
</span><span id="line-621"></span><span class="hs-comment">-- The only limit that applies to 'parallel' is 'Streamly.Prelude.maxBuffer'.</span><span>
</span><span id="line-622"></span><span class="hs-comment">-- Evaluation may block if the output buffer becomes full.</span><span>
</span><span id="line-623"></span><span class="hs-comment">--</span><span>
</span><span id="line-624"></span><span class="hs-comment">-- &gt;&gt;&gt; import Streamly.Prelude (parallel)</span><span>
</span><span id="line-625"></span><span class="hs-comment">-- &gt;&gt;&gt; stream = Stream.fromEffect (delay 2) `parallel` Stream.fromEffect (delay 1)</span><span>
</span><span id="line-626"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList stream -- IO [Int]</span><span>
</span><span id="line-627"></span><span class="hs-comment">-- 1 sec</span><span>
</span><span id="line-628"></span><span class="hs-comment">-- 2 sec</span><span>
</span><span id="line-629"></span><span class="hs-comment">-- [1,2]</span><span>
</span><span id="line-630"></span><span class="hs-comment">--</span><span>
</span><span id="line-631"></span><span class="hs-comment">-- 'parallel' guarantees that all the streams are scheduled for execution</span><span>
</span><span id="line-632"></span><span class="hs-comment">-- immediately, therefore, we could use things like starting timers inside the</span><span>
</span><span id="line-633"></span><span class="hs-comment">-- streams and relying on the fact that all timers were started at the same</span><span>
</span><span id="line-634"></span><span class="hs-comment">-- time.</span><span>
</span><span id="line-635"></span><span class="hs-comment">--</span><span>
</span><span id="line-636"></span><span class="hs-comment">-- Unlike 'async' this operation cannot be used to fold an infinite lazy</span><span>
</span><span id="line-637"></span><span class="hs-comment">-- container of streams, because it schedules all the streams strictly</span><span>
</span><span id="line-638"></span><span class="hs-comment">-- concurrently.</span><span>
</span><span id="line-639"></span><span class="hs-comment">--</span><span>
</span><span id="line-640"></span><span class="hs-comment">-- /Since: 0.2.0 (&quot;Streamly&quot;)/</span><span>
</span><span id="line-641"></span><span class="hs-comment">--</span><span>
</span><span id="line-642"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-643"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#parallel"><span class="hs-pragma hs-type">parallel</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-644"></span><span id="local-6989586621679424217"><span id="local-6989586621679424218"><span id="local-6989586621679424219"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#parallel"><span class="hs-identifier hs-type">parallel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424219"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Control.Concurrent.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424218"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424219"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424218"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424217"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424219"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424218"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424217"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424219"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424218"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424217"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-645"></span><span id="parallel"><span class="annot"><span class="annottext">parallel :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, MonadAsync m) =&gt;
t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#parallel"><span class="hs-identifier hs-var hs-var">parallel</span></a></span></span><span> </span><span id="local-6989586621679424210"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424210"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424209"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424209"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStream"><span class="hs-identifier hs-var">fromStream</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadAsync m =&gt;
Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.Parallel.html#parallelK"><span class="hs-identifier hs-var">Par.parallelK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424210"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424209"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>
</span><span id="line-647"></span><span class="hs-comment">-- This is a race like combinator for streams.</span><span>
</span><span id="line-648"></span><span class="hs-comment">--</span><span>
</span><span id="line-649"></span><span class="hs-comment">-- | Like `parallel` but stops the output as soon as any of the two streams</span><span>
</span><span id="line-650"></span><span class="hs-comment">-- stops.</span><span>
</span><span id="line-651"></span><span class="hs-comment">--</span><span>
</span><span id="line-652"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-653"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#parallelMin"><span class="hs-pragma hs-type">parallelMin</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-654"></span><span id="local-6989586621679424205"><span id="local-6989586621679424206"><span id="local-6989586621679424207"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#parallelMin"><span class="hs-identifier hs-type">parallelMin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424207"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Control.Concurrent.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424206"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424207"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424206"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424205"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424207"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424206"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424205"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424207"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424206"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424205"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-655"></span><span id="parallelMin"><span class="annot"><span class="annottext">parallelMin :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, MonadAsync m) =&gt;
t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#parallelMin"><span class="hs-identifier hs-var hs-var">parallelMin</span></a></span></span><span> </span><span id="local-6989586621679424198"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424198"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424197"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424197"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStream"><span class="hs-identifier hs-var">fromStream</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadAsync m =&gt;
Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.Parallel.html#parallelMinK"><span class="hs-identifier hs-var">Par.parallelMinK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424198"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424197"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>
</span><span id="line-657"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-658"></span><span class="hs-comment">-- Zipping</span><span>
</span><span id="line-659"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span class="hs-comment">-- | Like 'zipAsyncWith' but with a monadic zipping function.</span><span>
</span><span id="line-662"></span><span class="hs-comment">--</span><span>
</span><span id="line-663"></span><span class="hs-comment">-- @since 0.4.0</span><span>
</span><span id="line-664"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#zipAsyncWithM"><span class="hs-pragma hs-type">zipAsyncWithM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-665"></span><span id="local-6989586621679424645"><span id="local-6989586621679424646"><span id="local-6989586621679424647"><span id="local-6989586621679424648"><span id="local-6989586621679424649"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#zipAsyncWithM"><span class="hs-identifier hs-type">zipAsyncWithM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424649"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Control.Concurrent.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424648"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-666"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424647"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424646"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424648"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424645"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424649"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424648"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424647"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424649"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424648"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424646"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424649"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424648"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424645"><span class="hs-identifier hs-type">c</span></a></span></span></span></span></span></span><span>
</span><span id="line-667"></span><span id="zipAsyncWithM"><span class="annot"><span class="annottext">zipAsyncWithM :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b c.
(IsStream t, MonadAsync m) =&gt;
(a -&gt; b -&gt; m c) -&gt; t m a -&gt; t m b -&gt; t m c
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#zipAsyncWithM"><span class="hs-identifier hs-var hs-var">zipAsyncWithM</span></a></span></span><span> </span><span id="local-6989586621679424189"><span class="annot"><span class="annottext">a -&gt; b -&gt; m c
</span><a href="#local-6989586621679424189"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679424188"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424188"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424187"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424187"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-668"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStream"><span class="hs-identifier hs-var">fromStream</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
MonadAsync m =&gt;
(a -&gt; b -&gt; m c) -&gt; Stream m a -&gt; Stream m b -&gt; Stream m c
</span><a href="Streamly.Internal.Data.Stream.Zip.html#zipAsyncWithMK"><span class="hs-identifier hs-var">Zip.zipAsyncWithMK</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; m c
</span><a href="#local-6989586621679424189"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424188"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424187"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span class="hs-comment">-- XXX Should we rename this to zipParWith or zipParallelWith? This can happen</span><span>
</span><span id="line-671"></span><span class="hs-comment">-- along with the change of behvaior to end the stream concurrently.</span><span>
</span><span id="line-672"></span><span class="hs-comment">--</span><span>
</span><span id="line-673"></span><span class="hs-comment">-- | Like 'zipWith' but zips concurrently i.e. both the streams being zipped</span><span>
</span><span id="line-674"></span><span class="hs-comment">-- are evaluated concurrently using the 'ParallelT' concurrent evaluation</span><span>
</span><span id="line-675"></span><span class="hs-comment">-- style. The maximum number of elements of each stream evaluated in advance</span><span>
</span><span id="line-676"></span><span class="hs-comment">-- can be controlled by 'maxBuffer'.</span><span>
</span><span id="line-677"></span><span class="hs-comment">--</span><span>
</span><span id="line-678"></span><span class="hs-comment">-- The stream ends if stream @a@ or stream @b@ ends. However, if stream @b@</span><span>
</span><span id="line-679"></span><span class="hs-comment">-- ends while we are still evaluating stream @a@ and waiting for a result then</span><span>
</span><span id="line-680"></span><span class="hs-comment">-- stream will not end until after the evaluation of stream @a@ finishes. This</span><span>
</span><span id="line-681"></span><span class="hs-comment">-- behavior can potentially be changed in future to end the stream immediately</span><span>
</span><span id="line-682"></span><span class="hs-comment">-- as soon as any of the stream end is detected.</span><span>
</span><span id="line-683"></span><span class="hs-comment">--</span><span>
</span><span id="line-684"></span><span class="hs-comment">-- @since 0.1.0</span><span>
</span><span id="line-685"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#zipAsyncWith"><span class="hs-pragma hs-type">zipAsyncWith</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-686"></span><span id="local-6989586621679424631"><span id="local-6989586621679424632"><span id="local-6989586621679424633"><span id="local-6989586621679424634"><span id="local-6989586621679424635"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#zipAsyncWith"><span class="hs-identifier hs-type">zipAsyncWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424635"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Control.Concurrent.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424634"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424633"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424632"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424631"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424635"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424634"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424633"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424635"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424634"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424632"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424635"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424634"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424631"><span class="hs-identifier hs-type">c</span></a></span></span></span></span></span></span><span>
</span><span id="line-688"></span><span id="zipAsyncWith"><span class="annot"><span class="annottext">zipAsyncWith :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b c.
(IsStream t, MonadAsync m) =&gt;
(a -&gt; b -&gt; c) -&gt; t m a -&gt; t m b -&gt; t m c
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#zipAsyncWith"><span class="hs-identifier hs-var hs-var">zipAsyncWith</span></a></span></span><span> </span><span id="local-6989586621679424177"><span class="annot"><span class="annottext">a -&gt; b -&gt; c
</span><a href="#local-6989586621679424177"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b c.
(IsStream t, MonadAsync m) =&gt;
(a -&gt; b -&gt; m c) -&gt; t m a -&gt; t m b -&gt; t m c
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#zipAsyncWithM"><span class="hs-identifier hs-var">zipAsyncWithM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679424176"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679424176"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679424175"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679424175"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b -&gt; c
</span><a href="#local-6989586621679424177"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679424176"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679424175"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-691"></span><span class="hs-comment">-- Merging (sorted streams)</span><span>
</span><span id="line-692"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-693"></span><span>
</span><span id="line-694"></span><span class="hs-comment">-- | Merge two streams using a comparison function. The head elements of both</span><span>
</span><span id="line-695"></span><span class="hs-comment">-- the streams are compared and the smaller of the two elements is emitted, if</span><span>
</span><span id="line-696"></span><span class="hs-comment">-- both elements are equal then the element from the first stream is used</span><span>
</span><span id="line-697"></span><span class="hs-comment">-- first.</span><span>
</span><span id="line-698"></span><span class="hs-comment">--</span><span>
</span><span id="line-699"></span><span class="hs-comment">-- If the streams are sorted in ascending order, the resulting stream would</span><span>
</span><span id="line-700"></span><span class="hs-comment">-- also remain sorted in ascending order.</span><span>
</span><span id="line-701"></span><span class="hs-comment">--</span><span>
</span><span id="line-702"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-703"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.mergeBy compare (Stream.fromList [1,3,5]) (Stream.fromList [2,4,6,8])</span><span>
</span><span id="line-704"></span><span class="hs-comment">-- [1,2,3,4,5,6,8]</span><span>
</span><span id="line-705"></span><span class="hs-comment">--</span><span>
</span><span id="line-706"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-707"></span><span class="hs-comment">--</span><span>
</span><span id="line-708"></span><span class="hs-comment">-- See also: 'mergeByMFused'</span><span>
</span><span id="line-709"></span><span class="hs-comment">--</span><span>
</span><span id="line-710"></span><span class="hs-comment">-- @since 0.6.0</span><span>
</span><span id="line-711"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeBy"><span class="hs-pragma hs-type">mergeBy</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-712"></span><span id="local-6989586621679424616"><span id="local-6989586621679424617"><span id="local-6989586621679424618"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeBy"><span class="hs-identifier hs-type">mergeBy</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-713"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424618"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424617"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424616"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424616"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424618"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424617"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424616"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424618"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424617"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424616"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424618"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424617"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424616"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-714"></span><span id="mergeBy"><span class="annot"><span class="annottext">mergeBy :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
(a -&gt; a -&gt; Ordering) -&gt; t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeBy"><span class="hs-identifier hs-var hs-var">mergeBy</span></a></span></span><span> </span><span id="local-6989586621679424169"><span class="annot"><span class="annottext">a -&gt; a -&gt; Ordering
</span><a href="#local-6989586621679424169"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679424168"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424168"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424167"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424167"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStream"><span class="hs-identifier hs-var">fromStream</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(a -&gt; a -&gt; Ordering) -&gt; Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamK.html#mergeBy"><span class="hs-identifier hs-var">K.mergeBy</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Ordering
</span><a href="#local-6989586621679424169"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424168"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424167"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span class="hs-comment">-- | Like 'mergeBy' but with a monadic comparison function.</span><span>
</span><span id="line-717"></span><span class="hs-comment">--</span><span>
</span><span id="line-718"></span><span class="hs-comment">-- Merge two streams randomly:</span><span>
</span><span id="line-719"></span><span class="hs-comment">--</span><span>
</span><span id="line-720"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-721"></span><span class="hs-comment">-- &gt; randomly _ _ = randomIO &gt;&gt;= \x -&gt; return $ if x then LT else GT</span><span>
</span><span id="line-722"></span><span class="hs-comment">-- &gt; Stream.toList $ Stream.mergeByM randomly (Stream.fromList [1,1,1,1]) (Stream.fromList [2,2,2,2])</span><span>
</span><span id="line-723"></span><span class="hs-comment">-- [2,1,2,2,2,1,1,1]</span><span>
</span><span id="line-724"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-725"></span><span class="hs-comment">--</span><span>
</span><span id="line-726"></span><span class="hs-comment">-- Merge two streams in a proportion of 2:1:</span><span>
</span><span id="line-727"></span><span class="hs-comment">--</span><span>
</span><span id="line-728"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-729"></span><span class="hs-comment">-- &gt;&gt;&gt; :{</span><span>
</span><span id="line-730"></span><span class="hs-comment">-- do</span><span>
</span><span id="line-731"></span><span class="hs-comment">--  let proportionately m n = do</span><span>
</span><span id="line-732"></span><span class="hs-comment">--       ref &lt;- newIORef $ cycle $ Prelude.concat [Prelude.replicate m LT, Prelude.replicate n GT]</span><span>
</span><span id="line-733"></span><span class="hs-comment">--       return $ \_ _ -&gt; do</span><span>
</span><span id="line-734"></span><span class="hs-comment">--          r &lt;- readIORef ref</span><span>
</span><span id="line-735"></span><span class="hs-comment">--          writeIORef ref $ Prelude.tail r</span><span>
</span><span id="line-736"></span><span class="hs-comment">--          return $ Prelude.head r</span><span>
</span><span id="line-737"></span><span class="hs-comment">--  f &lt;- proportionately 2 1</span><span>
</span><span id="line-738"></span><span class="hs-comment">--  xs &lt;- Stream.toList $ Stream.mergeByM f (Stream.fromList [1,1,1,1,1,1]) (Stream.fromList [2,2,2])</span><span>
</span><span id="line-739"></span><span class="hs-comment">--  print xs</span><span>
</span><span id="line-740"></span><span class="hs-comment">-- :}</span><span>
</span><span id="line-741"></span><span class="hs-comment">-- [1,1,2,1,1,2,1,1,2]</span><span>
</span><span id="line-742"></span><span class="hs-comment">--</span><span>
</span><span id="line-743"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-744"></span><span class="hs-comment">--</span><span>
</span><span id="line-745"></span><span class="hs-comment">-- See also: 'mergeByMFused'</span><span>
</span><span id="line-746"></span><span class="hs-comment">--</span><span>
</span><span id="line-747"></span><span class="hs-comment">-- @since 0.6.0</span><span>
</span><span id="line-748"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeByM"><span class="hs-pragma hs-type">mergeByM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-749"></span><span id="local-6989586621679424608"><span id="local-6989586621679424609"><span id="local-6989586621679424610"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeByM"><span class="hs-identifier hs-type">mergeByM</span></a></span><span>
</span><span id="line-750"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424610"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424609"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-751"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424608"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424608"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424609"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424610"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424609"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424608"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424610"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424609"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424608"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424610"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424609"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424608"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-752"></span><span id="mergeByM"><span class="annot"><span class="annottext">mergeByM :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
(a -&gt; a -&gt; m Ordering) -&gt; t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeByM"><span class="hs-identifier hs-var hs-var">mergeByM</span></a></span></span><span> </span><span id="local-6989586621679424160"><span class="annot"><span class="annottext">a -&gt; a -&gt; m Ordering
</span><a href="#local-6989586621679424160"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679424159"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424159"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424158"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424158"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStream"><span class="hs-identifier hs-var">fromStream</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Monad m =&gt;
(a -&gt; a -&gt; m Ordering) -&gt; Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamK.html#mergeByM"><span class="hs-identifier hs-var">K.mergeByM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; m Ordering
</span><a href="#local-6989586621679424160"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424159"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424158"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-753"></span><span>
</span><span id="line-754"></span><span class="hs-comment">-- XXX Fused versions should probably go to a separate module using the same</span><span>
</span><span id="line-755"></span><span class="hs-comment">-- names for the combinators.</span><span>
</span><span id="line-756"></span><span class="hs-comment">--</span><span>
</span><span id="line-757"></span><span class="hs-comment">-- | Like 'mergeByM' but much faster, works best when merging statically known</span><span>
</span><span id="line-758"></span><span class="hs-comment">-- number of streams. When merging more than two streams try to merge pairs and</span><span>
</span><span id="line-759"></span><span class="hs-comment">-- pair pf pairs in a tree like structure.'mergeByM' works better with variable</span><span>
</span><span id="line-760"></span><span class="hs-comment">-- number of streams being merged using 'concatPairsWith'.</span><span>
</span><span id="line-761"></span><span class="hs-comment">--</span><span>
</span><span id="line-762"></span><span class="hs-comment">-- /Internal/</span><span>
</span><span id="line-763"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeByMFused"><span class="hs-pragma hs-type">mergeByMFused</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-764"></span><span id="local-6989586621679424155"><span id="local-6989586621679424156"><span id="local-6989586621679424157"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeByMFused"><span class="hs-identifier hs-type">mergeByMFused</span></a></span><span>
</span><span id="line-765"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424157"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424156"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-766"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424155"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424155"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424156"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424157"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424156"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424155"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424157"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424156"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424155"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424157"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424156"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424155"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-767"></span><span id="mergeByMFused"><span class="annot"><span class="annottext">mergeByMFused :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
(a -&gt; a -&gt; m Ordering) -&gt; t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeByMFused"><span class="hs-identifier hs-var hs-var">mergeByMFused</span></a></span></span><span> </span><span id="local-6989586621679424145"><span class="annot"><span class="annottext">a -&gt; a -&gt; m Ordering
</span><a href="#local-6989586621679424145"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679424144"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424144"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424143"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424143"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-768"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Monad m =&gt;
(a -&gt; a -&gt; m Ordering) -&gt; Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Nesting.html#mergeByM"><span class="hs-identifier hs-var">D.mergeByM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; m Ordering
</span><a href="#local-6989586621679424145"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424144"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424143"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-769"></span><span>
</span><span id="line-770"></span><span class="hs-comment">{-
-- | Like 'mergeByM' but stops merging as soon as any of the two streams stops.
{-# INLINABLE mergeEndByAny #-}
mergeEndByAny
    :: (IsStream t, Monad m)
    =&gt; (a -&gt; a -&gt; m Ordering) -&gt; t m a -&gt; t m a -&gt; t m a
mergeEndByAny f m1 m2 = fromStreamD $
    D.mergeEndByAny f (toStreamD m1) (toStreamD m2)

-- Like 'mergeByM' but stops merging as soon as the first stream stops.
{-# INLINABLE mergeEndByFirst #-}
mergeEndByFirst
    :: (IsStream t, Monad m)
    =&gt; (a -&gt; a -&gt; m Ordering) -&gt; t m a -&gt; t m a -&gt; t m a
mergeEndByFirst f m1 m2 = fromStreamS $
    D.mergeEndByFirst f (toStreamD m1) (toStreamD m2)

-- Holding this back for now, we may want to use the name &quot;merge&quot; differently
-- | Same as @'mergeBy' 'compare'@.
--
-- @
-- &gt;&gt;&gt; Stream.toList $ Stream.merge (Stream.fromList [1,3,5]) (Stream.fromList [2,4,6,8])
-- [1,2,3,4,5,6,8]
-- @
--
-- @since 0.6.0
{-# INLINABLE merge #-}
merge ::
       (IsStream t, Monad m, Ord a) =&gt; t m a -&gt; t m a -&gt; t m a
merge = mergeBy compare
-}</span><span>
</span><span id="line-801"></span><span>
</span><span id="line-802"></span><span class="hs-comment">-- | Like 'mergeBy' but merges concurrently (i.e. both the elements being</span><span>
</span><span id="line-803"></span><span class="hs-comment">-- merged are generated concurrently).</span><span>
</span><span id="line-804"></span><span class="hs-comment">--</span><span>
</span><span id="line-805"></span><span class="hs-comment">-- @since 0.6.0</span><span>
</span><span id="line-806"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeAsyncBy"><span class="hs-pragma hs-type">mergeAsyncBy</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-807"></span><span id="local-6989586621679424595"><span id="local-6989586621679424596"><span id="local-6989586621679424597"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeAsyncBy"><span class="hs-identifier hs-type">mergeAsyncBy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424597"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Control.Concurrent.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424596"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-808"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424595"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424595"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424597"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424596"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424595"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424597"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424596"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424595"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424597"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424596"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424595"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-809"></span><span id="mergeAsyncBy"><span class="annot"><span class="annottext">mergeAsyncBy :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, MonadAsync m) =&gt;
(a -&gt; a -&gt; Ordering) -&gt; t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeAsyncBy"><span class="hs-identifier hs-var hs-var">mergeAsyncBy</span></a></span></span><span> </span><span id="local-6989586621679424134"><span class="annot"><span class="annottext">a -&gt; a -&gt; Ordering
</span><a href="#local-6989586621679424134"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, MonadAsync m) =&gt;
(a -&gt; a -&gt; m Ordering) -&gt; t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeAsyncByM"><span class="hs-identifier hs-var">mergeAsyncByM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679424133"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679424133"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679424132"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679424132"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Ordering
</span><a href="#local-6989586621679424134"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679424133"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679424132"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span class="hs-comment">-- | Like 'mergeByM' but merges concurrently (i.e. both the elements being</span><span>
</span><span id="line-812"></span><span class="hs-comment">-- merged are generated concurrently).</span><span>
</span><span id="line-813"></span><span class="hs-comment">--</span><span>
</span><span id="line-814"></span><span class="hs-comment">-- @since 0.6.0</span><span>
</span><span id="line-815"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeAsyncByM"><span class="hs-pragma hs-type">mergeAsyncByM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-816"></span><span id="local-6989586621679424589"><span id="local-6989586621679424590"><span id="local-6989586621679424591"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeAsyncByM"><span class="hs-identifier hs-type">mergeAsyncByM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424591"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Control.Concurrent.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424590"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-817"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424589"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424589"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424590"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424591"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424590"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424589"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424591"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424590"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424589"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424591"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424590"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424589"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-818"></span><span id="mergeAsyncByM"><span class="annot"><span class="annottext">mergeAsyncByM :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, MonadAsync m) =&gt;
(a -&gt; a -&gt; m Ordering) -&gt; t m a -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#mergeAsyncByM"><span class="hs-identifier hs-var hs-var">mergeAsyncByM</span></a></span></span><span> </span><span id="local-6989586621679424122"><span class="annot"><span class="annottext">a -&gt; a -&gt; m Ordering
</span><a href="#local-6989586621679424122"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679424121"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424121"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679424120"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424120"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-819"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-820"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679424113"><span class="annot"><span class="annottext">par :: t m a -&gt; Stream m a
</span><a href="#local-6989586621679424113"><span class="hs-identifier hs-var hs-var">par</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadAsync m =&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.Parallel.html#mkParallelD"><span class="hs-identifier hs-var">Par.mkParallelD</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span>
</span><span id="line-821"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Monad m =&gt;
(a -&gt; a -&gt; m Ordering) -&gt; Stream m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Nesting.html#mergeByM"><span class="hs-identifier hs-var">D.mergeByM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; m Ordering
</span><a href="#local-6989586621679424122"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a}. t m a -&gt; Stream m a
</span><a href="#local-6989586621679424113"><span class="hs-identifier hs-var">par</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424121"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a}. t m a -&gt; Stream m a
</span><a href="#local-6989586621679424113"><span class="hs-identifier hs-var">par</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424120"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-822"></span><span>
</span><span id="line-823"></span><span>
</span><span id="line-824"></span><span class="hs-comment">-- @since 0.7.0</span><span>
</span><span id="line-825"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">concatUnfold</span><span> </span><span class="hs-pragma">&quot;Please use unfoldMany instead.&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-826"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#concatUnfold"><span class="hs-pragma hs-type">concatUnfold</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-827"></span><span id="local-6989586621679424574"><span id="local-6989586621679424575"><span id="local-6989586621679424576"><span id="local-6989586621679424577"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#concatUnfold"><span class="hs-identifier hs-type">concatUnfold</span></a></span><span> </span><span class="hs-glyph">::</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424577"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424576"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier hs-type">Unfold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424576"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424575"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424574"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424577"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424576"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424575"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424577"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424576"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424574"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span><span>
</span><span id="line-828"></span><span id="concatUnfold"><span class="annot"><span class="annottext">concatUnfold :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
(IsStream t, Monad m) =&gt;
Unfold m a b -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#concatUnfold"><span class="hs-identifier hs-var hs-var">concatUnfold</span></a></span></span><span> </span><span id="local-6989586621679424103"><span class="annot"><span class="annottext">Unfold m a b
</span><a href="#local-6989586621679424103"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679424102"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424102"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
Monad m =&gt;
Unfold m a b -&gt; Stream m a -&gt; Stream m b
</span><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#unfoldMany"><span class="hs-identifier hs-var">D.unfoldMany</span></a></span><span> </span><span class="annot"><span class="annottext">Unfold m a b
</span><a href="#local-6989586621679424103"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424102"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-831"></span><span class="hs-comment">-- Combine N Streams - unfoldMany</span><span>
</span><span id="line-832"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-833"></span><span>
</span><span id="line-834"></span><span class="hs-comment">-- | Like 'concatMap' but uses an 'Unfold' for stream generation. Unlike</span><span>
</span><span id="line-835"></span><span class="hs-comment">-- 'concatMap' this can fuse the 'Unfold' code with the inner loop and</span><span>
</span><span id="line-836"></span><span class="hs-comment">-- therefore provide many times better performance.</span><span>
</span><span id="line-837"></span><span class="hs-comment">--</span><span>
</span><span id="line-838"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-839"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#unfoldMany"><span class="hs-pragma hs-type">unfoldMany</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-840"></span><span id="local-6989586621679424097"><span id="local-6989586621679424098"><span id="local-6989586621679424099"><span id="local-6989586621679424100"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#unfoldMany"><span class="hs-identifier hs-type">unfoldMany</span></a></span><span> </span><span class="hs-glyph">::</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424100"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424099"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier hs-type">Unfold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424099"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424098"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424097"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424100"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424099"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424098"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424100"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424099"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424097"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span><span>
</span><span id="line-841"></span><span id="unfoldMany"><span class="annot"><span class="annottext">unfoldMany :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
(IsStream t, Monad m) =&gt;
Unfold m a b -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#unfoldMany"><span class="hs-identifier hs-var hs-var">unfoldMany</span></a></span></span><span> </span><span id="local-6989586621679424089"><span class="annot"><span class="annottext">Unfold m a b
</span><a href="#local-6989586621679424089"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679424088"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424088"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
Monad m =&gt;
Unfold m a b -&gt; Stream m a -&gt; Stream m b
</span><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#unfoldMany"><span class="hs-identifier hs-var">D.unfoldMany</span></a></span><span> </span><span class="annot"><span class="annottext">Unfold m a b
</span><a href="#local-6989586621679424089"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424088"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span class="hs-comment">-- | Like 'unfoldMany' but interleaves the streams in the same way as</span><span>
</span><span id="line-844"></span><span class="hs-comment">-- 'interleave' behaves instead of appending them.</span><span>
</span><span id="line-845"></span><span class="hs-comment">--</span><span>
</span><span id="line-846"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-847"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#unfoldManyInterleave"><span class="hs-pragma hs-type">unfoldManyInterleave</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-848"></span><span id="local-6989586621679424084"><span id="local-6989586621679424085"><span id="local-6989586621679424086"><span id="local-6989586621679424087"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#unfoldManyInterleave"><span class="hs-identifier hs-type">unfoldManyInterleave</span></a></span><span> </span><span class="hs-glyph">::</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424087"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424086"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-849"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier hs-type">Unfold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424086"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424085"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424084"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424087"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424086"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424085"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424087"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424086"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424084"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span><span>
</span><span id="line-850"></span><span id="unfoldManyInterleave"><span class="annot"><span class="annottext">unfoldManyInterleave :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
(IsStream t, Monad m) =&gt;
Unfold m a b -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#unfoldManyInterleave"><span class="hs-identifier hs-var hs-var">unfoldManyInterleave</span></a></span></span><span> </span><span id="local-6989586621679424076"><span class="annot"><span class="annottext">Unfold m a b
</span><a href="#local-6989586621679424076"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679424075"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424075"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-851"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
Monad m =&gt;
Unfold m a b -&gt; Stream m a -&gt; Stream m b
</span><a href="Streamly.Internal.Data.Stream.StreamD.Nesting.html#unfoldManyInterleave"><span class="hs-identifier hs-var">D.unfoldManyInterleave</span></a></span><span> </span><span class="annot"><span class="annottext">Unfold m a b
</span><a href="#local-6989586621679424076"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424075"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-852"></span><span>
</span><span id="line-853"></span><span class="hs-comment">-- | Like 'unfoldMany' but executes the streams in the same way as</span><span>
</span><span id="line-854"></span><span class="hs-comment">-- 'roundrobin'.</span><span>
</span><span id="line-855"></span><span class="hs-comment">--</span><span>
</span><span id="line-856"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-857"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#unfoldManyRoundRobin"><span class="hs-pragma hs-type">unfoldManyRoundRobin</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-858"></span><span id="local-6989586621679424070"><span id="local-6989586621679424071"><span id="local-6989586621679424072"><span id="local-6989586621679424073"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#unfoldManyRoundRobin"><span class="hs-identifier hs-type">unfoldManyRoundRobin</span></a></span><span> </span><span class="hs-glyph">::</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424073"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424072"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier hs-type">Unfold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424072"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424071"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424070"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424073"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424072"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424071"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424073"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424072"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424070"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span><span>
</span><span id="line-860"></span><span id="unfoldManyRoundRobin"><span class="annot"><span class="annottext">unfoldManyRoundRobin :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
(IsStream t, Monad m) =&gt;
Unfold m a b -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#unfoldManyRoundRobin"><span class="hs-identifier hs-var hs-var">unfoldManyRoundRobin</span></a></span></span><span> </span><span id="local-6989586621679424062"><span class="annot"><span class="annottext">Unfold m a b
</span><a href="#local-6989586621679424062"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679424061"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424061"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-861"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
Monad m =&gt;
Unfold m a b -&gt; Stream m a -&gt; Stream m b
</span><a href="Streamly.Internal.Data.Stream.StreamD.Nesting.html#unfoldManyRoundRobin"><span class="hs-identifier hs-var">D.unfoldManyRoundRobin</span></a></span><span> </span><span class="annot"><span class="annottext">Unfold m a b
</span><a href="#local-6989586621679424062"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424061"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-862"></span><span>
</span><span id="line-863"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-864"></span><span class="hs-comment">-- Combine N Streams - interpose</span><span>
</span><span id="line-865"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-866"></span><span>
</span><span id="line-867"></span><span class="hs-comment">-- &gt; interpose x unf str = gintercalate unf str UF.identity (repeat x)</span><span>
</span><span id="line-868"></span><span class="hs-comment">--</span><span>
</span><span id="line-869"></span><span class="hs-comment">-- | Unfold the elements of a stream, intersperse the given element between the</span><span>
</span><span id="line-870"></span><span class="hs-comment">-- unfolded streams and then concat them into a single stream.</span><span>
</span><span id="line-871"></span><span class="hs-comment">--</span><span>
</span><span id="line-872"></span><span class="hs-comment">-- &gt; unwords = S.interpose ' '</span><span>
</span><span id="line-873"></span><span class="hs-comment">--</span><span>
</span><span id="line-874"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-875"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interpose"><span class="hs-pragma hs-type">interpose</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-876"></span><span id="local-6989586621679424550"><span id="local-6989586621679424551"><span id="local-6989586621679424552"><span id="local-6989586621679424553"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interpose"><span class="hs-identifier hs-type">interpose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424553"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424552"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-877"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424551"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier hs-type">Unfold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424552"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424550"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424551"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424553"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424552"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424550"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424553"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424552"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424551"><span class="hs-identifier hs-type">c</span></a></span></span></span></span></span><span>
</span><span id="line-878"></span><span id="interpose"><span class="annot"><span class="annottext">interpose :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) c b.
(IsStream t, Monad m) =&gt;
c -&gt; Unfold m b c -&gt; t m b -&gt; t m c
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interpose"><span class="hs-identifier hs-var hs-var">interpose</span></a></span></span><span> </span><span id="local-6989586621679424051"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679424051"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679424050"><span class="annot"><span class="annottext">Unfold m b c
</span><a href="#local-6989586621679424050"><span class="hs-identifier hs-var">unf</span></a></span></span><span> </span><span id="local-6989586621679424049"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424049"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-879"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) c b.
Monad m =&gt;
m c -&gt; Unfold m b c -&gt; Stream m b -&gt; Stream m c
</span><a href="Streamly.Internal.Data.Stream.StreamD.Nesting.html#interpose"><span class="hs-identifier hs-var">D.interpose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679424051"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Unfold m b c
</span><a href="#local-6989586621679424050"><span class="hs-identifier hs-var">unf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424049"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span class="hs-comment">-- interposeSuffix x unf str = gintercalateSuffix unf str UF.identity (repeat x)</span><span>
</span><span id="line-882"></span><span class="hs-comment">--</span><span>
</span><span id="line-883"></span><span class="hs-comment">-- | Unfold the elements of a stream, append the given element after each</span><span>
</span><span id="line-884"></span><span class="hs-comment">-- unfolded stream and then concat them into a single stream.</span><span>
</span><span id="line-885"></span><span class="hs-comment">--</span><span>
</span><span id="line-886"></span><span class="hs-comment">-- &gt; unlines = S.interposeSuffix '\n'</span><span>
</span><span id="line-887"></span><span class="hs-comment">--</span><span>
</span><span id="line-888"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-889"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interposeSuffix"><span class="hs-pragma hs-type">interposeSuffix</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-890"></span><span id="local-6989586621679424044"><span id="local-6989586621679424045"><span id="local-6989586621679424046"><span id="local-6989586621679424047"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interposeSuffix"><span class="hs-identifier hs-type">interposeSuffix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424047"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424046"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-891"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424045"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier hs-type">Unfold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424046"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424044"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424045"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424047"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424046"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424044"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424047"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424046"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424045"><span class="hs-identifier hs-type">c</span></a></span></span></span></span></span><span>
</span><span id="line-892"></span><span id="interposeSuffix"><span class="annot"><span class="annottext">interposeSuffix :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) c b.
(IsStream t, Monad m) =&gt;
c -&gt; Unfold m b c -&gt; t m b -&gt; t m c
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interposeSuffix"><span class="hs-identifier hs-var hs-var">interposeSuffix</span></a></span></span><span> </span><span id="local-6989586621679424035"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679424035"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679424034"><span class="annot"><span class="annottext">Unfold m b c
</span><a href="#local-6989586621679424034"><span class="hs-identifier hs-var">unf</span></a></span></span><span> </span><span id="local-6989586621679424033"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424033"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-893"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) c b.
Monad m =&gt;
m c -&gt; Unfold m b c -&gt; Stream m b -&gt; Stream m c
</span><a href="Streamly.Internal.Data.Stream.StreamD.Nesting.html#interposeSuffix"><span class="hs-identifier hs-var">D.interposeSuffix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679424035"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Unfold m b c
</span><a href="#local-6989586621679424034"><span class="hs-identifier hs-var">unf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424033"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-894"></span><span>
</span><span id="line-895"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-896"></span><span class="hs-comment">-- Combine N Streams - intercalate</span><span>
</span><span id="line-897"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-898"></span><span>
</span><span id="line-899"></span><span class="hs-comment">-- XXX we can swap the order of arguments to gintercalate so that the</span><span>
</span><span id="line-900"></span><span class="hs-comment">-- definition of unfoldMany becomes simpler? The first stream should be</span><span>
</span><span id="line-901"></span><span class="hs-comment">-- infixed inside the second one. However, if we change the order in</span><span>
</span><span id="line-902"></span><span class="hs-comment">-- &quot;interleave&quot; as well similarly, then that will make it a bit unintuitive.</span><span>
</span><span id="line-903"></span><span class="hs-comment">--</span><span>
</span><span id="line-904"></span><span class="hs-comment">-- &gt; unfoldMany unf str =</span><span>
</span><span id="line-905"></span><span class="hs-comment">-- &gt;     gintercalate unf str (UF.nilM (\_ -&gt; return ())) (repeat ())</span><span>
</span><span id="line-906"></span><span class="hs-comment">--</span><span>
</span><span id="line-907"></span><span class="hs-comment">-- | 'interleaveInfix' followed by unfold and concat.</span><span>
</span><span id="line-908"></span><span class="hs-comment">--</span><span>
</span><span id="line-909"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-910"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#gintercalate"><span class="hs-pragma hs-type">gintercalate</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-911"></span><span id="local-6989586621679424534"><span id="local-6989586621679424535"><span id="local-6989586621679424536"><span id="local-6989586621679424537"><span id="local-6989586621679424538"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#gintercalate"><span class="hs-identifier hs-type">gintercalate</span></a></span><span>
</span><span id="line-912"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424538"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424537"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-913"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier hs-type">Unfold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424536"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424535"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424538"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424536"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier hs-type">Unfold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424534"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424535"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424538"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424534"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424538"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424535"><span class="hs-identifier hs-type">c</span></a></span></span></span></span></span></span><span>
</span><span id="line-914"></span><span id="gintercalate"><span class="annot"><span class="annottext">gintercalate :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a c b.
(IsStream t, Monad m) =&gt;
Unfold m a c -&gt; t m a -&gt; Unfold m b c -&gt; t m b -&gt; t m c
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#gintercalate"><span class="hs-identifier hs-var hs-var">gintercalate</span></a></span></span><span> </span><span id="local-6989586621679424022"><span class="annot"><span class="annottext">Unfold m a c
</span><a href="#local-6989586621679424022"><span class="hs-identifier hs-var">unf1</span></a></span></span><span> </span><span id="local-6989586621679424021"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424021"><span class="hs-identifier hs-var">str1</span></a></span></span><span> </span><span id="local-6989586621679424020"><span class="annot"><span class="annottext">Unfold m b c
</span><a href="#local-6989586621679424020"><span class="hs-identifier hs-var">unf2</span></a></span></span><span> </span><span id="local-6989586621679424019"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424019"><span class="hs-identifier hs-var">str2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-915"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a c b.
Monad m =&gt;
Unfold m a c
-&gt; Stream m a -&gt; Unfold m b c -&gt; Stream m b -&gt; Stream m c
</span><a href="Streamly.Internal.Data.Stream.StreamD.Nesting.html#gintercalate"><span class="hs-identifier hs-var">D.gintercalate</span></a></span><span>
</span><span id="line-916"></span><span>        </span><span class="annot"><span class="annottext">Unfold m a c
</span><a href="#local-6989586621679424022"><span class="hs-identifier hs-var">unf1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679424021"><span class="hs-identifier hs-var">str1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-917"></span><span>        </span><span class="annot"><span class="annottext">Unfold m b c
</span><a href="#local-6989586621679424020"><span class="hs-identifier hs-var">unf2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424019"><span class="hs-identifier hs-var">str2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-918"></span><span>
</span><span id="line-919"></span><span class="hs-comment">-- &gt; intercalate unf seed str = gintercalate unf str unf (repeatM seed)</span><span>
</span><span id="line-920"></span><span class="hs-comment">--</span><span>
</span><span id="line-921"></span><span class="hs-comment">-- | 'intersperse' followed by unfold and concat.</span><span>
</span><span id="line-922"></span><span class="hs-comment">--</span><span>
</span><span id="line-923"></span><span class="hs-comment">-- &gt; intercalate unf a str = unfoldMany unf $ intersperse a str</span><span>
</span><span id="line-924"></span><span class="hs-comment">-- &gt; intersperse = intercalate (Unfold.function id)</span><span>
</span><span id="line-925"></span><span class="hs-comment">-- &gt; unwords = intercalate Unfold.fromList &quot; &quot;</span><span>
</span><span id="line-926"></span><span class="hs-comment">--</span><span>
</span><span id="line-927"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.intercalate Unfold.fromList &quot; &quot; $ Stream.fromList [&quot;abc&quot;, &quot;def&quot;, &quot;ghi&quot;]</span><span>
</span><span id="line-928"></span><span class="hs-comment">-- &quot;abc def ghi&quot;</span><span>
</span><span id="line-929"></span><span class="hs-comment">--</span><span>
</span><span id="line-930"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-931"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#intercalate"><span class="hs-pragma hs-type">intercalate</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-932"></span><span id="local-6989586621679424521"><span id="local-6989586621679424522"><span id="local-6989586621679424523"><span id="local-6989586621679424524"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#intercalate"><span class="hs-identifier hs-type">intercalate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424524"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424523"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-933"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier hs-type">Unfold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424523"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424522"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424521"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424522"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424524"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424523"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424522"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424524"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424523"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424521"><span class="hs-identifier hs-type">c</span></a></span></span></span></span></span><span>
</span><span id="line-934"></span><span id="intercalate"><span class="annot"><span class="annottext">intercalate :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) b c.
(IsStream t, Monad m) =&gt;
Unfold m b c -&gt; b -&gt; t m b -&gt; t m c
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#intercalate"><span class="hs-identifier hs-var hs-var">intercalate</span></a></span></span><span> </span><span id="local-6989586621679424009"><span class="annot"><span class="annottext">Unfold m b c
</span><a href="#local-6989586621679424009"><span class="hs-identifier hs-var">unf</span></a></span></span><span> </span><span id="local-6989586621679424008"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679424008"><span class="hs-identifier hs-var">seed</span></a></span></span><span> </span><span id="local-6989586621679424007"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424007"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-935"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
Monad m =&gt;
Unfold m a b -&gt; Stream m a -&gt; Stream m b
</span><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#unfoldMany"><span class="hs-identifier hs-var">D.unfoldMany</span></a></span><span> </span><span class="annot"><span class="annottext">Unfold m b c
</span><a href="#local-6989586621679424009"><span class="hs-identifier hs-var">unf</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Transform.html#intersperse"><span class="hs-identifier hs-var">D.intersperse</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679424008"><span class="hs-identifier hs-var">seed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679424007"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-936"></span><span>
</span><span id="line-937"></span><span class="hs-comment">-- | 'interleaveSuffix' followed by unfold and concat.</span><span>
</span><span id="line-938"></span><span class="hs-comment">--</span><span>
</span><span id="line-939"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-940"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#gintercalateSuffix"><span class="hs-pragma hs-type">gintercalateSuffix</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-941"></span><span id="local-6989586621679424001"><span id="local-6989586621679424002"><span id="local-6989586621679424003"><span id="local-6989586621679424004"><span id="local-6989586621679424005"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#gintercalateSuffix"><span class="hs-identifier hs-type">gintercalateSuffix</span></a></span><span>
</span><span id="line-942"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424005"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424004"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-943"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier hs-type">Unfold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424004"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424003"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424002"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424005"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424004"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424003"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier hs-type">Unfold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424004"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424001"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424002"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424005"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424004"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424001"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424005"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424004"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424002"><span class="hs-identifier hs-type">c</span></a></span></span></span></span></span></span><span>
</span><span id="line-944"></span><span id="gintercalateSuffix"><span class="annot"><span class="annottext">gintercalateSuffix :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a c b.
(IsStream t, Monad m) =&gt;
Unfold m a c -&gt; t m a -&gt; Unfold m b c -&gt; t m b -&gt; t m c
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#gintercalateSuffix"><span class="hs-identifier hs-var hs-var">gintercalateSuffix</span></a></span></span><span> </span><span id="local-6989586621679423991"><span class="annot"><span class="annottext">Unfold m a c
</span><a href="#local-6989586621679423991"><span class="hs-identifier hs-var">unf1</span></a></span></span><span> </span><span id="local-6989586621679423990"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679423990"><span class="hs-identifier hs-var">str1</span></a></span></span><span> </span><span id="local-6989586621679423989"><span class="annot"><span class="annottext">Unfold m b c
</span><a href="#local-6989586621679423989"><span class="hs-identifier hs-var">unf2</span></a></span></span><span> </span><span id="local-6989586621679423988"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679423988"><span class="hs-identifier hs-var">str2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-945"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a c b.
Monad m =&gt;
Unfold m a c
-&gt; Stream m a -&gt; Unfold m b c -&gt; Stream m b -&gt; Stream m c
</span><a href="Streamly.Internal.Data.Stream.StreamD.Nesting.html#gintercalateSuffix"><span class="hs-identifier hs-var">D.gintercalateSuffix</span></a></span><span>
</span><span id="line-946"></span><span>        </span><span class="annot"><span class="annottext">Unfold m a c
</span><a href="#local-6989586621679423991"><span class="hs-identifier hs-var">unf1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679423990"><span class="hs-identifier hs-var">str1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-947"></span><span>        </span><span class="annot"><span class="annottext">Unfold m b c
</span><a href="#local-6989586621679423989"><span class="hs-identifier hs-var">unf2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679423988"><span class="hs-identifier hs-var">str2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span class="hs-comment">-- &gt; intercalateSuffix unf seed str = gintercalateSuffix unf str unf (repeatM seed)</span><span>
</span><span id="line-950"></span><span class="hs-comment">--</span><span>
</span><span id="line-951"></span><span class="hs-comment">-- | 'intersperseSuffix' followed by unfold and concat.</span><span>
</span><span id="line-952"></span><span class="hs-comment">--</span><span>
</span><span id="line-953"></span><span class="hs-comment">-- &gt; intercalateSuffix unf a str = unfoldMany unf $ intersperseSuffix a str</span><span>
</span><span id="line-954"></span><span class="hs-comment">-- &gt; intersperseSuffix = intercalateSuffix (Unfold.function id)</span><span>
</span><span id="line-955"></span><span class="hs-comment">-- &gt; unlines = intercalateSuffix Unfold.fromList &quot;\n&quot;</span><span>
</span><span id="line-956"></span><span class="hs-comment">--</span><span>
</span><span id="line-957"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.intercalateSuffix Unfold.fromList &quot;\n&quot; $ Stream.fromList [&quot;abc&quot;, &quot;def&quot;, &quot;ghi&quot;]</span><span>
</span><span id="line-958"></span><span class="hs-comment">-- &quot;abc\ndef\nghi\n&quot;</span><span>
</span><span id="line-959"></span><span class="hs-comment">--</span><span>
</span><span id="line-960"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-961"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#intercalateSuffix"><span class="hs-pragma hs-type">intercalateSuffix</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-962"></span><span id="local-6989586621679423983"><span id="local-6989586621679423984"><span id="local-6989586621679423985"><span id="local-6989586621679423986"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#intercalateSuffix"><span class="hs-identifier hs-type">intercalateSuffix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423986"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679423985"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-963"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier hs-type">Unfold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423985"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423984"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423983"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679423984"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679423986"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423985"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423984"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679423986"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423985"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423983"><span class="hs-identifier hs-type">c</span></a></span></span></span></span></span><span>
</span><span id="line-964"></span><span id="intercalateSuffix"><span class="annot"><span class="annottext">intercalateSuffix :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) b c.
(IsStream t, Monad m) =&gt;
Unfold m b c -&gt; b -&gt; t m b -&gt; t m c
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#intercalateSuffix"><span class="hs-identifier hs-var hs-var">intercalateSuffix</span></a></span></span><span> </span><span id="local-6989586621679423973"><span class="annot"><span class="annottext">Unfold m b c
</span><a href="#local-6989586621679423973"><span class="hs-identifier hs-var">unf</span></a></span></span><span> </span><span id="local-6989586621679423972"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679423972"><span class="hs-identifier hs-var">seed</span></a></span></span><span> </span><span id="local-6989586621679423971"><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679423971"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
Monad m =&gt;
Unfold m a b -&gt; Stream m a -&gt; Stream m b
</span><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#unfoldMany"><span class="hs-identifier hs-var">D.unfoldMany</span></a></span><span> </span><span class="annot"><span class="annottext">Unfold m b c
</span><a href="#local-6989586621679423973"><span class="hs-identifier hs-var">unf</span></a></span><span>
</span><span id="line-965"></span><span>    </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; Stream m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Transform.html#intersperseSuffix"><span class="hs-identifier hs-var">D.intersperseSuffix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679423972"><span class="hs-identifier hs-var">seed</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">t m b
</span><a href="#local-6989586621679423971"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-966"></span><span>
</span><span id="line-967"></span><span class="hs-comment">{-
{-# INLINE iterateUnfold #-}
iterateUnfold :: (IsStream t, MonadAsync m)
    =&gt; Unfold m a a -&gt; t m a -&gt; t m a
iterateUnfold unf xs = undefined
-}</span><span>
</span><span id="line-973"></span><span>
</span><span id="line-974"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-975"></span><span class="hs-comment">-- Combine N Streams - concatMap</span><span>
</span><span id="line-976"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-977"></span><span>
</span><span id="line-978"></span><span class="hs-comment">-- | Flatten a stream of streams to a single stream.</span><span>
</span><span id="line-979"></span><span class="hs-comment">--</span><span>
</span><span id="line-980"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-981"></span><span class="hs-comment">-- concat = concatMap id</span><span>
</span><span id="line-982"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-983"></span><span class="hs-comment">--</span><span>
</span><span id="line-984"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-985"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#concat"><span class="hs-pragma hs-type">concat</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-986"></span><span id="local-6989586621679424501"><span id="local-6989586621679424502"><span id="local-6989586621679424503"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#concat"><span class="hs-identifier hs-type">concat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424503"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424502"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424503"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424502"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424503"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424502"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424501"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424503"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424502"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424501"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-987"></span><span id="concat"><span class="annot"><span class="annottext">concat :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m (t m a) -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#concat"><span class="hs-identifier hs-var hs-var">concat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
(IsStream t, Monad m) =&gt;
(a -&gt; t m b) -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-988"></span><span>
</span><span id="line-989"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-990"></span><span class="hs-comment">-- Combine N Streams - concatMap</span><span>
</span><span id="line-991"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-992"></span><span>
</span><span id="line-993"></span><span class="hs-comment">-- | Like 'concatMapWith' but carries a state which can be used to share</span><span>
</span><span id="line-994"></span><span class="hs-comment">-- information across multiple steps of concat.</span><span>
</span><span id="line-995"></span><span class="hs-comment">--</span><span>
</span><span id="line-996"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-997"></span><span class="hs-comment">-- concatSmapMWith combine f initial = concatMapWith combine id . smapM f initial</span><span>
</span><span id="line-998"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-999"></span><span class="hs-comment">--</span><span>
</span><span id="line-1000"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-1001"></span><span class="hs-comment">--</span><span>
</span><span id="line-1002"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#concatSmapMWith"><span class="hs-pragma hs-type">concatSmapMWith</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1003"></span><span id="local-6989586621679424489"><span id="local-6989586621679424490"><span id="local-6989586621679424491"><span id="local-6989586621679424492"><span id="local-6989586621679424493"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#concatSmapMWith"><span class="hs-identifier hs-type">concatSmapMWith</span></a></span><span>
</span><span id="line-1004"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424493"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424492"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1005"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424493"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424492"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424491"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424493"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424492"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424491"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424493"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424492"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424491"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1006"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424490"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424489"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424492"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424490"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679424493"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424492"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424491"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1007"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424492"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424490"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1008"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424493"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424492"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424489"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1009"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424493"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424492"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424491"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span></span><span>
</span><span id="line-1010"></span><span id="concatSmapMWith"><span class="annot"><span class="annottext">concatSmapMWith :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) b s a.
(IsStream t, Monad m) =&gt;
(t m b -&gt; t m b -&gt; t m b)
-&gt; (s -&gt; a -&gt; m (s, t m b)) -&gt; m s -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#concatSmapMWith"><span class="hs-identifier hs-var hs-var">concatSmapMWith</span></a></span></span><span> </span><span id="local-6989586621679423959"><span class="annot"><span class="annottext">t m b -&gt; t m b -&gt; t m b
</span><a href="#local-6989586621679423959"><span class="hs-identifier hs-var">combine</span></a></span></span><span> </span><span id="local-6989586621679423958"><span class="annot"><span class="annottext">s -&gt; a -&gt; m (s, t m b)
</span><a href="#local-6989586621679423958"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679423957"><span class="annot"><span class="annottext">m s
</span><a href="#local-6989586621679423957"><span class="hs-identifier hs-var">initial</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1011"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) b a.
IsStream t =&gt;
(t m b -&gt; t m b -&gt; t m b) -&gt; (a -&gt; t m b) -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#concatMapWith"><span class="hs-identifier hs-var">IsStream.concatMapWith</span></a></span><span> </span><span class="annot"><span class="annottext">t m b -&gt; t m b -&gt; t m b
</span><a href="#local-6989586621679423959"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) s a b.
(IsStream t, Monad m) =&gt;
(s -&gt; a -&gt; m (s, b)) -&gt; m s -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#smapM"><span class="hs-identifier hs-var">smapM</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; a -&gt; m (s, t m b)
</span><a href="#local-6989586621679423958"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">m s
</span><a href="#local-6989586621679423957"><span class="hs-identifier hs-var">initial</span></a></span><span>
</span><span id="line-1012"></span><span>
</span><span id="line-1013"></span><span class="hs-comment">-- Keep concating either streams as long as rights are generated, stop as soon</span><span>
</span><span id="line-1014"></span><span class="hs-comment">-- as a left is generated and concat the left stream.</span><span>
</span><span id="line-1015"></span><span class="hs-comment">--</span><span>
</span><span id="line-1016"></span><span class="hs-comment">-- See also: 'handle'</span><span>
</span><span id="line-1017"></span><span class="hs-comment">--</span><span>
</span><span id="line-1018"></span><span class="hs-comment">-- /Unimplemented/</span><span>
</span><span id="line-1019"></span><span class="hs-comment">--</span><span>
</span><span id="line-1020"></span><span class="hs-comment">{-
concatMapEitherWith
    :: -- (IsStream t, MonadAsync m) =&gt;
       (forall x. t m x -&gt; t m x -&gt; t m x)
    -&gt; (a -&gt; t m (Either (t m b) b))
    -&gt; t m a
    -&gt; t m b
concatMapEitherWith = undefined
-}</span><span>
</span><span id="line-1029"></span><span>
</span><span id="line-1030"></span><span class="hs-comment">-- XXX Implement a StreamD version for fusion.</span><span>
</span><span id="line-1031"></span><span class="hs-comment">--</span><span>
</span><span id="line-1032"></span><span class="hs-comment">-- | Combine streams in pairs using a binary stream combinator, then combine</span><span>
</span><span id="line-1033"></span><span class="hs-comment">-- the resulting streams in pairs recursively until we get to a single combined</span><span>
</span><span id="line-1034"></span><span class="hs-comment">-- stream.</span><span>
</span><span id="line-1035"></span><span class="hs-comment">--</span><span>
</span><span id="line-1036"></span><span class="hs-comment">-- For example, you can sort a stream using merge sort like this:</span><span>
</span><span id="line-1037"></span><span class="hs-comment">--</span><span>
</span><span id="line-1038"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.concatPairsWith (Stream.mergeBy compare) Stream.fromPure $ Stream.fromList [5,1,7,9,2]</span><span>
</span><span id="line-1039"></span><span class="hs-comment">-- [1,2,5,7,9]</span><span>
</span><span id="line-1040"></span><span class="hs-comment">--</span><span>
</span><span id="line-1041"></span><span class="hs-comment">-- /Caution: the stream of streams must be finite/</span><span>
</span><span id="line-1042"></span><span class="hs-comment">--</span><span>
</span><span id="line-1043"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-1044"></span><span class="hs-comment">--</span><span>
</span><span id="line-1045"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#concatPairsWith"><span class="hs-pragma hs-type">concatPairsWith</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1046"></span><span id="local-6989586621679423953"><span id="local-6989586621679423954"><span id="local-6989586621679423955"><span id="local-6989586621679423956"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#concatPairsWith"><span class="hs-identifier hs-type">concatPairsWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423956"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1047"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679423956"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423955"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423954"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679423956"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423955"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423954"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679423956"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423955"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423954"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1048"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679423953"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679423956"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423955"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423954"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1049"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679423956"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423955"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423953"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1050"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679423956"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423955"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679423954"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span><span>
</span><span id="line-1051"></span><span id="concatPairsWith"><span class="annot"><span class="annottext">concatPairsWith :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) b a.
IsStream t =&gt;
(t m b -&gt; t m b -&gt; t m b) -&gt; (a -&gt; t m b) -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#concatPairsWith"><span class="hs-identifier hs-var hs-var">concatPairsWith</span></a></span></span><span> </span><span id="local-6989586621679423945"><span class="annot"><span class="annottext">t m b -&gt; t m b -&gt; t m b
</span><a href="#local-6989586621679423945"><span class="hs-identifier hs-var">par</span></a></span></span><span> </span><span id="local-6989586621679423944"><span class="annot"><span class="annottext">a -&gt; t m b
</span><a href="#local-6989586621679423944"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679423943"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679423943"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1052"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStream"><span class="hs-identifier hs-var">fromStream</span></a></span><span>
</span><span id="line-1053"></span><span>        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b a.
(Stream m b -&gt; Stream m b -&gt; Stream m b)
-&gt; (a -&gt; Stream m b) -&gt; Stream m a -&gt; Stream m b
</span><a href="Streamly.Internal.Data.Stream.StreamK.Type.html#concatPairsWith"><span class="hs-identifier hs-var">K.concatPairsWith</span></a></span><span>
</span><span id="line-1054"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679423941"><span class="annot"><span class="annottext">Stream m b
</span><a href="#local-6989586621679423941"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621679423940"><span class="annot"><span class="annottext">Stream m b
</span><a href="#local-6989586621679423940"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStream"><span class="hs-identifier hs-var">fromStream</span></a></span><span> </span><span class="annot"><span class="annottext">Stream m b
</span><a href="#local-6989586621679423941"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">t m b -&gt; t m b -&gt; t m b
</span><a href="#local-6989586621679423945"><span class="hs-operator hs-var">`par`</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStream"><span class="hs-identifier hs-var">fromStream</span></a></span><span> </span><span class="annot"><span class="annottext">Stream m b
</span><a href="#local-6989586621679423940"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1055"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; t m b
</span><a href="#local-6989586621679423944"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1056"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStream"><span class="hs-identifier hs-var">toStream</span></a></span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679423943"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1057"></span><span>
</span><span id="line-1058"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-1059"></span><span class="hs-comment">-- IterateMap - Map and flatten Trees of Streams</span><span>
</span><span id="line-1060"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-1061"></span><span>
</span><span id="line-1062"></span><span class="hs-comment">-- | Like 'iterateM' but iterates after mapping a stream generator on the</span><span>
</span><span id="line-1063"></span><span class="hs-comment">-- output.</span><span>
</span><span id="line-1064"></span><span class="hs-comment">--</span><span>
</span><span id="line-1065"></span><span class="hs-comment">-- Yield an input element in the output stream, map a stream generator on it</span><span>
</span><span id="line-1066"></span><span class="hs-comment">-- and then do the same on the resulting stream. This can be used for a depth</span><span>
</span><span id="line-1067"></span><span class="hs-comment">-- first traversal of a tree like structure.</span><span>
</span><span id="line-1068"></span><span class="hs-comment">--</span><span>
</span><span id="line-1069"></span><span class="hs-comment">-- Note that 'iterateM' is a special case of 'iterateMapWith':</span><span>
</span><span id="line-1070"></span><span class="hs-comment">--</span><span>
</span><span id="line-1071"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1072"></span><span class="hs-comment">-- iterateM f = iterateMapWith serial (fromEffect . f) . fromEffect</span><span>
</span><span id="line-1073"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1074"></span><span class="hs-comment">--</span><span>
</span><span id="line-1075"></span><span class="hs-comment">-- It can be used to traverse a tree structure.  For example, to list a</span><span>
</span><span id="line-1076"></span><span class="hs-comment">-- directory tree:</span><span>
</span><span id="line-1077"></span><span class="hs-comment">--</span><span>
</span><span id="line-1078"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1079"></span><span class="hs-comment">-- Stream.iterateMapWith Stream.serial</span><span>
</span><span id="line-1080"></span><span class="hs-comment">--     (either Dir.toEither (const nil))</span><span>
</span><span id="line-1081"></span><span class="hs-comment">--     (fromPure (Left &quot;tmp&quot;))</span><span>
</span><span id="line-1082"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1083"></span><span class="hs-comment">--</span><span>
</span><span id="line-1084"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-1085"></span><span class="hs-comment">--</span><span>
</span><span id="line-1086"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#iterateMapWith"><span class="hs-pragma hs-type">iterateMapWith</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1087"></span><span id="local-6989586621679424465"><span id="local-6989586621679424466"><span id="local-6989586621679424467"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#iterateMapWith"><span class="hs-identifier hs-type">iterateMapWith</span></a></span><span>
</span><span id="line-1088"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424467"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1089"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424467"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424466"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424465"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424467"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424466"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424465"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424467"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424466"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424465"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1090"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424465"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424467"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424466"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424465"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1091"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424467"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424466"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424465"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1092"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424467"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424466"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424465"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-1093"></span><span id="iterateMapWith"><span class="annot"><span class="annottext">iterateMapWith :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
(t m a -&gt; t m a -&gt; t m a) -&gt; (a -&gt; t m a) -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#iterateMapWith"><span class="hs-identifier hs-var hs-var">iterateMapWith</span></a></span></span><span> </span><span id="local-6989586621679423937"><span class="annot"><span class="annottext">t m a -&gt; t m a -&gt; t m a
</span><a href="#local-6989586621679423937"><span class="hs-identifier hs-var">combine</span></a></span></span><span> </span><span id="local-6989586621679423936"><span class="annot"><span class="annottext">a -&gt; t m a
</span><a href="#local-6989586621679423936"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) b a.
IsStream t =&gt;
(t m b -&gt; t m b -&gt; t m b) -&gt; (a -&gt; t m b) -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#concatMapWith"><span class="hs-identifier hs-var">IsStream.concatMapWith</span></a></span><span> </span><span class="annot"><span class="annottext">t m a -&gt; t m a -&gt; t m a
</span><a href="#local-6989586621679423937"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; t m a
</span><a href="#local-6989586621679423935"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-1094"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1095"></span><span>    </span><span id="local-6989586621679423935"><span class="annot"><span class="annottext">go :: a -&gt; t m a
</span><a href="#local-6989586621679423935"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679423932"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679423932"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) a (m :: * -&gt; *).
IsStream t =&gt;
a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#fromPure"><span class="hs-identifier hs-var">fromPure</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679423932"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">t m a -&gt; t m a -&gt; t m a
</span><a href="#local-6989586621679423937"><span class="hs-operator hs-var">`combine`</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) b a.
IsStream t =&gt;
(t m b -&gt; t m b -&gt; t m b) -&gt; (a -&gt; t m b) -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#concatMapWith"><span class="hs-identifier hs-var">IsStream.concatMapWith</span></a></span><span> </span><span class="annot"><span class="annottext">t m a -&gt; t m a -&gt; t m a
</span><a href="#local-6989586621679423937"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; t m a
</span><a href="#local-6989586621679423935"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; t m a
</span><a href="#local-6989586621679423936"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679423932"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1096"></span><span>
</span><span id="line-1097"></span><span class="hs-comment">{-
{-# INLINE iterateUnfold #-}
iterateUnfold :: (IsStream t, MonadAsync m)
    =&gt; Unfold m a a -&gt; t m a -&gt; t m a
iterateUnfold unf xs = undefined
-}</span><span>
</span><span id="line-1103"></span><span>
</span><span id="line-1104"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-1105"></span><span class="hs-comment">-- Flattening Graphs</span><span>
</span><span id="line-1106"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-1107"></span><span>
</span><span id="line-1108"></span><span class="hs-comment">-- To traverse graphs we need a state to be carried around in the traversal.</span><span>
</span><span id="line-1109"></span><span class="hs-comment">-- For example, we can use a hashmap to store the visited status of nodes.</span><span>
</span><span id="line-1110"></span><span>
</span><span id="line-1111"></span><span class="hs-comment">-- | Like 'iterateMap' but carries a state in the stream generation function.</span><span>
</span><span id="line-1112"></span><span class="hs-comment">-- This can be used to traverse graph like structures, we can remember the</span><span>
</span><span id="line-1113"></span><span class="hs-comment">-- visited nodes in the state to avoid cycles.</span><span>
</span><span id="line-1114"></span><span class="hs-comment">--</span><span>
</span><span id="line-1115"></span><span class="hs-comment">-- Note that a combination of 'iterateMap' and 'usingState' can also be used to</span><span>
</span><span id="line-1116"></span><span class="hs-comment">-- traverse graphs. However, this function provides a more localized state</span><span>
</span><span id="line-1117"></span><span class="hs-comment">-- instead of using a global state.</span><span>
</span><span id="line-1118"></span><span class="hs-comment">--</span><span>
</span><span id="line-1119"></span><span class="hs-comment">-- See also: 'mfix'</span><span>
</span><span id="line-1120"></span><span class="hs-comment">--</span><span>
</span><span id="line-1121"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-1122"></span><span class="hs-comment">--</span><span>
</span><span id="line-1123"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#iterateSmapMWith"><span class="hs-pragma hs-type">iterateSmapMWith</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1124"></span><span id="local-6989586621679424455"><span id="local-6989586621679424456"><span id="local-6989586621679424457"><span id="local-6989586621679424458"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#iterateSmapMWith"><span class="hs-identifier hs-type">iterateSmapMWith</span></a></span><span>
</span><span id="line-1125"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424458"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679424457"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1126"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424458"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424457"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424456"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424458"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424457"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424456"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424458"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424457"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424456"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1127"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424455"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424456"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424457"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424455"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679424458"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424457"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424456"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1128"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424457"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424455"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-1129"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424458"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424457"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424456"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1130"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424458"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424457"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424456"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-1131"></span><span id="iterateSmapMWith"><span class="annot"><span class="annottext">iterateSmapMWith :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
(IsStream t, Monad m) =&gt;
(t m a -&gt; t m a -&gt; t m a)
-&gt; (b -&gt; a -&gt; m (b, t m a)) -&gt; m b -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#iterateSmapMWith"><span class="hs-identifier hs-var hs-var">iterateSmapMWith</span></a></span></span><span> </span><span id="local-6989586621679423924"><span class="annot"><span class="annottext">t m a -&gt; t m a -&gt; t m a
</span><a href="#local-6989586621679423924"><span class="hs-identifier hs-var">combine</span></a></span></span><span> </span><span id="local-6989586621679423923"><span class="annot"><span class="annottext">b -&gt; a -&gt; m (b, t m a)
</span><a href="#local-6989586621679423923"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679423922"><span class="annot"><span class="annottext">m b
</span><a href="#local-6989586621679423922"><span class="hs-identifier hs-var">initial</span></a></span></span><span> </span><span id="local-6989586621679423921"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679423921"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1132"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
(IsStream t, Monad m) =&gt;
(a -&gt; t m b) -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span>
</span><span id="line-1133"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679423920"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679423920"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) b a.
IsStream t =&gt;
(t m b -&gt; t m b -&gt; t m b) -&gt; (a -&gt; t m b) -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#concatMapWith"><span class="hs-identifier hs-var">IsStream.concatMapWith</span></a></span><span> </span><span class="annot"><span class="annottext">t m a -&gt; t m a -&gt; t m a
</span><a href="#local-6989586621679423924"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; a -&gt; t m a
</span><a href="#local-6989586621679423919"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679423920"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679423921"><span class="hs-identifier hs-var">stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1134"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *) a.
(Monad m, IsStream t) =&gt;
m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#fromEffect"><span class="hs-identifier hs-var">fromEffect</span></a></span><span> </span><span class="annot"><span class="annottext">m b
</span><a href="#local-6989586621679423922"><span class="hs-identifier hs-var">initial</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1135"></span><span>
</span><span id="line-1136"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1137"></span><span>
</span><span id="line-1138"></span><span>    </span><span id="local-6989586621679423919"><span class="annot"><span class="annottext">go :: b -&gt; a -&gt; t m a
</span><a href="#local-6989586621679423919"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679423912"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679423912"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679423911"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679423911"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) a (m :: * -&gt; *).
IsStream t =&gt;
a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#fromPure"><span class="hs-identifier hs-var">fromPure</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679423911"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">t m a -&gt; t m a -&gt; t m a
</span><a href="#local-6989586621679423924"><span class="hs-operator hs-var">`combine`</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; a -&gt; t m a
</span><a href="#local-6989586621679423910"><span class="hs-identifier hs-var">feedback</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679423912"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679423911"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1139"></span><span>
</span><span id="line-1140"></span><span>    </span><span id="local-6989586621679423910"><span class="annot"><span class="annottext">feedback :: b -&gt; a -&gt; t m a
</span><a href="#local-6989586621679423910"><span class="hs-identifier hs-var hs-var">feedback</span></a></span></span><span> </span><span id="local-6989586621679423909"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679423909"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679423908"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679423908"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1141"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
(IsStream t, Monad m) =&gt;
(a -&gt; t m b) -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span>
</span><span id="line-1142"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679423907"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679423907"><span class="hs-identifier hs-var">b1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679423906"><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679423906"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) b a.
IsStream t =&gt;
(t m b -&gt; t m b -&gt; t m b) -&gt; (a -&gt; t m b) -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#concatMapWith"><span class="hs-identifier hs-var">IsStream.concatMapWith</span></a></span><span> </span><span class="annot"><span class="annottext">t m a -&gt; t m a -&gt; t m a
</span><a href="#local-6989586621679423924"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; a -&gt; t m a
</span><a href="#local-6989586621679423919"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679423907"><span class="hs-identifier hs-var">b1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t m a
</span><a href="#local-6989586621679423906"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1143"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *) a.
(Monad m, IsStream t) =&gt;
m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#fromEffect"><span class="hs-identifier hs-var">fromEffect</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; a -&gt; m (b, t m a)
</span><a href="#local-6989586621679423923"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679423909"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679423908"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1144"></span><span>
</span><span id="line-1145"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-1146"></span><span class="hs-comment">-- iterateMap - Either streams</span><span>
</span><span id="line-1147"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-1148"></span><span>
</span><span id="line-1149"></span><span class="hs-comment">-- | In an 'Either' stream iterate on 'Left's.  This is a special case of</span><span>
</span><span id="line-1150"></span><span class="hs-comment">-- 'iterateMapWith':</span><span>
</span><span id="line-1151"></span><span class="hs-comment">--</span><span>
</span><span id="line-1152"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1153"></span><span class="hs-comment">-- iterateMapLeftsWith combine f = iterateMapWith combine (either f (const nil))</span><span>
</span><span id="line-1154"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1155"></span><span class="hs-comment">--</span><span>
</span><span id="line-1156"></span><span class="hs-comment">-- To traverse a directory tree:</span><span>
</span><span id="line-1157"></span><span class="hs-comment">--</span><span>
</span><span id="line-1158"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1159"></span><span class="hs-comment">-- iterateMapLeftsWith serial Dir.toEither (fromPure (Left &quot;tmp&quot;))</span><span>
</span><span id="line-1160"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1161"></span><span class="hs-comment">--</span><span>
</span><span id="line-1162"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-1163"></span><span class="hs-comment">--</span><span>
</span><span id="line-1164"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#iterateMapLeftsWith"><span class="hs-pragma hs-type">iterateMapLeftsWith</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1165"></span><span id="local-6989586621679424444"><span id="local-6989586621679424445"><span id="local-6989586621679424446"><span id="local-6989586621679424447"><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#iterateMapLeftsWith"><span class="hs-identifier hs-type">iterateMapLeftsWith</span></a></span><span>
</span><span id="line-1166"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424447"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1167"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424447"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424446"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679424445"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424444"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424447"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424446"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679424445"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424444"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424447"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424446"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679424445"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424444"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1168"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679424445"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424447"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424446"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679424445"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424444"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1169"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424447"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424446"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679424445"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424444"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1170"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679424447"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424446"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679424445"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679424444"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-1171"></span><span id="iterateMapLeftsWith"><span class="annot"><span class="annottext">iterateMapLeftsWith :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
IsStream t =&gt;
(t m (Either a b) -&gt; t m (Either a b) -&gt; t m (Either a b))
-&gt; (a -&gt; t m (Either a b)) -&gt; t m (Either a b) -&gt; t m (Either a b)
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#iterateMapLeftsWith"><span class="hs-identifier hs-var hs-var">iterateMapLeftsWith</span></a></span></span><span> </span><span id="local-6989586621679423902"><span class="annot"><span class="annottext">t m (Either a b) -&gt; t m (Either a b) -&gt; t m (Either a b)
</span><a href="#local-6989586621679423902"><span class="hs-identifier hs-var">combine</span></a></span></span><span> </span><span id="local-6989586621679423901"><span class="annot"><span class="annottext">a -&gt; t m (Either a b)
</span><a href="#local-6989586621679423901"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1172"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
(t m a -&gt; t m a -&gt; t m a) -&gt; (a -&gt; t m a) -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#iterateMapWith"><span class="hs-identifier hs-var">iterateMapWith</span></a></span><span> </span><span class="annot"><span class="annottext">t m (Either a b) -&gt; t m (Either a b) -&gt; t m (Either a b)
</span><a href="#local-6989586621679423902"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; t m (Either a b)
</span><a href="#local-6989586621679423901"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
IsStream t =&gt;
t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#nil"><span class="hs-identifier hs-var">IsStream.nil</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1173"></span></pre></body></html>