<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- |</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- Module      : Streamly.Data.Fold</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Copyright   : (c) 2019 Composewell Technologies</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- License     : BSD-3-Clause</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Maintainer  : streamly@composewell.com</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Stability   : released</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Portability : GHC</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- A 'Fold' is a sink or a consumer of a stream of values.  The 'Fold' type</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- consists of an accumulator and an effectful action that absorbs a value into</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- the accumulator.</span><span>
</span><span id="line-12"></span><span class="hs-comment">--</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Function ((&amp;))</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Streamly.Data.Fold as Fold</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Streamly.Prelude as Stream</span><span>
</span><span id="line-16"></span><span class="hs-comment">--</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- For example, a 'sum' Fold represents adding the input to the accumulated</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- sum.  A fold driver e.g. 'Streamly.Prelude.fold' pushes values from a stream</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- to the 'Fold' one at a time, reducing the stream to a single value.</span><span>
</span><span id="line-20"></span><span class="hs-comment">--</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.fold Fold.sum $ Stream.fromList [1..100]</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- 5050</span><span>
</span><span id="line-23"></span><span class="hs-comment">--</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- Conceptually, a 'Fold' is a data type that can mimic a strict left fold</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- ('Data.List.foldl') as well as lazy right fold ('Prelude.foldr').  The above</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- example is similar to a left fold using @(+)@ as the step and @0@ as the</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- initial value of the accumulator:</span><span>
</span><span id="line-28"></span><span class="hs-comment">--</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- &gt;&gt;&gt; Data.List.foldl' (+) 0 [1..100]</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- 5050</span><span>
</span><span id="line-31"></span><span class="hs-comment">--</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- 'Fold's have an early termination capability e.g. the 'head' fold would</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- terminate on an infinite stream:</span><span>
</span><span id="line-34"></span><span class="hs-comment">--</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.fold Fold.head $ Stream.fromList [1..]</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- Just 1</span><span>
</span><span id="line-37"></span><span class="hs-comment">--</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- The above example is similar to the following right fold:</span><span>
</span><span id="line-39"></span><span class="hs-comment">--</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- &gt;&gt;&gt; Prelude.foldr (\x _ -&gt; Just x) Nothing [1..]</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- Just 1</span><span>
</span><span id="line-42"></span><span class="hs-comment">--</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- 'Fold's can be combined together using combinators. For example, to create a</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- fold that sums first two elements in a stream:</span><span>
</span><span id="line-45"></span><span class="hs-comment">--</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- &gt;&gt;&gt; sumTwo = Fold.take 2 Fold.sum</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.fold sumTwo $ Stream.fromList [1..100]</span><span>
</span><span id="line-48"></span><span class="hs-comment">-- 3</span><span>
</span><span id="line-49"></span><span class="hs-comment">--</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- Folds can be combined to run in parallel on the same input. For example, to</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- compute the average of numbers in a stream without going through the stream</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- twice:</span><span>
</span><span id="line-53"></span><span class="hs-comment">--</span><span>
</span><span id="line-54"></span><span class="hs-comment">-- &gt;&gt;&gt; avg = Fold.teeWith (/) Fold.sum (fmap fromIntegral Fold.length)</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.fold avg $ Stream.fromList [1.0..100.0]</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- 50.5</span><span>
</span><span id="line-57"></span><span class="hs-comment">--</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- Folds can be combined so as to partition the input stream over multiple</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- folds. For example, to count even and odd numbers in a stream:</span><span>
</span><span id="line-60"></span><span class="hs-comment">--</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- &gt;&gt;&gt; split n = if even n then Left n else Right n</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- &gt;&gt;&gt; stream = Stream.map split $ Stream.fromList [1..100]</span><span>
</span><span id="line-63"></span><span class="hs-comment">-- &gt;&gt;&gt; countEven = fmap ((&quot;Even &quot; ++) . show) Fold.length</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- &gt;&gt;&gt; countOdd = fmap ((&quot;Odd &quot;  ++) . show) Fold.length</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- &gt;&gt;&gt; f = Fold.partition countEven countOdd</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.fold f stream</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- (&quot;Even 50&quot;,&quot;Odd 50&quot;)</span><span>
</span><span id="line-68"></span><span class="hs-comment">--</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- Terminating folds can be combined to parse the stream serially such that the</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- first fold consumes the input until it terminates and the second fold</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- consumes the rest of the input until it terminates:</span><span>
</span><span id="line-72"></span><span class="hs-comment">--</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- &gt;&gt;&gt; f = Fold.serialWith (,) (Fold.take 8 Fold.toList) (Fold.takeEndBy (== '\n') Fold.toList)</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.fold f $ Stream.fromList &quot;header: hello\n&quot;</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- (&quot;header: &quot;,&quot;hello\n&quot;)</span><span>
</span><span id="line-76"></span><span class="hs-comment">--</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- A 'Fold' can be applied repeatedly on a stream to transform it to a stream</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- of fold results. To split a stream on newlines:</span><span>
</span><span id="line-79"></span><span class="hs-comment">--</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- &gt;&gt;&gt; f = Fold.takeEndBy (== '\n') Fold.toList</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ Stream.foldMany f $ Stream.fromList &quot;Hello there!\nHow are you\n&quot;</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- [&quot;Hello there!\n&quot;,&quot;How are you\n&quot;]</span><span>
</span><span id="line-83"></span><span class="hs-comment">--</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- Similarly, we can split the input of a fold too:</span><span>
</span><span id="line-85"></span><span class="hs-comment">--</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.fold (Fold.many f Fold.toList) $ Stream.fromList &quot;Hello there!\nHow are you\n&quot;</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- [&quot;Hello there!\n&quot;,&quot;How are you\n&quot;]</span><span>
</span><span id="line-88"></span><span class="hs-comment">--</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- Please see &quot;Streamly.Internal.Data.Fold&quot; for additional @Pre-release@</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- functions.</span><span>
</span><span id="line-91"></span><span class="hs-comment">--</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- = Folds vs. Streams</span><span>
</span><span id="line-93"></span><span class="hs-comment">--</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- We can often use streams or folds to achieve the same goal. However, streams</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- are more efficient in composition of producers (e.g.</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- 'Streamly.Prelude.serial' or 'Streamly.Prelude.mergeBy') whereas folds are</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- more efficient in composition of consumers (e.g.  'serialWith', 'partition'</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- or 'teeWith').</span><span>
</span><span id="line-99"></span><span class="hs-comment">--</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- Streams are producers, transformations on streams happen on the output side:</span><span>
</span><span id="line-101"></span><span class="hs-comment">--</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- &gt;&gt;&gt; :{</span><span>
</span><span id="line-103"></span><span class="hs-comment">--  f stream =</span><span>
</span><span id="line-104"></span><span class="hs-comment">--        Stream.filter odd stream</span><span>
</span><span id="line-105"></span><span class="hs-comment">--      &amp; Stream.map (+1)</span><span>
</span><span id="line-106"></span><span class="hs-comment">--      &amp; Stream.sum</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- :}</span><span>
</span><span id="line-108"></span><span class="hs-comment">--</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- &gt;&gt;&gt; f $ Stream.fromList [1..100 :: Int]</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- 2550</span><span>
</span><span id="line-111"></span><span class="hs-comment">--</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- Folds are stream consumers with an input stream and an output value, stream</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- transformations on folds happen on the input side:</span><span>
</span><span id="line-114"></span><span class="hs-comment">--</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- &gt;&gt;&gt; :{</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- f =</span><span>
</span><span id="line-117"></span><span class="hs-comment">--        Fold.filter odd</span><span>
</span><span id="line-118"></span><span class="hs-comment">--      $ Fold.lmap (+1)</span><span>
</span><span id="line-119"></span><span class="hs-comment">--      $ Fold.sum</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- :}</span><span>
</span><span id="line-121"></span><span class="hs-comment">--</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.fold f $ Stream.fromList [1..100 :: Int]</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- 2550</span><span>
</span><span id="line-124"></span><span class="hs-comment">--</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- Notice the similiarity in the definition of @f@ in both cases, the only</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- difference is the composition by @&amp;@ vs @$@ and the use @lmap@ vs @map@, the</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- difference is due to output vs input side transformations.</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Streamly.Data.Fold</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Fold Type</span></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#Fold"><span class="hs-identifier">Fold</span></a></span><span> </span><span class="hs-comment">-- (..)</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Constructors</span></span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#foldl%27"><span class="hs-identifier">foldl'</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#foldlM%27"><span class="hs-identifier">foldlM'</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#foldr"><span class="hs-identifier">foldr</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Folds</span></span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Accumulators</span></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-comment">-- | Folds that never terminate, these folds are much like strict left</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-comment">-- folds. 'mconcat' is the fundamental accumulator.  All other accumulators</span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-comment">-- can be expressed in terms of 'mconcat' using a suitable Monoid.  Instead</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-comment">-- of writing folds we could write Monoids and turn them into folds.</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-comment">-- Monoids</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#sconcat"><span class="hs-identifier">sconcat</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#mconcat"><span class="hs-identifier">mconcat</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#foldMap"><span class="hs-identifier">foldMap</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#foldMapM"><span class="hs-identifier">foldMapM</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-comment">-- Reducers</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#drain"><span class="hs-identifier">drain</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#drainBy"><span class="hs-identifier">drainBy</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#last"><span class="hs-identifier">last</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#length"><span class="hs-identifier">length</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#sum"><span class="hs-identifier">sum</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#product"><span class="hs-identifier">product</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#maximumBy"><span class="hs-identifier">maximumBy</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#maximum"><span class="hs-identifier">maximum</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#minimumBy"><span class="hs-identifier">minimumBy</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#minimum"><span class="hs-identifier">minimum</span></a></span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#mean"><span class="hs-identifier">mean</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#variance"><span class="hs-identifier">variance</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#stdDev"><span class="hs-identifier">stdDev</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#rollingHash"><span class="hs-identifier">rollingHash</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#rollingHashWithSalt"><span class="hs-identifier">rollingHashWithSalt</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-comment">-- Collectors</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#toList"><span class="hs-identifier">toList</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#toListRev"><span class="hs-identifier">toListRev</span></a></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Terminating Folds</span></span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><span class="hs-comment">-- | These are much like lazy right folds.</span></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#index"><span class="hs-identifier">index</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#head"><span class="hs-identifier">head</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#find"><span class="hs-identifier">find</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#lookup"><span class="hs-identifier">lookup</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#findIndex"><span class="hs-identifier">findIndex</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#elemIndex"><span class="hs-identifier">elemIndex</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#null"><span class="hs-identifier">null</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#elem"><span class="hs-identifier">elem</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#notElem"><span class="hs-identifier">notElem</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#all"><span class="hs-identifier">all</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#any"><span class="hs-identifier">any</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#and"><span class="hs-identifier">and</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#or"><span class="hs-identifier">or</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Combinators</span></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-comment">-- | Combinators are modifiers of folds.  In the type @Fold m a b@, @a@ is</span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-comment">-- the input type and @b@ is the output type.  Transformations can be</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-comment">-- applied either on the input side or on the output side.  Therefore,</span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-comment">-- combinators are of one of the following general shapes:</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-comment">-- * @... -&gt; Fold m a b -&gt; Fold m c b@ (input transformation)</span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-comment">-- * @... -&gt; Fold m a b -&gt; Fold m a c@ (output transformation)</span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-comment">-- Output transformations are also known as covariant transformations, and</span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-comment">-- input transformations are also known as contravariant transformations.</span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-comment">-- The input side transformations are more interesting for folds.  Most of</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-comment">-- the following sections describe the input transformation operations on a</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-comment">-- fold.  The names and signatures of the operations are consistent with</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-comment">-- corresponding operations in &quot;Streamly.Prelude&quot;. When an operation makes</span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-comment">-- sense on both input and output side we use the prefix @l@ (for left) for</span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-comment">-- input side operations and the prefix @r@ (for right) for output side</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-comment">-- operations.</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Mapping on output</span></span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-comment">-- | The 'Functor' instance of a fold maps on the output of the fold:</span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-comment">-- &gt;&gt;&gt; Stream.fold (fmap show Fold.sum) (Stream.enumerateFromTo 1 100)</span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-comment">-- &quot;5050&quot;</span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#rmapM"><span class="hs-identifier">rmapM</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Mapping on Input</span></span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#lmap"><span class="hs-identifier">lmap</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#lmapM"><span class="hs-identifier">lmapM</span></a></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Filtering</span></span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#filter"><span class="hs-identifier">filter</span></a></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#filterM"><span class="hs-identifier">filterM</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-comment">-- -- ** Mapping Filters</span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#catMaybes"><span class="hs-identifier">catMaybes</span></a></span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#mapMaybe"><span class="hs-identifier">mapMaybe</span></a></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Trimming</span></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#take"><span class="hs-identifier">take</span></a></span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-comment">-- , takeInterval</span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#takeEndBy_"><span class="hs-identifier">takeEndBy_</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#takeEndBy"><span class="hs-identifier">takeEndBy</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Serial Append</span></span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#serialWith"><span class="hs-identifier">serialWith</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Parallel Distribution</span></span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-comment">-- | For applicative composition using distribution see</span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-comment">-- &quot;Streamly.Internal.Data.Fold.Tee&quot;.</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#teeWith"><span class="hs-identifier">teeWith</span></a></span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-comment">--, teeWithFst</span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-comment">--, teeWithMin</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#tee"><span class="hs-identifier">tee</span></a></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#distribute"><span class="hs-identifier">distribute</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Partitioning</span></span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-comment">-- | Direct items in the input stream to different folds using a binary</span><span>
</span><span id="line-251"></span><span>    </span><span class="hs-comment">-- fold selector.</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#partition"><span class="hs-identifier">partition</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-comment">--, partitionByM</span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-comment">--, partitionByFstM</span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-comment">--, partitionByMinM</span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-comment">--, partitionBy</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Unzipping</span></span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#unzip"><span class="hs-identifier">unzip</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Splitting</span></span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#many"><span class="hs-identifier">many</span></a></span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#chunksOf"><span class="hs-identifier">chunksOf</span></a></span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-comment">-- , intervalsOf</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Nesting</span></span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#concatMap"><span class="hs-identifier">concatMap</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Deprecated</span></span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#sequence"><span class="hs-identifier">sequence</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html#mapM"><span class="hs-identifier">mapM</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span class="hs-keyword">where</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span>
</span><span id="line-277"></span><span>       </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">filter</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">drop</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">dropWhile</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">take</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">takeWhile</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipWith</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">foldr</span></span><span class="hs-special">,</span><span>
</span><span id="line-278"></span><span>               </span><span class="annot"><span class="hs-identifier">foldl</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">map</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapM_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sequence</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">all</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">any</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sum</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">product</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">elem</span></span><span class="hs-special">,</span><span>
</span><span id="line-279"></span><span>               </span><span class="annot"><span class="hs-identifier">notElem</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">maximum</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">minimum</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">head</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">last</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tail</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">length</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">,</span><span>
</span><span id="line-280"></span><span>               </span><span class="annot"><span class="hs-identifier">reverse</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">iterate</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">init</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">and</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">or</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lookup</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">foldr1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(!!)</span></span><span class="hs-special">,</span><span>
</span><span id="line-281"></span><span>               </span><span class="annot"><span class="hs-identifier">scanl</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">scanl1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">replicate</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">concatMap</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mconcat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">foldMap</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unzip</span></span><span class="hs-special">,</span><span>
</span><span id="line-282"></span><span>               </span><span class="annot"><span class="hs-identifier">span</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">splitAt</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">break</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapM</span></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html"><span class="hs-identifier">Streamly.Internal.Data.Fold</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="hs-comment">-- $setup</span><span>
</span><span id="line-287"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Function ((&amp;))</span><span>
</span><span id="line-288"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Streamly.Data.Fold as Fold</span><span>
</span><span id="line-289"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Streamly.Prelude as Stream</span><span>
</span><span id="line-290"></span></pre></body></html>