<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- |</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- Module      : Streamly.Internal.Unicode.Stream</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Copyright   : (c) 2018 Composewell Technologies</span><span>
</span><span id="line-4"></span><span class="hs-comment">--               (c) Bjoern Hoehrmann 2008-2009</span><span>
</span><span id="line-5"></span><span class="hs-comment">--</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- License     : BSD-3-Clause</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Maintainer  : streamly@composewell.com</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Stability   : experimental</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Portability : GHC</span><span>
</span><span id="line-10"></span><span class="hs-comment">--</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Streamly.Internal.Unicode.Stream</span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Construction (Decoding)</span></span><span>
</span><span id="line-15"></span><span>      </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeLatin1"><span class="hs-identifier">decodeLatin1</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** UTF-8 Decoding</span></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8"><span class="hs-identifier">decodeUtf8</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8%27"><span class="hs-identifier">decodeUtf8'</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8_"><span class="hs-identifier">decodeUtf8_</span></a></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Resumable UTF-8 Decoding</span></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeError"><span class="hs-identifier">DecodeError</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeState"><span class="hs-identifier">DecodeState</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#CodePoint"><span class="hs-identifier">CodePoint</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Either"><span class="hs-identifier">decodeUtf8Either</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#resumeDecodeUtf8Either"><span class="hs-identifier">resumeDecodeUtf8Either</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** UTF-8 Array Stream Decoding</span></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Arrays"><span class="hs-identifier">decodeUtf8Arrays</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Arrays%27"><span class="hs-identifier">decodeUtf8Arrays'</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Arrays_"><span class="hs-identifier">decodeUtf8Arrays_</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Elimination (Encoding)</span></span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Latin1 Encoding</span></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1"><span class="hs-identifier">encodeLatin1</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1%27"><span class="hs-identifier">encodeLatin1'</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1_"><span class="hs-identifier">encodeLatin1_</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** UTF-8 Encoding</span></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8"><span class="hs-identifier">encodeUtf8</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8%27"><span class="hs-identifier">encodeUtf8'</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8_"><span class="hs-identifier">encodeUtf8_</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeStrings"><span class="hs-identifier">encodeStrings</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-comment">{-
    -- * Operations on character strings
    , strip -- (dropAround isSpace)
    , stripEnd
    -}</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Transformation</span></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#stripHead"><span class="hs-identifier">stripHead</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#lines"><span class="hs-identifier">lines</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#words"><span class="hs-identifier">words</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#unlines"><span class="hs-identifier">unlines</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#unwords"><span class="hs-identifier">unwords</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><span class="hs-comment">-- * StreamD UTF8 Encoding / Decoding transformations.</span></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8D"><span class="hs-identifier">decodeUtf8D</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8D%27"><span class="hs-identifier">decodeUtf8D'</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8D_"><span class="hs-identifier">decodeUtf8D_</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8D"><span class="hs-identifier">encodeUtf8D</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8D%27"><span class="hs-identifier">encodeUtf8D'</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8D_"><span class="hs-identifier">encodeUtf8D_</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8EitherD"><span class="hs-identifier">decodeUtf8EitherD</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#resumeDecodeUtf8EitherD"><span class="hs-identifier">resumeDecodeUtf8EitherD</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysD"><span class="hs-identifier">decodeUtf8ArraysD</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysD%27"><span class="hs-identifier">decodeUtf8ArraysD'</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysD_"><span class="hs-identifier">decodeUtf8ArraysD_</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Deprecations</span></span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Lax"><span class="hs-identifier">decodeUtf8Lax</span></a></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1Lax"><span class="hs-identifier">encodeLatin1Lax</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8Lax"><span class="hs-identifier">encodeUtf8Lax</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;inline.hs&quot;
</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">liftIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">shiftR</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">shiftL</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.|.)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.&amp;.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">chr</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ord</span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word8</span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.Storable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Storable</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Fusion.Plugin.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Fuse</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Base</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">assert</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unsafeChr</span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.IO.Encoding.Failure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isSurrogate</span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">plusPtr</span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafePerformIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.html"><span class="hs-identifier">Streamly.Internal.Data.Array.Foreign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier">Array</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Mut.Type.html"><span class="hs-identifier">Streamly.Internal.Data.Array.Foreign.Mut.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Mut.Type.html#ArrayContents"><span class="hs-identifier">ArrayContents</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Mut.Type.html#touch"><span class="hs-identifier">touch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.html"><span class="hs-identifier">Streamly.Internal.Data.Fold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#Fold"><span class="hs-identifier">Fold</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.IsStream.Type</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier">IsStream</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier">fromStreamD</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier">toStreamD</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#adapt"><span class="hs-identifier">adapt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.Serial.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.Serial</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.Serial.html#SerialT"><span class="hs-identifier">SerialT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.StreamD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier">Stream</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Step"><span class="hs-identifier">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.SVar.html"><span class="hs-identifier">Streamly.Internal.Data.SVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.SVar.Type.html#adaptState"><span class="hs-identifier">adaptState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html"><span class="hs-identifier">Streamly.Internal.Data.Tuple.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier">Tuple'</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.html"><span class="hs-identifier">Streamly.Internal.Data.Unfold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier">Unfold</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.System.IO.html"><span class="hs-identifier">Streamly.Internal.System.IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.System.IO.html#unsafeInlineIO"><span class="hs-identifier">unsafeInlineIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.html"><span class="hs-identifier">Streamly.Internal.Data.Unfold</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Unfold</span></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.Serial.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.Serial</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Serial</span></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.html"><span class="hs-identifier">Streamly.Internal.Data.Array.Foreign</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Array</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html"><span class="hs-identifier">Streamly.Internal.Data.Array.Foreign.Type</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.IsStream</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.html"><span class="hs-identifier">Streamly.Internal.Data.Stream.StreamD</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">D</span></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lines</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">words</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unlines</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unwords</span></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">-- $setup</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- &gt;&gt;&gt; :m</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- &gt;&gt;&gt; import Prelude hiding (lines, words, unlines, unwords)</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Streamly.Prelude as Stream</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Streamly.Data.Fold as Fold</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- &gt;&gt;&gt; import Streamly.Internal.Unicode.Stream</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- Latin1 decoding</span><span>
</span><span id="line-120"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- | Decode a stream of bytes to Unicode characters by mapping each byte to a</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- corresponding Unicode 'Char' in 0-255 range.</span><span>
</span><span id="line-124"></span><span class="hs-comment">--</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- /Since: 0.7.0 (&quot;Streamly.Data.Unicode.Stream&quot;)/</span><span>
</span><span id="line-126"></span><span class="hs-comment">--</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-128"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeLatin1"><span class="hs-pragma hs-type">decodeLatin1</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-129"></span><span id="local-6989586621679435518"><span id="local-6989586621679435520"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeLatin1"><span class="hs-identifier hs-type">decodeLatin1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435520"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679435518"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435520"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435518"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435520"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435518"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span></span><span>
</span><span id="line-130"></span><span id="decodeLatin1"><span class="annot"><span class="annottext">decodeLatin1 :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *).
(IsStream t, Monad m) =&gt;
t m Word8 -&gt; t m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeLatin1"><span class="hs-identifier hs-var hs-var">decodeLatin1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
(IsStream t, Monad m) =&gt;
(a -&gt; b) -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#map"><span class="hs-identifier hs-var">S.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Char
</span><span class="hs-identifier hs-var">unsafeChr</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- Latin1 encoding</span><span>
</span><span id="line-134"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">-- | Encode a stream of Unicode characters to bytes by mapping each character</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- to a byte in 0-255 range. Throws an error if the input stream contains</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- characters beyond 255.</span><span>
</span><span id="line-139"></span><span class="hs-comment">--</span><span>
</span><span id="line-140"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-141"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1%27"><span class="hs-pragma hs-type">encodeLatin1'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-142"></span><span id="local-6989586621679435505"><span id="local-6989586621679435506"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1%27"><span class="hs-identifier hs-type">encodeLatin1'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435506"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679435505"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435506"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435505"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435506"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435505"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span></span></span><span>
</span><span id="line-143"></span><span id="encodeLatin1%27"><span class="annot"><span class="annottext">encodeLatin1' :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *).
(IsStream t, Monad m) =&gt;
t m Char -&gt; t m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1%27"><span class="hs-identifier hs-var hs-var">encodeLatin1'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
(IsStream t, Monad m) =&gt;
(a -&gt; b) -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#map"><span class="hs-identifier hs-var">S.map</span></a></span><span> </span><span class="annot"><span class="annottext">forall {a}. Num a =&gt; Char -&gt; a
</span><a href="#local-6989586621679434756"><span class="hs-identifier hs-var">convert</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621679434756"><span class="annot"><span class="annottext">convert :: Char -&gt; a
</span><a href="#local-6989586621679434756"><span class="hs-identifier hs-var hs-var">convert</span></a></span></span><span> </span><span id="local-6989586621679434746"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434746"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-146"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679434745"><span class="annot"><span class="annottext">codepoint :: Int
</span><a href="#local-6989586621679434745"><span class="hs-identifier hs-var hs-var">codepoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434746"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434745"><span class="hs-identifier hs-var">codepoint</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">255</span></span><span>
</span><span id="line-148"></span><span>           </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Streamly.Unicode.encodeLatin1 invalid &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-149"></span><span>                      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;input char codepoint &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434745"><span class="hs-identifier hs-var">codepoint</span></a></span><span>
</span><span id="line-150"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434745"><span class="hs-identifier hs-var">codepoint</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-comment">-- XXX Should we instead replace the invalid chars by NUL or whitespace or some</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- other control char? That may affect the perf a bit but may be a better</span><span>
</span><span id="line-154"></span><span class="hs-comment">-- behavior.</span><span>
</span><span id="line-155"></span><span class="hs-comment">--</span><span>
</span><span id="line-156"></span><span class="hs-comment">-- | Like 'encodeLatin1'' but silently maps input codepoints beyond 255 to</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- arbitrary Latin1 chars in 0-255 range. No error or exception is thrown when</span><span>
</span><span id="line-158"></span><span class="hs-comment">-- such mapping occurs.</span><span>
</span><span id="line-159"></span><span class="hs-comment">--</span><span>
</span><span id="line-160"></span><span class="hs-comment">-- /Since: 0.7.0 (&quot;Streamly.Data.Unicode.Stream&quot;)/</span><span>
</span><span id="line-161"></span><span class="hs-comment">--</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- /Since: 0.8.0 (Lenient Behaviour)/</span><span>
</span><span id="line-163"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1"><span class="hs-pragma hs-type">encodeLatin1</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-164"></span><span id="local-6989586621679434740"><span id="local-6989586621679434741"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1"><span class="hs-identifier hs-type">encodeLatin1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434741"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679434740"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434741"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434740"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434741"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434740"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span></span></span><span>
</span><span id="line-165"></span><span id="encodeLatin1"><span class="annot"><span class="annottext">encodeLatin1 :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *).
(IsStream t, Monad m) =&gt;
t m Char -&gt; t m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1"><span class="hs-identifier hs-var hs-var">encodeLatin1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
(IsStream t, Monad m) =&gt;
(a -&gt; b) -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#map"><span class="hs-identifier hs-var">S.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">ord</span></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">-- | Like 'encodeLatin1' but drops the input characters beyond 255.</span><span>
</span><span id="line-168"></span><span class="hs-comment">--</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-170"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1_"><span class="hs-pragma hs-type">encodeLatin1_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-171"></span><span id="local-6989586621679434732"><span id="local-6989586621679434733"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1_"><span class="hs-identifier hs-type">encodeLatin1_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434733"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679434732"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434733"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434732"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434733"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434732"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span></span></span><span>
</span><span id="line-172"></span><span id="encodeLatin1_"><span class="annot"><span class="annottext">encodeLatin1_ :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *).
(IsStream t, Monad m) =&gt;
t m Char -&gt; t m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1_"><span class="hs-identifier hs-var hs-var">encodeLatin1_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
(IsStream t, Monad m) =&gt;
(a -&gt; b) -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#map"><span class="hs-identifier hs-var">S.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">ord</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
(a -&gt; Bool) -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Transform.html#filter"><span class="hs-identifier hs-var">S.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Char
</span><span class="hs-identifier hs-var">chr</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">255</span></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-comment">-- | Same as 'encodeLatin1'</span><span>
</span><span id="line-175"></span><span class="hs-comment">--</span><span>
</span><span id="line-176"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">encodeLatin1Lax</span><span> </span><span class="hs-pragma">&quot;Please use 'encodeLatin1' instead&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-177"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1Lax"><span class="hs-pragma hs-type">encodeLatin1Lax</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-178"></span><span id="local-6989586621679434718"><span id="local-6989586621679434719"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1Lax"><span class="hs-identifier hs-type">encodeLatin1Lax</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434719"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679434718"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434719"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434718"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434719"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434718"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span></span></span><span>
</span><span id="line-179"></span><span id="encodeLatin1Lax"><span class="annot"><span class="annottext">encodeLatin1Lax :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *).
(IsStream t, Monad m) =&gt;
t m Char -&gt; t m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1Lax"><span class="hs-identifier hs-var hs-var">encodeLatin1Lax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *).
(IsStream t, Monad m) =&gt;
t m Char -&gt; t m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeLatin1"><span class="hs-identifier hs-var">encodeLatin1</span></a></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- UTF-8 decoding</span><span>
</span><span id="line-183"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="hs-comment">-- Int helps in cheaper conversion from Int to Char</span><span>
</span><span id="line-186"></span><span class="hs-keyword">type</span><span> </span><span id="CodePoint"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#CodePoint"><span class="hs-identifier hs-var">CodePoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-187"></span><span class="hs-keyword">type</span><span> </span><span id="DecodeState"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeState"><span class="hs-identifier hs-var">DecodeState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">-- We can divide the errors in three general categories:</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- * A non-starter was encountered in a begin state</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- * A starter was encountered without completing a codepoint</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- * The last codepoint was not complete (input underflow)</span><span>
</span><span id="line-193"></span><span class="hs-comment">--</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- Need to separate resumable and non-resumable error. In case of non-resumable</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- error we can also provide the failing byte. In case of resumable error the</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- state can be opaque.</span><span>
</span><span id="line-197"></span><span class="hs-comment">--</span><span>
</span><span id="line-198"></span><span class="hs-keyword">data</span><span> </span><span id="DecodeError"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeError"><span class="hs-identifier hs-var">DecodeError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DecodeError"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeError"><span class="hs-identifier hs-var">DecodeError</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeState"><span class="hs-identifier hs-type">DecodeState</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#CodePoint"><span class="hs-identifier hs-type">CodePoint</span></a></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679434704"><span id="local-6989586621679434706"><span id="local-6989586621679434711"><span class="annot"><span class="annottext">Int -&gt; DecodeError -&gt; ShowS
[DecodeError] -&gt; ShowS
DecodeError -&gt; [Char]
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [DecodeError] -&gt; ShowS
$cshowList :: [DecodeError] -&gt; ShowS
show :: DecodeError -&gt; [Char]
$cshow :: DecodeError -&gt; [Char]
showsPrec :: Int -&gt; DecodeError -&gt; ShowS
$cshowsPrec :: Int -&gt; DecodeError -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">-- See http://bjoern.hoehrmann.de/utf-8/decoder/dfa/ for details.</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-comment">-- XXX Use names decodeSuccess = 0, decodeFailure = 12</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeTable"><span class="hs-identifier hs-type">decodeTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">]</span><span>
</span><span id="line-205"></span><span id="decodeTable"><span class="annot"><span class="annottext">decodeTable :: [Word8]
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeTable"><span class="hs-identifier hs-var hs-var">decodeTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-206"></span><span>   </span><span class="hs-comment">-- The first part of the table maps bytes to character classes that</span><span>
</span><span id="line-207"></span><span>   </span><span class="hs-comment">-- to reduce the size of the transition table and create bitmasks.</span><span>
</span><span id="line-208"></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-209"></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-210"></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-211"></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-212"></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span>
</span><span id="line-213"></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">7</span></span><span class="hs-special">,</span><span>
</span><span id="line-214"></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">8</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">8</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span>
</span><span id="line-215"></span><span>  </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">10</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">4</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">11</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">6</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">6</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">6</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">5</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">8</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">8</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">8</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">8</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">8</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">8</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">8</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">8</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">8</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">8</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">8</span></span><span class="hs-special">,</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>   </span><span class="hs-comment">-- The second part is a transition table that maps a combination</span><span>
</span><span id="line-218"></span><span>   </span><span class="hs-comment">-- of a state of the automaton and a character class to a state.</span><span>
</span><span id="line-219"></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">24</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">36</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">60</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">96</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">84</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">48</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">72</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span>
</span><span id="line-220"></span><span>  </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">24</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">24</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">24</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span>
</span><span id="line-221"></span><span>  </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">24</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">24</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">24</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span>
</span><span id="line-222"></span><span>  </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">36</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">36</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">36</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">36</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">36</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span>
</span><span id="line-223"></span><span>  </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">36</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#utf8d"><span class="hs-pragma hs-type">utf8d</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-227"></span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#utf8d"><span class="hs-identifier hs-type">utf8d</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">A.Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span>
</span><span id="line-228"></span><span id="utf8d"><span class="annot"><span class="annottext">utf8d :: Array Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#utf8d"><span class="hs-identifier hs-var hs-var">utf8d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-229"></span><span>      </span><span class="annot"><span class="annottext">forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-comment">-- Aligning to cacheline makes a barely noticeable difference</span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-comment">-- XXX currently alignment is not implemented for unmanaged allocation</span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
Monad m =&gt;
Fold m a b -&gt; Stream m a -&gt; m b
</span><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#fold"><span class="hs-identifier hs-var">D.fold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(MonadIO m, Storable a) =&gt;
Int -&gt; Int -&gt; Fold m a (Array a)
</span><a href="Streamly.Internal.Data.Array.Foreign.Type.html#writeNAlignedUnmanaged"><span class="hs-identifier hs-var">A.writeNAlignedUnmanaged</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">64</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Word8]
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeTable"><span class="hs-identifier hs-var">decodeTable</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Applicative m =&gt; [a] -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#fromList"><span class="hs-identifier hs-var">D.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Word8]
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeTable"><span class="hs-identifier hs-var">decodeTable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="hs-comment">-- | Return element at the specified index without checking the bounds.</span><span>
</span><span id="line-236"></span><span class="hs-comment">-- and without touching the foreign ptr.</span><span>
</span><span id="line-237"></span><span class="hs-pragma">{-# INLINE_NORMAL unsafePeekElemOff #-}</span><span>
</span><span id="line-238"></span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#unsafePeekElemOff"><span class="hs-identifier hs-type">unsafePeekElemOff</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679435470"><span class="annot"><a href="#local-6989586621679435470"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Storable</span></span><span> </span><span class="annot"><a href="#local-6989586621679435470"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="#local-6989586621679435470"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435470"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-239"></span><span id="unsafePeekElemOff"><span class="annot"><span class="annottext">unsafePeekElemOff :: forall a. Storable a =&gt; Ptr a -&gt; Int -&gt; a
</span><a href="Streamly.Internal.Unicode.Stream.html#unsafePeekElemOff"><span class="hs-identifier hs-var hs-var">unsafePeekElemOff</span></a></span></span><span> </span><span id="local-6989586621679434694"><span class="annot"><span class="annottext">Ptr a
</span><a href="#local-6989586621679434694"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679434693"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434693"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679434691"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621679434691"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; a
</span><a href="Streamly.Internal.System.IO.html#unsafeInlineIO"><span class="hs-identifier hs-var">unsafeInlineIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Storable a =&gt; Ptr a -&gt; Int -&gt; IO a
</span><span class="hs-identifier hs-var">peekElemOff</span></span><span> </span><span class="annot"><span class="annottext">Ptr a
</span><a href="#local-6989586621679434694"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434693"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679434691"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-comment">-- decode is split into two separate cases to avoid branching instructions.</span><span>
</span><span id="line-242"></span><span class="hs-comment">-- From the higher level flow we already know which case we are in so we can</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- call the appropriate decode function.</span><span>
</span><span id="line-244"></span><span class="hs-comment">--</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- When the state is 0</span><span>
</span><span id="line-246"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decode0"><span class="hs-pragma hs-type">decode0</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-247"></span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decode0"><span class="hs-identifier hs-type">decode0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-type">Tuple'</span></a></span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeState"><span class="hs-identifier hs-type">DecodeState</span></a></span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#CodePoint"><span class="hs-identifier hs-type">CodePoint</span></a></span><span>
</span><span id="line-248"></span><span id="decode0"><span class="annot"><span class="annottext">decode0 :: Ptr Word8 -&gt; Word8 -&gt; Tuple' Word8 Int
</span><a href="Streamly.Internal.Unicode.Stream.html#decode0"><span class="hs-identifier hs-var hs-var">decode0</span></a></span></span><span> </span><span id="local-6989586621679434688"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434688"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span id="local-6989586621679434687"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434687"><span class="hs-identifier hs-var">byte</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679434683"><span class="annot"><span class="annottext">t :: Word8
</span><a href="#local-6989586621679434683"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434688"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Storable a =&gt; Ptr a -&gt; Int -&gt; a
</span><a href="Streamly.Internal.Unicode.Stream.html#unsafePeekElemOff"><span class="hs-operator hs-var">`unsafePeekElemOff`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434687"><span class="hs-identifier hs-var">byte</span></a></span><span>
</span><span id="line-250"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679434674"><span class="annot"><span class="annottext">codep' :: Int
</span><a href="#local-6989586621679434674"><span class="hs-identifier hs-var hs-var">codep'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0xff</span></span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftR`</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434683"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434687"><span class="hs-identifier hs-var">byte</span></a></span><span>
</span><span id="line-251"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679434668"><span class="annot"><span class="annottext">state' :: Word8
</span><a href="#local-6989586621679434668"><span class="hs-identifier hs-var hs-var">state'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434688"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Storable a =&gt; Ptr a -&gt; Int -&gt; a
</span><a href="Streamly.Internal.Unicode.Stream.html#unsafePeekElemOff"><span class="hs-operator hs-var">`unsafePeekElemOff`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">256</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434683"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434687"><span class="hs-identifier hs-var">byte</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x7f</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679434665"><span class="hs-identifier hs-var">showByte</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434668"><span class="hs-identifier hs-var">state'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679434665"><span class="hs-identifier hs-var">showByte</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679434662"><span class="hs-identifier hs-var">showTable</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434668"><span class="hs-identifier hs-var">state'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434674"><span class="hs-identifier hs-var">codep'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621679434658"><span class="annot"><span class="annottext">utf8table :: Array Word8
</span><a href="#local-6989586621679434658"><span class="hs-identifier hs-var hs-var">utf8table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-259"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679434657"><span class="annot"><span class="annottext">end :: Ptr b
</span><a href="#local-6989586621679434657"><span class="hs-identifier hs-var hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434688"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">364</span></span><span>
</span><span id="line-260"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall a. ArrayContents -&gt; Ptr a -&gt; Ptr a -&gt; Array a
</span><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-var">A.Array</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434688"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">forall {b}. Ptr b
</span><a href="#local-6989586621679434657"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">A.Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span>
</span><span id="line-261"></span><span>    </span><span id="local-6989586621679434665"><span class="annot"><span class="annottext">showByte :: [Char]
</span><a href="#local-6989586621679434665"><span class="hs-identifier hs-var hs-var">showByte</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Streamly: decode0: byte: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434687"><span class="hs-identifier hs-var">byte</span></a></span><span>
</span><span id="line-262"></span><span>    </span><span id="local-6989586621679434662"><span class="annot"><span class="annottext">showTable :: [Char]
</span><a href="#local-6989586621679434662"><span class="hs-identifier hs-var hs-var">showTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; table: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Array Word8
</span><a href="#local-6989586621679434658"><span class="hs-identifier hs-var">utf8table</span></a></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-comment">-- When the state is not 0</span><span>
</span><span id="line-265"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decode1"><span class="hs-pragma hs-type">decode1</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-266"></span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decode1"><span class="hs-identifier hs-type">decode1</span></a></span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeState"><span class="hs-identifier hs-type">DecodeState</span></a></span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#CodePoint"><span class="hs-identifier hs-type">CodePoint</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-type">Tuple'</span></a></span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeState"><span class="hs-identifier hs-type">DecodeState</span></a></span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#CodePoint"><span class="hs-identifier hs-type">CodePoint</span></a></span><span>
</span><span id="line-272"></span><span id="decode1"><span class="annot"><span class="annottext">decode1 :: Ptr Word8 -&gt; Word8 -&gt; Int -&gt; Word8 -&gt; Tuple' Word8 Int
</span><a href="Streamly.Internal.Unicode.Stream.html#decode1"><span class="hs-identifier hs-var hs-var">decode1</span></a></span></span><span> </span><span id="local-6989586621679434648"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434648"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span id="local-6989586621679434647"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434647"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span id="local-6989586621679434646"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434646"><span class="hs-identifier hs-var">codep</span></a></span></span><span> </span><span id="local-6989586621679434645"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434645"><span class="hs-identifier hs-var">byte</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-comment">-- Remember codep is Int type!</span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-comment">-- Can it be unsafe to convert the resulting Int to Char?</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679434641"><span class="annot"><span class="annottext">t :: Word8
</span><a href="#local-6989586621679434641"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434648"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Storable a =&gt; Ptr a -&gt; Int -&gt; a
</span><a href="Streamly.Internal.Unicode.Stream.html#unsafePeekElemOff"><span class="hs-operator hs-var">`unsafePeekElemOff`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434645"><span class="hs-identifier hs-var">byte</span></a></span><span>
</span><span id="line-276"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679434634"><span class="annot"><span class="annottext">codep' :: Int
</span><a href="#local-6989586621679434634"><span class="hs-identifier hs-var hs-var">codep'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434645"><span class="hs-identifier hs-var">byte</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x3f</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434646"><span class="hs-identifier hs-var">codep</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679434625"><span class="annot"><span class="annottext">state' :: Word8
</span><a href="#local-6989586621679434625"><span class="hs-identifier hs-var hs-var">state'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434648"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Storable a =&gt; Ptr a -&gt; Int -&gt; a
</span><a href="Streamly.Internal.Unicode.Stream.html#unsafePeekElemOff"><span class="hs-operator hs-var">`unsafePeekElemOff`</span></a></span><span>
</span><span id="line-278"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">256</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434647"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434641"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434634"><span class="hs-identifier hs-var">codep'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x10FFFF</span></span><span>
</span><span id="line-280"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679434624"><span class="hs-identifier hs-var">showByte</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall {a} {a}. (Show a, Show a) =&gt; a -&gt; a -&gt; [Char]
</span><a href="#local-6989586621679434623"><span class="hs-identifier hs-var">showState</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434647"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434646"><span class="hs-identifier hs-var">codep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434625"><span class="hs-identifier hs-var">state'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434634"><span class="hs-identifier hs-var">codep'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span>    </span><span id="local-6989586621679434620"><span class="annot"><span class="annottext">utf8table :: Array Word8
</span><a href="#local-6989586621679434620"><span class="hs-identifier hs-var hs-var">utf8table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-285"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679434619"><span class="annot"><span class="annottext">end :: Ptr b
</span><a href="#local-6989586621679434619"><span class="hs-identifier hs-var hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434648"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">364</span></span><span>
</span><span id="line-286"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall a. ArrayContents -&gt; Ptr a -&gt; Ptr a -&gt; Array a
</span><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-var">A.Array</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434648"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">forall {b}. Ptr b
</span><a href="#local-6989586621679434619"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">A.Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span>
</span><span id="line-287"></span><span>    </span><span id="local-6989586621679434624"><span class="annot"><span class="annottext">showByte :: [Char]
</span><a href="#local-6989586621679434624"><span class="hs-identifier hs-var hs-var">showByte</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Streamly: decode1: byte: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434645"><span class="hs-identifier hs-var">byte</span></a></span><span>
</span><span id="line-288"></span><span>    </span><span id="local-6989586621679434623"><span class="annot"><span class="annottext">showState :: a -&gt; a -&gt; [Char]
</span><a href="#local-6989586621679434623"><span class="hs-identifier hs-var hs-var">showState</span></a></span></span><span> </span><span id="local-6989586621679434610"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679434610"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679434609"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679434609"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-289"></span><span>        </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; state: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679434610"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-290"></span><span>        </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; codepoint: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679434609"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-291"></span><span>        </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; table: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Array Word8
</span><a href="#local-6989586621679434620"><span class="hs-identifier hs-var">utf8table</span></a></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- Resumable UTF-8 decoding</span><span>
</span><span id="line-295"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="hs-comment">-- Strangely, GHCJS hangs linking template-haskell with this</span><span class="hs-cpp">
#ifndef __GHCJS__
</span><span class="hs-pragma">{-# ANN</span><span> </span><span class="hs-pragma">type</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeState"><span class="hs-pragma hs-type">UTF8DecodeState</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Fuse</span></span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">data</span><span> </span><span id="UTF8DecodeState"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeState"><span class="hs-identifier hs-var">UTF8DecodeState</span></a></span></span><span> </span><span id="local-6989586621679435440"><span class="annot"><a href="#local-6989586621679435440"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679435439"><span class="annot"><a href="#local-6989586621679435439"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-302"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="UTF8DecodeInit"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit"><span class="hs-identifier hs-var">UTF8DecodeInit</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679435440"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-303"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="UTF8DecodeInit1"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit1"><span class="hs-identifier hs-var">UTF8DecodeInit1</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679435440"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="UTF8DecodeFirst"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeFirst"><span class="hs-identifier hs-var">UTF8DecodeFirst</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679435440"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="UTF8Decoding"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#UTF8Decoding"><span class="hs-identifier hs-var">UTF8Decoding</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679435440"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeState"><span class="hs-identifier hs-type">DecodeState</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#CodePoint"><span class="hs-identifier hs-type">CodePoint</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="YieldAndContinue"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#YieldAndContinue"><span class="hs-identifier hs-var">YieldAndContinue</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679435439"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeState"><span class="hs-identifier hs-type">UTF8DecodeState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435440"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435439"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Done"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#Done"><span class="hs-identifier hs-var">Done</span></a></span></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="hs-pragma">{-# INLINE_NORMAL resumeDecodeUtf8EitherD #-}</span><span>
</span><span id="line-310"></span><span id="local-6989586621679435448"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#resumeDecodeUtf8EitherD"><span class="hs-identifier hs-type">resumeDecodeUtf8EitherD</span></a></span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679435448"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeState"><span class="hs-identifier hs-type">DecodeState</span></a></span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#CodePoint"><span class="hs-identifier hs-type">CodePoint</span></a></span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435448"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435448"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeError"><span class="hs-identifier hs-type">DecodeError</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-316"></span><span id="resumeDecodeUtf8EitherD"><span class="annot"><span class="annottext">resumeDecodeUtf8EitherD :: forall (m :: * -&gt; *).
Monad m =&gt;
Word8
-&gt; Int -&gt; Stream m Word8 -&gt; Stream m (Either DecodeError Char)
</span><a href="Streamly.Internal.Unicode.Stream.html#resumeDecodeUtf8EitherD"><span class="hs-identifier hs-var hs-var">resumeDecodeUtf8EitherD</span></a></span></span><span> </span><span id="local-6989586621679434600"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434600"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span id="local-6989586621679434599"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434599"><span class="hs-identifier hs-var">codep</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span id="local-6989586621679434597"><span class="annot"><span class="annottext">State Stream m Word8 -&gt; s -&gt; m (Step s Word8)
</span><a href="#local-6989586621679434597"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span id="local-6989586621679434596"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434596"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-317"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">A.Array</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayContents
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679434595"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434595"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#utf8d"><span class="hs-identifier hs-var">utf8d</span></a></span><span>
</span><span id="line-318"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679434594"><span class="annot"><span class="annottext">ptr :: Ptr Word8
</span><a href="#local-6989586621679434594"><span class="hs-identifier hs-var hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434595"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-319"></span><span>        </span><span id="local-6989586621679434591"><span class="annot"><span class="annottext">stt :: UTF8DecodeState s a
</span><a href="#local-6989586621679434591"><span class="hs-identifier hs-var hs-var">stt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-320"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434600"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span>
</span><span id="line-321"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit"><span class="hs-identifier hs-var">UTF8DecodeInit</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434596"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-322"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Word8 -&gt; Int -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8Decoding"><span class="hs-identifier hs-var">UTF8Decoding</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434596"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434600"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434599"><span class="hs-identifier hs-var">codep</span></a></span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a s.
(State Stream m a -&gt; s -&gt; m (Step s a)) -&gt; s -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-var">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {a}.
Ptr Word8
-&gt; State Stream m a
-&gt; UTF8DecodeState s (Either DecodeError Char)
-&gt; m (Step
        (UTF8DecodeState s (Either DecodeError Char))
        (Either DecodeError Char))
</span><a href="#local-6989586621679434590"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434594"><span class="hs-identifier hs-var">ptr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall {a}. UTF8DecodeState s a
</span><a href="#local-6989586621679434591"><span class="hs-identifier hs-var">stt</span></a></span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-pragma">{-# INLINE_LATE step' #-}</span><span>
</span><span id="line-326"></span><span>    </span><span id="local-6989586621679434590"><span class="annot"><span class="annottext">step' :: Ptr Word8
-&gt; State Stream m a
-&gt; UTF8DecodeState s (Either DecodeError Char)
-&gt; m (Step
        (UTF8DecodeState s (Either DecodeError Char))
        (Either DecodeError Char))
</span><a href="#local-6989586621679434590"><span class="hs-identifier hs-var hs-var">step'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679434561"><span class="annot"><span class="annottext">State Stream m a
</span><a href="#local-6989586621679434561"><span class="hs-identifier hs-var">gst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit"><span class="hs-identifier hs-type">UTF8DecodeInit</span></a></span><span> </span><span id="local-6989586621679434560"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434560"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-327"></span><span>        </span><span id="local-6989586621679434559"><span class="annot"><span class="annottext">Step s Word8
</span><a href="#local-6989586621679434559"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State Stream m Word8 -&gt; s -&gt; m (Step s Word8)
</span><a href="#local-6989586621679434597"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a (n :: * -&gt; *) b.
State t m a -&gt; State t n b
</span><a href="Streamly.Internal.Data.SVar.Type.html#adaptState"><span class="hs-identifier hs-var">adaptState</span></a></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><a href="#local-6989586621679434561"><span class="hs-identifier hs-var">gst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434560"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-328"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step s Word8
</span><a href="#local-6989586621679434559"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-329"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679434557"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434557"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679434556"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434556"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Word8 -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit1"><span class="hs-identifier hs-var">UTF8DecodeInit1</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434556"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434557"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-type">Skip</span></a></span><span> </span><span id="local-6989586621679434554"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434554"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit"><span class="hs-identifier hs-var">UTF8DecodeInit</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434554"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>            </span><span class="annot"><span class="annottext">Step s Word8
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>    </span><span class="annot"><a href="#local-6989586621679434590"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit1"><span class="hs-identifier hs-type">UTF8DecodeInit1</span></a></span><span> </span><span id="local-6989586621679434552"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434552"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679434551"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434551"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-comment">-- Note: It is important to use a &quot;&gt;&quot; instead of a &quot;&lt;=&quot; test</span><span>
</span><span id="line-335"></span><span>        </span><span class="hs-comment">-- here for GHC to generate code layout for default branch</span><span>
</span><span id="line-336"></span><span>        </span><span class="hs-comment">-- prediction for the common case. This is fragile and might</span><span>
</span><span id="line-337"></span><span>        </span><span class="hs-comment">-- change with the compiler versions, we need a more reliable</span><span>
</span><span id="line-338"></span><span>        </span><span class="hs-comment">-- &quot;likely&quot; primitive to control branch predication.</span><span>
</span><span id="line-339"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434551"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x7f</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-340"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-341"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. a -&gt; UTF8DecodeState s a -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#YieldAndContinue"><span class="hs-identifier hs-var">YieldAndContinue</span></a></span><span>
</span><span id="line-342"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Char
</span><span class="hs-identifier hs-var">unsafeChr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434551"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit"><span class="hs-identifier hs-var">UTF8DecodeInit</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434552"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>            </span><span class="hs-comment">-- Using a separate state here generates a jump to a</span><span>
</span><span id="line-345"></span><span>            </span><span class="hs-comment">-- separate code block in the core which seems to perform</span><span>
</span><span id="line-346"></span><span>            </span><span class="hs-comment">-- slightly better for the non-ascii case.</span><span>
</span><span id="line-347"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Word8 -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeFirst"><span class="hs-identifier hs-var">UTF8DecodeFirst</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434552"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434551"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-comment">-- XXX should we merge it with UTF8DecodeInit1?</span><span>
</span><span id="line-350"></span><span>    </span><span class="annot"><a href="#local-6989586621679434590"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span id="local-6989586621679434550"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434550"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeFirst"><span class="hs-identifier hs-type">UTF8DecodeFirst</span></a></span><span> </span><span id="local-6989586621679434549"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434549"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679434548"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434548"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-351"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-type">Tuple'</span></a></span><span> </span><span id="local-6989586621679434547"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434547"><span class="hs-identifier hs-var">sv</span></a></span></span><span> </span><span id="local-6989586621679434546"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434546"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Word8 -&gt; Tuple' Word8 Int
</span><a href="Streamly.Internal.Unicode.Stream.html#decode0"><span class="hs-identifier hs-var">decode0</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434550"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434548"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-352"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-353"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434547"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-354"></span><span>                </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-355"></span><span>                    </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. a -&gt; UTF8DecodeState s a -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#YieldAndContinue"><span class="hs-identifier hs-var">YieldAndContinue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int -&gt; DecodeError
</span><a href="Streamly.Internal.Unicode.Stream.html#DecodeError"><span class="hs-identifier hs-var">DecodeError</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434548"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>                                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit"><span class="hs-identifier hs-var">UTF8DecodeInit</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434549"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>                </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unreachable state&quot;</span></span><span>
</span><span id="line-358"></span><span>                </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Word8 -&gt; Int -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8Decoding"><span class="hs-identifier hs-var">UTF8Decoding</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434549"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434547"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434546"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-comment">-- We recover by trying the new byte x a starter of a new codepoint.</span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-comment">-- XXX on error need to report the next byte &quot;x&quot; as well.</span><span>
</span><span id="line-362"></span><span>    </span><span class="hs-comment">-- XXX need to use the same recovery in array decoding routine as well</span><span>
</span><span id="line-363"></span><span>    </span><span class="annot"><a href="#local-6989586621679434590"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span id="local-6989586621679434545"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434545"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span id="local-6989586621679434544"><span class="annot"><span class="annottext">State Stream m a
</span><a href="#local-6989586621679434544"><span class="hs-identifier hs-var">gst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#UTF8Decoding"><span class="hs-identifier hs-type">UTF8Decoding</span></a></span><span> </span><span id="local-6989586621679434543"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434543"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679434542"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434542"><span class="hs-identifier hs-var">statePtr</span></a></span></span><span> </span><span id="local-6989586621679434541"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434541"><span class="hs-identifier hs-var">codepointPtr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-364"></span><span>        </span><span id="local-6989586621679434540"><span class="annot"><span class="annottext">Step s Word8
</span><a href="#local-6989586621679434540"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State Stream m Word8 -&gt; s -&gt; m (Step s Word8)
</span><a href="#local-6989586621679434597"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a (n :: * -&gt; *) b.
State t m a -&gt; State t n b
</span><a href="Streamly.Internal.Data.SVar.Type.html#adaptState"><span class="hs-identifier hs-var">adaptState</span></a></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><a href="#local-6989586621679434544"><span class="hs-identifier hs-var">gst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434543"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-365"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step s Word8
</span><a href="#local-6989586621679434540"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-366"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679434539"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434539"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679434538"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434538"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-367"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-type">Tuple'</span></a></span><span> </span><span id="local-6989586621679434537"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434537"><span class="hs-identifier hs-var">sv</span></a></span></span><span> </span><span id="local-6989586621679434536"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434536"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Word8 -&gt; Int -&gt; Word8 -&gt; Tuple' Word8 Int
</span><a href="Streamly.Internal.Unicode.Stream.html#decode1"><span class="hs-identifier hs-var">decode1</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434545"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434542"><span class="hs-identifier hs-var">statePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434541"><span class="hs-identifier hs-var">codepointPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434539"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-368"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-369"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434537"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-370"></span><span>                        </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. a -&gt; UTF8DecodeState s a -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#YieldAndContinue"><span class="hs-identifier hs-var">YieldAndContinue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Char
</span><span class="hs-identifier hs-var">unsafeChr</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434536"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit"><span class="hs-identifier hs-var">UTF8DecodeInit</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434538"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>                        </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-373"></span><span>                            </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. a -&gt; UTF8DecodeState s a -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#YieldAndContinue"><span class="hs-identifier hs-var">YieldAndContinue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int -&gt; DecodeError
</span><a href="Streamly.Internal.Unicode.Stream.html#DecodeError"><span class="hs-identifier hs-var">DecodeError</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434542"><span class="hs-identifier hs-var">statePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434541"><span class="hs-identifier hs-var">codepointPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Word8 -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit1"><span class="hs-identifier hs-var">UTF8DecodeInit1</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434538"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434539"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>                        </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Word8 -&gt; Int -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8Decoding"><span class="hs-identifier hs-var">UTF8Decoding</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434538"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434537"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434536"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-type">Skip</span></a></span><span> </span><span id="local-6989586621679434535"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434535"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Word8 -&gt; Int -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8Decoding"><span class="hs-identifier hs-var">UTF8Decoding</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434535"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434542"><span class="hs-identifier hs-var">statePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434541"><span class="hs-identifier hs-var">codepointPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>            </span><span class="annot"><span class="annottext">Step s Word8
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. a -&gt; UTF8DecodeState s a -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#YieldAndContinue"><span class="hs-identifier hs-var">YieldAndContinue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int -&gt; DecodeError
</span><a href="Streamly.Internal.Unicode.Stream.html#DecodeError"><span class="hs-identifier hs-var">DecodeError</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434542"><span class="hs-identifier hs-var">statePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434541"><span class="hs-identifier hs-var">codepointPtr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall s a. UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span>    </span><span class="annot"><a href="#local-6989586621679434590"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#YieldAndContinue"><span class="hs-identifier hs-type">YieldAndContinue</span></a></span><span> </span><span id="local-6989586621679434534"><span class="annot"><span class="annottext">Either DecodeError Char
</span><a href="#local-6989586621679434534"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679434533"><span class="annot"><span class="annottext">UTF8DecodeState s (Either DecodeError Char)
</span><a href="#local-6989586621679434533"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">Either DecodeError Char
</span><a href="#local-6989586621679434534"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">UTF8DecodeState s (Either DecodeError Char)
</span><a href="#local-6989586621679434533"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-380"></span><span>    </span><span class="annot"><a href="#local-6989586621679434590"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">UTF8DecodeState s (Either DecodeError Char)
</span><a href="Streamly.Internal.Unicode.Stream.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall s a. Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span class="hs-comment">-- XXX We can use just one API, and define InitState = 0 and InitCodePoint = 0</span><span>
</span><span id="line-383"></span><span class="hs-comment">-- to use as starting state.</span><span>
</span><span id="line-384"></span><span class="hs-comment">--</span><span>
</span><span id="line-385"></span><span class="hs-pragma">{-# INLINE_NORMAL decodeUtf8EitherD #-}</span><span>
</span><span id="line-386"></span><span id="local-6989586621679435422"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8EitherD"><span class="hs-identifier hs-type">decodeUtf8EitherD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679435422"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-387"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435422"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435422"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeError"><span class="hs-identifier hs-type">DecodeError</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-388"></span><span id="decodeUtf8EitherD"><span class="annot"><span class="annottext">decodeUtf8EitherD :: forall (m :: * -&gt; *).
Monad m =&gt;
Stream m Word8 -&gt; Stream m (Either DecodeError Char)
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8EitherD"><span class="hs-identifier hs-var hs-var">decodeUtf8EitherD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
Word8
-&gt; Int -&gt; Stream m Word8 -&gt; Stream m (Either DecodeError Char)
</span><a href="Streamly.Internal.Unicode.Stream.html#resumeDecodeUtf8EitherD"><span class="hs-identifier hs-var">resumeDecodeUtf8EitherD</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-391"></span><span class="hs-comment">--</span><span>
</span><span id="line-392"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-393"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Either"><span class="hs-pragma hs-type">decodeUtf8Either</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-394"></span><span id="local-6989586621679435419"><span id="local-6989586621679435420"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Either"><span class="hs-identifier hs-type">decodeUtf8Either</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679435420"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435419"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435419"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435420"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435419"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435420"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeError"><span class="hs-identifier hs-type">DecodeError</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-396"></span><span id="decodeUtf8Either"><span class="annot"><span class="annottext">decodeUtf8Either :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *).
(Monad m, IsStream t) =&gt;
t m Word8 -&gt; t m (Either DecodeError Char)
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Either"><span class="hs-identifier hs-var hs-var">decodeUtf8Either</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
Stream m Word8 -&gt; Stream m (Either DecodeError Char)
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8EitherD"><span class="hs-identifier hs-var">decodeUtf8EitherD</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-399"></span><span class="hs-comment">--</span><span>
</span><span id="line-400"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-401"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#resumeDecodeUtf8Either"><span class="hs-pragma hs-type">resumeDecodeUtf8Either</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-402"></span><span id="local-6989586621679435409"><span id="local-6989586621679435410"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#resumeDecodeUtf8Either"><span class="hs-identifier hs-type">resumeDecodeUtf8Either</span></a></span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679435410"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435409"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeState"><span class="hs-identifier hs-type">DecodeState</span></a></span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#CodePoint"><span class="hs-identifier hs-type">CodePoint</span></a></span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435409"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435410"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435409"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435410"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeError"><span class="hs-identifier hs-type">DecodeError</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-408"></span><span id="resumeDecodeUtf8Either"><span class="annot"><span class="annottext">resumeDecodeUtf8Either :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *).
(Monad m, IsStream t) =&gt;
Word8 -&gt; Int -&gt; t m Word8 -&gt; t m (Either DecodeError Char)
</span><a href="Streamly.Internal.Unicode.Stream.html#resumeDecodeUtf8Either"><span class="hs-identifier hs-var hs-var">resumeDecodeUtf8Either</span></a></span></span><span> </span><span id="local-6989586621679434515"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434515"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679434514"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434514"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
Word8
-&gt; Int -&gt; Stream m Word8 -&gt; Stream m (Either DecodeError Char)
</span><a href="Streamly.Internal.Unicode.Stream.html#resumeDecodeUtf8EitherD"><span class="hs-identifier hs-var">resumeDecodeUtf8EitherD</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434515"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434514"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-412"></span><span class="hs-comment">-- One shot decoding</span><span>
</span><span id="line-413"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span class="hs-keyword">data</span><span> </span><span id="CodingFailureMode"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#CodingFailureMode"><span class="hs-identifier hs-var">CodingFailureMode</span></a></span></span><span>
</span><span id="line-416"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="TransliterateCodingFailure"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#TransliterateCodingFailure"><span class="hs-identifier hs-var">TransliterateCodingFailure</span></a></span></span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrorOnCodingFailure"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#ErrorOnCodingFailure"><span class="hs-identifier hs-var">ErrorOnCodingFailure</span></a></span></span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="DropOnCodingFailure"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DropOnCodingFailure"><span class="hs-identifier hs-var">DropOnCodingFailure</span></a></span></span><span>
</span><span id="line-419"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679434505"><span id="local-6989586621679434507"><span id="local-6989586621679434509"><span class="annot"><span class="annottext">Int -&gt; CodingFailureMode -&gt; ShowS
[CodingFailureMode] -&gt; ShowS
CodingFailureMode -&gt; [Char]
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [CodingFailureMode] -&gt; ShowS
$cshowList :: [CodingFailureMode] -&gt; ShowS
show :: CodingFailureMode -&gt; [Char]
$cshow :: CodingFailureMode -&gt; [Char]
showsPrec :: Int -&gt; CodingFailureMode -&gt; ShowS
$cshowsPrec :: Int -&gt; CodingFailureMode -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#replacementChar"><span class="hs-pragma hs-type">replacementChar</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-422"></span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#replacementChar"><span class="hs-identifier hs-type">replacementChar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>
</span><span id="line-423"></span><span id="replacementChar"><span class="annot"><span class="annottext">replacementChar :: Char
</span><a href="Streamly.Internal.Unicode.Stream.html#replacementChar"><span class="hs-identifier hs-var hs-var">replacementChar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\xFFFD'</span></span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span class="hs-comment">-- XXX write it as a parser and use parseMany to decode a stream, need to check</span><span>
</span><span id="line-426"></span><span class="hs-comment">-- if that preserves the same performance. Or we can use a resumable parser</span><span>
</span><span id="line-427"></span><span class="hs-comment">-- that parses a chunk at a time.</span><span>
</span><span id="line-428"></span><span class="hs-comment">--</span><span>
</span><span id="line-429"></span><span class="hs-comment">-- XXX Implement this in terms of decodeUtf8Either. Need to make sure that</span><span>
</span><span id="line-430"></span><span class="hs-comment">-- decodeUtf8Either preserves the performance characterstics.</span><span>
</span><span id="line-431"></span><span class="hs-comment">--</span><span>
</span><span id="line-432"></span><span class="hs-pragma">{-# INLINE_NORMAL decodeUtf8WithD #-}</span><span>
</span><span id="line-433"></span><span id="local-6989586621679435406"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8WithD"><span class="hs-identifier hs-type">decodeUtf8WithD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679435406"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-434"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#CodingFailureMode"><span class="hs-identifier hs-type">CodingFailureMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435406"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435406"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span><span>
</span><span id="line-435"></span><span id="decodeUtf8WithD"><span class="annot"><span class="annottext">decodeUtf8WithD :: forall (m :: * -&gt; *).
Monad m =&gt;
CodingFailureMode -&gt; Stream m Word8 -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8WithD"><span class="hs-identifier hs-var hs-var">decodeUtf8WithD</span></a></span></span><span> </span><span id="local-6989586621679434501"><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="#local-6989586621679434501"><span class="hs-identifier hs-var">cfm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span id="local-6989586621679434500"><span class="annot"><span class="annottext">State Stream m Word8 -&gt; s -&gt; m (Step s Word8)
</span><a href="#local-6989586621679434500"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span id="local-6989586621679434499"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434499"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">A.Array</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayContents
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679434498"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434498"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#utf8d"><span class="hs-identifier hs-var">utf8d</span></a></span><span>
</span><span id="line-437"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a s.
(State Stream m a -&gt; s -&gt; m (Step s a)) -&gt; s -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-var">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {a}.
Ptr Word8
-&gt; State Stream m a
-&gt; UTF8DecodeState s Char
-&gt; m (Step (UTF8DecodeState s Char) Char)
</span><a href="#local-6989586621679434497"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434498"><span class="hs-identifier hs-var">ptr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit"><span class="hs-identifier hs-var">UTF8DecodeInit</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434499"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span>    </span><span id="local-6989586621679434496"><span class="annot"><span class="annottext">prefix :: [Char]
</span><a href="#local-6989586621679434496"><span class="hs-identifier hs-var hs-var">prefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Streamly.Internal.Data.Stream.StreamD.decodeUtf8With: &quot;</span></span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679434495"><span class="hs-pragma hs-type">handleError</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-444"></span><span>    </span><span id="local-6989586621679434495"><span class="annot"><span class="annottext">handleError :: [Char] -&gt; UTF8DecodeState s Char -&gt; UTF8DecodeState s Char
</span><a href="#local-6989586621679434495"><span class="hs-identifier hs-var hs-var">handleError</span></a></span></span><span> </span><span id="local-6989586621679434492"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679434492"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679434491"><span class="annot"><span class="annottext">UTF8DecodeState s Char
</span><a href="#local-6989586621679434491"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-445"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="#local-6989586621679434501"><span class="hs-identifier hs-var">cfm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-446"></span><span>            </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#ErrorOnCodingFailure"><span class="hs-identifier hs-var">ErrorOnCodingFailure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679434492"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-447"></span><span>            </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#TransliterateCodingFailure"><span class="hs-identifier hs-var">TransliterateCodingFailure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. a -&gt; UTF8DecodeState s a -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#YieldAndContinue"><span class="hs-identifier hs-var">YieldAndContinue</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="Streamly.Internal.Unicode.Stream.html#replacementChar"><span class="hs-identifier hs-var">replacementChar</span></a></span><span> </span><span class="annot"><span class="annottext">UTF8DecodeState s Char
</span><a href="#local-6989586621679434491"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-448"></span><span>            </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#DropOnCodingFailure"><span class="hs-identifier hs-var">DropOnCodingFailure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTF8DecodeState s Char
</span><a href="#local-6989586621679434491"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679434490"><span class="hs-pragma hs-type">handleUnderflow</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-451"></span><span>    </span><span id="local-6989586621679434490"><span class="annot"><span class="annottext">handleUnderflow :: UTF8DecodeState s Char
</span><a href="#local-6989586621679434490"><span class="hs-identifier hs-var hs-var">handleUnderflow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-452"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="#local-6989586621679434501"><span class="hs-identifier hs-var">cfm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-453"></span><span>            </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#ErrorOnCodingFailure"><span class="hs-identifier hs-var">ErrorOnCodingFailure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679434496"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Not enough input&quot;</span></span><span>
</span><span id="line-454"></span><span>            </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#TransliterateCodingFailure"><span class="hs-identifier hs-var">TransliterateCodingFailure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. a -&gt; UTF8DecodeState s a -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#YieldAndContinue"><span class="hs-identifier hs-var">YieldAndContinue</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="Streamly.Internal.Unicode.Stream.html#replacementChar"><span class="hs-identifier hs-var">replacementChar</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span>
</span><span id="line-455"></span><span>            </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#DropOnCodingFailure"><span class="hs-identifier hs-var">DropOnCodingFailure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-pragma">{-# INLINE_LATE step' #-}</span><span>
</span><span id="line-458"></span><span>    </span><span id="local-6989586621679434497"><span class="annot"><span class="annottext">step' :: Ptr Word8
-&gt; State Stream m a
-&gt; UTF8DecodeState s Char
-&gt; m (Step (UTF8DecodeState s Char) Char)
</span><a href="#local-6989586621679434497"><span class="hs-identifier hs-var hs-var">step'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679434462"><span class="annot"><span class="annottext">State Stream m a
</span><a href="#local-6989586621679434462"><span class="hs-identifier hs-var">gst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit"><span class="hs-identifier hs-type">UTF8DecodeInit</span></a></span><span> </span><span id="local-6989586621679434461"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434461"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-459"></span><span>        </span><span id="local-6989586621679434460"><span class="annot"><span class="annottext">Step s Word8
</span><a href="#local-6989586621679434460"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State Stream m Word8 -&gt; s -&gt; m (Step s Word8)
</span><a href="#local-6989586621679434500"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a (n :: * -&gt; *) b.
State t m a -&gt; State t n b
</span><a href="Streamly.Internal.Data.SVar.Type.html#adaptState"><span class="hs-identifier hs-var">adaptState</span></a></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><a href="#local-6989586621679434462"><span class="hs-identifier hs-var">gst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434461"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-460"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step s Word8
</span><a href="#local-6989586621679434460"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-461"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679434459"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434459"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679434458"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434458"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Word8 -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit1"><span class="hs-identifier hs-var">UTF8DecodeInit1</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434458"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434459"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-type">Skip</span></a></span><span> </span><span id="local-6989586621679434457"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434457"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit"><span class="hs-identifier hs-var">UTF8DecodeInit</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434457"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>            </span><span class="annot"><span class="annottext">Step s Word8
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span>    </span><span class="annot"><a href="#local-6989586621679434497"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit1"><span class="hs-identifier hs-type">UTF8DecodeInit1</span></a></span><span> </span><span id="local-6989586621679434456"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434456"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679434455"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434455"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-466"></span><span>        </span><span class="hs-comment">-- Note: It is important to use a &quot;&gt;&quot; instead of a &quot;&lt;=&quot; test</span><span>
</span><span id="line-467"></span><span>        </span><span class="hs-comment">-- here for GHC to generate code layout for default branch</span><span>
</span><span id="line-468"></span><span>        </span><span class="hs-comment">-- prediction for the common case. This is fragile and might</span><span>
</span><span id="line-469"></span><span>        </span><span class="hs-comment">-- change with the compiler versions, we need a more reliable</span><span>
</span><span id="line-470"></span><span>        </span><span class="hs-comment">-- &quot;likely&quot; primitive to control branch predication.</span><span>
</span><span id="line-471"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434455"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x7f</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-472"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-473"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. a -&gt; UTF8DecodeState s a -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#YieldAndContinue"><span class="hs-identifier hs-var">YieldAndContinue</span></a></span><span>
</span><span id="line-474"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Char
</span><span class="hs-identifier hs-var">unsafeChr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434455"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-475"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit"><span class="hs-identifier hs-var">UTF8DecodeInit</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434456"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>            </span><span class="hs-comment">-- Using a separate state here generates a jump to a</span><span>
</span><span id="line-477"></span><span>            </span><span class="hs-comment">-- separate code block in the core which seems to perform</span><span>
</span><span id="line-478"></span><span>            </span><span class="hs-comment">-- slightly better for the non-ascii case.</span><span>
</span><span id="line-479"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Word8 -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeFirst"><span class="hs-identifier hs-var">UTF8DecodeFirst</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434456"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434455"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span>    </span><span class="hs-comment">-- XXX should we merge it with UTF8DecodeInit1?</span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><a href="#local-6989586621679434497"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span id="local-6989586621679434454"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434454"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeFirst"><span class="hs-identifier hs-type">UTF8DecodeFirst</span></a></span><span> </span><span id="local-6989586621679434453"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434453"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679434452"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434452"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-483"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-type">Tuple'</span></a></span><span> </span><span id="local-6989586621679434451"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434451"><span class="hs-identifier hs-var">sv</span></a></span></span><span> </span><span id="local-6989586621679434450"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434450"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Word8 -&gt; Tuple' Word8 Int
</span><a href="Streamly.Internal.Unicode.Stream.html#decode0"><span class="hs-identifier hs-var">decode0</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434454"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434452"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-484"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-485"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434451"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-486"></span><span>                </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-487"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679434448"><span class="annot"><span class="annottext">msg :: [Char]
</span><a href="#local-6989586621679434448"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679434496"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Invalid first UTF8 byte &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434452"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-488"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {s}.
[Char] -&gt; UTF8DecodeState s Char -&gt; UTF8DecodeState s Char
</span><a href="#local-6989586621679434495"><span class="hs-identifier hs-var">handleError</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679434448"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit"><span class="hs-identifier hs-var">UTF8DecodeInit</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434453"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>                </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unreachable state&quot;</span></span><span>
</span><span id="line-490"></span><span>                </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Word8 -&gt; Int -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8Decoding"><span class="hs-identifier hs-var">UTF8Decoding</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434453"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434451"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434450"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span>    </span><span class="hs-comment">-- We recover by trying the new byte x as a starter of a new codepoint.</span><span>
</span><span id="line-493"></span><span>    </span><span class="hs-comment">-- XXX need to use the same recovery in array decoding routine as well</span><span>
</span><span id="line-494"></span><span>    </span><span class="annot"><a href="#local-6989586621679434497"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span id="local-6989586621679434447"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434447"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span id="local-6989586621679434446"><span class="annot"><span class="annottext">State Stream m a
</span><a href="#local-6989586621679434446"><span class="hs-identifier hs-var">gst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#UTF8Decoding"><span class="hs-identifier hs-type">UTF8Decoding</span></a></span><span> </span><span id="local-6989586621679434445"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434445"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679434444"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434444"><span class="hs-identifier hs-var">statePtr</span></a></span></span><span> </span><span id="local-6989586621679434443"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434443"><span class="hs-identifier hs-var">codepointPtr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-495"></span><span>        </span><span id="local-6989586621679434442"><span class="annot"><span class="annottext">Step s Word8
</span><a href="#local-6989586621679434442"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State Stream m Word8 -&gt; s -&gt; m (Step s Word8)
</span><a href="#local-6989586621679434500"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a (n :: * -&gt; *) b.
State t m a -&gt; State t n b
</span><a href="Streamly.Internal.Data.SVar.Type.html#adaptState"><span class="hs-identifier hs-var">adaptState</span></a></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><a href="#local-6989586621679434446"><span class="hs-identifier hs-var">gst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434445"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-496"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step s Word8
</span><a href="#local-6989586621679434442"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-497"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679434441"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434441"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679434440"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434440"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-498"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-type">Tuple'</span></a></span><span> </span><span id="local-6989586621679434439"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434439"><span class="hs-identifier hs-var">sv</span></a></span></span><span> </span><span id="local-6989586621679434438"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434438"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Word8 -&gt; Int -&gt; Word8 -&gt; Tuple' Word8 Int
</span><a href="Streamly.Internal.Unicode.Stream.html#decode1"><span class="hs-identifier hs-var">decode1</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434447"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434444"><span class="hs-identifier hs-var">statePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434443"><span class="hs-identifier hs-var">codepointPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434441"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-499"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434439"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-500"></span><span>                    </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. a -&gt; UTF8DecodeState s a -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#YieldAndContinue"><span class="hs-identifier hs-var">YieldAndContinue</span></a></span><span>
</span><span id="line-501"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Char
</span><span class="hs-identifier hs-var">unsafeChr</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434438"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit"><span class="hs-identifier hs-var">UTF8DecodeInit</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434440"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-502"></span><span>                    </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-503"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679434434"><span class="annot"><span class="annottext">msg :: [Char]
</span><a href="#local-6989586621679434434"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679434496"><span class="hs-identifier hs-var">prefix</span></a></span><span>
</span><span id="line-504"></span><span>                                </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Invalid subsequent UTF8 byte &quot;</span></span><span>
</span><span id="line-505"></span><span>                                </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434441"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-506"></span><span>                                </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; in state &quot;</span></span><span>
</span><span id="line-507"></span><span>                                </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434444"><span class="hs-identifier hs-var">statePtr</span></a></span><span>
</span><span id="line-508"></span><span>                                </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; accumulated value &quot;</span></span><span>
</span><span id="line-509"></span><span>                                </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434443"><span class="hs-identifier hs-var">codepointPtr</span></a></span><span>
</span><span id="line-510"></span><span>                         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {s}.
[Char] -&gt; UTF8DecodeState s Char -&gt; UTF8DecodeState s Char
</span><a href="#local-6989586621679434495"><span class="hs-identifier hs-var">handleError</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679434434"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Word8 -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8DecodeInit1"><span class="hs-identifier hs-var">UTF8DecodeInit1</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434440"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434441"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>                    </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Word8 -&gt; Int -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8Decoding"><span class="hs-identifier hs-var">UTF8Decoding</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434440"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434439"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434438"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-type">Skip</span></a></span><span> </span><span id="local-6989586621679434433"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434433"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-513"></span><span>                </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Word8 -&gt; Int -&gt; UTF8DecodeState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#UTF8Decoding"><span class="hs-identifier hs-var">UTF8Decoding</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434433"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434444"><span class="hs-identifier hs-var">statePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434443"><span class="hs-identifier hs-var">codepointPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>            </span><span class="annot"><span class="annottext">Step s Word8
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall {s}. UTF8DecodeState s Char
</span><a href="#local-6989586621679434490"><span class="hs-identifier hs-var">handleUnderflow</span></a></span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span>    </span><span class="annot"><a href="#local-6989586621679434497"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#YieldAndContinue"><span class="hs-identifier hs-type">YieldAndContinue</span></a></span><span> </span><span id="local-6989586621679434432"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434432"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679434431"><span class="annot"><span class="annottext">UTF8DecodeState s Char
</span><a href="#local-6989586621679434431"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434432"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">UTF8DecodeState s Char
</span><a href="#local-6989586621679434431"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-517"></span><span>    </span><span class="annot"><a href="#local-6989586621679434497"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">UTF8DecodeState s Char
</span><a href="Streamly.Internal.Unicode.Stream.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall s a. Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8D"><span class="hs-pragma hs-type">decodeUtf8D</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-520"></span><span id="local-6989586621679435399"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8D"><span class="hs-identifier hs-type">decodeUtf8D</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679435399"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435399"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435399"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span><span>
</span><span id="line-521"></span><span id="decodeUtf8D"><span class="annot"><span class="annottext">decodeUtf8D :: forall (m :: * -&gt; *). Monad m =&gt; Stream m Word8 -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8D"><span class="hs-identifier hs-var hs-var">decodeUtf8D</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
CodingFailureMode -&gt; Stream m Word8 -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8WithD"><span class="hs-identifier hs-var">decodeUtf8WithD</span></a></span><span> </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#TransliterateCodingFailure"><span class="hs-identifier hs-var">TransliterateCodingFailure</span></a></span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span class="hs-comment">-- | Decode a UTF-8 encoded bytestream to a stream of Unicode characters.</span><span>
</span><span id="line-524"></span><span class="hs-comment">-- Any invalid codepoint encountered is replaced with the unicode replacement</span><span>
</span><span id="line-525"></span><span class="hs-comment">-- character.</span><span>
</span><span id="line-526"></span><span class="hs-comment">--</span><span>
</span><span id="line-527"></span><span class="hs-comment">-- /Since: 0.7.0 (&quot;Streamly.Data.Unicode.Stream&quot;)/</span><span>
</span><span id="line-528"></span><span class="hs-comment">--</span><span>
</span><span id="line-529"></span><span class="hs-comment">-- /Since: 0.8.0 (Lenient Behaviour)/</span><span>
</span><span id="line-530"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8"><span class="hs-pragma hs-type">decodeUtf8</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-531"></span><span id="local-6989586621679435396"><span id="local-6989586621679435397"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8"><span class="hs-identifier hs-type">decodeUtf8</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679435397"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435396"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435396"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435397"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435396"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435397"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span></span><span>
</span><span id="line-532"></span><span id="decodeUtf8"><span class="annot"><span class="annottext">decodeUtf8 :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *).
(Monad m, IsStream t) =&gt;
t m Word8 -&gt; t m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8"><span class="hs-identifier hs-var hs-var">decodeUtf8</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; Stream m Word8 -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8D"><span class="hs-identifier hs-var">decodeUtf8D</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span>
</span><span id="line-533"></span><span>
</span><span id="line-534"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8D%27"><span class="hs-pragma hs-type">decodeUtf8D'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-535"></span><span id="local-6989586621679434421"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8D%27"><span class="hs-identifier hs-type">decodeUtf8D'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679434421"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434421"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434421"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span><span>
</span><span id="line-536"></span><span id="decodeUtf8D%27"><span class="annot"><span class="annottext">decodeUtf8D' :: forall (m :: * -&gt; *). Monad m =&gt; Stream m Word8 -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8D%27"><span class="hs-identifier hs-var hs-var">decodeUtf8D'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
CodingFailureMode -&gt; Stream m Word8 -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8WithD"><span class="hs-identifier hs-var">decodeUtf8WithD</span></a></span><span> </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#ErrorOnCodingFailure"><span class="hs-identifier hs-var">ErrorOnCodingFailure</span></a></span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span class="hs-comment">-- | Decode a UTF-8 encoded bytestream to a stream of Unicode characters.</span><span>
</span><span id="line-539"></span><span class="hs-comment">-- The function throws an error if an invalid codepoint is encountered.</span><span>
</span><span id="line-540"></span><span class="hs-comment">--</span><span>
</span><span id="line-541"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-542"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8%27"><span class="hs-pragma hs-type">decodeUtf8'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-543"></span><span id="local-6989586621679434417"><span id="local-6989586621679434418"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8%27"><span class="hs-identifier hs-type">decodeUtf8'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679434418"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434417"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434417"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434418"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434417"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434418"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span></span><span>
</span><span id="line-544"></span><span id="decodeUtf8%27"><span class="annot"><span class="annottext">decodeUtf8' :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *).
(Monad m, IsStream t) =&gt;
t m Word8 -&gt; t m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8%27"><span class="hs-identifier hs-var hs-var">decodeUtf8'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; Stream m Word8 -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8D%27"><span class="hs-identifier hs-var">decodeUtf8D'</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8D_"><span class="hs-pragma hs-type">decodeUtf8D_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-547"></span><span id="local-6989586621679434409"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8D_"><span class="hs-identifier hs-type">decodeUtf8D_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679434409"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434409"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434409"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span><span>
</span><span id="line-548"></span><span id="decodeUtf8D_"><span class="annot"><span class="annottext">decodeUtf8D_ :: forall (m :: * -&gt; *). Monad m =&gt; Stream m Word8 -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8D_"><span class="hs-identifier hs-var hs-var">decodeUtf8D_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
CodingFailureMode -&gt; Stream m Word8 -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8WithD"><span class="hs-identifier hs-var">decodeUtf8WithD</span></a></span><span> </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#DropOnCodingFailure"><span class="hs-identifier hs-var">DropOnCodingFailure</span></a></span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span class="hs-comment">-- | Decode a UTF-8 encoded bytestream to a stream of Unicode characters.</span><span>
</span><span id="line-551"></span><span class="hs-comment">-- Any invalid codepoint encountered is dropped.</span><span>
</span><span id="line-552"></span><span class="hs-comment">--</span><span>
</span><span id="line-553"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-554"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8_"><span class="hs-pragma hs-type">decodeUtf8_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-555"></span><span id="local-6989586621679434405"><span id="local-6989586621679434406"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8_"><span class="hs-identifier hs-type">decodeUtf8_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679434406"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434405"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434405"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434406"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434405"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434406"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span></span><span>
</span><span id="line-556"></span><span id="decodeUtf8_"><span class="annot"><span class="annottext">decodeUtf8_ :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *).
(Monad m, IsStream t) =&gt;
t m Word8 -&gt; t m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8_"><span class="hs-identifier hs-var hs-var">decodeUtf8_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; Stream m Word8 -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8D_"><span class="hs-identifier hs-var">decodeUtf8D_</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="hs-comment">-- | Same as 'decodeUtf8'</span><span>
</span><span id="line-559"></span><span class="hs-comment">--</span><span>
</span><span id="line-560"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">decodeUtf8Lax</span><span> </span><span class="hs-pragma">&quot;Please use 'decodeUtf8' instead&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-561"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Lax"><span class="hs-pragma hs-type">decodeUtf8Lax</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-562"></span><span id="local-6989586621679434396"><span id="local-6989586621679434397"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Lax"><span class="hs-identifier hs-type">decodeUtf8Lax</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434397"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679434396"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434397"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434396"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434397"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434396"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span></span><span>
</span><span id="line-563"></span><span id="decodeUtf8Lax"><span class="annot"><span class="annottext">decodeUtf8Lax :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *).
(IsStream t, Monad m) =&gt;
t m Word8 -&gt; t m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Lax"><span class="hs-identifier hs-var hs-var">decodeUtf8Lax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *).
(Monad m, IsStream t) =&gt;
t m Word8 -&gt; t m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8"><span class="hs-identifier hs-var">decodeUtf8</span></a></span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-566"></span><span class="hs-comment">-- Decoding Array Streams</span><span>
</span><span id="line-567"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span class="hs-cpp">

#ifndef __GHCJS__
</span><span class="hs-pragma">{-# ANN</span><span> </span><span class="hs-pragma">type</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#FlattenState"><span class="hs-pragma hs-type">FlattenState</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Fuse</span></span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">data</span><span> </span><span id="FlattenState"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#FlattenState"><span class="hs-identifier hs-var">FlattenState</span></a></span></span><span> </span><span id="local-6989586621679435378"><span class="annot"><a href="#local-6989586621679435378"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679435377"><span class="annot"><a href="#local-6989586621679435377"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-573"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="OuterLoop"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#OuterLoop"><span class="hs-identifier hs-var">OuterLoop</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679435378"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeState"><span class="hs-identifier hs-type">DecodeState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#CodePoint"><span class="hs-identifier hs-type">CodePoint</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="InnerLoopDecodeInit"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecodeInit"><span class="hs-identifier hs-var">InnerLoopDecodeInit</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679435378"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Mut.Type.html#ArrayContents"><span class="hs-identifier hs-type">ArrayContents</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="#local-6989586621679435377"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="#local-6989586621679435377"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="InnerLoopDecodeFirst"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecodeFirst"><span class="hs-identifier hs-var">InnerLoopDecodeFirst</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679435378"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Mut.Type.html#ArrayContents"><span class="hs-identifier hs-type">ArrayContents</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="#local-6989586621679435377"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="#local-6989586621679435377"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span>
</span><span id="line-576"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="InnerLoopDecoding"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecoding"><span class="hs-identifier hs-var">InnerLoopDecoding</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679435378"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Mut.Type.html#ArrayContents"><span class="hs-identifier hs-type">ArrayContents</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="#local-6989586621679435377"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="#local-6989586621679435377"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>        </span><span class="hs-glyph">!</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DecodeState"><span class="hs-identifier hs-type">DecodeState</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#CodePoint"><span class="hs-identifier hs-type">CodePoint</span></a></span><span>
</span><span id="line-578"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="YAndC"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#YAndC"><span class="hs-identifier hs-var">YAndC</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#FlattenState"><span class="hs-identifier hs-type">FlattenState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435378"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435377"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- These constructors can be</span><span>
</span><span id="line-579"></span><span>                                     </span><span class="hs-comment">-- encoded in the UTF8DecodeState</span><span>
</span><span id="line-580"></span><span>                                     </span><span class="hs-comment">-- type, I prefer to keep these</span><span>
</span><span id="line-581"></span><span>                                     </span><span class="hs-comment">-- flat even though that means</span><span>
</span><span id="line-582"></span><span>                                     </span><span class="hs-comment">-- coming up with new names</span><span>
</span><span id="line-583"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="D"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#D"><span class="hs-identifier hs-var">D</span></a></span></span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span class="hs-comment">-- The normal decodeUtf8 above should fuse with flattenArrays</span><span>
</span><span id="line-586"></span><span class="hs-comment">-- to create this exact code but it doesn't for some reason, as of now this</span><span>
</span><span id="line-587"></span><span class="hs-comment">-- remains the fastest way I could figure out to decodeUtf8.</span><span>
</span><span id="line-588"></span><span class="hs-comment">--</span><span>
</span><span id="line-589"></span><span class="hs-comment">-- XXX Add Proper error messages</span><span>
</span><span id="line-590"></span><span class="hs-pragma">{-# INLINE_NORMAL decodeUtf8ArraysWithD #-}</span><span>
</span><span id="line-591"></span><span id="local-6989586621679435385"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysWithD"><span class="hs-identifier hs-type">decodeUtf8ArraysWithD</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-592"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679435385"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-593"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#CodingFailureMode"><span class="hs-identifier hs-type">CodingFailureMode</span></a></span><span>
</span><span id="line-594"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435385"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">A.Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435385"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span><span>
</span><span id="line-596"></span><span id="decodeUtf8ArraysWithD"><span class="annot"><span class="annottext">decodeUtf8ArraysWithD :: forall (m :: * -&gt; *).
MonadIO m =&gt;
CodingFailureMode -&gt; Stream m (Array Word8) -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysWithD"><span class="hs-identifier hs-var hs-var">decodeUtf8ArraysWithD</span></a></span></span><span> </span><span id="local-6989586621679434381"><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="#local-6989586621679434381"><span class="hs-identifier hs-var">cfm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span id="local-6989586621679434380"><span class="annot"><span class="annottext">State Stream m (Array Word8) -&gt; s -&gt; m (Step s (Array Word8))
</span><a href="#local-6989586621679434380"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span id="local-6989586621679434379"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434379"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-597"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">A.Array</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayContents
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679434378"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434378"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#utf8d"><span class="hs-identifier hs-var">utf8d</span></a></span><span>
</span><span id="line-598"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a s.
(State Stream m a -&gt; s -&gt; m (Step s a)) -&gt; s -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-var">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {a}.
Ptr Word8
-&gt; State Stream m a
-&gt; FlattenState s Word8
-&gt; m (Step (FlattenState s Word8) Char)
</span><a href="#local-6989586621679434377"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434378"><span class="hs-identifier hs-var">ptr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Maybe (Word8, Int) -&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#OuterLoop"><span class="hs-identifier hs-var">OuterLoop</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434379"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-600"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679434376"><span class="hs-pragma hs-type">transliterateOrError</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-601"></span><span>    </span><span id="local-6989586621679434376"><span class="annot"><span class="annottext">transliterateOrError :: [Char] -&gt; FlattenState s a -&gt; FlattenState s a
</span><a href="#local-6989586621679434376"><span class="hs-identifier hs-var hs-var">transliterateOrError</span></a></span></span><span> </span><span id="local-6989586621679434373"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679434373"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679434372"><span class="annot"><span class="annottext">FlattenState s a
</span><a href="#local-6989586621679434372"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-602"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="#local-6989586621679434381"><span class="hs-identifier hs-var">cfm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-603"></span><span>            </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#ErrorOnCodingFailure"><span class="hs-identifier hs-var">ErrorOnCodingFailure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679434373"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-604"></span><span>            </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#TransliterateCodingFailure"><span class="hs-identifier hs-var">TransliterateCodingFailure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. Char -&gt; FlattenState s a -&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#YAndC"><span class="hs-identifier hs-var">YAndC</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="Streamly.Internal.Unicode.Stream.html#replacementChar"><span class="hs-identifier hs-var">replacementChar</span></a></span><span> </span><span class="annot"><span class="annottext">FlattenState s a
</span><a href="#local-6989586621679434372"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-605"></span><span>            </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#DropOnCodingFailure"><span class="hs-identifier hs-var">DropOnCodingFailure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FlattenState s a
</span><a href="#local-6989586621679434372"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-606"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679434371"><span class="hs-pragma hs-type">inputUnderflow</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-607"></span><span>    </span><span id="local-6989586621679434371"><span class="annot"><span class="annottext">inputUnderflow :: FlattenState s a
</span><a href="#local-6989586621679434371"><span class="hs-identifier hs-var hs-var">inputUnderflow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-608"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="#local-6989586621679434381"><span class="hs-identifier hs-var">cfm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-609"></span><span>            </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#ErrorOnCodingFailure"><span class="hs-identifier hs-var">ErrorOnCodingFailure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-610"></span><span>                </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-611"></span><span>                </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Streamly.Internal.Data.Stream.StreamD.&quot;</span></span><span>
</span><span id="line-612"></span><span>                </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;decodeUtf8ArraysWith: Input Underflow&quot;</span></span><span>
</span><span id="line-613"></span><span>            </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#TransliterateCodingFailure"><span class="hs-identifier hs-var">TransliterateCodingFailure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. Char -&gt; FlattenState s a -&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#YAndC"><span class="hs-identifier hs-var">YAndC</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="Streamly.Internal.Unicode.Stream.html#replacementChar"><span class="hs-identifier hs-var">replacementChar</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#D"><span class="hs-identifier hs-var">D</span></a></span><span>
</span><span id="line-614"></span><span>            </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#DropOnCodingFailure"><span class="hs-identifier hs-var">DropOnCodingFailure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#D"><span class="hs-identifier hs-var">D</span></a></span><span>
</span><span id="line-615"></span><span>    </span><span class="hs-pragma">{-# INLINE_LATE step' #-}</span><span>
</span><span id="line-616"></span><span>    </span><span id="local-6989586621679434377"><span class="annot"><span class="annottext">step' :: Ptr Word8
-&gt; State Stream m a
-&gt; FlattenState s Word8
-&gt; m (Step (FlattenState s Word8) Char)
</span><a href="#local-6989586621679434377"><span class="hs-identifier hs-var hs-var">step'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679434325"><span class="annot"><span class="annottext">State Stream m a
</span><a href="#local-6989586621679434325"><span class="hs-identifier hs-var">gst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#OuterLoop"><span class="hs-identifier hs-type">OuterLoop</span></a></span><span> </span><span id="local-6989586621679434324"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434324"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (Word8, Int)
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-617"></span><span>        </span><span id="local-6989586621679434323"><span class="annot"><span class="annottext">Step s (Array Word8)
</span><a href="#local-6989586621679434323"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State Stream m (Array Word8) -&gt; s -&gt; m (Step s (Array Word8))
</span><a href="#local-6989586621679434380"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a (n :: * -&gt; *) b.
State t m a -&gt; State t n b
</span><a href="Streamly.Internal.Data.SVar.Type.html#adaptState"><span class="hs-identifier hs-var">adaptState</span></a></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><a href="#local-6989586621679434325"><span class="hs-identifier hs-var">gst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434324"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-618"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-619"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step s (Array Word8)
</span><a href="#local-6989586621679434323"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-620"></span><span>                </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">A.Array</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679434320"><span id="local-6989586621679434321"><span id="local-6989586621679434322"><span class="annot"><span class="annottext">Ptr Word8
ArrayContents
aEnd :: forall a. Array a -&gt; Ptr a
arrStart :: forall a. Array a -&gt; Ptr a
arrContents :: forall a. Array a -&gt; ArrayContents
aEnd :: Ptr Word8
arrStart :: Ptr Word8
arrContents :: ArrayContents
</span><a href="Streamly.Internal.Data.Array.Foreign.Type.html#aEnd"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679434316"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434316"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-621"></span><span>                     </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a.
s -&gt; ArrayContents -&gt; Ptr a -&gt; Ptr a -&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecodeInit"><span class="hs-identifier hs-var">InnerLoopDecodeInit</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434316"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621679434322"><span class="hs-identifier hs-var">arrContents</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434321"><span class="hs-identifier hs-var">arrStart</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434320"><span class="hs-identifier hs-var">aEnd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>                </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-type">Skip</span></a></span><span> </span><span id="local-6989586621679434315"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434315"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Maybe (Word8, Int) -&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#OuterLoop"><span class="hs-identifier hs-var">OuterLoop</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434315"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>                </span><span class="annot"><span class="annottext">Step s (Array Word8)
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#D"><span class="hs-identifier hs-var">D</span></a></span><span>
</span><span id="line-624"></span><span>    </span><span class="annot"><a href="#local-6989586621679434377"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679434314"><span class="annot"><span class="annottext">State Stream m a
</span><a href="#local-6989586621679434314"><span class="hs-identifier hs-var">gst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#OuterLoop"><span class="hs-identifier hs-type">OuterLoop</span></a></span><span> </span><span id="local-6989586621679434313"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434313"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679434312"><span class="annot"><span class="annottext">dst :: Maybe (Word8, Int)
</span><a href="#local-6989586621679434312"><span class="hs-identifier hs-var">dst</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679434311"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434311"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679434310"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434310"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-625"></span><span>        </span><span id="local-6989586621679434309"><span class="annot"><span class="annottext">Step s (Array Word8)
</span><a href="#local-6989586621679434309"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State Stream m (Array Word8) -&gt; s -&gt; m (Step s (Array Word8))
</span><a href="#local-6989586621679434380"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a (n :: * -&gt; *) b.
State t m a -&gt; State t n b
</span><a href="Streamly.Internal.Data.SVar.Type.html#adaptState"><span class="hs-identifier hs-var">adaptState</span></a></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><a href="#local-6989586621679434314"><span class="hs-identifier hs-var">gst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434313"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-626"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-627"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step s (Array Word8)
</span><a href="#local-6989586621679434309"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-628"></span><span>                </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">A.Array</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679434306"><span id="local-6989586621679434307"><span id="local-6989586621679434308"><span class="annot"><span class="annottext">Ptr Word8
ArrayContents
aEnd :: Ptr Word8
arrStart :: Ptr Word8
arrContents :: ArrayContents
aEnd :: forall a. Array a -&gt; Ptr a
arrStart :: forall a. Array a -&gt; Ptr a
arrContents :: forall a. Array a -&gt; ArrayContents
</span><a href="#local-6989586621679434306"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679434305"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434305"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-629"></span><span>                     </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a.
s
-&gt; ArrayContents
-&gt; Ptr a
-&gt; Ptr a
-&gt; Word8
-&gt; Int
-&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecoding"><span class="hs-identifier hs-var">InnerLoopDecoding</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434305"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621679434308"><span class="hs-identifier hs-var">arrContents</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434307"><span class="hs-identifier hs-var">arrStart</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434306"><span class="hs-identifier hs-var">aEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434311"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434310"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>                </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-type">Skip</span></a></span><span> </span><span id="local-6989586621679434304"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434304"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Maybe (Word8, Int) -&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#OuterLoop"><span class="hs-identifier hs-var">OuterLoop</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434304"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Word8, Int)
</span><a href="#local-6989586621679434312"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span>                </span><span class="annot"><span class="annottext">Step s (Array Word8)
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. FlattenState s a
</span><a href="#local-6989586621679434371"><span class="hs-identifier hs-var">inputUnderflow</span></a></span><span>
</span><span id="line-632"></span><span>    </span><span class="annot"><a href="#local-6989586621679434377"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecodeInit"><span class="hs-identifier hs-type">InnerLoopDecodeInit</span></a></span><span> </span><span id="local-6989586621679434303"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434303"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679434302"><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621679434302"><span class="hs-identifier hs-var">startf</span></a></span></span><span> </span><span id="local-6989586621679434301"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434301"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679434300"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434300"><span class="hs-identifier hs-var">end</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434301"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434300"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-634"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArrayContents -&gt; IO ()
</span><a href="Streamly.Internal.Data.Array.Foreign.Mut.Type.html#touch"><span class="hs-identifier hs-var">touch</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621679434302"><span class="hs-identifier hs-var">startf</span></a></span><span>
</span><span id="line-635"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Maybe (Word8, Int) -&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#OuterLoop"><span class="hs-identifier hs-var">OuterLoop</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434303"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-636"></span><span>    </span><span class="annot"><a href="#local-6989586621679434377"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecodeInit"><span class="hs-identifier hs-type">InnerLoopDecodeInit</span></a></span><span> </span><span id="local-6989586621679434299"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434299"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679434298"><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621679434298"><span class="hs-identifier hs-var">startf</span></a></span></span><span> </span><span id="local-6989586621679434297"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434297"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679434296"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434296"><span class="hs-identifier hs-var">end</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-637"></span><span>        </span><span id="local-6989586621679434295"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434295"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434297"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-638"></span><span>        </span><span class="hs-comment">-- Note: It is important to use a &quot;&gt;&quot; instead of a &quot;&lt;=&quot; test here for</span><span>
</span><span id="line-639"></span><span>        </span><span class="hs-comment">-- GHC to generate code layout for default branch prediction for the</span><span>
</span><span id="line-640"></span><span>        </span><span class="hs-comment">-- common case. This is fragile and might change with the compiler</span><span>
</span><span id="line-641"></span><span>        </span><span class="hs-comment">-- versions, we need a more reliable &quot;likely&quot; primitive to control</span><span>
</span><span id="line-642"></span><span>        </span><span class="hs-comment">-- branch predication.</span><span>
</span><span id="line-643"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434295"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x7f</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-644"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-645"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. Char -&gt; FlattenState s a -&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#YAndC"><span class="hs-identifier hs-var">YAndC</span></a></span><span>
</span><span id="line-646"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Char
</span><span class="hs-identifier hs-var">unsafeChr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434295"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a.
s -&gt; ArrayContents -&gt; Ptr a -&gt; Ptr a -&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecodeInit"><span class="hs-identifier hs-var">InnerLoopDecodeInit</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434299"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621679434298"><span class="hs-identifier hs-var">startf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434297"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434296"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>            </span><span class="hs-comment">-- Using a separate state here generates a jump to a separate code</span><span>
</span><span id="line-649"></span><span>            </span><span class="hs-comment">-- block in the core which seems to perform slightly better for the</span><span>
</span><span id="line-650"></span><span>            </span><span class="hs-comment">-- non-ascii case.</span><span>
</span><span id="line-651"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a.
s -&gt; ArrayContents -&gt; Ptr a -&gt; Ptr a -&gt; Word8 -&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecodeFirst"><span class="hs-identifier hs-var">InnerLoopDecodeFirst</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434299"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621679434298"><span class="hs-identifier hs-var">startf</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434297"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434296"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434295"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span>    </span><span class="annot"><a href="#local-6989586621679434377"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span id="local-6989586621679434293"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434293"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecodeFirst"><span class="hs-identifier hs-type">InnerLoopDecodeFirst</span></a></span><span> </span><span id="local-6989586621679434292"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434292"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679434291"><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621679434291"><span class="hs-identifier hs-var">startf</span></a></span></span><span> </span><span id="local-6989586621679434290"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434290"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679434289"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434289"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span id="local-6989586621679434288"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434288"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-654"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-type">Tuple'</span></a></span><span> </span><span id="local-6989586621679434287"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434287"><span class="hs-identifier hs-var">sv</span></a></span></span><span> </span><span id="local-6989586621679434286"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434286"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Word8 -&gt; Tuple' Word8 Int
</span><a href="Streamly.Internal.Unicode.Stream.html#decode0"><span class="hs-identifier hs-var">decode0</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434293"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434288"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-655"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-656"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434287"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-657"></span><span>                </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-658"></span><span>                    </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-659"></span><span>                    </span><span class="annot"><span class="annottext">forall {s} {a}. [Char] -&gt; FlattenState s a -&gt; FlattenState s a
</span><a href="#local-6989586621679434376"><span class="hs-identifier hs-var">transliterateOrError</span></a></span><span>
</span><span id="line-660"></span><span>                        </span><span class="hs-special">(</span><span>
</span><span id="line-661"></span><span>                           </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Streamly.Internal.Data.Stream.StreamD.&quot;</span></span><span>
</span><span id="line-662"></span><span>                        </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;decodeUtf8ArraysWith: Invalid UTF8&quot;</span></span><span>
</span><span id="line-663"></span><span>                        </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; codepoint encountered&quot;</span></span><span>
</span><span id="line-664"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-665"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a.
s -&gt; ArrayContents -&gt; Ptr a -&gt; Ptr a -&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecodeInit"><span class="hs-identifier hs-var">InnerLoopDecodeInit</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434292"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621679434291"><span class="hs-identifier hs-var">startf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434290"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434289"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-666"></span><span>                </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unreachable state&quot;</span></span><span>
</span><span id="line-667"></span><span>                </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a.
s
-&gt; ArrayContents
-&gt; Ptr a
-&gt; Ptr a
-&gt; Word8
-&gt; Int
-&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecoding"><span class="hs-identifier hs-var">InnerLoopDecoding</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434292"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621679434291"><span class="hs-identifier hs-var">startf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434290"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434289"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434287"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434286"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>    </span><span class="annot"><a href="#local-6989586621679434377"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecoding"><span class="hs-identifier hs-type">InnerLoopDecoding</span></a></span><span> </span><span id="local-6989586621679434285"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434285"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679434284"><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621679434284"><span class="hs-identifier hs-var">startf</span></a></span></span><span> </span><span id="local-6989586621679434283"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434283"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679434282"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434282"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span id="local-6989586621679434281"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434281"><span class="hs-identifier hs-var">sv</span></a></span></span><span> </span><span id="local-6989586621679434280"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434280"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434283"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434282"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-670"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArrayContents -&gt; IO ()
</span><a href="Streamly.Internal.Data.Array.Foreign.Mut.Type.html#touch"><span class="hs-identifier hs-var">touch</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621679434284"><span class="hs-identifier hs-var">startf</span></a></span><span>
</span><span id="line-671"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Maybe (Word8, Int) -&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#OuterLoop"><span class="hs-identifier hs-var">OuterLoop</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434285"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434281"><span class="hs-identifier hs-var">sv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434280"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-672"></span><span>    </span><span class="annot"><a href="#local-6989586621679434377"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span id="local-6989586621679434279"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434279"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecoding"><span class="hs-identifier hs-type">InnerLoopDecoding</span></a></span><span> </span><span id="local-6989586621679434278"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434278"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679434277"><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621679434277"><span class="hs-identifier hs-var">startf</span></a></span></span><span> </span><span id="local-6989586621679434276"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434276"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679434275"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434275"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span id="local-6989586621679434274"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434274"><span class="hs-identifier hs-var">statePtr</span></a></span></span><span> </span><span id="local-6989586621679434273"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434273"><span class="hs-identifier hs-var">codepointPtr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-673"></span><span>        </span><span id="local-6989586621679434272"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434272"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434276"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-674"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-type">Tuple'</span></a></span><span> </span><span id="local-6989586621679434271"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434271"><span class="hs-identifier hs-var">sv</span></a></span></span><span> </span><span id="local-6989586621679434270"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434270"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Word8 -&gt; Int -&gt; Word8 -&gt; Tuple' Word8 Int
</span><a href="Streamly.Internal.Unicode.Stream.html#decode1"><span class="hs-identifier hs-var">decode1</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434279"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434274"><span class="hs-identifier hs-var">statePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434273"><span class="hs-identifier hs-var">codepointPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434272"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-675"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-676"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434271"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-677"></span><span>                </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-678"></span><span>                    </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-679"></span><span>                    </span><span class="annot"><span class="annottext">forall s a. Char -&gt; FlattenState s a -&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#YAndC"><span class="hs-identifier hs-var">YAndC</span></a></span><span>
</span><span id="line-680"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Char
</span><span class="hs-identifier hs-var">unsafeChr</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434270"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a.
s -&gt; ArrayContents -&gt; Ptr a -&gt; Ptr a -&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecodeInit"><span class="hs-identifier hs-var">InnerLoopDecodeInit</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434278"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621679434277"><span class="hs-identifier hs-var">startf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434276"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434275"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-682"></span><span>                </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">12</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-683"></span><span>                    </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-684"></span><span>                    </span><span class="annot"><span class="annottext">forall {s} {a}. [Char] -&gt; FlattenState s a -&gt; FlattenState s a
</span><a href="#local-6989586621679434376"><span class="hs-identifier hs-var">transliterateOrError</span></a></span><span>
</span><span id="line-685"></span><span>                        </span><span class="hs-special">(</span><span>
</span><span id="line-686"></span><span>                           </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Streamly.Internal.Data.Stream.StreamD.&quot;</span></span><span>
</span><span id="line-687"></span><span>                        </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;decodeUtf8ArraysWith: Invalid UTF8&quot;</span></span><span>
</span><span id="line-688"></span><span>                        </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; codepoint encountered&quot;</span></span><span>
</span><span id="line-689"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-690"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a.
s -&gt; ArrayContents -&gt; Ptr a -&gt; Ptr a -&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecodeInit"><span class="hs-identifier hs-var">InnerLoopDecodeInit</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434278"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621679434277"><span class="hs-identifier hs-var">startf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434276"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434275"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>                </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-692"></span><span>                    </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span>
</span><span id="line-693"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a.
s
-&gt; ArrayContents
-&gt; Ptr a
-&gt; Ptr a
-&gt; Word8
-&gt; Int
-&gt; FlattenState s a
</span><a href="Streamly.Internal.Unicode.Stream.html#InnerLoopDecoding"><span class="hs-identifier hs-var">InnerLoopDecoding</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434278"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621679434277"><span class="hs-identifier hs-var">startf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434276"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679434275"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434271"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434270"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-694"></span><span>    </span><span class="annot"><a href="#local-6989586621679434377"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#YAndC"><span class="hs-identifier hs-type">YAndC</span></a></span><span> </span><span id="local-6989586621679434269"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434269"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679434268"><span class="annot"><span class="annottext">FlattenState s Word8
</span><a href="#local-6989586621679434268"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434269"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">FlattenState s Word8
</span><a href="#local-6989586621679434268"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-695"></span><span>    </span><span class="annot"><a href="#local-6989586621679434377"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FlattenState s Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#D"><span class="hs-identifier hs-var">D</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall s a. Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span>
</span><span id="line-696"></span><span>
</span><span id="line-697"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysD"><span class="hs-pragma hs-type">decodeUtf8ArraysD</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-698"></span><span id="local-6989586621679435368"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysD"><span class="hs-identifier hs-type">decodeUtf8ArraysD</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-699"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679435368"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-700"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435368"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">A.Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435368"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span><span>
</span><span id="line-702"></span><span id="decodeUtf8ArraysD"><span class="annot"><span class="annottext">decodeUtf8ArraysD :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Stream m (Array Word8) -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysD"><span class="hs-identifier hs-var hs-var">decodeUtf8ArraysD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
CodingFailureMode -&gt; Stream m (Array Word8) -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysWithD"><span class="hs-identifier hs-var">decodeUtf8ArraysWithD</span></a></span><span> </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#TransliterateCodingFailure"><span class="hs-identifier hs-var">TransliterateCodingFailure</span></a></span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-705"></span><span class="hs-comment">--</span><span>
</span><span id="line-706"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-707"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Arrays"><span class="hs-pragma hs-type">decodeUtf8Arrays</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-708"></span><span id="local-6989586621679435365"><span id="local-6989586621679435366"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Arrays"><span class="hs-identifier hs-type">decodeUtf8Arrays</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-709"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679435366"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435365"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435365"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435366"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435365"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435366"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span></span><span>
</span><span id="line-710"></span><span id="decodeUtf8Arrays"><span class="annot"><span class="annottext">decodeUtf8Arrays :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *).
(MonadIO m, IsStream t) =&gt;
t m (Array Word8) -&gt; t m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Arrays"><span class="hs-identifier hs-var hs-var">decodeUtf8Arrays</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-711"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Stream m (Array Word8) -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysD"><span class="hs-identifier hs-var">decodeUtf8ArraysD</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span>
</span><span id="line-712"></span><span>
</span><span id="line-713"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysD%27"><span class="hs-pragma hs-type">decodeUtf8ArraysD'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-714"></span><span id="local-6989586621679434257"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysD%27"><span class="hs-identifier hs-type">decodeUtf8ArraysD'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-715"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679434257"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-716"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434257"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">A.Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434257"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span><span>
</span><span id="line-718"></span><span id="decodeUtf8ArraysD%27"><span class="annot"><span class="annottext">decodeUtf8ArraysD' :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Stream m (Array Word8) -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysD%27"><span class="hs-identifier hs-var hs-var">decodeUtf8ArraysD'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
CodingFailureMode -&gt; Stream m (Array Word8) -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysWithD"><span class="hs-identifier hs-var">decodeUtf8ArraysWithD</span></a></span><span> </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#ErrorOnCodingFailure"><span class="hs-identifier hs-var">ErrorOnCodingFailure</span></a></span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-721"></span><span class="hs-comment">--</span><span>
</span><span id="line-722"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-723"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Arrays%27"><span class="hs-pragma hs-type">decodeUtf8Arrays'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-724"></span><span id="local-6989586621679434253"><span id="local-6989586621679434254"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Arrays%27"><span class="hs-identifier hs-type">decodeUtf8Arrays'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679434254"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434253"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434253"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434254"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434253"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434254"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span></span><span>
</span><span id="line-725"></span><span id="decodeUtf8Arrays%27"><span class="annot"><span class="annottext">decodeUtf8Arrays' :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *).
(MonadIO m, IsStream t) =&gt;
t m (Array Word8) -&gt; t m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Arrays%27"><span class="hs-identifier hs-var hs-var">decodeUtf8Arrays'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Stream m (Array Word8) -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysD%27"><span class="hs-identifier hs-var">decodeUtf8ArraysD'</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span>
</span><span id="line-726"></span><span>
</span><span id="line-727"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysD_"><span class="hs-pragma hs-type">decodeUtf8ArraysD_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-728"></span><span id="local-6989586621679434244"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysD_"><span class="hs-identifier hs-type">decodeUtf8ArraysD_</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-729"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679434244"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-730"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434244"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">A.Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434244"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span><span>
</span><span id="line-732"></span><span id="decodeUtf8ArraysD_"><span class="annot"><span class="annottext">decodeUtf8ArraysD_ :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Stream m (Array Word8) -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysD_"><span class="hs-identifier hs-var hs-var">decodeUtf8ArraysD_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
CodingFailureMode -&gt; Stream m (Array Word8) -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysWithD"><span class="hs-identifier hs-var">decodeUtf8ArraysWithD</span></a></span><span> </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="Streamly.Internal.Unicode.Stream.html#DropOnCodingFailure"><span class="hs-identifier hs-var">DropOnCodingFailure</span></a></span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-735"></span><span class="hs-comment">--</span><span>
</span><span id="line-736"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-737"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Arrays_"><span class="hs-pragma hs-type">decodeUtf8Arrays_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-738"></span><span id="local-6989586621679434240"><span id="local-6989586621679434241"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Arrays_"><span class="hs-identifier hs-type">decodeUtf8Arrays_</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-739"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679434241"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434240"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434240"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434241"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434240"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434241"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span></span><span>
</span><span id="line-740"></span><span id="decodeUtf8Arrays_"><span class="annot"><span class="annottext">decodeUtf8Arrays_ :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *).
(MonadIO m, IsStream t) =&gt;
t m (Array Word8) -&gt; t m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8Arrays_"><span class="hs-identifier hs-var hs-var">decodeUtf8Arrays_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-741"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Stream m (Array Word8) -&gt; Stream m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#decodeUtf8ArraysD_"><span class="hs-identifier hs-var">decodeUtf8ArraysD_</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span>
</span><span id="line-742"></span><span>
</span><span id="line-743"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-744"></span><span class="hs-comment">-- Encoding Unicode (UTF-8) Characters</span><span>
</span><span id="line-745"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-746"></span><span>
</span><span id="line-747"></span><span class="hs-keyword">data</span><span> </span><span id="WList"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#WList"><span class="hs-identifier hs-var">WList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WCons"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#WCons"><span class="hs-identifier hs-var">WCons</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#WList"><span class="hs-identifier hs-type">WList</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="WNil"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#WNil"><span class="hs-identifier hs-var">WNil</span></a></span></span><span>
</span><span id="line-748"></span><span>
</span><span id="line-749"></span><span class="hs-comment">-- UTF-8 primitives, Lifted from GHC.IO.Encoding.UTF8.</span><span>
</span><span id="line-750"></span><span>
</span><span id="line-751"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#ord2"><span class="hs-pragma hs-type">ord2</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-752"></span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#ord2"><span class="hs-identifier hs-type">ord2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#WList"><span class="hs-identifier hs-type">WList</span></a></span><span>
</span><span id="line-753"></span><span id="ord2"><span class="annot"><span class="annottext">ord2 :: Char -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#ord2"><span class="hs-identifier hs-var hs-var">ord2</span></a></span></span><span> </span><span id="local-6989586621679434228"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434228"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434227"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x80</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434227"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x07ff</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; WList -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WCons"><span class="hs-identifier hs-var">WCons</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434226"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; WList -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WCons"><span class="hs-identifier hs-var">WCons</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434225"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WNil"><span class="hs-identifier hs-var">WNil</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-754"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-755"></span><span>    </span><span id="local-6989586621679434227"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621679434227"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434228"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-756"></span><span>    </span><span id="local-6989586621679434226"><span class="annot"><span class="annottext">x1 :: Word8
</span><a href="#local-6989586621679434226"><span class="hs-identifier hs-var hs-var">x1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434227"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftR`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0xC0</span></span><span>
</span><span id="line-757"></span><span>    </span><span id="local-6989586621679434225"><span class="annot"><span class="annottext">x2 :: Word8
</span><a href="#local-6989586621679434225"><span class="hs-identifier hs-var hs-var">x2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434227"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x3F</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x80</span></span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#ord3"><span class="hs-pragma hs-type">ord3</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-760"></span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#ord3"><span class="hs-identifier hs-type">ord3</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#WList"><span class="hs-identifier hs-type">WList</span></a></span><span>
</span><span id="line-761"></span><span id="ord3"><span class="annot"><span class="annottext">ord3 :: Char -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#ord3"><span class="hs-identifier hs-var hs-var">ord3</span></a></span></span><span> </span><span id="local-6989586621679434212"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434212"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434211"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x0800</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434211"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0xffff</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; WList -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WCons"><span class="hs-identifier hs-var">WCons</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434210"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; WList -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WCons"><span class="hs-identifier hs-var">WCons</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434209"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; WList -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WCons"><span class="hs-identifier hs-var">WCons</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434208"><span class="hs-identifier hs-var">x3</span></a></span><span> </span><span class="annot"><span class="annottext">WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WNil"><span class="hs-identifier hs-var">WNil</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-762"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-763"></span><span>    </span><span id="local-6989586621679434211"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621679434211"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434212"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-764"></span><span>    </span><span id="local-6989586621679434210"><span class="annot"><span class="annottext">x1 :: Word8
</span><a href="#local-6989586621679434210"><span class="hs-identifier hs-var hs-var">x1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434211"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftR`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0xE0</span></span><span>
</span><span id="line-765"></span><span>    </span><span id="local-6989586621679434209"><span class="annot"><span class="annottext">x2 :: Word8
</span><a href="#local-6989586621679434209"><span class="hs-identifier hs-var hs-var">x2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434211"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftR`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x3F</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x80</span></span><span>
</span><span id="line-766"></span><span>    </span><span id="local-6989586621679434208"><span class="annot"><span class="annottext">x3 :: Word8
</span><a href="#local-6989586621679434208"><span class="hs-identifier hs-var hs-var">x3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434211"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x3F</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x80</span></span><span>
</span><span id="line-767"></span><span>
</span><span id="line-768"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#ord4"><span class="hs-pragma hs-type">ord4</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-769"></span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#ord4"><span class="hs-identifier hs-type">ord4</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#WList"><span class="hs-identifier hs-type">WList</span></a></span><span>
</span><span id="line-770"></span><span id="ord4"><span class="annot"><span class="annottext">ord4 :: Char -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#ord4"><span class="hs-identifier hs-var hs-var">ord4</span></a></span></span><span> </span><span id="local-6989586621679434188"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434188"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434187"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x10000</span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; WList -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WCons"><span class="hs-identifier hs-var">WCons</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434186"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; WList -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WCons"><span class="hs-identifier hs-var">WCons</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434185"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; WList -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WCons"><span class="hs-identifier hs-var">WCons</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434184"><span class="hs-identifier hs-var">x3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; WList -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WCons"><span class="hs-identifier hs-var">WCons</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434183"><span class="hs-identifier hs-var">x4</span></a></span><span> </span><span class="annot"><span class="annottext">WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WNil"><span class="hs-identifier hs-var">WNil</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-771"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-772"></span><span>    </span><span id="local-6989586621679434187"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621679434187"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434188"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-773"></span><span>    </span><span id="local-6989586621679434186"><span class="annot"><span class="annottext">x1 :: Word8
</span><a href="#local-6989586621679434186"><span class="hs-identifier hs-var hs-var">x1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434187"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftR`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">18</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0xF0</span></span><span>
</span><span id="line-774"></span><span>    </span><span id="local-6989586621679434185"><span class="annot"><span class="annottext">x2 :: Word8
</span><a href="#local-6989586621679434185"><span class="hs-identifier hs-var hs-var">x2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434187"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftR`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x3F</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x80</span></span><span>
</span><span id="line-775"></span><span>    </span><span id="local-6989586621679434184"><span class="annot"><span class="annottext">x3 :: Word8
</span><a href="#local-6989586621679434184"><span class="hs-identifier hs-var hs-var">x3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434187"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftR`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x3F</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x80</span></span><span>
</span><span id="line-776"></span><span>    </span><span id="local-6989586621679434183"><span class="annot"><span class="annottext">x4 :: Word8
</span><a href="#local-6989586621679434183"><span class="hs-identifier hs-var hs-var">x4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434187"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x3F</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x80</span></span><span class="hs-cpp">

#ifndef __GHCJS__
</span><span class="hs-pragma">{-# ANN</span><span> </span><span class="hs-pragma">type</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-pragma hs-type">EncodeState</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Fuse</span></span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">data</span><span> </span><span id="EncodeState"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-var">EncodeState</span></a></span></span><span> </span><span id="local-6989586621679435350"><span class="annot"><a href="#local-6989586621679435350"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="EncodeState"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-var">EncodeState</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679435350"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#WList"><span class="hs-identifier hs-type">WList</span></a></span><span class="hs-cpp">

#ifndef __GHCJS__
</span><span class="hs-pragma">{-# ANN</span><span> </span><span class="hs-pragma">type</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#InvalidAction"><span class="hs-pragma hs-type">InvalidAction</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Fuse</span></span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">data</span><span> </span><span id="InvalidAction"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#InvalidAction"><span class="hs-identifier hs-var">InvalidAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-787"></span><span>    </span><span id="DropInvalid"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#DropInvalid"><span class="hs-identifier hs-var">DropInvalid</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="ErrorInvalid"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#ErrorInvalid"><span class="hs-identifier hs-var">ErrorInvalid</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="IgnoreInvalid"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#IgnoreInvalid"><span class="hs-identifier hs-var">IgnoreInvalid</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="ReplaceInvalid"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#ReplaceInvalid"><span class="hs-identifier hs-var">ReplaceInvalid</span></a></span></span><span>
</span><span id="line-788"></span><span>
</span><span id="line-789"></span><span id="local-6989586621679435353"><span id="local-6989586621679435355"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#replaceInvalid"><span class="hs-identifier hs-type">replaceInvalid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679435355"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-type">EncodeState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435355"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679435353"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-790"></span><span id="replaceInvalid"><span class="annot"><span class="annottext">replaceInvalid :: forall s a. s -&gt; Step (EncodeState s) a
</span><a href="Streamly.Internal.Unicode.Stream.html#replaceInvalid"><span class="hs-identifier hs-var hs-var">replaceInvalid</span></a></span></span><span> </span><span id="local-6989586621679434148"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434148"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-791"></span><span>    </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. s -&gt; WList -&gt; EncodeState s
</span><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-var">EncodeState</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434148"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; WList -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WCons"><span class="hs-identifier hs-var">WCons</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">239</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; WList -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WCons"><span class="hs-identifier hs-var">WCons</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">191</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; WList -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WCons"><span class="hs-identifier hs-var">WCons</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">189</span></span><span> </span><span class="annot"><span class="annottext">WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WNil"><span class="hs-identifier hs-var">WNil</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-792"></span><span>
</span><span id="line-793"></span><span id="local-6989586621679434146"><span id="local-6989586621679434147"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#dropInvalid"><span class="hs-identifier hs-type">dropInvalid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679434147"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-type">EncodeState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434147"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679434146"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-794"></span><span id="dropInvalid"><span class="annot"><span class="annottext">dropInvalid :: forall s a. s -&gt; Step (EncodeState s) a
</span><a href="Streamly.Internal.Unicode.Stream.html#dropInvalid"><span class="hs-identifier hs-var hs-var">dropInvalid</span></a></span></span><span> </span><span id="local-6989586621679434144"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434144"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. s -&gt; WList -&gt; EncodeState s
</span><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-var">EncodeState</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434144"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WNil"><span class="hs-identifier hs-var">WNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-795"></span><span>
</span><span id="line-796"></span><span id="local-6989586621679434142"><span id="local-6989586621679434143"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#errorOnInvalid"><span class="hs-identifier hs-type">errorOnInvalid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679434143"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-type">EncodeState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434143"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679434142"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-797"></span><span id="errorOnInvalid"><span class="annot"><span class="annottext">errorOnInvalid :: forall s a. s -&gt; Step (EncodeState s) a
</span><a href="Streamly.Internal.Unicode.Stream.html#errorOnInvalid"><span class="hs-identifier hs-var hs-var">errorOnInvalid</span></a></span></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-798"></span><span>    </span><span class="annot"><span class="annottext">forall a. (?callStack::CallStack) =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-799"></span><span>    </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Streamly.Internal.Data.Stream.StreamD.encodeUtf8:&quot;</span></span><span>
</span><span id="line-800"></span><span>    </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Encountered a surrogate&quot;</span></span><span>
</span><span id="line-801"></span><span>
</span><span id="line-802"></span><span class="hs-pragma">{-# INLINE_NORMAL encodeUtf8DGeneric #-}</span><span>
</span><span id="line-803"></span><span id="local-6989586621679435346"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8DGeneric"><span class="hs-identifier hs-type">encodeUtf8DGeneric</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-804"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679435346"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-805"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#InvalidAction"><span class="hs-identifier hs-type">InvalidAction</span></a></span><span>
</span><span id="line-806"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435346"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>
</span><span id="line-807"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435346"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span></span><span>
</span><span id="line-808"></span><span id="encodeUtf8DGeneric"><span class="annot"><span class="annottext">encodeUtf8DGeneric :: forall (m :: * -&gt; *).
Monad m =&gt;
InvalidAction -&gt; Stream m Char -&gt; Stream m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8DGeneric"><span class="hs-identifier hs-var hs-var">encodeUtf8DGeneric</span></a></span></span><span> </span><span id="local-6989586621679434134"><span class="annot"><span class="annottext">InvalidAction
</span><a href="#local-6989586621679434134"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span id="local-6989586621679434133"><span class="annot"><span class="annottext">State Stream m Char -&gt; s -&gt; m (Step s Char)
</span><a href="#local-6989586621679434133"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span id="local-6989586621679434132"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434132"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-809"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a s.
(State Stream m a -&gt; s -&gt; m (Step s a)) -&gt; s -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-var">Stream</span></a></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {a}.
State Stream m a -&gt; EncodeState s -&gt; m (Step (EncodeState s) Word8)
</span><a href="#local-6989586621679434131"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. s -&gt; WList -&gt; EncodeState s
</span><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-var">EncodeState</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434132"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WNil"><span class="hs-identifier hs-var">WNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span>    </span><span class="hs-pragma">{-# INLINE_LATE step' #-}</span><span>
</span><span id="line-814"></span><span>    </span><span id="local-6989586621679434131"><span class="annot"><span class="annottext">step' :: State Stream m a -&gt; EncodeState s -&gt; m (Step (EncodeState s) Word8)
</span><a href="#local-6989586621679434131"><span class="hs-identifier hs-var hs-var">step'</span></a></span></span><span> </span><span id="local-6989586621679434119"><span class="annot"><span class="annottext">State Stream m a
</span><a href="#local-6989586621679434119"><span class="hs-identifier hs-var">gst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-type">EncodeState</span></a></span><span> </span><span id="local-6989586621679434118"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434118"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="annot"><span class="annottext">WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WNil"><span class="hs-identifier hs-var">WNil</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-815"></span><span>        </span><span id="local-6989586621679434117"><span class="annot"><span class="annottext">Step s Char
</span><a href="#local-6989586621679434117"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State Stream m Char -&gt; s -&gt; m (Step s Char)
</span><a href="#local-6989586621679434133"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a (n :: * -&gt; *) b.
State t m a -&gt; State t n b
</span><a href="Streamly.Internal.Data.SVar.Type.html#adaptState"><span class="hs-identifier hs-var">adaptState</span></a></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><a href="#local-6989586621679434119"><span class="hs-identifier hs-var">gst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434118"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-816"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-817"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step s Char
</span><a href="#local-6989586621679434117"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-818"></span><span>                </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679434116"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434116"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679434115"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434115"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-819"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434116"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-820"></span><span>                        </span><span id="local-6989586621679434114"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434114"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434114"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x7F</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-821"></span><span>                                </span><span class="annot"><span class="annottext">forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434114"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. s -&gt; WList -&gt; EncodeState s
</span><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-var">EncodeState</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434115"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WNil"><span class="hs-identifier hs-var">WNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-822"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434114"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x7FF</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. s -&gt; WList -&gt; EncodeState s
</span><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-var">EncodeState</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434115"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#ord2"><span class="hs-identifier hs-var">ord2</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434116"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-823"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679434114"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0xFFFF</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-824"></span><span>                                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InvalidAction
</span><a href="#local-6989586621679434134"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-825"></span><span>                                    </span><span class="annot"><span class="annottext">InvalidAction
</span><a href="Streamly.Internal.Unicode.Stream.html#DropInvalid"><span class="hs-identifier hs-var">DropInvalid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-826"></span><span>                                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isSurrogate</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434116"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-827"></span><span>                                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step (EncodeState s) a
</span><a href="Streamly.Internal.Unicode.Stream.html#dropInvalid"><span class="hs-identifier hs-var">dropInvalid</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434115"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-828"></span><span>                                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. s -&gt; WList -&gt; EncodeState s
</span><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-var">EncodeState</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434115"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#ord3"><span class="hs-identifier hs-var">ord3</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434116"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span>                                    </span><span class="annot"><span class="annottext">InvalidAction
</span><a href="Streamly.Internal.Unicode.Stream.html#ErrorInvalid"><span class="hs-identifier hs-var">ErrorInvalid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-831"></span><span>                                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isSurrogate</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434116"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-832"></span><span>                                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step (EncodeState s) a
</span><a href="Streamly.Internal.Unicode.Stream.html#errorOnInvalid"><span class="hs-identifier hs-var">errorOnInvalid</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434115"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-833"></span><span>                                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. s -&gt; WList -&gt; EncodeState s
</span><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-var">EncodeState</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434115"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#ord3"><span class="hs-identifier hs-var">ord3</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434116"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-834"></span><span>
</span><span id="line-835"></span><span>                                    </span><span class="annot"><span class="annottext">InvalidAction
</span><a href="Streamly.Internal.Unicode.Stream.html#IgnoreInvalid"><span class="hs-identifier hs-var">IgnoreInvalid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-836"></span><span>                                        </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. s -&gt; WList -&gt; EncodeState s
</span><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-var">EncodeState</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434115"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#ord3"><span class="hs-identifier hs-var">ord3</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434116"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span>                                    </span><span class="annot"><span class="annottext">InvalidAction
</span><a href="Streamly.Internal.Unicode.Stream.html#ReplaceInvalid"><span class="hs-identifier hs-var">ReplaceInvalid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-839"></span><span>                                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isSurrogate</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434116"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-840"></span><span>                                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step (EncodeState s) a
</span><a href="Streamly.Internal.Unicode.Stream.html#replaceInvalid"><span class="hs-identifier hs-var">replaceInvalid</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434115"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-841"></span><span>                                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. s -&gt; WList -&gt; EncodeState s
</span><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-var">EncodeState</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434115"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#ord3"><span class="hs-identifier hs-var">ord3</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434116"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. s -&gt; WList -&gt; EncodeState s
</span><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-var">EncodeState</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434115"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; WList
</span><a href="Streamly.Internal.Unicode.Stream.html#ord4"><span class="hs-identifier hs-var">ord4</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434116"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-844"></span><span>                </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-type">Skip</span></a></span><span> </span><span id="local-6989586621679434113"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434113"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. s -&gt; WList -&gt; EncodeState s
</span><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-var">EncodeState</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434113"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">WList
</span><a href="Streamly.Internal.Unicode.Stream.html#WNil"><span class="hs-identifier hs-var">WNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-845"></span><span>                </span><span class="annot"><span class="annottext">Step s Char
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s a. Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span>
</span><span id="line-846"></span><span>    </span><span class="annot"><a href="#local-6989586621679434131"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">State Stream m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-type">EncodeState</span></a></span><span> </span><span id="local-6989586621679434112"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434112"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#WCons"><span class="hs-identifier hs-type">WCons</span></a></span><span> </span><span id="local-6989586621679434111"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434111"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679434110"><span class="annot"><span class="annottext">WList
</span><a href="#local-6989586621679434110"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Stream.StreamD.Step.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679434111"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. s -&gt; WList -&gt; EncodeState s
</span><a href="Streamly.Internal.Unicode.Stream.html#EncodeState"><span class="hs-identifier hs-var">EncodeState</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679434112"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">WList
</span><a href="#local-6989586621679434110"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-847"></span><span>
</span><span id="line-848"></span><span class="hs-comment">-- More yield points improve performance, but I am not sure if they can cause</span><span>
</span><span id="line-849"></span><span class="hs-comment">-- too much code bloat or some trouble with fusion. So keeping only two yield</span><span>
</span><span id="line-850"></span><span class="hs-comment">-- points for now, one for the ascii chars (fast path) and one for all other</span><span>
</span><span id="line-851"></span><span class="hs-comment">-- paths (slow path).</span><span>
</span><span id="line-852"></span><span class="hs-pragma">{-# INLINE_NORMAL encodeUtf8D' #-}</span><span>
</span><span id="line-853"></span><span id="local-6989586621679435340"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8D%27"><span class="hs-identifier hs-type">encodeUtf8D'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679435340"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435340"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435340"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span></span><span>
</span><span id="line-854"></span><span id="encodeUtf8D%27"><span class="annot"><span class="annottext">encodeUtf8D' :: forall (m :: * -&gt; *). Monad m =&gt; Stream m Char -&gt; Stream m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8D%27"><span class="hs-identifier hs-var hs-var">encodeUtf8D'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
InvalidAction -&gt; Stream m Char -&gt; Stream m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8DGeneric"><span class="hs-identifier hs-var">encodeUtf8DGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidAction
</span><a href="Streamly.Internal.Unicode.Stream.html#ErrorInvalid"><span class="hs-identifier hs-var">ErrorInvalid</span></a></span><span>
</span><span id="line-855"></span><span>
</span><span id="line-856"></span><span class="hs-comment">-- | Encode a stream of Unicode characters to a UTF-8 encoded bytestream. When</span><span>
</span><span id="line-857"></span><span class="hs-comment">-- any invalid character (U+D800-U+D8FF) is encountered in the input stream the</span><span>
</span><span id="line-858"></span><span class="hs-comment">-- function errors out.</span><span>
</span><span id="line-859"></span><span class="hs-comment">--</span><span>
</span><span id="line-860"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-861"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8%27"><span class="hs-pragma hs-type">encodeUtf8'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-862"></span><span id="local-6989586621679435337"><span id="local-6989586621679435338"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8%27"><span class="hs-identifier hs-type">encodeUtf8'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679435338"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435337"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435337"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435338"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435337"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435338"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span></span></span><span>
</span><span id="line-863"></span><span id="encodeUtf8%27"><span class="annot"><span class="annottext">encodeUtf8' :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *).
(Monad m, IsStream t) =&gt;
t m Char -&gt; t m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8%27"><span class="hs-identifier hs-var hs-var">encodeUtf8'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; Stream m Char -&gt; Stream m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8D%27"><span class="hs-identifier hs-var">encodeUtf8D'</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span>
</span><span id="line-864"></span><span>
</span><span id="line-865"></span><span class="hs-comment">-- | See section &quot;3.9 Unicode Encoding Forms&quot; in</span><span>
</span><span id="line-866"></span><span class="hs-comment">-- https://www.unicode.org/versions/Unicode13.0.0/UnicodeStandard-13.0.pdf</span><span>
</span><span id="line-867"></span><span class="hs-comment">--</span><span>
</span><span id="line-868"></span><span class="hs-pragma">{-# INLINE_NORMAL encodeUtf8D #-}</span><span>
</span><span id="line-869"></span><span id="local-6989586621679434100"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8D"><span class="hs-identifier hs-type">encodeUtf8D</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679434100"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434100"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434100"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span></span><span>
</span><span id="line-870"></span><span id="encodeUtf8D"><span class="annot"><span class="annottext">encodeUtf8D :: forall (m :: * -&gt; *). Monad m =&gt; Stream m Char -&gt; Stream m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8D"><span class="hs-identifier hs-var hs-var">encodeUtf8D</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
InvalidAction -&gt; Stream m Char -&gt; Stream m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8DGeneric"><span class="hs-identifier hs-var">encodeUtf8DGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidAction
</span><a href="Streamly.Internal.Unicode.Stream.html#ReplaceInvalid"><span class="hs-identifier hs-var">ReplaceInvalid</span></a></span><span>
</span><span id="line-871"></span><span>
</span><span id="line-872"></span><span class="hs-comment">-- | Encode a stream of Unicode characters to a UTF-8 encoded bytestream. Any</span><span>
</span><span id="line-873"></span><span class="hs-comment">-- Invalid characters (U+D800-U+D8FF) in the input stream are replaced by the</span><span>
</span><span id="line-874"></span><span class="hs-comment">-- Unicode replacement character U+FFFD.</span><span>
</span><span id="line-875"></span><span class="hs-comment">--</span><span>
</span><span id="line-876"></span><span class="hs-comment">-- /Since: 0.7.0 (&quot;Streamly.Data.Unicode.Stream&quot;)/</span><span>
</span><span id="line-877"></span><span class="hs-comment">--</span><span>
</span><span id="line-878"></span><span class="hs-comment">-- /Since: 0.8.0 (Lenient Behaviour)/</span><span>
</span><span id="line-879"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8"><span class="hs-pragma hs-type">encodeUtf8</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-880"></span><span id="local-6989586621679434096"><span id="local-6989586621679434097"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8"><span class="hs-identifier hs-type">encodeUtf8</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679434097"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434096"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434096"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434097"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434096"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434097"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span></span></span><span>
</span><span id="line-881"></span><span id="encodeUtf8"><span class="annot"><span class="annottext">encodeUtf8 :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *).
(Monad m, IsStream t) =&gt;
t m Char -&gt; t m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8"><span class="hs-identifier hs-var hs-var">encodeUtf8</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; Stream m Char -&gt; Stream m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8D"><span class="hs-identifier hs-var">encodeUtf8D</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span>
</span><span id="line-882"></span><span>
</span><span id="line-883"></span><span class="hs-pragma">{-# INLINE_NORMAL encodeUtf8D_ #-}</span><span>
</span><span id="line-884"></span><span id="local-6989586621679434088"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8D_"><span class="hs-identifier hs-type">encodeUtf8D_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679434088"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434088"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.StreamD.Type.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434088"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span></span><span>
</span><span id="line-885"></span><span id="encodeUtf8D_"><span class="annot"><span class="annottext">encodeUtf8D_ :: forall (m :: * -&gt; *). Monad m =&gt; Stream m Char -&gt; Stream m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8D_"><span class="hs-identifier hs-var hs-var">encodeUtf8D_</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
InvalidAction -&gt; Stream m Char -&gt; Stream m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8DGeneric"><span class="hs-identifier hs-var">encodeUtf8DGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidAction
</span><a href="Streamly.Internal.Unicode.Stream.html#DropInvalid"><span class="hs-identifier hs-var">DropInvalid</span></a></span><span>
</span><span id="line-886"></span><span>
</span><span id="line-887"></span><span class="hs-comment">-- | Encode a stream of Unicode characters to a UTF-8 encoded bytestream. Any</span><span>
</span><span id="line-888"></span><span class="hs-comment">-- Invalid characters (U+D800-U+D8FF) in the input stream are dropped.</span><span>
</span><span id="line-889"></span><span class="hs-comment">--</span><span>
</span><span id="line-890"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-891"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8_"><span class="hs-pragma hs-type">encodeUtf8_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-892"></span><span id="local-6989586621679434084"><span id="local-6989586621679434085"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8_"><span class="hs-identifier hs-type">encodeUtf8_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679434085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434084"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434084"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434085"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434084"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434085"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span></span></span><span>
</span><span id="line-893"></span><span id="encodeUtf8_"><span class="annot"><span class="annottext">encodeUtf8_ :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *).
(Monad m, IsStream t) =&gt;
t m Char -&gt; t m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8_"><span class="hs-identifier hs-var hs-var">encodeUtf8_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
Stream m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#fromStreamD"><span class="hs-identifier hs-var">fromStreamD</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; Stream m Char -&gt; Stream m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8D_"><span class="hs-identifier hs-var">encodeUtf8D_</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
t m a -&gt; Stream m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#toStreamD"><span class="hs-identifier hs-var">toStreamD</span></a></span><span>
</span><span id="line-894"></span><span>
</span><span id="line-895"></span><span class="hs-comment">-- | Same as 'encodeUtf8'</span><span>
</span><span id="line-896"></span><span class="hs-comment">--</span><span>
</span><span id="line-897"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">encodeUtf8Lax</span><span> </span><span class="hs-pragma">&quot;Please use 'encodeUtf8' instead&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-898"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8Lax"><span class="hs-pragma hs-type">encodeUtf8Lax</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-899"></span><span id="local-6989586621679434075"><span id="local-6989586621679434076"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8Lax"><span class="hs-identifier hs-type">encodeUtf8Lax</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434076"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679434075"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434076"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434075"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434076"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434075"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span></span></span><span>
</span><span id="line-900"></span><span id="encodeUtf8Lax"><span class="annot"><span class="annottext">encodeUtf8Lax :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *).
(IsStream t, Monad m) =&gt;
t m Char -&gt; t m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8Lax"><span class="hs-identifier hs-var hs-var">encodeUtf8Lax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *).
(Monad m, IsStream t) =&gt;
t m Char -&gt; t m Word8
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeUtf8"><span class="hs-identifier hs-var">encodeUtf8</span></a></span><span>
</span><span id="line-901"></span><span>
</span><span id="line-902"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-903"></span><span class="hs-comment">-- Encode streams of containers</span><span>
</span><span id="line-904"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span class="hs-comment">-- | Encode a container to @Array Word8@ provided an unfold to covert it to a</span><span>
</span><span id="line-907"></span><span class="hs-comment">-- Char stream and an encoding function.</span><span>
</span><span id="line-908"></span><span class="hs-comment">--</span><span>
</span><span id="line-909"></span><span class="hs-comment">-- /Internal/</span><span>
</span><span id="line-910"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeObject"><span class="hs-pragma hs-type">encodeObject</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-911"></span><span id="local-6989586621679435324"><span id="local-6989586621679435326"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeObject"><span class="hs-identifier hs-type">encodeObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679435326"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-912"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.Serial.html#SerialT"><span class="hs-identifier hs-type">SerialT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435326"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.Serial.html#SerialT"><span class="hs-identifier hs-type">SerialT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435326"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span>
</span><span id="line-913"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier hs-type">Unfold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435326"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435324"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>
</span><span id="line-914"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435324"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-915"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435326"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-916"></span><span id="encodeObject"><span class="annot"><span class="annottext">encodeObject :: forall (m :: * -&gt; *) a.
MonadIO m =&gt;
(SerialT m Char -&gt; SerialT m Word8)
-&gt; Unfold m a Char -&gt; a -&gt; m (Array Word8)
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeObject"><span class="hs-identifier hs-var hs-var">encodeObject</span></a></span></span><span> </span><span id="local-6989586621679434061"><span class="annot"><span class="annottext">SerialT m Char -&gt; SerialT m Word8
</span><a href="#local-6989586621679434061"><span class="hs-identifier hs-var">encode</span></a></span></span><span> </span><span id="local-6989586621679434060"><span class="annot"><span class="annottext">Unfold m a Char
</span><a href="#local-6989586621679434060"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
Monad m =&gt;
Fold m a b -&gt; SerialT m a -&gt; m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Common.html#fold"><span class="hs-identifier hs-var">S.fold</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(MonadIO m, Storable a) =&gt;
Fold m a (Array a)
</span><a href="Streamly.Internal.Data.Array.Foreign.Type.html#write"><span class="hs-identifier hs-var">Array.write</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SerialT m Char -&gt; SerialT m Word8
</span><a href="#local-6989586621679434061"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
(IsStream t, Monad m) =&gt;
Unfold m a b -&gt; a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Generate.html#unfold"><span class="hs-identifier hs-var">S.unfold</span></a></span><span> </span><span class="annot"><span class="annottext">Unfold m a Char
</span><a href="#local-6989586621679434060"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-917"></span><span>
</span><span id="line-918"></span><span class="hs-comment">-- | Encode a stream of container objects using the supplied encoding scheme.</span><span>
</span><span id="line-919"></span><span class="hs-comment">-- Each object is encoded as an @Array Word8@.</span><span>
</span><span id="line-920"></span><span class="hs-comment">--</span><span>
</span><span id="line-921"></span><span class="hs-comment">-- /Internal/</span><span>
</span><span id="line-922"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeObjects"><span class="hs-pragma hs-type">encodeObjects</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-923"></span><span id="local-6989586621679435309"><span id="local-6989586621679435310"><span id="local-6989586621679435311"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeObjects"><span class="hs-identifier hs-type">encodeObjects</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679435311"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435310"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-924"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.Serial.html#SerialT"><span class="hs-identifier hs-type">SerialT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435311"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.Serial.html#SerialT"><span class="hs-identifier hs-type">SerialT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435311"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span>
</span><span id="line-925"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier hs-type">Unfold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435311"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435309"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>
</span><span id="line-926"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435310"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435311"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435309"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-927"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435310"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435311"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-928"></span><span id="encodeObjects"><span class="annot"><span class="annottext">encodeObjects :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *) a.
(MonadIO m, IsStream t) =&gt;
(SerialT m Char -&gt; SerialT m Word8)
-&gt; Unfold m a Char -&gt; t m a -&gt; t m (Array Word8)
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeObjects"><span class="hs-identifier hs-var hs-var">encodeObjects</span></a></span></span><span> </span><span id="local-6989586621679434046"><span class="annot"><span class="annottext">SerialT m Char -&gt; SerialT m Word8
</span><a href="#local-6989586621679434046"><span class="hs-identifier hs-var">encode</span></a></span></span><span> </span><span id="local-6989586621679434045"><span class="annot"><span class="annottext">Unfold m a Char
</span><a href="#local-6989586621679434045"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t1 :: (* -&gt; *) -&gt; * -&gt; *) (t2 :: (* -&gt; *) -&gt; * -&gt; *)
       (m :: * -&gt; *) a.
(IsStream t1, IsStream t2) =&gt;
t1 m a -&gt; t2 m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#adapt"><span class="hs-identifier hs-var">adapt</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; SerialT m a -&gt; SerialT m b
</span><a href="Streamly.Internal.Data.Stream.Serial.html#mapM"><span class="hs-identifier hs-var">Serial.mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
(SerialT m Char -&gt; SerialT m Word8)
-&gt; Unfold m a Char -&gt; a -&gt; m (Array Word8)
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeObject"><span class="hs-identifier hs-var">encodeObject</span></a></span><span> </span><span class="annot"><span class="annottext">SerialT m Char -&gt; SerialT m Word8
</span><a href="#local-6989586621679434046"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="annot"><span class="annottext">Unfold m a Char
</span><a href="#local-6989586621679434045"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t1 :: (* -&gt; *) -&gt; * -&gt; *) (t2 :: (* -&gt; *) -&gt; * -&gt; *)
       (m :: * -&gt; *) a.
(IsStream t1, IsStream t2) =&gt;
t1 m a -&gt; t2 m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#adapt"><span class="hs-identifier hs-var">adapt</span></a></span><span>
</span><span id="line-929"></span><span>
</span><span id="line-930"></span><span class="hs-comment">-- | Encode a stream of 'String' using the supplied encoding scheme. Each</span><span>
</span><span id="line-931"></span><span class="hs-comment">-- string is encoded as an @Array Word8@.</span><span>
</span><span id="line-932"></span><span class="hs-comment">--</span><span>
</span><span id="line-933"></span><span class="hs-comment">-- @since 0.8.0</span><span>
</span><span id="line-934"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeStrings"><span class="hs-pragma hs-type">encodeStrings</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-935"></span><span id="local-6989586621679435297"><span id="local-6989586621679435298"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#encodeStrings"><span class="hs-identifier hs-type">encodeStrings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679435298"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435297"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-936"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Stream.Serial.html#SerialT"><span class="hs-identifier hs-type">SerialT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435298"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.Serial.html#SerialT"><span class="hs-identifier hs-type">SerialT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435298"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435297"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435298"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435297"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435298"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Array.Foreign.Type.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-937"></span><span id="encodeStrings"><span class="annot"><span class="annottext">encodeStrings :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *).
(MonadIO m, IsStream t) =&gt;
(SerialT m Char -&gt; SerialT m Word8)
-&gt; t m [Char] -&gt; t m (Array Word8)
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeStrings"><span class="hs-identifier hs-var hs-var">encodeStrings</span></a></span></span><span> </span><span id="local-6989586621679434037"><span class="annot"><span class="annottext">SerialT m Char -&gt; SerialT m Word8
</span><a href="#local-6989586621679434037"><span class="hs-identifier hs-var">encode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *) a.
(MonadIO m, IsStream t) =&gt;
(SerialT m Char -&gt; SerialT m Word8)
-&gt; Unfold m a Char -&gt; t m a -&gt; t m (Array Word8)
</span><a href="Streamly.Internal.Unicode.Stream.html#encodeObjects"><span class="hs-identifier hs-var">encodeObjects</span></a></span><span> </span><span class="annot"><span class="annottext">SerialT m Char -&gt; SerialT m Word8
</span><a href="#local-6989586621679434037"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; Unfold m [a] a
</span><a href="Streamly.Internal.Data.Unfold.html#fromList"><span class="hs-identifier hs-var">Unfold.fromList</span></a></span><span>
</span><span id="line-938"></span><span>
</span><span id="line-939"></span><span class="hs-comment">{-
-------------------------------------------------------------------------------
-- Utility operations on strings
-------------------------------------------------------------------------------

strip :: IsStream t =&gt; t m Char -&gt; t m Char
strip = undefined

stripTail :: IsStream t =&gt; t m Char -&gt; t m Char
stripTail = undefined
-}</span><span>
</span><span id="line-950"></span><span>
</span><span id="line-951"></span><span class="hs-comment">-- | Remove leading whitespace from a string.</span><span>
</span><span id="line-952"></span><span class="hs-comment">--</span><span>
</span><span id="line-953"></span><span class="hs-comment">-- &gt; stripHead = S.dropWhile isSpace</span><span>
</span><span id="line-954"></span><span class="hs-comment">--</span><span>
</span><span id="line-955"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-956"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#stripHead"><span class="hs-pragma hs-type">stripHead</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-957"></span><span id="local-6989586621679435291"><span id="local-6989586621679435292"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#stripHead"><span class="hs-identifier hs-type">stripHead</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679435292"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435291"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435291"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435292"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435291"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435292"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span></span><span>
</span><span id="line-958"></span><span id="stripHead"><span class="annot"><span class="annottext">stripHead :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *).
(Monad m, IsStream t) =&gt;
t m Char -&gt; t m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#stripHead"><span class="hs-identifier hs-var hs-var">stripHead</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(IsStream t, Monad m) =&gt;
(a -&gt; Bool) -&gt; t m a -&gt; t m a
</span><a href="Streamly.Internal.Data.Stream.IsStream.Transform.html#dropWhile"><span class="hs-identifier hs-var">S.dropWhile</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="Streamly.Internal.Unicode.Stream.html#isSpace"><span class="hs-identifier hs-var">isSpace</span></a></span><span>
</span><span id="line-959"></span><span>
</span><span id="line-960"></span><span class="hs-comment">-- | Fold each line of the stream using the supplied 'Fold'</span><span>
</span><span id="line-961"></span><span class="hs-comment">-- and stream the result.</span><span>
</span><span id="line-962"></span><span class="hs-comment">--</span><span>
</span><span id="line-963"></span><span class="hs-comment">-- &gt;&gt;&gt; Stream.toList $ lines Fold.toList (Stream.fromList &quot;lines\nthis\nstring\n\n\n&quot;)</span><span>
</span><span id="line-964"></span><span class="hs-comment">-- [&quot;lines&quot;,&quot;this&quot;,&quot;string&quot;,&quot;&quot;,&quot;&quot;]</span><span>
</span><span id="line-965"></span><span class="hs-comment">--</span><span>
</span><span id="line-966"></span><span class="hs-comment">-- &gt; lines = S.splitOnSuffix (== '\n')</span><span>
</span><span id="line-967"></span><span class="hs-comment">--</span><span>
</span><span id="line-968"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-969"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#lines"><span class="hs-pragma hs-type">lines</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-970"></span><span id="local-6989586621679435286"><span id="local-6989586621679435287"><span id="local-6989586621679435288"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#lines"><span class="hs-identifier hs-type">lines</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679435288"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435287"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#Fold"><span class="hs-identifier hs-type">Fold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435288"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="annot"><a href="#local-6989586621679435286"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435287"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435288"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435287"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435288"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435286"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-971"></span><span id="lines"><span class="annot"><span class="annottext">lines :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *) b.
(Monad m, IsStream t) =&gt;
Fold m Char b -&gt; t m Char -&gt; t m b
</span><a href="Streamly.Internal.Unicode.Stream.html#lines"><span class="hs-identifier hs-var hs-var">lines</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
(IsStream t, Monad m) =&gt;
(a -&gt; Bool) -&gt; Fold m a b -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Reduce.html#splitOnSuffix"><span class="hs-identifier hs-var">S.splitOnSuffix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span class="hs-special">)</span><span>
</span><span id="line-972"></span><span>
</span><span id="line-973"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;u_iswspace&quot;</span></span><span>
</span><span id="line-974"></span><span>  </span><span id="iswspace"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#iswspace"><span class="hs-identifier hs-var">iswspace</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-975"></span><span>
</span><span id="line-976"></span><span class="hs-comment">-- | Code copied from base/Data.Char to INLINE it</span><span>
</span><span id="line-977"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#isSpace"><span class="hs-pragma hs-type">isSpace</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-978"></span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#isSpace"><span class="hs-identifier hs-type">isSpace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-979"></span><span id="isSpace"><span class="annot"><span class="annottext">isSpace :: Char -&gt; Bool
</span><a href="Streamly.Internal.Unicode.Stream.html#isSpace"><span class="hs-identifier hs-var hs-var">isSpace</span></a></span></span><span> </span><span id="local-6989586621679434021"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434021"><span class="hs-identifier hs-var">c</span></a></span></span><span>
</span><span id="line-980"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679434020"><span class="hs-identifier hs-var">uc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x377</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679434020"><span class="hs-identifier hs-var">uc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679434020"><span class="hs-identifier hs-var">uc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x9</span></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679434020"><span class="hs-identifier hs-var">uc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0xa0</span></span><span>
</span><span id="line-981"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Streamly.Internal.Unicode.Stream.html#iswspace"><span class="hs-identifier hs-var">iswspace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434021"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-982"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-983"></span><span>    </span><span id="local-6989586621679434020"><span class="annot"><span class="annottext">uc :: Word
</span><a href="#local-6989586621679434020"><span class="hs-identifier hs-var hs-var">uc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679434021"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span>
</span><span id="line-984"></span><span>
</span><span id="line-985"></span><span class="hs-comment">-- | Fold each word of the stream using the supplied 'Fold'</span><span>
</span><span id="line-986"></span><span class="hs-comment">-- and stream the result.</span><span>
</span><span id="line-987"></span><span class="hs-comment">--</span><span>
</span><span id="line-988"></span><span class="hs-comment">-- &gt;&gt;&gt;  Stream.toList $ words Fold.toList (Stream.fromList &quot;fold these     words&quot;)</span><span>
</span><span id="line-989"></span><span class="hs-comment">-- [&quot;fold&quot;,&quot;these&quot;,&quot;words&quot;]</span><span>
</span><span id="line-990"></span><span class="hs-comment">--</span><span>
</span><span id="line-991"></span><span class="hs-comment">-- &gt; words = S.wordsBy isSpace</span><span>
</span><span id="line-992"></span><span class="hs-comment">--</span><span>
</span><span id="line-993"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-994"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#words"><span class="hs-pragma hs-type">words</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-995"></span><span id="local-6989586621679434015"><span id="local-6989586621679434016"><span id="local-6989586621679434017"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#words"><span class="hs-identifier hs-type">words</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679434017"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434016"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Fold.Type.html#Fold"><span class="hs-identifier hs-type">Fold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434017"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="annot"><a href="#local-6989586621679434015"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434016"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434017"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434016"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434017"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434015"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-996"></span><span id="words"><span class="annot"><span class="annottext">words :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *) b.
(Monad m, IsStream t) =&gt;
Fold m Char b -&gt; t m Char -&gt; t m b
</span><a href="Streamly.Internal.Unicode.Stream.html#words"><span class="hs-identifier hs-var hs-var">words</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
(IsStream t, Monad m) =&gt;
(a -&gt; Bool) -&gt; Fold m a b -&gt; t m a -&gt; t m b
</span><a href="Streamly.Internal.Data.Stream.IsStream.Reduce.html#wordsBy"><span class="hs-identifier hs-var">S.wordsBy</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="Streamly.Internal.Unicode.Stream.html#isSpace"><span class="hs-identifier hs-var">isSpace</span></a></span><span>
</span><span id="line-997"></span><span>
</span><span id="line-998"></span><span class="hs-comment">-- | Unfold a stream to character streams using the supplied 'Unfold'</span><span>
</span><span id="line-999"></span><span class="hs-comment">-- and concat the results suffixing a newline character @\\n@ to each stream.</span><span>
</span><span id="line-1000"></span><span class="hs-comment">--</span><span>
</span><span id="line-1001"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1002"></span><span class="hs-comment">-- unlines = Stream.interposeSuffix '\n'</span><span>
</span><span id="line-1003"></span><span class="hs-comment">-- unlines = Stream.intercalateSuffix Unfold.fromList &quot;\n&quot;</span><span>
</span><span id="line-1004"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1005"></span><span class="hs-comment">--</span><span>
</span><span id="line-1006"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-1007"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#unlines"><span class="hs-pragma hs-type">unlines</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1008"></span><span id="local-6989586621679435275"><span id="local-6989586621679435276"><span id="local-6989586621679435277"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#unlines"><span class="hs-identifier hs-type">unlines</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679435277"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435276"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier hs-type">Unfold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435277"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435275"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435276"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435277"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435275"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679435276"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679435277"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span></span></span><span>
</span><span id="line-1009"></span><span id="unlines"><span class="annot"><span class="annottext">unlines :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *) a.
(MonadIO m, IsStream t) =&gt;
Unfold m a Char -&gt; t m a -&gt; t m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#unlines"><span class="hs-identifier hs-var hs-var">unlines</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) c b.
(IsStream t, Monad m) =&gt;
c -&gt; Unfold m b c -&gt; t m b -&gt; t m c
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interposeSuffix"><span class="hs-identifier hs-var">S.interposeSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span>
</span><span id="line-1010"></span><span>
</span><span id="line-1011"></span><span class="hs-comment">-- | Unfold the elements of a stream to character streams using the supplied</span><span>
</span><span id="line-1012"></span><span class="hs-comment">-- 'Unfold' and concat the results with a whitespace character infixed between</span><span>
</span><span id="line-1013"></span><span class="hs-comment">-- the streams.</span><span>
</span><span id="line-1014"></span><span class="hs-comment">--</span><span>
</span><span id="line-1015"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1016"></span><span class="hs-comment">-- unwords = Stream.interpose ' '</span><span>
</span><span id="line-1017"></span><span class="hs-comment">-- unwords = Stream.intercalate Unfold.fromList &quot; &quot;</span><span>
</span><span id="line-1018"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1019"></span><span class="hs-comment">--</span><span>
</span><span id="line-1020"></span><span class="hs-comment">-- /Pre-release/</span><span>
</span><span id="line-1021"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#unwords"><span class="hs-pragma hs-type">unwords</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1022"></span><span id="local-6989586621679434001"><span id="local-6989586621679434002"><span id="local-6989586621679434003"><span class="annot"><a href="Streamly.Internal.Unicode.Stream.html#unwords"><span class="hs-identifier hs-type">unwords</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679434003"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Stream.IsStream.Type.html#IsStream"><span class="hs-identifier hs-type">IsStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434002"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Unfold.Type.html#Unfold"><span class="hs-identifier hs-type">Unfold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434003"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434001"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434002"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434003"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434001"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679434002"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679434003"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span></span></span></span><span>
</span><span id="line-1023"></span><span id="unwords"><span class="annot"><span class="annottext">unwords :: forall (m :: * -&gt; *) (t :: (* -&gt; *) -&gt; * -&gt; *) a.
(MonadIO m, IsStream t) =&gt;
Unfold m a Char -&gt; t m a -&gt; t m Char
</span><a href="Streamly.Internal.Unicode.Stream.html#unwords"><span class="hs-identifier hs-var hs-var">unwords</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) c b.
(IsStream t, Monad m) =&gt;
c -&gt; Unfold m b c -&gt; t m b -&gt; t m c
</span><a href="Streamly.Internal.Data.Stream.IsStream.Expand.html#interpose"><span class="hs-identifier hs-var">S.interpose</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span>
</span><span id="line-1024"></span></pre></body></html>