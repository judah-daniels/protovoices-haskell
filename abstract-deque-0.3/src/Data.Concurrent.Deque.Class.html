<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TypeFamilies, CPP, TypeSynonymInstances, MultiParamTypeClasses,
    FlexibleInstances, EmptyDataDecls  #-}</span><span class="hs-cpp">

#ifdef DEFAULT_SIGNATURES
</span><span class="hs-pragma">{-# LANGUAGE DefaultSignatures #-}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-8"></span><span class="hs-comment">{- |
   An abstract, parameterizable interface for queues.  

   This interface includes a non-associated type family for Deques
   plus separate type classes encapsulating the Deque operations.
   That is, we separate type selection (type family) from function overloading
   (vanilla type classes).

   This design strives to hide the extra phantom-type parameters from
   the Class constraints and therefore from the type signatures of
   client code.

-}</span><span> </span><span>
</span><span id="line-21"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Concurrent.Deque.Class</span><span>
</span><span id="line-22"></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Highly parameterized Deque type(s)</span></span><span>
</span><span id="line-24"></span><span>   </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Deque"><span class="hs-identifier">Deque</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** The choices that select a queue-variant.</span></span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Choice #1 -- thread safety.</span></span><span>
</span><span id="line-27"></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Threadsafe"><span class="hs-identifier">Threadsafe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Nonthreadsafe"><span class="hs-identifier">Nonthreadsafe</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Choice #2 -- double or single functionality on an end.</span></span><span>
</span><span id="line-29"></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#SingleEnd"><span class="hs-identifier">SingleEnd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#DoubleEnd"><span class="hs-identifier">DoubleEnd</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Choice #3 -- bounded or growing queues:</span></span><span>
</span><span id="line-31"></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Bound"><span class="hs-identifier">Bound</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Grow"><span class="hs-identifier">Grow</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Choice #4 -- duplication of elements.</span></span><span>
</span><span id="line-33"></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Safe"><span class="hs-identifier">Safe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Dup"><span class="hs-identifier">Dup</span></a></span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Aliases enabling more concise Deque types:</span></span><span>
</span><span id="line-35"></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#S"><span class="hs-identifier">S</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#D"><span class="hs-identifier">D</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#NT"><span class="hs-identifier">NT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#T"><span class="hs-identifier">T</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Aliases for commonly used Deque configurations:</span></span><span>
</span><span id="line-38"></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Queue"><span class="hs-identifier">Queue</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#ConcQueue"><span class="hs-identifier">ConcQueue</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#ConcDeque"><span class="hs-identifier">ConcDeque</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#WSDeque"><span class="hs-identifier">WSDeque</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Class for basic Queue operations</span></span><span>
</span><span id="line-41"></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#DequeClass"><span class="hs-identifier">DequeClass</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Extra capabilities: type classes</span></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span>   </span><span class="hs-comment">-- | These classes provide a more programmer-friendly constraints than directly</span><span>
</span><span id="line-46"></span><span>   </span><span class="hs-comment">-- using the phantom type parameters to constrain queues in user code.  Also note</span><span>
</span><span id="line-47"></span><span>   </span><span class="hs-comment">-- that instances can be provided for types outside the type `Deque` type family.</span><span>
</span><span id="line-48"></span><span>   </span><span class="hs-comment">-- </span><span>
</span><span id="line-49"></span><span>   </span><span class="hs-comment">-- We still make a distinction between the different capabilities</span><span>
</span><span id="line-50"></span><span>   </span><span class="hs-comment">-- (e.g. single-ended / double ended), and thus we need the below type classes for</span><span>
</span><span id="line-51"></span><span>   </span><span class="hs-comment">-- the additional operations unsupported by the minimal &quot;DequeClass&quot;.</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** The \&quot;unnatural\&quot; double ended cases: pop left, push right.</span></span><span>
</span><span id="line-54"></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#PopL"><span class="hs-identifier">PopL</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#PushR"><span class="hs-identifier">PushR</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>             </span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Operations that only make sense for bounded queues.</span></span><span>
</span><span id="line-57"></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#BoundedL"><span class="hs-identifier">BoundedL</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#BoundedR"><span class="hs-identifier">BoundedR</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Bounded</span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-comment">{- | 

 A family of Deques implementations.  A concrete Deque implementation
 is selected based on the (phantom) type parameters, which encode
 several choices.

 For example, a work stealing deque is threadsafe only on one end and
 supports push/pop on one end (and pop-only) on the other:

  &gt;&gt; (Deque NT T  D S Grow elt)

 Note, however, that the above example is overconstraining in many
 situations.  It demands an implementation which is NOT threadsafe on
 one end and does NOT support push on one end, whereas both these
 features would not hurt, if present.

 Thus when accepting a queue as input to a function you probably never
 want to overconstrain by demanding a less-featureful option.

   For example, rather than @(Deque NT D T S Grow elt)@
   You would probably want: @(Deque nt D T s Grow elt)@

 -}</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- data family Deque lThreaded rThreaded lDbl rDbl bnd safe elt </span><span>
</span><span id="line-89"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="Deque"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Deque"><span class="hs-identifier hs-var">Deque</span></a></span></span><span> </span><span id="local-6989586621679036033"><span class="annot"><a href="#local-6989586621679036033"><span class="hs-identifier hs-type">lThreaded</span></a></span></span><span> </span><span id="local-6989586621679036032"><span class="annot"><a href="#local-6989586621679036032"><span class="hs-identifier hs-type">rThreaded</span></a></span></span><span> </span><span id="local-6989586621679036031"><span class="annot"><a href="#local-6989586621679036031"><span class="hs-identifier hs-type">lDbl</span></a></span></span><span> </span><span id="local-6989586621679036030"><span class="annot"><a href="#local-6989586621679036030"><span class="hs-identifier hs-type">rDbl</span></a></span></span><span> </span><span id="local-6989586621679036029"><span class="annot"><a href="#local-6989586621679036029"><span class="hs-identifier hs-type">bnd</span></a></span></span><span> </span><span id="local-6989586621679036028"><span class="annot"><a href="#local-6989586621679036028"><span class="hs-identifier hs-type">safe</span></a></span></span><span> </span><span id="local-6989586621679036027"><span class="annot"><a href="#local-6989586621679036027"><span class="hs-identifier hs-type">elt</span></a></span></span><span> </span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- | Haskell IO threads (&quot;Control.Concurrent&quot;) may concurrently access</span><span>
</span><span id="line-92"></span><span class="hs-comment">--   this end of the queue.  Note that this attribute is set</span><span>
</span><span id="line-93"></span><span class="hs-comment">--   separately for the left and right ends.</span><span>
</span><span id="line-94"></span><span class="hs-keyword">data</span><span> </span><span id="Threadsafe"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Threadsafe"><span class="hs-identifier hs-var">Threadsafe</span></a></span></span><span>
</span><span id="line-95"></span><span class="hs-comment">-- | Only one thread at a time may access this end of the queue.</span><span>
</span><span id="line-96"></span><span class="hs-keyword">data</span><span> </span><span id="Nonthreadsafe"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Nonthreadsafe"><span class="hs-identifier hs-var">Nonthreadsafe</span></a></span></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- | This end of the queue provides push-only (left) or pop-only</span><span>
</span><span id="line-99"></span><span class="hs-comment">--   (right) functionality. Thus a 'SingleEnd' / 'SingleEnd' combination</span><span>
</span><span id="line-100"></span><span class="hs-comment">--   is what is commonly referred to as a /single ended queue/, whereas</span><span>
</span><span id="line-101"></span><span class="hs-comment">--   'DoubleEnd' / 'DoubleEnd' is </span><span>
</span><span id="line-102"></span><span class="hs-comment">--   a /double ended queue/.  Heterogeneous combinations are sometimes</span><span>
</span><span id="line-103"></span><span class="hs-comment">--   colloquially referred to as \&quot;1.5 ended queues\&quot;.</span><span>
</span><span id="line-104"></span><span class="hs-keyword">data</span><span> </span><span id="SingleEnd"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#SingleEnd"><span class="hs-identifier hs-var">SingleEnd</span></a></span></span><span>
</span><span id="line-105"></span><span class="hs-comment">-- | This end of the queue supports both push and pop.</span><span>
</span><span id="line-106"></span><span class="hs-keyword">data</span><span> </span><span id="DoubleEnd"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#DoubleEnd"><span class="hs-identifier hs-var">DoubleEnd</span></a></span></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-comment">-- | The queue has bounded capacity.</span><span>
</span><span id="line-109"></span><span class="hs-keyword">data</span><span> </span><span id="Bound"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Bound"><span class="hs-identifier hs-var">Bound</span></a></span></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- | The queue can grow as elements are added.</span><span>
</span><span id="line-111"></span><span class="hs-keyword">data</span><span> </span><span id="Grow"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Grow"><span class="hs-identifier hs-var">Grow</span></a></span></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- | The queue will not duplicate elements.</span><span>
</span><span id="line-114"></span><span class="hs-keyword">data</span><span> </span><span id="Safe"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Safe"><span class="hs-identifier hs-var">Safe</span></a></span></span><span>  </span><span>
</span><span id="line-115"></span><span class="hs-comment">-- | Pop operations may possibly duplicate elements.  Hopefully with low probability!</span><span>
</span><span id="line-116"></span><span class="hs-keyword">data</span><span> </span><span id="Dup"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Dup"><span class="hs-identifier hs-var">Dup</span></a></span></span><span>   </span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">-- Possible #5:</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- data Lossy -- I know of no algorithm which would motivate having a Lossy mode.</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-comment">----------------------------------------</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-keyword">type</span><span> </span><span id="T"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#T"><span class="hs-identifier hs-var">T</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Threadsafe"><span class="hs-identifier hs-type">Threadsafe</span></a></span><span>
</span><span id="line-124"></span><span class="hs-keyword">type</span><span> </span><span id="NT"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#NT"><span class="hs-identifier hs-var">NT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Nonthreadsafe"><span class="hs-identifier hs-type">Nonthreadsafe</span></a></span><span>
</span><span id="line-125"></span><span class="hs-keyword">type</span><span> </span><span id="S"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#S"><span class="hs-identifier hs-var">S</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#SingleEnd"><span class="hs-identifier hs-type">SingleEnd</span></a></span><span>
</span><span id="line-126"></span><span class="hs-keyword">type</span><span> </span><span id="D"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#D"><span class="hs-identifier hs-var">D</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#DoubleEnd"><span class="hs-identifier hs-type">DoubleEnd</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-comment">-- | A traditional single-threaded, single-ended queue.</span><span>
</span><span id="line-129"></span><span class="hs-keyword">type</span><span> </span><span id="Queue"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Queue"><span class="hs-identifier hs-var">Queue</span></a></span></span><span> </span><span id="local-6989586621679036026"><span class="annot"><a href="#local-6989586621679036026"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Deque"><span class="hs-identifier hs-type">Deque</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Nonthreadsafe"><span class="hs-identifier hs-type">Nonthreadsafe</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Nonthreadsafe"><span class="hs-identifier hs-type">Nonthreadsafe</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#SingleEnd"><span class="hs-identifier hs-type">SingleEnd</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#SingleEnd"><span class="hs-identifier hs-type">SingleEnd</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Grow"><span class="hs-identifier hs-type">Grow</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Safe"><span class="hs-identifier hs-type">Safe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036026"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-130"></span><span class="hs-comment">-- | A concurrent queue.</span><span>
</span><span id="line-131"></span><span class="hs-keyword">type</span><span> </span><span id="ConcQueue"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#ConcQueue"><span class="hs-identifier hs-var">ConcQueue</span></a></span></span><span> </span><span id="local-6989586621679036025"><span class="annot"><a href="#local-6989586621679036025"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Deque"><span class="hs-identifier hs-type">Deque</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Threadsafe"><span class="hs-identifier hs-type">Threadsafe</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Threadsafe"><span class="hs-identifier hs-type">Threadsafe</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#SingleEnd"><span class="hs-identifier hs-type">SingleEnd</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#SingleEnd"><span class="hs-identifier hs-type">SingleEnd</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Grow"><span class="hs-identifier hs-type">Grow</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Safe"><span class="hs-identifier hs-type">Safe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036025"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- | A concurrent deque.</span><span>
</span><span id="line-133"></span><span class="hs-keyword">type</span><span> </span><span id="ConcDeque"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#ConcDeque"><span class="hs-identifier hs-var">ConcDeque</span></a></span></span><span> </span><span id="local-6989586621679036024"><span class="annot"><a href="#local-6989586621679036024"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Deque"><span class="hs-identifier hs-type">Deque</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Threadsafe"><span class="hs-identifier hs-type">Threadsafe</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Threadsafe"><span class="hs-identifier hs-type">Threadsafe</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#DoubleEnd"><span class="hs-identifier hs-type">DoubleEnd</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#DoubleEnd"><span class="hs-identifier hs-type">DoubleEnd</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Grow"><span class="hs-identifier hs-type">Grow</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Safe"><span class="hs-identifier hs-type">Safe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036024"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-134"></span><span class="hs-comment">-- | Work-stealing deques (1.5 ended).  Typically the worker pushes</span><span>
</span><span id="line-135"></span><span class="hs-comment">--   and pops its own queue (left) whereas thieves only pop (right).</span><span>
</span><span id="line-136"></span><span class="hs-keyword">type</span><span> </span><span id="WSDeque"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#WSDeque"><span class="hs-identifier hs-var">WSDeque</span></a></span></span><span> </span><span id="local-6989586621679036023"><span class="annot"><a href="#local-6989586621679036023"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Deque"><span class="hs-identifier hs-type">Deque</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Nonthreadsafe"><span class="hs-identifier hs-type">Nonthreadsafe</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Threadsafe"><span class="hs-identifier hs-type">Threadsafe</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#DoubleEnd"><span class="hs-identifier hs-type">DoubleEnd</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#SingleEnd"><span class="hs-identifier hs-type">SingleEnd</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Grow"><span class="hs-identifier hs-type">Grow</span></a></span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#Safe"><span class="hs-identifier hs-type">Safe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036023"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-comment">-- | Class encompassing the basic queue operations that hold for all</span><span>
</span><span id="line-141"></span><span class="hs-comment">--   single, 1.5, and double ended modes.  We arbitrarily call the</span><span>
</span><span id="line-142"></span><span class="hs-comment">--   ends \&quot;left\&quot; and \&quot;right\&quot; and choose the natural operations to be</span><span>
</span><span id="line-143"></span><span class="hs-comment">--   pushing on the left and popping on the right.</span><span>
</span><span id="line-144"></span><span class="hs-keyword">class</span><span> </span><span id="DequeClass"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#DequeClass"><span class="hs-identifier hs-var">DequeClass</span></a></span></span><span> </span><span id="local-6989586621679036022"><span class="annot"><a href="#local-6989586621679036022"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-145"></span><span>   </span><span class="hs-comment">-- | Create a new deque.  Most appropriate for unbounded deques.</span><span>
</span><span id="line-146"></span><span>   </span><span class="hs-comment">--   If bounded, the size is unspecified.</span><span>
</span><span id="line-147"></span><span>   </span><span id="newQ"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#newQ"><span class="hs-identifier hs-type">newQ</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679036020"><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679036022"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036020"><span class="hs-identifier hs-type">elt</span></a></span><span class="hs-special">)</span></span><span class="hs-cpp">

#ifdef DEFAULT_SIGNATURES
</span><span class="hs-cpp">#warning &quot;Providing default binding and signature for newQ...&quot;
</span><span>   </span><span class="hs-keyword">default</span><span> </span><span class="hs-identifier">newQ</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">BoundedL</span><span> </span><span class="hs-identifier">d</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">d</span><span> </span><span class="hs-identifier">elt</span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>   </span><span class="hs-identifier">newQ</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newBoundedQ</span><span> </span><span class="hs-number">256</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-155"></span><span>   </span><span class="hs-comment">-- | Is the queue currently empty?  Beware that this can be a highly transient state.</span><span>
</span><span id="line-156"></span><span>   </span><span id="nullQ"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#nullQ"><span class="hs-identifier hs-type">nullQ</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679036018"><span class="annot"><a href="#local-6989586621679036022"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036018"><span class="hs-identifier hs-type">elt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>   </span><span class="hs-comment">-- | Natural push: push onto the left end of the deque.</span><span>
</span><span id="line-159"></span><span>   </span><span id="pushL"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#pushL"><span class="hs-identifier hs-type">pushL</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679036016"><span class="annot"><a href="#local-6989586621679036022"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036016"><span class="hs-identifier hs-type">elt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679036016"><span class="hs-identifier hs-type">elt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-160"></span><span>   </span><span class="hs-comment">-- | Natural pop: pop from the right end of the deque.</span><span>
</span><span id="line-161"></span><span>   </span><span id="tryPopR"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#tryPopR"><span class="hs-identifier hs-type">tryPopR</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679036014"><span class="annot"><a href="#local-6989586621679036022"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036014"><span class="hs-identifier hs-type">elt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679036014"><span class="hs-identifier hs-type">elt</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>   </span><span class="hs-comment">-- TODO: Consider adding a peek operation?</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>   </span><span class="hs-comment">-- TODO: It would also be possible to include blocking/spinning pops.</span><span>
</span><span id="line-166"></span><span>   </span><span class="hs-comment">-- But maybe those should go in separate type classes...</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span>   </span><span class="hs-comment">-- | Runtime indication of thread saftey for `pushL` (and `popL`).</span><span>
</span><span id="line-169"></span><span>   </span><span class="hs-comment">-- (Argument unused.)            </span><span>
</span><span id="line-170"></span><span>   </span><span id="leftThreadSafe"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#leftThreadSafe"><span class="hs-identifier hs-type">leftThreadSafe</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679036012"><span class="annot"><a href="#local-6989586621679036022"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036012"><span class="hs-identifier hs-type">elt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-171"></span><span>               </span><span>
</span><span id="line-172"></span><span>   </span><span class="hs-comment">-- | Runtime indication of thread saftey for `tryPopR` (and `pushR`).</span><span>
</span><span id="line-173"></span><span>   </span><span class="hs-comment">-- (Argument unused.) </span><span>
</span><span id="line-174"></span><span>   </span><span id="rightThreadSafe"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#rightThreadSafe"><span class="hs-identifier hs-type">rightThreadSafe</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679036010"><span class="annot"><a href="#local-6989586621679036022"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036010"><span class="hs-identifier hs-type">elt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#DequeClass"><span class="hs-identifier hs-type">DequeClass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036059"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="PopL"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#PopL"><span class="hs-identifier hs-var">PopL</span></a></span></span><span> </span><span id="local-6989586621679036059"><span class="annot"><a href="#local-6989586621679036059"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span class="hs-keyword">where</span><span> </span><span>
</span><span id="line-177"></span><span>   </span><span class="hs-comment">-- | PopL is not the native operation for the left end, so it requires</span><span>
</span><span id="line-178"></span><span>   </span><span class="hs-comment">--   that the left end be a 'DoubleEnd', but places no other requirements</span><span>
</span><span id="line-179"></span><span>   </span><span class="hs-comment">--   on the input queue.</span><span>
</span><span id="line-180"></span><span>   </span><span class="hs-comment">-- </span><span>
</span><span id="line-181"></span><span>   </span><span id="tryPopL"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#tryPopL"><span class="hs-identifier hs-type">tryPopL</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679036007"><span class="annot"><a href="#local-6989586621679036059"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036007"><span class="hs-identifier hs-type">elt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679036007"><span class="hs-identifier hs-type">elt</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#DequeClass"><span class="hs-identifier hs-type">DequeClass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036056"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="PushR"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#PushR"><span class="hs-identifier hs-var">PushR</span></a></span></span><span> </span><span id="local-6989586621679036056"><span class="annot"><a href="#local-6989586621679036056"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span class="hs-keyword">where</span><span> </span><span>
</span><span id="line-184"></span><span>   </span><span class="hs-comment">-- | Pushing is not the native operation for the right end, so it requires</span><span>
</span><span id="line-185"></span><span>   </span><span class="hs-comment">--   that end be a 'DoubleEnd'.</span><span>
</span><span id="line-186"></span><span>   </span><span id="pushR"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#pushR"><span class="hs-identifier hs-type">pushR</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679036004"><span class="annot"><a href="#local-6989586621679036056"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036004"><span class="hs-identifier hs-type">elt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679036004"><span class="hs-identifier hs-type">elt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#DequeClass"><span class="hs-identifier hs-type">DequeClass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036054"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="BoundedL"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#BoundedL"><span class="hs-identifier hs-var">BoundedL</span></a></span></span><span> </span><span id="local-6989586621679036054"><span class="annot"><a href="#local-6989586621679036054"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span class="hs-keyword">where</span><span> </span><span>
</span><span id="line-189"></span><span>   </span><span class="hs-comment">-- | Create a new, bounded deque with a specified capacity.</span><span>
</span><span id="line-190"></span><span>   </span><span id="newBoundedQ"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#newBoundedQ"><span class="hs-identifier hs-type">newBoundedQ</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679036001"><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679036054"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036001"><span class="hs-identifier hs-type">elt</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-191"></span><span>   </span><span class="hs-comment">-- | For a bounded deque, pushing may fail if the deque is full.</span><span>
</span><span id="line-192"></span><span>   </span><span id="tryPushL"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#tryPushL"><span class="hs-identifier hs-type">tryPushL</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679035999"><span class="annot"><a href="#local-6989586621679036054"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679035999"><span class="hs-identifier hs-type">elt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679035999"><span class="hs-identifier hs-type">elt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><a href="Data.Concurrent.Deque.Class.html#PushR"><span class="hs-identifier hs-type">PushR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679036052"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="BoundedR"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#BoundedR"><span class="hs-identifier hs-var">BoundedR</span></a></span></span><span> </span><span id="local-6989586621679036052"><span class="annot"><a href="#local-6989586621679036052"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span class="hs-keyword">where</span><span> </span><span>
</span><span id="line-195"></span><span>   </span><span class="hs-comment">-- | For a bounded deque, pushing may fail if the deque is full.</span><span>
</span><span id="line-196"></span><span>   </span><span id="tryPushR"><span class="annot"><a href="Data.Concurrent.Deque.Class.html#tryPushR"><span class="hs-identifier hs-type">tryPushR</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679035996"><span class="annot"><a href="#local-6989586621679036052"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679035996"><span class="hs-identifier hs-type">elt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679035996"><span class="hs-identifier hs-type">elt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span></pre></body></html>